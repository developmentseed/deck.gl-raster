const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-vtRboCKw.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-Cpiq9mOA.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();function v_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var cp={exports:{}},pl={};var tb;function yC(){if(tb)return pl;tb=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,r){var o=null;if(r!==void 0&&(o=""+r),s.key!==void 0&&(o=""+s.key),"key"in s){r={};for(var l in s)l!=="key"&&(r[l]=s[l])}else r=s;return s=r.ref,{$$typeof:i,type:n,key:o,ref:s!==void 0?s:null,props:r}}return pl.Fragment=t,pl.jsx=e,pl.jsxs=e,pl}var eb;function vC(){return eb||(eb=1,cp.exports=yC()),cp.exports}var Me=vC(),up={exports:{}},Ct={};var ib;function bC(){if(ib)return Ct;ib=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),_=Symbol.iterator;function v(I){return I===null||typeof I!="object"?null:(I=_&&I[_]||I["@@iterator"],typeof I=="function"?I:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function w(I,B,Z){this.props=I,this.context=B,this.refs=T,this.updater=Z||b}w.prototype.isReactComponent={},w.prototype.setState=function(I,B){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,B,"setState")},w.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function M(){}M.prototype=w.prototype;function E(I,B,Z){this.props=I,this.context=B,this.refs=T,this.updater=Z||b}var P=E.prototype=new M;P.constructor=E,x(P,w.prototype),P.isPureReactComponent=!0;var k=Array.isArray;function U(){}var Y={H:null,A:null,T:null,S:null},et=Object.prototype.hasOwnProperty;function K(I,B,Z){var at=Z.ref;return{$$typeof:i,type:I,key:B,ref:at!==void 0?at:null,props:Z}}function ut(I,B){return K(I.type,B,I.props)}function ht(I){return typeof I=="object"&&I!==null&&I.$$typeof===i}function _t(I){var B={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(Z){return B[Z]})}var St=/\/+/g;function pt(I,B){return typeof I=="object"&&I!==null&&I.key!=null?_t(""+I.key):B.toString(36)}function It(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(U,U):(I.status="pending",I.then(function(B){I.status==="pending"&&(I.status="fulfilled",I.value=B)},function(B){I.status==="pending"&&(I.status="rejected",I.reason=B)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function C(I,B,Z,at,ct){var mt=typeof I;(mt==="undefined"||mt==="boolean")&&(I=null);var xt=!1;if(I===null)xt=!0;else switch(mt){case"bigint":case"string":case"number":xt=!0;break;case"object":switch(I.$$typeof){case i:case t:xt=!0;break;case g:return xt=I._init,C(xt(I._payload),B,Z,at,ct)}}if(xt)return ct=ct(I),xt=at===""?"."+pt(I,0):at,k(ct)?(Z="",xt!=null&&(Z=xt.replace(St,"$&/")+"/"),C(ct,B,Z,"",function(kt){return kt})):ct!=null&&(ht(ct)&&(ct=ut(ct,Z+(ct.key==null||I&&I.key===ct.key?"":(""+ct.key).replace(St,"$&/")+"/")+xt)),B.push(ct)),1;xt=0;var Mt=at===""?".":at+":";if(k(I))for(var Ot=0;Ot<I.length;Ot++)at=I[Ot],mt=Mt+pt(at,Ot),xt+=C(at,B,Z,mt,ct);else if(Ot=v(I),typeof Ot=="function")for(I=Ot.call(I),Ot=0;!(at=I.next()).done;)at=at.value,mt=Mt+pt(at,Ot++),xt+=C(at,B,Z,mt,ct);else if(mt==="object"){if(typeof I.then=="function")return C(It(I),B,Z,at,ct);throw B=String(I),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return xt}function N(I,B,Z){if(I==null)return I;var at=[],ct=0;return C(I,at,"","",function(mt){return B.call(Z,mt,ct++)}),at}function D(I){if(I._status===-1){var B=I._result;B=B(),B.then(function(Z){(I._status===0||I._status===-1)&&(I._status=1,I._result=Z)},function(Z){(I._status===0||I._status===-1)&&(I._status=2,I._result=Z)}),I._status===-1&&(I._status=0,I._result=B)}if(I._status===1)return I._result.default;throw I._result}var Q=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},J={map:N,forEach:function(I,B,Z){N(I,function(){B.apply(this,arguments)},Z)},count:function(I){var B=0;return N(I,function(){B++}),B},toArray:function(I){return N(I,function(B){return B})||[]},only:function(I){if(!ht(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return Ct.Activity=p,Ct.Children=J,Ct.Component=w,Ct.Fragment=e,Ct.Profiler=s,Ct.PureComponent=E,Ct.StrictMode=n,Ct.Suspense=u,Ct.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Y,Ct.__COMPILER_RUNTIME={__proto__:null,c:function(I){return Y.H.useMemoCache(I)}},Ct.cache=function(I){return function(){return I.apply(null,arguments)}},Ct.cacheSignal=function(){return null},Ct.cloneElement=function(I,B,Z){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var at=x({},I.props),ct=I.key;if(B!=null)for(mt in B.key!==void 0&&(ct=""+B.key),B)!et.call(B,mt)||mt==="key"||mt==="__self"||mt==="__source"||mt==="ref"&&B.ref===void 0||(at[mt]=B[mt]);var mt=arguments.length-2;if(mt===1)at.children=Z;else if(1<mt){for(var xt=Array(mt),Mt=0;Mt<mt;Mt++)xt[Mt]=arguments[Mt+2];at.children=xt}return K(I.type,ct,at)},Ct.createContext=function(I){return I={$$typeof:o,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:r,_context:I},I},Ct.createElement=function(I,B,Z){var at,ct={},mt=null;if(B!=null)for(at in B.key!==void 0&&(mt=""+B.key),B)et.call(B,at)&&at!=="key"&&at!=="__self"&&at!=="__source"&&(ct[at]=B[at]);var xt=arguments.length-2;if(xt===1)ct.children=Z;else if(1<xt){for(var Mt=Array(xt),Ot=0;Ot<xt;Ot++)Mt[Ot]=arguments[Ot+2];ct.children=Mt}if(I&&I.defaultProps)for(at in xt=I.defaultProps,xt)ct[at]===void 0&&(ct[at]=xt[at]);return K(I,mt,ct)},Ct.createRef=function(){return{current:null}},Ct.forwardRef=function(I){return{$$typeof:l,render:I}},Ct.isValidElement=ht,Ct.lazy=function(I){return{$$typeof:g,_payload:{_status:-1,_result:I},_init:D}},Ct.memo=function(I,B){return{$$typeof:f,type:I,compare:B===void 0?null:B}},Ct.startTransition=function(I){var B=Y.T,Z={};Y.T=Z;try{var at=I(),ct=Y.S;ct!==null&&ct(Z,at),typeof at=="object"&&at!==null&&typeof at.then=="function"&&at.then(U,Q)}catch(mt){Q(mt)}finally{B!==null&&Z.types!==null&&(B.types=Z.types),Y.T=B}},Ct.unstable_useCacheRefresh=function(){return Y.H.useCacheRefresh()},Ct.use=function(I){return Y.H.use(I)},Ct.useActionState=function(I,B,Z){return Y.H.useActionState(I,B,Z)},Ct.useCallback=function(I,B){return Y.H.useCallback(I,B)},Ct.useContext=function(I){return Y.H.useContext(I)},Ct.useDebugValue=function(){},Ct.useDeferredValue=function(I,B){return Y.H.useDeferredValue(I,B)},Ct.useEffect=function(I,B){return Y.H.useEffect(I,B)},Ct.useEffectEvent=function(I){return Y.H.useEffectEvent(I)},Ct.useId=function(){return Y.H.useId()},Ct.useImperativeHandle=function(I,B,Z){return Y.H.useImperativeHandle(I,B,Z)},Ct.useInsertionEffect=function(I,B){return Y.H.useInsertionEffect(I,B)},Ct.useLayoutEffect=function(I,B){return Y.H.useLayoutEffect(I,B)},Ct.useMemo=function(I,B){return Y.H.useMemo(I,B)},Ct.useOptimistic=function(I,B){return Y.H.useOptimistic(I,B)},Ct.useReducer=function(I,B,Z){return Y.H.useReducer(I,B,Z)},Ct.useRef=function(I){return Y.H.useRef(I)},Ct.useState=function(I){return Y.H.useState(I)},Ct.useSyncExternalStore=function(I,B,Z){return Y.H.useSyncExternalStore(I,B,Z)},Ct.useTransition=function(){return Y.H.useTransition()},Ct.version="19.2.4",Ct}var nb;function b_(){return nb||(nb=1,up.exports=bC()),up.exports}var bt=b_(),hp={exports:{}},_l={},fp={exports:{}},dp={};var sb;function xC(){return sb||(sb=1,(function(i){function t(C,N){var D=C.length;C.push(N);t:for(;0<D;){var Q=D-1>>>1,J=C[Q];if(0<s(J,N))C[Q]=N,C[D]=J,D=Q;else break t}}function e(C){return C.length===0?null:C[0]}function n(C){if(C.length===0)return null;var N=C[0],D=C.pop();if(D!==N){C[0]=D;t:for(var Q=0,J=C.length,I=J>>>1;Q<I;){var B=2*(Q+1)-1,Z=C[B],at=B+1,ct=C[at];if(0>s(Z,D))at<J&&0>s(ct,Z)?(C[Q]=ct,C[at]=D,Q=at):(C[Q]=Z,C[B]=D,Q=B);else if(at<J&&0>s(ct,D))C[Q]=ct,C[at]=D,Q=at;else break t}}return N}function s(C,N){var D=C.sortIndex-N.sortIndex;return D!==0?D:C.id-N.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();i.unstable_now=function(){return o.now()-l}}var u=[],f=[],g=1,p=null,_=3,v=!1,b=!1,x=!1,T=!1,w=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function P(C){for(var N=e(f);N!==null;){if(N.callback===null)n(f);else if(N.startTime<=C)n(f),N.sortIndex=N.expirationTime,t(u,N);else break;N=e(f)}}function k(C){if(x=!1,P(C),!b)if(e(u)!==null)b=!0,U||(U=!0,_t());else{var N=e(f);N!==null&&It(k,N.startTime-C)}}var U=!1,Y=-1,et=5,K=-1;function ut(){return T?!0:!(i.unstable_now()-K<et)}function ht(){if(T=!1,U){var C=i.unstable_now();K=C;var N=!0;try{t:{b=!1,x&&(x=!1,M(Y),Y=-1),v=!0;var D=_;try{e:{for(P(C),p=e(u);p!==null&&!(p.expirationTime>C&&ut());){var Q=p.callback;if(typeof Q=="function"){p.callback=null,_=p.priorityLevel;var J=Q(p.expirationTime<=C);if(C=i.unstable_now(),typeof J=="function"){p.callback=J,P(C),N=!0;break e}p===e(u)&&n(u),P(C)}else n(u);p=e(u)}if(p!==null)N=!0;else{var I=e(f);I!==null&&It(k,I.startTime-C),N=!1}}break t}finally{p=null,_=D,v=!1}N=void 0}}finally{N?_t():U=!1}}}var _t;if(typeof E=="function")_t=function(){E(ht)};else if(typeof MessageChannel<"u"){var St=new MessageChannel,pt=St.port2;St.port1.onmessage=ht,_t=function(){pt.postMessage(null)}}else _t=function(){w(ht,0)};function It(C,N){Y=w(function(){C(i.unstable_now())},N)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(C){C.callback=null},i.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):et=0<C?Math.floor(1e3/C):5},i.unstable_getCurrentPriorityLevel=function(){return _},i.unstable_next=function(C){switch(_){case 1:case 2:case 3:var N=3;break;default:N=_}var D=_;_=N;try{return C()}finally{_=D}},i.unstable_requestPaint=function(){T=!0},i.unstable_runWithPriority=function(C,N){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var D=_;_=C;try{return N()}finally{_=D}},i.unstable_scheduleCallback=function(C,N,D){var Q=i.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?Q+D:Q):D=Q,C){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=D+J,C={id:g++,callback:N,priorityLevel:C,startTime:D,expirationTime:J,sortIndex:-1},D>Q?(C.sortIndex=D,t(f,C),e(u)===null&&C===e(f)&&(x?(M(Y),Y=-1):x=!0,It(k,D-Q))):(C.sortIndex=J,t(u,C),b||v||(b=!0,U||(U=!0,_t()))),C},i.unstable_shouldYield=ut,i.unstable_wrapCallback=function(C){var N=_;return function(){var D=_;_=N;try{return C.apply(this,arguments)}finally{_=D}}}})(dp)),dp}var rb;function SC(){return rb||(rb=1,fp.exports=xC()),fp.exports}var gp={exports:{}},We={};var ab;function TC(){if(ab)return We;ab=1;var i=b_();function t(u){var f="https://react.dev/errors/"+u;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+u+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(u,f,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:p==null?null:""+p,children:u,containerInfo:f,implementation:g}}var o=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,f){if(u==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return We.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,We.createPortal=function(u,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return r(u,f,null,g)},We.flushSync=function(u){var f=o.T,g=n.p;try{if(o.T=null,n.p=2,u)return u()}finally{o.T=f,n.p=g,n.d.f()}},We.preconnect=function(u,f){typeof u=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(u,f))},We.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},We.preinit=function(u,f){if(typeof u=="string"&&f&&typeof f.as=="string"){var g=f.as,p=l(g,f.crossOrigin),_=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?n.d.S(u,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:p,integrity:_,fetchPriority:v}):g==="script"&&n.d.X(u,{crossOrigin:p,integrity:_,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},We.preinitModule=function(u,f){if(typeof u=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=l(f.as,f.crossOrigin);n.d.M(u,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(u)},We.preload=function(u,f){if(typeof u=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,p=l(g,f.crossOrigin);n.d.L(u,g,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},We.preloadModule=function(u,f){if(typeof u=="string")if(f){var g=l(f.as,f.crossOrigin);n.d.m(u,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(u)},We.requestFormReset=function(u){n.d.r(u)},We.unstable_batchedUpdates=function(u,f){return u(f)},We.useFormState=function(u,f,g){return o.H.useFormState(u,f,g)},We.useFormStatus=function(){return o.H.useHostTransitionStatus()},We.version="19.2.4",We}var ob;function rT(){if(ob)return gp.exports;ob=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),gp.exports=TC(),gp.exports}var lb;function wC(){if(lb)return _l;lb=1;var i=SC(),t=b_(),e=rT();function n(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var c=a,h=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(h=c.return),a=c.return;while(a)}return c.tag===3?h:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(a.tag===31){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function u(a){if(r(a)!==a)throw Error(n(188))}function f(a){var c=a.alternate;if(!c){if(c=r(a),c===null)throw Error(n(188));return c!==a?null:a}for(var h=a,d=c;;){var m=h.return;if(m===null)break;var y=m.alternate;if(y===null){if(d=m.return,d!==null){h=d;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===h)return u(m),a;if(y===d)return u(m),c;y=y.sibling}throw Error(n(188))}if(h.return!==d.return)h=m,d=y;else{for(var S=!1,A=m.child;A;){if(A===h){S=!0,h=m,d=y;break}if(A===d){S=!0,d=m,h=y;break}A=A.sibling}if(!S){for(A=y.child;A;){if(A===h){S=!0,h=y,d=m;break}if(A===d){S=!0,d=y,h=m;break}A=A.sibling}if(!S)throw Error(n(189))}}if(h.alternate!==d)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?a:c}function g(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=g(a),c!==null)return c;a=a.sibling}return null}var p=Object.assign,_=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),E=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),et=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),ut=Symbol.for("react.memo_cache_sentinel"),ht=Symbol.iterator;function _t(a){return a===null||typeof a!="object"?null:(a=ht&&a[ht]||a["@@iterator"],typeof a=="function"?a:null)}var St=Symbol.for("react.client.reference");function pt(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===St?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case x:return"Fragment";case w:return"Profiler";case T:return"StrictMode";case k:return"Suspense";case U:return"SuspenseList";case K:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case b:return"Portal";case E:return a.displayName||"Context";case M:return(a._context.displayName||"Context")+".Consumer";case P:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Y:return c=a.displayName||null,c!==null?c:pt(a.type)||"Memo";case et:c=a._payload,a=a._init;try{return pt(a(c))}catch{}}return null}var It=Array.isArray,C=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D={pending:!1,data:null,method:null,action:null},Q=[],J=-1;function I(a){return{current:a}}function B(a){0>J||(a.current=Q[J],Q[J]=null,J--)}function Z(a,c){J++,Q[J]=a.current,a.current=c}var at=I(null),ct=I(null),mt=I(null),xt=I(null);function Mt(a,c){switch(Z(mt,c),Z(ct,a),Z(at,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?Tv(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=Tv(c),a=wv(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}B(at),Z(at,a)}function Ot(){B(at),B(ct),B(mt)}function kt(a){a.memoizedState!==null&&Z(xt,a);var c=at.current,h=wv(c,a.type);c!==h&&(Z(ct,a),Z(at,h))}function an(a){ct.current===a&&(B(at),B(ct)),xt.current===a&&(B(xt),hl._currentValue=D)}var Cn,So;function on(a){if(Cn===void 0)try{throw Error()}catch(h){var c=h.stack.trim().match(/\n( *(at )?)/);Cn=c&&c[1]||"",So=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Cn+a+So}var Ht=!1;function $t(a,c){if(!a||Ht)return"";Ht=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(c){var rt=function(){throw Error()};if(Object.defineProperty(rt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(rt,[])}catch(tt){var X=tt}Reflect.construct(a,[],rt)}else{try{rt.call()}catch(tt){X=tt}a.call(rt.prototype)}}else{try{throw Error()}catch(tt){X=tt}(rt=a())&&typeof rt.catch=="function"&&rt.catch(function(){})}}catch(tt){if(tt&&X&&typeof tt.stack=="string")return[tt.stack,X.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),S=y[0],A=y[1];if(S&&A){var L=S.split(`
`),q=A.split(`
`);for(m=d=0;d<L.length&&!L[d].includes("DetermineComponentFrameRoot");)d++;for(;m<q.length&&!q[m].includes("DetermineComponentFrameRoot");)m++;if(d===L.length||m===q.length)for(d=L.length-1,m=q.length-1;1<=d&&0<=m&&L[d]!==q[m];)m--;for(;1<=d&&0<=m;d--,m--)if(L[d]!==q[m]){if(d!==1||m!==1)do if(d--,m--,0>m||L[d]!==q[m]){var it=`
`+L[d].replace(" at new "," at ");return a.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",a.displayName)),it}while(1<=d&&0<=m);break}}}finally{Ht=!1,Error.prepareStackTrace=h}return(h=a?a.displayName||a.name:"")?on(h):""}function YA(a,c){switch(a.tag){case 26:case 27:case 5:return on(a.type);case 16:return on("Lazy");case 13:return a.child!==c&&c!==null?on("Suspense Fallback"):on("Suspense");case 19:return on("SuspenseList");case 0:case 15:return $t(a.type,!1);case 11:return $t(a.type.render,!1);case 1:return $t(a.type,!0);case 31:return on("Activity");default:return""}}function ty(a){try{var c="",h=null;do c+=YA(a,h),h=a,a=a.return;while(a);return c}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Xf=Object.prototype.hasOwnProperty,Yf=i.unstable_scheduleCallback,Kf=i.unstable_cancelCallback,KA=i.unstable_shouldYield,ZA=i.unstable_requestPaint,pi=i.unstable_now,QA=i.unstable_getCurrentPriorityLevel,ey=i.unstable_ImmediatePriority,iy=i.unstable_UserBlockingPriority,Rc=i.unstable_NormalPriority,JA=i.unstable_LowPriority,ny=i.unstable_IdlePriority,t4=i.log,e4=i.unstable_setDisableYieldValue,To=null,_i=null;function ls(a){if(typeof t4=="function"&&e4(a),_i&&typeof _i.setStrictMode=="function")try{_i.setStrictMode(To,a)}catch{}}var mi=Math.clz32?Math.clz32:s4,i4=Math.log,n4=Math.LN2;function s4(a){return a>>>=0,a===0?32:31-(i4(a)/n4|0)|0}var Pc=256,Ic=262144,Oc=4194304;function er(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Nc(a,c,h){var d=a.pendingLanes;if(d===0)return 0;var m=0,y=a.suspendedLanes,S=a.pingedLanes;a=a.warmLanes;var A=d&134217727;return A!==0?(d=A&~y,d!==0?m=er(d):(S&=A,S!==0?m=er(S):h||(h=A&~a,h!==0&&(m=er(h))))):(A=d&~y,A!==0?m=er(A):S!==0?m=er(S):h||(h=d&~a,h!==0&&(m=er(h)))),m===0?0:c!==0&&c!==m&&(c&y)===0&&(y=m&-m,h=c&-c,y>=h||y===32&&(h&4194048)!==0)?c:m}function wo(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function r4(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sy(){var a=Oc;return Oc<<=1,(Oc&62914560)===0&&(Oc=4194304),a}function Zf(a){for(var c=[],h=0;31>h;h++)c.push(a);return c}function Eo(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function a4(a,c,h,d,m,y){var S=a.pendingLanes;a.pendingLanes=h,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=h,a.entangledLanes&=h,a.errorRecoveryDisabledLanes&=h,a.shellSuspendCounter=0;var A=a.entanglements,L=a.expirationTimes,q=a.hiddenUpdates;for(h=S&~h;0<h;){var it=31-mi(h),rt=1<<it;A[it]=0,L[it]=-1;var X=q[it];if(X!==null)for(q[it]=null,it=0;it<X.length;it++){var tt=X[it];tt!==null&&(tt.lane&=-536870913)}h&=~rt}d!==0&&ry(a,d,0),y!==0&&m===0&&a.tag!==0&&(a.suspendedLanes|=y&~(S&~c))}function ry(a,c,h){a.pendingLanes|=c,a.suspendedLanes&=~c;var d=31-mi(c);a.entangledLanes|=c,a.entanglements[d]=a.entanglements[d]|1073741824|h&261930}function ay(a,c){var h=a.entangledLanes|=c;for(a=a.entanglements;h;){var d=31-mi(h),m=1<<d;m&c|a[d]&c&&(a[d]|=c),h&=~m}}function oy(a,c){var h=c&-c;return h=(h&42)!==0?1:Qf(h),(h&(a.suspendedLanes|c))!==0?0:h}function Qf(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Jf(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ly(){var a=N.p;return a!==0?a:(a=window.event,a===void 0?32:qv(a.type))}function cy(a,c){var h=N.p;try{return N.p=a,c()}finally{N.p=h}}var cs=Math.random().toString(36).slice(2),Be="__reactFiber$"+cs,ni="__reactProps$"+cs,$r="__reactContainer$"+cs,td="__reactEvents$"+cs,o4="__reactListeners$"+cs,l4="__reactHandles$"+cs,uy="__reactResources$"+cs,Ao="__reactMarker$"+cs;function ed(a){delete a[Be],delete a[ni],delete a[td],delete a[o4],delete a[l4]}function Gr(a){var c=a[Be];if(c)return c;for(var h=a.parentNode;h;){if(c=h[$r]||h[Be]){if(h=c.alternate,c.child!==null||h!==null&&h.child!==null)for(a=Iv(a);a!==null;){if(h=a[Be])return h;a=Iv(a)}return c}a=h,h=a.parentNode}return null}function Wr(a){if(a=a[Be]||a[$r]){var c=a.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return a}return null}function Mo(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(n(33))}function qr(a){var c=a[uy];return c||(c=a[uy]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function De(a){a[Ao]=!0}var hy=new Set,fy={};function ir(a,c){Xr(a,c),Xr(a+"Capture",c)}function Xr(a,c){for(fy[a]=c,a=0;a<c.length;a++)hy.add(c[a])}var c4=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dy={},gy={};function u4(a){return Xf.call(gy,a)?!0:Xf.call(dy,a)?!1:c4.test(a)?gy[a]=!0:(dy[a]=!0,!1)}function Dc(a,c,h){if(u4(c))if(h===null)a.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var d=c.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+h)}}function Lc(a,c,h){if(h===null)a.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+h)}}function Rn(a,c,h,d){if(d===null)a.removeAttribute(h);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttributeNS(c,h,""+d)}}function Pi(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function py(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function h4(a,c,h){var d=Object.getOwnPropertyDescriptor(a.constructor.prototype,c);if(!a.hasOwnProperty(c)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var m=d.get,y=d.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return m.call(this)},set:function(S){h=""+S,y.call(this,S)}}),Object.defineProperty(a,c,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(S){h=""+S},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function id(a){if(!a._valueTracker){var c=py(a)?"checked":"value";a._valueTracker=h4(a,c,""+a[c])}}function _y(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var h=c.getValue(),d="";return a&&(d=py(a)?a.checked?"true":"false":a.value),a=d,a!==h?(c.setValue(a),!0):!1}function kc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var f4=/[\n"\\]/g;function Ii(a){return a.replace(f4,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function nd(a,c,h,d,m,y,S,A){a.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?a.type=S:a.removeAttribute("type"),c!=null?S==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Pi(c)):a.value!==""+Pi(c)&&(a.value=""+Pi(c)):S!=="submit"&&S!=="reset"||a.removeAttribute("value"),c!=null?sd(a,S,Pi(c)):h!=null?sd(a,S,Pi(h)):d!=null&&a.removeAttribute("value"),m==null&&y!=null&&(a.defaultChecked=!!y),m!=null&&(a.checked=m&&typeof m!="function"&&typeof m!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?a.name=""+Pi(A):a.removeAttribute("name")}function my(a,c,h,d,m,y,S,A){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(a.type=y),c!=null||h!=null){if(!(y!=="submit"&&y!=="reset"||c!=null)){id(a);return}h=h!=null?""+Pi(h):"",c=c!=null?""+Pi(c):h,A||c===a.value||(a.value=c),a.defaultValue=c}d=d??m,d=typeof d!="function"&&typeof d!="symbol"&&!!d,a.checked=A?a.checked:!!d,a.defaultChecked=!!d,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(a.name=S),id(a)}function sd(a,c,h){c==="number"&&kc(a.ownerDocument)===a||a.defaultValue===""+h||(a.defaultValue=""+h)}function Yr(a,c,h,d){if(a=a.options,c){c={};for(var m=0;m<h.length;m++)c["$"+h[m]]=!0;for(h=0;h<a.length;h++)m=c.hasOwnProperty("$"+a[h].value),a[h].selected!==m&&(a[h].selected=m),m&&d&&(a[h].defaultSelected=!0)}else{for(h=""+Pi(h),c=null,m=0;m<a.length;m++){if(a[m].value===h){a[m].selected=!0,d&&(a[m].defaultSelected=!0);return}c!==null||a[m].disabled||(c=a[m])}c!==null&&(c.selected=!0)}}function yy(a,c,h){if(c!=null&&(c=""+Pi(c),c!==a.value&&(a.value=c),h==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=h!=null?""+Pi(h):""}function vy(a,c,h,d){if(c==null){if(d!=null){if(h!=null)throw Error(n(92));if(It(d)){if(1<d.length)throw Error(n(93));d=d[0]}h=d}h==null&&(h=""),c=h}h=Pi(c),a.defaultValue=h,d=a.textContent,d===h&&d!==""&&d!==null&&(a.value=d),id(a)}function Kr(a,c){if(c){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=c;return}}a.textContent=c}var d4=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function by(a,c,h){var d=c.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?d?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":d?a.setProperty(c,h):typeof h!="number"||h===0||d4.has(c)?c==="float"?a.cssFloat=h:a[c]=(""+h).trim():a[c]=h+"px"}function xy(a,c,h){if(c!=null&&typeof c!="object")throw Error(n(62));if(a=a.style,h!=null){for(var d in h)!h.hasOwnProperty(d)||c!=null&&c.hasOwnProperty(d)||(d.indexOf("--")===0?a.setProperty(d,""):d==="float"?a.cssFloat="":a[d]="");for(var m in c)d=c[m],c.hasOwnProperty(m)&&h[m]!==d&&by(a,m,d)}else for(var y in c)c.hasOwnProperty(y)&&by(a,y,c[y])}function rd(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var g4=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),p4=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Bc(a){return p4.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Pn(){}var ad=null;function od(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Zr=null,Qr=null;function Sy(a){var c=Wr(a);if(c&&(a=c.stateNode)){var h=a[ni]||null;t:switch(a=c.stateNode,c.type){case"input":if(nd(a,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),c=h.name,h.type==="radio"&&c!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Ii(""+c)+'"][type="radio"]'),c=0;c<h.length;c++){var d=h[c];if(d!==a&&d.form===a.form){var m=d[ni]||null;if(!m)throw Error(n(90));nd(d,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(c=0;c<h.length;c++)d=h[c],d.form===a.form&&_y(d)}break t;case"textarea":yy(a,h.value,h.defaultValue);break t;case"select":c=h.value,c!=null&&Yr(a,!!h.multiple,c,!1)}}}var ld=!1;function Ty(a,c,h){if(ld)return a(c,h);ld=!0;try{var d=a(c);return d}finally{if(ld=!1,(Zr!==null||Qr!==null)&&(wu(),Zr&&(c=Zr,a=Qr,Qr=Zr=null,Sy(c),a)))for(c=0;c<a.length;c++)Sy(a[c])}}function Co(a,c){var h=a.stateNode;if(h===null)return null;var d=h[ni]||null;if(d===null)return null;h=d[c];t:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(a=a.type,d=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!d;break t;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(n(231,c,typeof h));return h}var In=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cd=!1;if(In)try{var Ro={};Object.defineProperty(Ro,"passive",{get:function(){cd=!0}}),window.addEventListener("test",Ro,Ro),window.removeEventListener("test",Ro,Ro)}catch{cd=!1}var us=null,ud=null,Uc=null;function wy(){if(Uc)return Uc;var a,c=ud,h=c.length,d,m="value"in us?us.value:us.textContent,y=m.length;for(a=0;a<h&&c[a]===m[a];a++);var S=h-a;for(d=1;d<=S&&c[h-d]===m[y-d];d++);return Uc=m.slice(a,1<d?1-d:void 0)}function Fc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function zc(){return!0}function Ey(){return!1}function si(a){function c(h,d,m,y,S){this._reactName=h,this._targetInst=m,this.type=d,this.nativeEvent=y,this.target=S,this.currentTarget=null;for(var A in a)a.hasOwnProperty(A)&&(h=a[A],this[A]=h?h(y):y[A]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?zc:Ey,this.isPropagationStopped=Ey,this}return p(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=zc)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=zc)},persist:function(){},isPersistent:zc}),c}var nr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vc=si(nr),Po=p({},nr,{view:0,detail:0}),_4=si(Po),hd,fd,Io,jc=p({},Po,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Io&&(Io&&a.type==="mousemove"?(hd=a.screenX-Io.screenX,fd=a.screenY-Io.screenY):fd=hd=0,Io=a),hd)},movementY:function(a){return"movementY"in a?a.movementY:fd}}),Ay=si(jc),m4=p({},jc,{dataTransfer:0}),y4=si(m4),v4=p({},Po,{relatedTarget:0}),dd=si(v4),b4=p({},nr,{animationName:0,elapsedTime:0,pseudoElement:0}),x4=si(b4),S4=p({},nr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),T4=si(S4),w4=p({},nr,{data:0}),My=si(w4),E4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},M4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function C4(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=M4[a])?!!c[a]:!1}function gd(){return C4}var R4=p({},Po,{key:function(a){if(a.key){var c=E4[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Fc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?A4[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gd,charCode:function(a){return a.type==="keypress"?Fc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Fc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),P4=si(R4),I4=p({},jc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cy=si(I4),O4=p({},Po,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gd}),N4=si(O4),D4=p({},nr,{propertyName:0,elapsedTime:0,pseudoElement:0}),L4=si(D4),k4=p({},jc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),B4=si(k4),U4=p({},nr,{newState:0,oldState:0}),F4=si(U4),z4=[9,13,27,32],pd=In&&"CompositionEvent"in window,Oo=null;In&&"documentMode"in document&&(Oo=document.documentMode);var V4=In&&"TextEvent"in window&&!Oo,Ry=In&&(!pd||Oo&&8<Oo&&11>=Oo),Py=" ",Iy=!1;function Oy(a,c){switch(a){case"keyup":return z4.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ny(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Jr=!1;function j4(a,c){switch(a){case"compositionend":return Ny(c);case"keypress":return c.which!==32?null:(Iy=!0,Py);case"textInput":return a=c.data,a===Py&&Iy?null:a;default:return null}}function H4(a,c){if(Jr)return a==="compositionend"||!pd&&Oy(a,c)?(a=wy(),Uc=ud=us=null,Jr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Ry&&c.locale!=="ko"?null:c.data;default:return null}}var $4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dy(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!$4[a.type]:c==="textarea"}function Ly(a,c,h,d){Zr?Qr?Qr.push(d):Qr=[d]:Zr=d,c=Iu(c,"onChange"),0<c.length&&(h=new Vc("onChange","change",null,h,d),a.push({event:h,listeners:c}))}var No=null,Do=null;function G4(a){mv(a,0)}function Hc(a){var c=Mo(a);if(_y(c))return a}function ky(a,c){if(a==="change")return c}var By=!1;if(In){var _d;if(In){var md="oninput"in document;if(!md){var Uy=document.createElement("div");Uy.setAttribute("oninput","return;"),md=typeof Uy.oninput=="function"}_d=md}else _d=!1;By=_d&&(!document.documentMode||9<document.documentMode)}function Fy(){No&&(No.detachEvent("onpropertychange",zy),Do=No=null)}function zy(a){if(a.propertyName==="value"&&Hc(Do)){var c=[];Ly(c,Do,a,od(a)),Ty(G4,c)}}function W4(a,c,h){a==="focusin"?(Fy(),No=c,Do=h,No.attachEvent("onpropertychange",zy)):a==="focusout"&&Fy()}function q4(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Hc(Do)}function X4(a,c){if(a==="click")return Hc(c)}function Y4(a,c){if(a==="input"||a==="change")return Hc(c)}function K4(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var yi=typeof Object.is=="function"?Object.is:K4;function Lo(a,c){if(yi(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var h=Object.keys(a),d=Object.keys(c);if(h.length!==d.length)return!1;for(d=0;d<h.length;d++){var m=h[d];if(!Xf.call(c,m)||!yi(a[m],c[m]))return!1}return!0}function Vy(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function jy(a,c){var h=Vy(a);a=0;for(var d;h;){if(h.nodeType===3){if(d=a+h.textContent.length,a<=c&&d>=c)return{node:h,offset:c-a};a=d}t:{for(;h;){if(h.nextSibling){h=h.nextSibling;break t}h=h.parentNode}h=void 0}h=Vy(h)}}function Hy(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?Hy(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function $y(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=kc(a.document);c instanceof a.HTMLIFrameElement;){try{var h=typeof c.contentWindow.location.href=="string"}catch{h=!1}if(h)a=c.contentWindow;else break;c=kc(a.document)}return c}function yd(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var Z4=In&&"documentMode"in document&&11>=document.documentMode,ta=null,vd=null,ko=null,bd=!1;function Gy(a,c,h){var d=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;bd||ta==null||ta!==kc(d)||(d=ta,"selectionStart"in d&&yd(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ko&&Lo(ko,d)||(ko=d,d=Iu(vd,"onSelect"),0<d.length&&(c=new Vc("onSelect","select",null,c,h),a.push({event:c,listeners:d}),c.target=ta)))}function sr(a,c){var h={};return h[a.toLowerCase()]=c.toLowerCase(),h["Webkit"+a]="webkit"+c,h["Moz"+a]="moz"+c,h}var ea={animationend:sr("Animation","AnimationEnd"),animationiteration:sr("Animation","AnimationIteration"),animationstart:sr("Animation","AnimationStart"),transitionrun:sr("Transition","TransitionRun"),transitionstart:sr("Transition","TransitionStart"),transitioncancel:sr("Transition","TransitionCancel"),transitionend:sr("Transition","TransitionEnd")},xd={},Wy={};In&&(Wy=document.createElement("div").style,"AnimationEvent"in window||(delete ea.animationend.animation,delete ea.animationiteration.animation,delete ea.animationstart.animation),"TransitionEvent"in window||delete ea.transitionend.transition);function rr(a){if(xd[a])return xd[a];if(!ea[a])return a;var c=ea[a],h;for(h in c)if(c.hasOwnProperty(h)&&h in Wy)return xd[a]=c[h];return a}var qy=rr("animationend"),Xy=rr("animationiteration"),Yy=rr("animationstart"),Q4=rr("transitionrun"),J4=rr("transitionstart"),tM=rr("transitioncancel"),Ky=rr("transitionend"),Zy=new Map,Sd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Sd.push("scrollEnd");function qi(a,c){Zy.set(a,c),ir(c,[a])}var $c=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Oi=[],ia=0,Td=0;function Gc(){for(var a=ia,c=Td=ia=0;c<a;){var h=Oi[c];Oi[c++]=null;var d=Oi[c];Oi[c++]=null;var m=Oi[c];Oi[c++]=null;var y=Oi[c];if(Oi[c++]=null,d!==null&&m!==null){var S=d.pending;S===null?m.next=m:(m.next=S.next,S.next=m),d.pending=m}y!==0&&Qy(h,m,y)}}function Wc(a,c,h,d){Oi[ia++]=a,Oi[ia++]=c,Oi[ia++]=h,Oi[ia++]=d,Td|=d,a.lanes|=d,a=a.alternate,a!==null&&(a.lanes|=d)}function wd(a,c,h,d){return Wc(a,c,h,d),qc(a)}function ar(a,c){return Wc(a,null,null,c),qc(a)}function Qy(a,c,h){a.lanes|=h;var d=a.alternate;d!==null&&(d.lanes|=h);for(var m=!1,y=a.return;y!==null;)y.childLanes|=h,d=y.alternate,d!==null&&(d.childLanes|=h),y.tag===22&&(a=y.stateNode,a===null||a._visibility&1||(m=!0)),a=y,y=y.return;return a.tag===3?(y=a.stateNode,m&&c!==null&&(m=31-mi(h),a=y.hiddenUpdates,d=a[m],d===null?a[m]=[c]:d.push(c),c.lane=h|536870912),y):null}function qc(a){if(50<sl)throw sl=0,Ng=null,Error(n(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var na={};function eM(a,c,h,d){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(a,c,h,d){return new eM(a,c,h,d)}function Ed(a){return a=a.prototype,!(!a||!a.isReactComponent)}function On(a,c){var h=a.alternate;return h===null?(h=vi(a.tag,c,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=c,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&65011712,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,c=a.dependencies,h.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h.refCleanup=a.refCleanup,h}function Jy(a,c){a.flags&=65011714;var h=a.alternate;return h===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,c=h.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function Xc(a,c,h,d,m,y){var S=0;if(d=a,typeof a=="function")Ed(a)&&(S=1);else if(typeof a=="string")S=aC(a,h,at.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case K:return a=vi(31,h,c,m),a.elementType=K,a.lanes=y,a;case x:return or(h.children,m,y,c);case T:S=8,m|=24;break;case w:return a=vi(12,h,c,m|2),a.elementType=w,a.lanes=y,a;case k:return a=vi(13,h,c,m),a.elementType=k,a.lanes=y,a;case U:return a=vi(19,h,c,m),a.elementType=U,a.lanes=y,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case E:S=10;break t;case M:S=9;break t;case P:S=11;break t;case Y:S=14;break t;case et:S=16,d=null;break t}S=29,h=Error(n(130,a===null?"null":typeof a,"")),d=null}return c=vi(S,h,c,m),c.elementType=a,c.type=d,c.lanes=y,c}function or(a,c,h,d){return a=vi(7,a,d,c),a.lanes=h,a}function Ad(a,c,h){return a=vi(6,a,null,c),a.lanes=h,a}function t1(a){var c=vi(18,null,null,0);return c.stateNode=a,c}function Md(a,c,h){return c=vi(4,a.children!==null?a.children:[],a.key,c),c.lanes=h,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var e1=new WeakMap;function Ni(a,c){if(typeof a=="object"&&a!==null){var h=e1.get(a);return h!==void 0?h:(c={value:a,source:c,stack:ty(c)},e1.set(a,c),c)}return{value:a,source:c,stack:ty(c)}}var sa=[],ra=0,Yc=null,Bo=0,Di=[],Li=0,hs=null,ln=1,cn="";function Nn(a,c){sa[ra++]=Bo,sa[ra++]=Yc,Yc=a,Bo=c}function i1(a,c,h){Di[Li++]=ln,Di[Li++]=cn,Di[Li++]=hs,hs=a;var d=ln;a=cn;var m=32-mi(d)-1;d&=~(1<<m),h+=1;var y=32-mi(c)+m;if(30<y){var S=m-m%5;y=(d&(1<<S)-1).toString(32),d>>=S,m-=S,ln=1<<32-mi(c)+m|h<<m|d,cn=y+a}else ln=1<<y|h<<m|d,cn=a}function Cd(a){a.return!==null&&(Nn(a,1),i1(a,1,0))}function Rd(a){for(;a===Yc;)Yc=sa[--ra],sa[ra]=null,Bo=sa[--ra],sa[ra]=null;for(;a===hs;)hs=Di[--Li],Di[Li]=null,cn=Di[--Li],Di[Li]=null,ln=Di[--Li],Di[Li]=null}function n1(a,c){Di[Li++]=ln,Di[Li++]=cn,Di[Li++]=hs,ln=c.id,cn=c.overflow,hs=a}var Ue=null,oe=null,jt=!1,fs=null,ki=!1,Pd=Error(n(519));function ds(a){var c=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Uo(Ni(c,a)),Pd}function s1(a){var c=a.stateNode,h=a.type,d=a.memoizedProps;switch(c[Be]=a,c[ni]=d,h){case"dialog":Ut("cancel",c),Ut("close",c);break;case"iframe":case"object":case"embed":Ut("load",c);break;case"video":case"audio":for(h=0;h<al.length;h++)Ut(al[h],c);break;case"source":Ut("error",c);break;case"img":case"image":case"link":Ut("error",c),Ut("load",c);break;case"details":Ut("toggle",c);break;case"input":Ut("invalid",c),my(c,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Ut("invalid",c);break;case"textarea":Ut("invalid",c),vy(c,d.value,d.defaultValue,d.children)}h=d.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||c.textContent===""+h||d.suppressHydrationWarning===!0||xv(c.textContent,h)?(d.popover!=null&&(Ut("beforetoggle",c),Ut("toggle",c)),d.onScroll!=null&&Ut("scroll",c),d.onScrollEnd!=null&&Ut("scrollend",c),d.onClick!=null&&(c.onclick=Pn),c=!0):c=!1,c||ds(a,!0)}function r1(a){for(Ue=a.return;Ue;)switch(Ue.tag){case 5:case 31:case 13:ki=!1;return;case 27:case 3:ki=!0;return;default:Ue=Ue.return}}function aa(a){if(a!==Ue)return!1;if(!jt)return r1(a),jt=!0,!1;var c=a.tag,h;if((h=c!==3&&c!==27)&&((h=c===5)&&(h=a.type,h=!(h!=="form"&&h!=="button")||Xg(a.type,a.memoizedProps)),h=!h),h&&oe&&ds(a),r1(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));oe=Pv(a)}else if(c===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));oe=Pv(a)}else c===27?(c=oe,Ms(a.type)?(a=Jg,Jg=null,oe=a):oe=c):oe=Ue?Ui(a.stateNode.nextSibling):null;return!0}function lr(){oe=Ue=null,jt=!1}function Id(){var a=fs;return a!==null&&(li===null?li=a:li.push.apply(li,a),fs=null),a}function Uo(a){fs===null?fs=[a]:fs.push(a)}var Od=I(null),cr=null,Dn=null;function gs(a,c,h){Z(Od,c._currentValue),c._currentValue=h}function Ln(a){a._currentValue=Od.current,B(Od)}function Nd(a,c,h){for(;a!==null;){var d=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,d!==null&&(d.childLanes|=c)):d!==null&&(d.childLanes&c)!==c&&(d.childLanes|=c),a===h)break;a=a.return}}function Dd(a,c,h,d){var m=a.child;for(m!==null&&(m.return=a);m!==null;){var y=m.dependencies;if(y!==null){var S=m.child;y=y.firstContext;t:for(;y!==null;){var A=y;y=m;for(var L=0;L<c.length;L++)if(A.context===c[L]){y.lanes|=h,A=y.alternate,A!==null&&(A.lanes|=h),Nd(y.return,h,a),d||(S=null);break t}y=A.next}}else if(m.tag===18){if(S=m.return,S===null)throw Error(n(341));S.lanes|=h,y=S.alternate,y!==null&&(y.lanes|=h),Nd(S,h,a),S=null}else S=m.child;if(S!==null)S.return=m;else for(S=m;S!==null;){if(S===a){S=null;break}if(m=S.sibling,m!==null){m.return=S.return,S=m;break}S=S.return}m=S}}function oa(a,c,h,d){a=null;for(var m=c,y=!1;m!==null;){if(!y){if((m.flags&524288)!==0)y=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var S=m.alternate;if(S===null)throw Error(n(387));if(S=S.memoizedProps,S!==null){var A=m.type;yi(m.pendingProps.value,S.value)||(a!==null?a.push(A):a=[A])}}else if(m===xt.current){if(S=m.alternate,S===null)throw Error(n(387));S.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(a!==null?a.push(hl):a=[hl])}m=m.return}a!==null&&Dd(c,a,h,d),c.flags|=262144}function Kc(a){for(a=a.firstContext;a!==null;){if(!yi(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ur(a){cr=a,Dn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Fe(a){return a1(cr,a)}function Zc(a,c){return cr===null&&ur(a),a1(a,c)}function a1(a,c){var h=c._currentValue;if(c={context:c,memoizedValue:h,next:null},Dn===null){if(a===null)throw Error(n(308));Dn=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Dn=Dn.next=c;return h}var iM=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(h,d){a.push(d)}};this.abort=function(){c.aborted=!0,a.forEach(function(h){return h()})}},nM=i.unstable_scheduleCallback,sM=i.unstable_NormalPriority,Se={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ld(){return{controller:new iM,data:new Map,refCount:0}}function Fo(a){a.refCount--,a.refCount===0&&nM(sM,function(){a.controller.abort()})}var zo=null,kd=0,la=0,ca=null;function rM(a,c){if(zo===null){var h=zo=[];kd=0,la=Fg(),ca={status:"pending",value:void 0,then:function(d){h.push(d)}}}return kd++,c.then(o1,o1),c}function o1(){if(--kd===0&&zo!==null){ca!==null&&(ca.status="fulfilled");var a=zo;zo=null,la=0,ca=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function aM(a,c){var h=[],d={status:"pending",value:null,reason:null,then:function(m){h.push(m)}};return a.then(function(){d.status="fulfilled",d.value=c;for(var m=0;m<h.length;m++)(0,h[m])(c)},function(m){for(d.status="rejected",d.reason=m,m=0;m<h.length;m++)(0,h[m])(void 0)}),d}var l1=C.S;C.S=function(a,c){G2=pi(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&rM(a,c),l1!==null&&l1(a,c)};var hr=I(null);function Bd(){var a=hr.current;return a!==null?a:re.pooledCache}function Qc(a,c){c===null?Z(hr,hr.current):Z(hr,c.pool)}function c1(){var a=Bd();return a===null?null:{parent:Se._currentValue,pool:a}}var ua=Error(n(460)),Ud=Error(n(474)),Jc=Error(n(542)),tu={then:function(){}};function u1(a){return a=a.status,a==="fulfilled"||a==="rejected"}function h1(a,c,h){switch(h=a[h],h===void 0?a.push(c):h!==c&&(c.then(Pn,Pn),c=h),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,d1(a),a;default:if(typeof c.status=="string")c.then(Pn,Pn);else{if(a=re,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=c,a.status="pending",a.then(function(d){if(c.status==="pending"){var m=c;m.status="fulfilled",m.value=d}},function(d){if(c.status==="pending"){var m=c;m.status="rejected",m.reason=d}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,d1(a),a}throw dr=c,ua}}function fr(a){try{var c=a._init;return c(a._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(dr=h,ua):h}}var dr=null;function f1(){if(dr===null)throw Error(n(459));var a=dr;return dr=null,a}function d1(a){if(a===ua||a===Jc)throw Error(n(483))}var ha=null,Vo=0;function eu(a){var c=Vo;return Vo+=1,ha===null&&(ha=[]),h1(ha,a,c)}function jo(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function iu(a,c){throw c.$$typeof===_?Error(n(525)):(a=Object.prototype.toString.call(c),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function g1(a){function c(H,F){if(a){var W=H.deletions;W===null?(H.deletions=[F],H.flags|=16):W.push(F)}}function h(H,F){if(!a)return null;for(;F!==null;)c(H,F),F=F.sibling;return null}function d(H){for(var F=new Map;H!==null;)H.key!==null?F.set(H.key,H):F.set(H.index,H),H=H.sibling;return F}function m(H,F){return H=On(H,F),H.index=0,H.sibling=null,H}function y(H,F,W){return H.index=W,a?(W=H.alternate,W!==null?(W=W.index,W<F?(H.flags|=67108866,F):W):(H.flags|=67108866,F)):(H.flags|=1048576,F)}function S(H){return a&&H.alternate===null&&(H.flags|=67108866),H}function A(H,F,W,nt){return F===null||F.tag!==6?(F=Ad(W,H.mode,nt),F.return=H,F):(F=m(F,W),F.return=H,F)}function L(H,F,W,nt){var wt=W.type;return wt===x?it(H,F,W.props.children,nt,W.key):F!==null&&(F.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===et&&fr(wt)===F.type)?(F=m(F,W.props),jo(F,W),F.return=H,F):(F=Xc(W.type,W.key,W.props,null,H.mode,nt),jo(F,W),F.return=H,F)}function q(H,F,W,nt){return F===null||F.tag!==4||F.stateNode.containerInfo!==W.containerInfo||F.stateNode.implementation!==W.implementation?(F=Md(W,H.mode,nt),F.return=H,F):(F=m(F,W.children||[]),F.return=H,F)}function it(H,F,W,nt,wt){return F===null||F.tag!==7?(F=or(W,H.mode,nt,wt),F.return=H,F):(F=m(F,W),F.return=H,F)}function rt(H,F,W){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Ad(""+F,H.mode,W),F.return=H,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case v:return W=Xc(F.type,F.key,F.props,null,H.mode,W),jo(W,F),W.return=H,W;case b:return F=Md(F,H.mode,W),F.return=H,F;case et:return F=fr(F),rt(H,F,W)}if(It(F)||_t(F))return F=or(F,H.mode,W,null),F.return=H,F;if(typeof F.then=="function")return rt(H,eu(F),W);if(F.$$typeof===E)return rt(H,Zc(H,F),W);iu(H,F)}return null}function X(H,F,W,nt){var wt=F!==null?F.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return wt!==null?null:A(H,F,""+W,nt);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case v:return W.key===wt?L(H,F,W,nt):null;case b:return W.key===wt?q(H,F,W,nt):null;case et:return W=fr(W),X(H,F,W,nt)}if(It(W)||_t(W))return wt!==null?null:it(H,F,W,nt,null);if(typeof W.then=="function")return X(H,F,eu(W),nt);if(W.$$typeof===E)return X(H,F,Zc(H,W),nt);iu(H,W)}return null}function tt(H,F,W,nt,wt){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return H=H.get(W)||null,A(F,H,""+nt,wt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case v:return H=H.get(nt.key===null?W:nt.key)||null,L(F,H,nt,wt);case b:return H=H.get(nt.key===null?W:nt.key)||null,q(F,H,nt,wt);case et:return nt=fr(nt),tt(H,F,W,nt,wt)}if(It(nt)||_t(nt))return H=H.get(W)||null,it(F,H,nt,wt,null);if(typeof nt.then=="function")return tt(H,F,W,eu(nt),wt);if(nt.$$typeof===E)return tt(H,F,W,Zc(F,nt),wt);iu(F,nt)}return null}function vt(H,F,W,nt){for(var wt=null,Gt=null,Tt=F,Nt=F=0,Vt=null;Tt!==null&&Nt<W.length;Nt++){Tt.index>Nt?(Vt=Tt,Tt=null):Vt=Tt.sibling;var Wt=X(H,Tt,W[Nt],nt);if(Wt===null){Tt===null&&(Tt=Vt);break}a&&Tt&&Wt.alternate===null&&c(H,Tt),F=y(Wt,F,Nt),Gt===null?wt=Wt:Gt.sibling=Wt,Gt=Wt,Tt=Vt}if(Nt===W.length)return h(H,Tt),jt&&Nn(H,Nt),wt;if(Tt===null){for(;Nt<W.length;Nt++)Tt=rt(H,W[Nt],nt),Tt!==null&&(F=y(Tt,F,Nt),Gt===null?wt=Tt:Gt.sibling=Tt,Gt=Tt);return jt&&Nn(H,Nt),wt}for(Tt=d(Tt);Nt<W.length;Nt++)Vt=tt(Tt,H,Nt,W[Nt],nt),Vt!==null&&(a&&Vt.alternate!==null&&Tt.delete(Vt.key===null?Nt:Vt.key),F=y(Vt,F,Nt),Gt===null?wt=Vt:Gt.sibling=Vt,Gt=Vt);return a&&Tt.forEach(function(Os){return c(H,Os)}),jt&&Nn(H,Nt),wt}function Et(H,F,W,nt){if(W==null)throw Error(n(151));for(var wt=null,Gt=null,Tt=F,Nt=F=0,Vt=null,Wt=W.next();Tt!==null&&!Wt.done;Nt++,Wt=W.next()){Tt.index>Nt?(Vt=Tt,Tt=null):Vt=Tt.sibling;var Os=X(H,Tt,Wt.value,nt);if(Os===null){Tt===null&&(Tt=Vt);break}a&&Tt&&Os.alternate===null&&c(H,Tt),F=y(Os,F,Nt),Gt===null?wt=Os:Gt.sibling=Os,Gt=Os,Tt=Vt}if(Wt.done)return h(H,Tt),jt&&Nn(H,Nt),wt;if(Tt===null){for(;!Wt.done;Nt++,Wt=W.next())Wt=rt(H,Wt.value,nt),Wt!==null&&(F=y(Wt,F,Nt),Gt===null?wt=Wt:Gt.sibling=Wt,Gt=Wt);return jt&&Nn(H,Nt),wt}for(Tt=d(Tt);!Wt.done;Nt++,Wt=W.next())Wt=tt(Tt,H,Nt,Wt.value,nt),Wt!==null&&(a&&Wt.alternate!==null&&Tt.delete(Wt.key===null?Nt:Wt.key),F=y(Wt,F,Nt),Gt===null?wt=Wt:Gt.sibling=Wt,Gt=Wt);return a&&Tt.forEach(function(mC){return c(H,mC)}),jt&&Nn(H,Nt),wt}function ie(H,F,W,nt){if(typeof W=="object"&&W!==null&&W.type===x&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case v:t:{for(var wt=W.key;F!==null;){if(F.key===wt){if(wt=W.type,wt===x){if(F.tag===7){h(H,F.sibling),nt=m(F,W.props.children),nt.return=H,H=nt;break t}}else if(F.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===et&&fr(wt)===F.type){h(H,F.sibling),nt=m(F,W.props),jo(nt,W),nt.return=H,H=nt;break t}h(H,F);break}else c(H,F);F=F.sibling}W.type===x?(nt=or(W.props.children,H.mode,nt,W.key),nt.return=H,H=nt):(nt=Xc(W.type,W.key,W.props,null,H.mode,nt),jo(nt,W),nt.return=H,H=nt)}return S(H);case b:t:{for(wt=W.key;F!==null;){if(F.key===wt)if(F.tag===4&&F.stateNode.containerInfo===W.containerInfo&&F.stateNode.implementation===W.implementation){h(H,F.sibling),nt=m(F,W.children||[]),nt.return=H,H=nt;break t}else{h(H,F);break}else c(H,F);F=F.sibling}nt=Md(W,H.mode,nt),nt.return=H,H=nt}return S(H);case et:return W=fr(W),ie(H,F,W,nt)}if(It(W))return vt(H,F,W,nt);if(_t(W)){if(wt=_t(W),typeof wt!="function")throw Error(n(150));return W=wt.call(W),Et(H,F,W,nt)}if(typeof W.then=="function")return ie(H,F,eu(W),nt);if(W.$$typeof===E)return ie(H,F,Zc(H,W),nt);iu(H,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,F!==null&&F.tag===6?(h(H,F.sibling),nt=m(F,W),nt.return=H,H=nt):(h(H,F),nt=Ad(W,H.mode,nt),nt.return=H,H=nt),S(H)):h(H,F)}return function(H,F,W,nt){try{Vo=0;var wt=ie(H,F,W,nt);return ha=null,wt}catch(Tt){if(Tt===ua||Tt===Jc)throw Tt;var Gt=vi(29,Tt,null,H.mode);return Gt.lanes=nt,Gt.return=H,Gt}}}var gr=g1(!0),p1=g1(!1),ps=!1;function Fd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function zd(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function _s(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ms(a,c,h){var d=a.updateQueue;if(d===null)return null;if(d=d.shared,(qt&2)!==0){var m=d.pending;return m===null?c.next=c:(c.next=m.next,m.next=c),d.pending=c,c=qc(a),Qy(a,null,h),c}return Wc(a,d,c,h),qc(a)}function Ho(a,c,h){if(c=c.updateQueue,c!==null&&(c=c.shared,(h&4194048)!==0)){var d=c.lanes;d&=a.pendingLanes,h|=d,c.lanes=h,ay(a,h)}}function Vd(a,c){var h=a.updateQueue,d=a.alternate;if(d!==null&&(d=d.updateQueue,h===d)){var m=null,y=null;if(h=h.firstBaseUpdate,h!==null){do{var S={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};y===null?m=y=S:y=y.next=S,h=h.next}while(h!==null);y===null?m=y=c:y=y.next=c}else m=y=c;h={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=c}var jd=!1;function $o(){if(jd){var a=ca;if(a!==null)throw a}}function Go(a,c,h,d){jd=!1;var m=a.updateQueue;ps=!1;var y=m.firstBaseUpdate,S=m.lastBaseUpdate,A=m.shared.pending;if(A!==null){m.shared.pending=null;var L=A,q=L.next;L.next=null,S===null?y=q:S.next=q,S=L;var it=a.alternate;it!==null&&(it=it.updateQueue,A=it.lastBaseUpdate,A!==S&&(A===null?it.firstBaseUpdate=q:A.next=q,it.lastBaseUpdate=L))}if(y!==null){var rt=m.baseState;S=0,it=q=L=null,A=y;do{var X=A.lane&-536870913,tt=X!==A.lane;if(tt?(zt&X)===X:(d&X)===X){X!==0&&X===la&&(jd=!0),it!==null&&(it=it.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});t:{var vt=a,Et=A;X=c;var ie=h;switch(Et.tag){case 1:if(vt=Et.payload,typeof vt=="function"){rt=vt.call(ie,rt,X);break t}rt=vt;break t;case 3:vt.flags=vt.flags&-65537|128;case 0:if(vt=Et.payload,X=typeof vt=="function"?vt.call(ie,rt,X):vt,X==null)break t;rt=p({},rt,X);break t;case 2:ps=!0}}X=A.callback,X!==null&&(a.flags|=64,tt&&(a.flags|=8192),tt=m.callbacks,tt===null?m.callbacks=[X]:tt.push(X))}else tt={lane:X,tag:A.tag,payload:A.payload,callback:A.callback,next:null},it===null?(q=it=tt,L=rt):it=it.next=tt,S|=X;if(A=A.next,A===null){if(A=m.shared.pending,A===null)break;tt=A,A=tt.next,tt.next=null,m.lastBaseUpdate=tt,m.shared.pending=null}}while(!0);it===null&&(L=rt),m.baseState=L,m.firstBaseUpdate=q,m.lastBaseUpdate=it,y===null&&(m.shared.lanes=0),Ss|=S,a.lanes=S,a.memoizedState=rt}}function _1(a,c){if(typeof a!="function")throw Error(n(191,a));a.call(c)}function m1(a,c){var h=a.callbacks;if(h!==null)for(a.callbacks=null,a=0;a<h.length;a++)_1(h[a],c)}var fa=I(null),nu=I(0);function y1(a,c){a=$n,Z(nu,a),Z(fa,c),$n=a|c.baseLanes}function Hd(){Z(nu,$n),Z(fa,fa.current)}function $d(){$n=nu.current,B(fa),B(nu)}var bi=I(null),Bi=null;function ys(a){var c=a.alternate;Z(ve,ve.current&1),Z(bi,a),Bi===null&&(c===null||fa.current!==null||c.memoizedState!==null)&&(Bi=a)}function Gd(a){Z(ve,ve.current),Z(bi,a),Bi===null&&(Bi=a)}function v1(a){a.tag===22?(Z(ve,ve.current),Z(bi,a),Bi===null&&(Bi=a)):vs()}function vs(){Z(ve,ve.current),Z(bi,bi.current)}function xi(a){B(bi),Bi===a&&(Bi=null),B(ve)}var ve=I(0);function su(a){for(var c=a;c!==null;){if(c.tag===13){var h=c.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Zg(h)||Qg(h)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var kn=0,Pt=null,te=null,Te=null,ru=!1,da=!1,pr=!1,au=0,Wo=0,ga=null,oM=0;function de(){throw Error(n(321))}function Wd(a,c){if(c===null)return!1;for(var h=0;h<c.length&&h<a.length;h++)if(!yi(a[h],c[h]))return!1;return!0}function qd(a,c,h,d,m,y){return kn=y,Pt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,C.H=a===null||a.memoizedState===null?i2:lg,pr=!1,y=h(d,m),pr=!1,da&&(y=x1(c,h,d,m)),b1(a),y}function b1(a){C.H=Yo;var c=te!==null&&te.next!==null;if(kn=0,Te=te=Pt=null,ru=!1,Wo=0,ga=null,c)throw Error(n(300));a===null||we||(a=a.dependencies,a!==null&&Kc(a)&&(we=!0))}function x1(a,c,h,d){Pt=a;var m=0;do{if(da&&(ga=null),Wo=0,da=!1,25<=m)throw Error(n(301));if(m+=1,Te=te=null,a.updateQueue!=null){var y=a.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}C.H=n2,y=c(h,d)}while(da);return y}function lM(){var a=C.H,c=a.useState()[0];return c=typeof c.then=="function"?qo(c):c,a=a.useState()[0],(te!==null?te.memoizedState:null)!==a&&(Pt.flags|=1024),c}function Xd(){var a=au!==0;return au=0,a}function Yd(a,c,h){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~h}function Kd(a){if(ru){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}ru=!1}kn=0,Te=te=Pt=null,da=!1,Wo=au=0,ga=null}function Je(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Te===null?Pt.memoizedState=Te=a:Te=Te.next=a,Te}function be(){if(te===null){var a=Pt.alternate;a=a!==null?a.memoizedState:null}else a=te.next;var c=Te===null?Pt.memoizedState:Te.next;if(c!==null)Te=c,te=a;else{if(a===null)throw Pt.alternate===null?Error(n(467)):Error(n(310));te=a,a={memoizedState:te.memoizedState,baseState:te.baseState,baseQueue:te.baseQueue,queue:te.queue,next:null},Te===null?Pt.memoizedState=Te=a:Te=Te.next=a}return Te}function ou(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function qo(a){var c=Wo;return Wo+=1,ga===null&&(ga=[]),a=h1(ga,a,c),c=Pt,(Te===null?c.memoizedState:Te.next)===null&&(c=c.alternate,C.H=c===null||c.memoizedState===null?i2:lg),a}function lu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return qo(a);if(a.$$typeof===E)return Fe(a)}throw Error(n(438,String(a)))}function Zd(a){var c=null,h=Pt.updateQueue;if(h!==null&&(c=h.memoCache),c==null){var d=Pt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(c={data:d.data.map(function(m){return m.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),h===null&&(h=ou(),Pt.updateQueue=h),h.memoCache=c,h=c.data[c.index],h===void 0)for(h=c.data[c.index]=Array(a),d=0;d<a;d++)h[d]=ut;return c.index++,h}function Bn(a,c){return typeof c=="function"?c(a):c}function cu(a){var c=be();return Qd(c,te,a)}function Qd(a,c,h){var d=a.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=h;var m=a.baseQueue,y=d.pending;if(y!==null){if(m!==null){var S=m.next;m.next=y.next,y.next=S}c.baseQueue=m=y,d.pending=null}if(y=a.baseState,m===null)a.memoizedState=y;else{c=m.next;var A=S=null,L=null,q=c,it=!1;do{var rt=q.lane&-536870913;if(rt!==q.lane?(zt&rt)===rt:(kn&rt)===rt){var X=q.revertLane;if(X===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),rt===la&&(it=!0);else if((kn&X)===X){q=q.next,X===la&&(it=!0);continue}else rt={lane:0,revertLane:q.revertLane,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},L===null?(A=L=rt,S=y):L=L.next=rt,Pt.lanes|=X,Ss|=X;rt=q.action,pr&&h(y,rt),y=q.hasEagerState?q.eagerState:h(y,rt)}else X={lane:rt,revertLane:q.revertLane,gesture:q.gesture,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},L===null?(A=L=X,S=y):L=L.next=X,Pt.lanes|=rt,Ss|=rt;q=q.next}while(q!==null&&q!==c);if(L===null?S=y:L.next=A,!yi(y,a.memoizedState)&&(we=!0,it&&(h=ca,h!==null)))throw h;a.memoizedState=y,a.baseState=S,a.baseQueue=L,d.lastRenderedState=y}return m===null&&(d.lanes=0),[a.memoizedState,d.dispatch]}function Jd(a){var c=be(),h=c.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=a;var d=h.dispatch,m=h.pending,y=c.memoizedState;if(m!==null){h.pending=null;var S=m=m.next;do y=a(y,S.action),S=S.next;while(S!==m);yi(y,c.memoizedState)||(we=!0),c.memoizedState=y,c.baseQueue===null&&(c.baseState=y),h.lastRenderedState=y}return[y,d]}function S1(a,c,h){var d=Pt,m=be(),y=jt;if(y){if(h===void 0)throw Error(n(407));h=h()}else h=c();var S=!yi((te||m).memoizedState,h);if(S&&(m.memoizedState=h,we=!0),m=m.queue,ig(E1.bind(null,d,m,a),[a]),m.getSnapshot!==c||S||Te!==null&&Te.memoizedState.tag&1){if(d.flags|=2048,pa(9,{destroy:void 0},w1.bind(null,d,m,h,c),null),re===null)throw Error(n(349));y||(kn&127)!==0||T1(d,c,h)}return h}function T1(a,c,h){a.flags|=16384,a={getSnapshot:c,value:h},c=Pt.updateQueue,c===null?(c=ou(),Pt.updateQueue=c,c.stores=[a]):(h=c.stores,h===null?c.stores=[a]:h.push(a))}function w1(a,c,h,d){c.value=h,c.getSnapshot=d,A1(c)&&M1(a)}function E1(a,c,h){return h(function(){A1(c)&&M1(a)})}function A1(a){var c=a.getSnapshot;a=a.value;try{var h=c();return!yi(a,h)}catch{return!0}}function M1(a){var c=ar(a,2);c!==null&&ci(c,a,2)}function tg(a){var c=Je();if(typeof a=="function"){var h=a;if(a=h(),pr){ls(!0);try{h()}finally{ls(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bn,lastRenderedState:a},c}function C1(a,c,h,d){return a.baseState=h,Qd(a,te,typeof d=="function"?d:Bn)}function cM(a,c,h,d,m){if(fu(a))throw Error(n(485));if(a=c.action,a!==null){var y={payload:m,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){y.listeners.push(S)}};C.T!==null?h(!0):y.isTransition=!1,d(y),h=c.pending,h===null?(y.next=c.pending=y,R1(c,y)):(y.next=h.next,c.pending=h.next=y)}}function R1(a,c){var h=c.action,d=c.payload,m=a.state;if(c.isTransition){var y=C.T,S={};C.T=S;try{var A=h(m,d),L=C.S;L!==null&&L(S,A),P1(a,c,A)}catch(q){eg(a,c,q)}finally{y!==null&&S.types!==null&&(y.types=S.types),C.T=y}}else try{y=h(m,d),P1(a,c,y)}catch(q){eg(a,c,q)}}function P1(a,c,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(d){I1(a,c,d)},function(d){return eg(a,c,d)}):I1(a,c,h)}function I1(a,c,h){c.status="fulfilled",c.value=h,O1(c),a.state=h,c=a.pending,c!==null&&(h=c.next,h===c?a.pending=null:(h=h.next,c.next=h,R1(a,h)))}function eg(a,c,h){var d=a.pending;if(a.pending=null,d!==null){d=d.next;do c.status="rejected",c.reason=h,O1(c),c=c.next;while(c!==d)}a.action=null}function O1(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function N1(a,c){return c}function D1(a,c){if(jt){var h=re.formState;if(h!==null){t:{var d=Pt;if(jt){if(oe){e:{for(var m=oe,y=ki;m.nodeType!==8;){if(!y){m=null;break e}if(m=Ui(m.nextSibling),m===null){m=null;break e}}y=m.data,m=y==="F!"||y==="F"?m:null}if(m){oe=Ui(m.nextSibling),d=m.data==="F!";break t}}ds(d)}d=!1}d&&(c=h[0])}}return h=Je(),h.memoizedState=h.baseState=c,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:N1,lastRenderedState:c},h.queue=d,h=J1.bind(null,Pt,d),d.dispatch=h,d=tg(!1),y=og.bind(null,Pt,!1,d.queue),d=Je(),m={state:c,dispatch:null,action:a,pending:null},d.queue=m,h=cM.bind(null,Pt,m,y,h),m.dispatch=h,d.memoizedState=a,[c,h,!1]}function L1(a){var c=be();return k1(c,te,a)}function k1(a,c,h){if(c=Qd(a,c,N1)[0],a=cu(Bn)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var d=qo(c)}catch(S){throw S===ua?Jc:S}else d=c;c=be();var m=c.queue,y=m.dispatch;return h!==c.memoizedState&&(Pt.flags|=2048,pa(9,{destroy:void 0},uM.bind(null,m,h),null)),[d,y,a]}function uM(a,c){a.action=c}function B1(a){var c=be(),h=te;if(h!==null)return k1(c,h,a);be(),c=c.memoizedState,h=be();var d=h.queue.dispatch;return h.memoizedState=a,[c,d,!1]}function pa(a,c,h,d){return a={tag:a,create:h,deps:d,inst:c,next:null},c=Pt.updateQueue,c===null&&(c=ou(),Pt.updateQueue=c),h=c.lastEffect,h===null?c.lastEffect=a.next=a:(d=h.next,h.next=a,a.next=d,c.lastEffect=a),a}function U1(){return be().memoizedState}function uu(a,c,h,d){var m=Je();Pt.flags|=a,m.memoizedState=pa(1|c,{destroy:void 0},h,d===void 0?null:d)}function hu(a,c,h,d){var m=be();d=d===void 0?null:d;var y=m.memoizedState.inst;te!==null&&d!==null&&Wd(d,te.memoizedState.deps)?m.memoizedState=pa(c,y,h,d):(Pt.flags|=a,m.memoizedState=pa(1|c,y,h,d))}function F1(a,c){uu(8390656,8,a,c)}function ig(a,c){hu(2048,8,a,c)}function hM(a){Pt.flags|=4;var c=Pt.updateQueue;if(c===null)c=ou(),Pt.updateQueue=c,c.events=[a];else{var h=c.events;h===null?c.events=[a]:h.push(a)}}function z1(a){var c=be().memoizedState;return hM({ref:c,nextImpl:a}),function(){if((qt&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}function V1(a,c){return hu(4,2,a,c)}function j1(a,c){return hu(4,4,a,c)}function H1(a,c){if(typeof c=="function"){a=a();var h=c(a);return function(){typeof h=="function"?h():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function $1(a,c,h){h=h!=null?h.concat([a]):null,hu(4,4,H1.bind(null,c,a),h)}function ng(){}function G1(a,c){var h=be();c=c===void 0?null:c;var d=h.memoizedState;return c!==null&&Wd(c,d[1])?d[0]:(h.memoizedState=[a,c],a)}function W1(a,c){var h=be();c=c===void 0?null:c;var d=h.memoizedState;if(c!==null&&Wd(c,d[1]))return d[0];if(d=a(),pr){ls(!0);try{a()}finally{ls(!1)}}return h.memoizedState=[d,c],d}function sg(a,c,h){return h===void 0||(kn&1073741824)!==0&&(zt&261930)===0?a.memoizedState=c:(a.memoizedState=h,a=q2(),Pt.lanes|=a,Ss|=a,h)}function q1(a,c,h,d){return yi(h,c)?h:fa.current!==null?(a=sg(a,h,d),yi(a,c)||(we=!0),a):(kn&42)===0||(kn&1073741824)!==0&&(zt&261930)===0?(we=!0,a.memoizedState=h):(a=q2(),Pt.lanes|=a,Ss|=a,c)}function X1(a,c,h,d,m){var y=N.p;N.p=y!==0&&8>y?y:8;var S=C.T,A={};C.T=A,og(a,!1,c,h);try{var L=m(),q=C.S;if(q!==null&&q(A,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var it=aM(L,d);Xo(a,c,it,wi(a))}else Xo(a,c,d,wi(a))}catch(rt){Xo(a,c,{then:function(){},status:"rejected",reason:rt},wi())}finally{N.p=y,S!==null&&A.types!==null&&(S.types=A.types),C.T=S}}function fM(){}function rg(a,c,h,d){if(a.tag!==5)throw Error(n(476));var m=Y1(a).queue;X1(a,m,c,D,h===null?fM:function(){return K1(a),h(d)})}function Y1(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bn,lastRenderedState:D},next:null};var h={};return c.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bn,lastRenderedState:h},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function K1(a){var c=Y1(a);c.next===null&&(c=a.alternate.memoizedState),Xo(a,c.next.queue,{},wi())}function ag(){return Fe(hl)}function Z1(){return be().memoizedState}function Q1(){return be().memoizedState}function dM(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var h=wi();a=_s(h);var d=ms(c,a,h);d!==null&&(ci(d,c,h),Ho(d,c,h)),c={cache:Ld()},a.payload=c;return}c=c.return}}function gM(a,c,h){var d=wi();h={lane:d,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},fu(a)?t2(c,h):(h=wd(a,c,h,d),h!==null&&(ci(h,a,d),e2(h,c,d)))}function J1(a,c,h){var d=wi();Xo(a,c,h,d)}function Xo(a,c,h,d){var m={lane:d,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(fu(a))t2(c,m);else{var y=a.alternate;if(a.lanes===0&&(y===null||y.lanes===0)&&(y=c.lastRenderedReducer,y!==null))try{var S=c.lastRenderedState,A=y(S,h);if(m.hasEagerState=!0,m.eagerState=A,yi(A,S))return Wc(a,c,m,0),re===null&&Gc(),!1}catch{}if(h=wd(a,c,m,d),h!==null)return ci(h,a,d),e2(h,c,d),!0}return!1}function og(a,c,h,d){if(d={lane:2,revertLane:Fg(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},fu(a)){if(c)throw Error(n(479))}else c=wd(a,h,d,2),c!==null&&ci(c,a,2)}function fu(a){var c=a.alternate;return a===Pt||c!==null&&c===Pt}function t2(a,c){da=ru=!0;var h=a.pending;h===null?c.next=c:(c.next=h.next,h.next=c),a.pending=c}function e2(a,c,h){if((h&4194048)!==0){var d=c.lanes;d&=a.pendingLanes,h|=d,c.lanes=h,ay(a,h)}}var Yo={readContext:Fe,use:lu,useCallback:de,useContext:de,useEffect:de,useImperativeHandle:de,useLayoutEffect:de,useInsertionEffect:de,useMemo:de,useReducer:de,useRef:de,useState:de,useDebugValue:de,useDeferredValue:de,useTransition:de,useSyncExternalStore:de,useId:de,useHostTransitionStatus:de,useFormState:de,useActionState:de,useOptimistic:de,useMemoCache:de,useCacheRefresh:de};Yo.useEffectEvent=de;var i2={readContext:Fe,use:lu,useCallback:function(a,c){return Je().memoizedState=[a,c===void 0?null:c],a},useContext:Fe,useEffect:F1,useImperativeHandle:function(a,c,h){h=h!=null?h.concat([a]):null,uu(4194308,4,H1.bind(null,c,a),h)},useLayoutEffect:function(a,c){return uu(4194308,4,a,c)},useInsertionEffect:function(a,c){uu(4,2,a,c)},useMemo:function(a,c){var h=Je();c=c===void 0?null:c;var d=a();if(pr){ls(!0);try{a()}finally{ls(!1)}}return h.memoizedState=[d,c],d},useReducer:function(a,c,h){var d=Je();if(h!==void 0){var m=h(c);if(pr){ls(!0);try{h(c)}finally{ls(!1)}}}else m=c;return d.memoizedState=d.baseState=m,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:m},d.queue=a,a=a.dispatch=gM.bind(null,Pt,a),[d.memoizedState,a]},useRef:function(a){var c=Je();return a={current:a},c.memoizedState=a},useState:function(a){a=tg(a);var c=a.queue,h=J1.bind(null,Pt,c);return c.dispatch=h,[a.memoizedState,h]},useDebugValue:ng,useDeferredValue:function(a,c){var h=Je();return sg(h,a,c)},useTransition:function(){var a=tg(!1);return a=X1.bind(null,Pt,a.queue,!0,!1),Je().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,h){var d=Pt,m=Je();if(jt){if(h===void 0)throw Error(n(407));h=h()}else{if(h=c(),re===null)throw Error(n(349));(zt&127)!==0||T1(d,c,h)}m.memoizedState=h;var y={value:h,getSnapshot:c};return m.queue=y,F1(E1.bind(null,d,y,a),[a]),d.flags|=2048,pa(9,{destroy:void 0},w1.bind(null,d,y,h,c),null),h},useId:function(){var a=Je(),c=re.identifierPrefix;if(jt){var h=cn,d=ln;h=(d&~(1<<32-mi(d)-1)).toString(32)+h,c="_"+c+"R_"+h,h=au++,0<h&&(c+="H"+h.toString(32)),c+="_"}else h=oM++,c="_"+c+"r_"+h.toString(32)+"_";return a.memoizedState=c},useHostTransitionStatus:ag,useFormState:D1,useActionState:D1,useOptimistic:function(a){var c=Je();c.memoizedState=c.baseState=a;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=h,c=og.bind(null,Pt,!0,h),h.dispatch=c,[a,c]},useMemoCache:Zd,useCacheRefresh:function(){return Je().memoizedState=dM.bind(null,Pt)},useEffectEvent:function(a){var c=Je(),h={impl:a};return c.memoizedState=h,function(){if((qt&2)!==0)throw Error(n(440));return h.impl.apply(void 0,arguments)}}},lg={readContext:Fe,use:lu,useCallback:G1,useContext:Fe,useEffect:ig,useImperativeHandle:$1,useInsertionEffect:V1,useLayoutEffect:j1,useMemo:W1,useReducer:cu,useRef:U1,useState:function(){return cu(Bn)},useDebugValue:ng,useDeferredValue:function(a,c){var h=be();return q1(h,te.memoizedState,a,c)},useTransition:function(){var a=cu(Bn)[0],c=be().memoizedState;return[typeof a=="boolean"?a:qo(a),c]},useSyncExternalStore:S1,useId:Z1,useHostTransitionStatus:ag,useFormState:L1,useActionState:L1,useOptimistic:function(a,c){var h=be();return C1(h,te,a,c)},useMemoCache:Zd,useCacheRefresh:Q1};lg.useEffectEvent=z1;var n2={readContext:Fe,use:lu,useCallback:G1,useContext:Fe,useEffect:ig,useImperativeHandle:$1,useInsertionEffect:V1,useLayoutEffect:j1,useMemo:W1,useReducer:Jd,useRef:U1,useState:function(){return Jd(Bn)},useDebugValue:ng,useDeferredValue:function(a,c){var h=be();return te===null?sg(h,a,c):q1(h,te.memoizedState,a,c)},useTransition:function(){var a=Jd(Bn)[0],c=be().memoizedState;return[typeof a=="boolean"?a:qo(a),c]},useSyncExternalStore:S1,useId:Z1,useHostTransitionStatus:ag,useFormState:B1,useActionState:B1,useOptimistic:function(a,c){var h=be();return te!==null?C1(h,te,a,c):(h.baseState=a,[a,h.queue.dispatch])},useMemoCache:Zd,useCacheRefresh:Q1};n2.useEffectEvent=z1;function cg(a,c,h,d){c=a.memoizedState,h=h(d,c),h=h==null?c:p({},c,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var ug={enqueueSetState:function(a,c,h){a=a._reactInternals;var d=wi(),m=_s(d);m.payload=c,h!=null&&(m.callback=h),c=ms(a,m,d),c!==null&&(ci(c,a,d),Ho(c,a,d))},enqueueReplaceState:function(a,c,h){a=a._reactInternals;var d=wi(),m=_s(d);m.tag=1,m.payload=c,h!=null&&(m.callback=h),c=ms(a,m,d),c!==null&&(ci(c,a,d),Ho(c,a,d))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var h=wi(),d=_s(h);d.tag=2,c!=null&&(d.callback=c),c=ms(a,d,h),c!==null&&(ci(c,a,h),Ho(c,a,h))}};function s2(a,c,h,d,m,y,S){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(d,y,S):c.prototype&&c.prototype.isPureReactComponent?!Lo(h,d)||!Lo(m,y):!0}function r2(a,c,h,d){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(h,d),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(h,d),c.state!==a&&ug.enqueueReplaceState(c,c.state,null)}function _r(a,c){var h=c;if("ref"in c){h={};for(var d in c)d!=="ref"&&(h[d]=c[d])}if(a=a.defaultProps){h===c&&(h=p({},h));for(var m in a)h[m]===void 0&&(h[m]=a[m])}return h}function a2(a){$c(a)}function o2(a){console.error(a)}function l2(a){$c(a)}function du(a,c){try{var h=a.onUncaughtError;h(c.value,{componentStack:c.stack})}catch(d){setTimeout(function(){throw d})}}function c2(a,c,h){try{var d=a.onCaughtError;d(h.value,{componentStack:h.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function hg(a,c,h){return h=_s(h),h.tag=3,h.payload={element:null},h.callback=function(){du(a,c)},h}function u2(a){return a=_s(a),a.tag=3,a}function h2(a,c,h,d){var m=h.type.getDerivedStateFromError;if(typeof m=="function"){var y=d.value;a.payload=function(){return m(y)},a.callback=function(){c2(c,h,d)}}var S=h.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(a.callback=function(){c2(c,h,d),typeof m!="function"&&(Ts===null?Ts=new Set([this]):Ts.add(this));var A=d.stack;this.componentDidCatch(d.value,{componentStack:A!==null?A:""})})}function pM(a,c,h,d,m){if(h.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(c=h.alternate,c!==null&&oa(c,h,m,!0),h=bi.current,h!==null){switch(h.tag){case 31:case 13:return Bi===null?Eu():h.alternate===null&&ge===0&&(ge=3),h.flags&=-257,h.flags|=65536,h.lanes=m,d===tu?h.flags|=16384:(c=h.updateQueue,c===null?h.updateQueue=new Set([d]):c.add(d),kg(a,d,m)),!1;case 22:return h.flags|=65536,d===tu?h.flags|=16384:(c=h.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([d])},h.updateQueue=c):(h=c.retryQueue,h===null?c.retryQueue=new Set([d]):h.add(d)),kg(a,d,m)),!1}throw Error(n(435,h.tag))}return kg(a,d,m),Eu(),!1}if(jt)return c=bi.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=m,d!==Pd&&(a=Error(n(422),{cause:d}),Uo(Ni(a,h)))):(d!==Pd&&(c=Error(n(423),{cause:d}),Uo(Ni(c,h))),a=a.current.alternate,a.flags|=65536,m&=-m,a.lanes|=m,d=Ni(d,h),m=hg(a.stateNode,d,m),Vd(a,m),ge!==4&&(ge=2)),!1;var y=Error(n(520),{cause:d});if(y=Ni(y,h),nl===null?nl=[y]:nl.push(y),ge!==4&&(ge=2),c===null)return!0;d=Ni(d,h),h=c;do{switch(h.tag){case 3:return h.flags|=65536,a=m&-m,h.lanes|=a,a=hg(h.stateNode,d,a),Vd(h,a),!1;case 1:if(c=h.type,y=h.stateNode,(h.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ts===null||!Ts.has(y))))return h.flags|=65536,m&=-m,h.lanes|=m,m=u2(m),h2(m,a,h,d),Vd(h,m),!1}h=h.return}while(h!==null);return!1}var fg=Error(n(461)),we=!1;function ze(a,c,h,d){c.child=a===null?p1(c,null,h,d):gr(c,a.child,h,d)}function f2(a,c,h,d,m){h=h.render;var y=c.ref;if("ref"in d){var S={};for(var A in d)A!=="ref"&&(S[A]=d[A])}else S=d;return ur(c),d=qd(a,c,h,S,y,m),A=Xd(),a!==null&&!we?(Yd(a,c,m),Un(a,c,m)):(jt&&A&&Cd(c),c.flags|=1,ze(a,c,d,m),c.child)}function d2(a,c,h,d,m){if(a===null){var y=h.type;return typeof y=="function"&&!Ed(y)&&y.defaultProps===void 0&&h.compare===null?(c.tag=15,c.type=y,g2(a,c,y,d,m)):(a=Xc(h.type,null,d,c,c.mode,m),a.ref=c.ref,a.return=c,c.child=a)}if(y=a.child,!bg(a,m)){var S=y.memoizedProps;if(h=h.compare,h=h!==null?h:Lo,h(S,d)&&a.ref===c.ref)return Un(a,c,m)}return c.flags|=1,a=On(y,d),a.ref=c.ref,a.return=c,c.child=a}function g2(a,c,h,d,m){if(a!==null){var y=a.memoizedProps;if(Lo(y,d)&&a.ref===c.ref)if(we=!1,c.pendingProps=d=y,bg(a,m))(a.flags&131072)!==0&&(we=!0);else return c.lanes=a.lanes,Un(a,c,m)}return dg(a,c,h,d,m)}function p2(a,c,h,d){var m=d.children,y=a!==null?a.memoizedState:null;if(a===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((c.flags&128)!==0){if(y=y!==null?y.baseLanes|h:h,a!==null){for(d=c.child=a.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;d=m&~y}else d=0,c.child=null;return _2(a,c,y,h,d)}if((h&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&Qc(c,y!==null?y.cachePool:null),y!==null?y1(c,y):Hd(),v1(c);else return d=c.lanes=536870912,_2(a,c,y!==null?y.baseLanes|h:h,h,d)}else y!==null?(Qc(c,y.cachePool),y1(c,y),vs(),c.memoizedState=null):(a!==null&&Qc(c,null),Hd(),vs());return ze(a,c,m,h),c.child}function Ko(a,c){return a!==null&&a.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function _2(a,c,h,d,m){var y=Bd();return y=y===null?null:{parent:Se._currentValue,pool:y},c.memoizedState={baseLanes:h,cachePool:y},a!==null&&Qc(c,null),Hd(),v1(c),a!==null&&oa(a,c,d,!0),c.childLanes=m,null}function gu(a,c){return c=_u({mode:c.mode,children:c.children},a.mode),c.ref=a.ref,a.child=c,c.return=a,c}function m2(a,c,h){return gr(c,a.child,null,h),a=gu(c,c.pendingProps),a.flags|=2,xi(c),c.memoizedState=null,a}function _M(a,c,h){var d=c.pendingProps,m=(c.flags&128)!==0;if(c.flags&=-129,a===null){if(jt){if(d.mode==="hidden")return a=gu(c,d),c.lanes=536870912,Ko(null,a);if(Gd(c),(a=oe)?(a=Rv(a,ki),a=a!==null&&a.data==="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:hs!==null?{id:ln,overflow:cn}:null,retryLane:536870912,hydrationErrors:null},h=t1(a),h.return=c,c.child=h,Ue=c,oe=null)):a=null,a===null)throw ds(c);return c.lanes=536870912,null}return gu(c,d)}var y=a.memoizedState;if(y!==null){var S=y.dehydrated;if(Gd(c),m)if(c.flags&256)c.flags&=-257,c=m2(a,c,h);else if(c.memoizedState!==null)c.child=a.child,c.flags|=128,c=null;else throw Error(n(558));else if(we||oa(a,c,h,!1),m=(h&a.childLanes)!==0,we||m){if(d=re,d!==null&&(S=oy(d,h),S!==0&&S!==y.retryLane))throw y.retryLane=S,ar(a,S),ci(d,a,S),fg;Eu(),c=m2(a,c,h)}else a=y.treeContext,oe=Ui(S.nextSibling),Ue=c,jt=!0,fs=null,ki=!1,a!==null&&n1(c,a),c=gu(c,d),c.flags|=4096;return c}return a=On(a.child,{mode:d.mode,children:d.children}),a.ref=c.ref,c.child=a,a.return=c,a}function pu(a,c){var h=c.ref;if(h===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(a===null||a.ref!==h)&&(c.flags|=4194816)}}function dg(a,c,h,d,m){return ur(c),h=qd(a,c,h,d,void 0,m),d=Xd(),a!==null&&!we?(Yd(a,c,m),Un(a,c,m)):(jt&&d&&Cd(c),c.flags|=1,ze(a,c,h,m),c.child)}function y2(a,c,h,d,m,y){return ur(c),c.updateQueue=null,h=x1(c,d,h,m),b1(a),d=Xd(),a!==null&&!we?(Yd(a,c,y),Un(a,c,y)):(jt&&d&&Cd(c),c.flags|=1,ze(a,c,h,y),c.child)}function v2(a,c,h,d,m){if(ur(c),c.stateNode===null){var y=na,S=h.contextType;typeof S=="object"&&S!==null&&(y=Fe(S)),y=new h(d,y),c.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ug,c.stateNode=y,y._reactInternals=c,y=c.stateNode,y.props=d,y.state=c.memoizedState,y.refs={},Fd(c),S=h.contextType,y.context=typeof S=="object"&&S!==null?Fe(S):na,y.state=c.memoizedState,S=h.getDerivedStateFromProps,typeof S=="function"&&(cg(c,h,S,d),y.state=c.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(S=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),S!==y.state&&ug.enqueueReplaceState(y,y.state,null),Go(c,d,y,m),$o(),y.state=c.memoizedState),typeof y.componentDidMount=="function"&&(c.flags|=4194308),d=!0}else if(a===null){y=c.stateNode;var A=c.memoizedProps,L=_r(h,A);y.props=L;var q=y.context,it=h.contextType;S=na,typeof it=="object"&&it!==null&&(S=Fe(it));var rt=h.getDerivedStateFromProps;it=typeof rt=="function"||typeof y.getSnapshotBeforeUpdate=="function",A=c.pendingProps!==A,it||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(A||q!==S)&&r2(c,y,d,S),ps=!1;var X=c.memoizedState;y.state=X,Go(c,d,y,m),$o(),q=c.memoizedState,A||X!==q||ps?(typeof rt=="function"&&(cg(c,h,rt,d),q=c.memoizedState),(L=ps||s2(c,h,L,d,X,q,S))?(it||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(c.flags|=4194308)):(typeof y.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=d,c.memoizedState=q),y.props=d,y.state=q,y.context=S,d=L):(typeof y.componentDidMount=="function"&&(c.flags|=4194308),d=!1)}else{y=c.stateNode,zd(a,c),S=c.memoizedProps,it=_r(h,S),y.props=it,rt=c.pendingProps,X=y.context,q=h.contextType,L=na,typeof q=="object"&&q!==null&&(L=Fe(q)),A=h.getDerivedStateFromProps,(q=typeof A=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S!==rt||X!==L)&&r2(c,y,d,L),ps=!1,X=c.memoizedState,y.state=X,Go(c,d,y,m),$o();var tt=c.memoizedState;S!==rt||X!==tt||ps||a!==null&&a.dependencies!==null&&Kc(a.dependencies)?(typeof A=="function"&&(cg(c,h,A,d),tt=c.memoizedState),(it=ps||s2(c,h,it,d,X,tt,L)||a!==null&&a.dependencies!==null&&Kc(a.dependencies))?(q||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,tt,L),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,tt,L)),typeof y.componentDidUpdate=="function"&&(c.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof y.componentDidUpdate!="function"||S===a.memoizedProps&&X===a.memoizedState||(c.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===a.memoizedProps&&X===a.memoizedState||(c.flags|=1024),c.memoizedProps=d,c.memoizedState=tt),y.props=d,y.state=tt,y.context=L,d=it):(typeof y.componentDidUpdate!="function"||S===a.memoizedProps&&X===a.memoizedState||(c.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===a.memoizedProps&&X===a.memoizedState||(c.flags|=1024),d=!1)}return y=d,pu(a,c),d=(c.flags&128)!==0,y||d?(y=c.stateNode,h=d&&typeof h.getDerivedStateFromError!="function"?null:y.render(),c.flags|=1,a!==null&&d?(c.child=gr(c,a.child,null,m),c.child=gr(c,null,h,m)):ze(a,c,h,m),c.memoizedState=y.state,a=c.child):a=Un(a,c,m),a}function b2(a,c,h,d){return lr(),c.flags|=256,ze(a,c,h,d),c.child}var gg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function pg(a){return{baseLanes:a,cachePool:c1()}}function _g(a,c,h){return a=a!==null?a.childLanes&~h:0,c&&(a|=Ti),a}function x2(a,c,h){var d=c.pendingProps,m=!1,y=(c.flags&128)!==0,S;if((S=y)||(S=a!==null&&a.memoizedState===null?!1:(ve.current&2)!==0),S&&(m=!0,c.flags&=-129),S=(c.flags&32)!==0,c.flags&=-33,a===null){if(jt){if(m?ys(c):vs(),(a=oe)?(a=Rv(a,ki),a=a!==null&&a.data!=="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:hs!==null?{id:ln,overflow:cn}:null,retryLane:536870912,hydrationErrors:null},h=t1(a),h.return=c,c.child=h,Ue=c,oe=null)):a=null,a===null)throw ds(c);return Qg(a)?c.lanes=32:c.lanes=536870912,null}var A=d.children;return d=d.fallback,m?(vs(),m=c.mode,A=_u({mode:"hidden",children:A},m),d=or(d,m,h,null),A.return=c,d.return=c,A.sibling=d,c.child=A,d=c.child,d.memoizedState=pg(h),d.childLanes=_g(a,S,h),c.memoizedState=gg,Ko(null,d)):(ys(c),mg(c,A))}var L=a.memoizedState;if(L!==null&&(A=L.dehydrated,A!==null)){if(y)c.flags&256?(ys(c),c.flags&=-257,c=yg(a,c,h)):c.memoizedState!==null?(vs(),c.child=a.child,c.flags|=128,c=null):(vs(),A=d.fallback,m=c.mode,d=_u({mode:"visible",children:d.children},m),A=or(A,m,h,null),A.flags|=2,d.return=c,A.return=c,d.sibling=A,c.child=d,gr(c,a.child,null,h),d=c.child,d.memoizedState=pg(h),d.childLanes=_g(a,S,h),c.memoizedState=gg,c=Ko(null,d));else if(ys(c),Qg(A)){if(S=A.nextSibling&&A.nextSibling.dataset,S)var q=S.dgst;S=q,d=Error(n(419)),d.stack="",d.digest=S,Uo({value:d,source:null,stack:null}),c=yg(a,c,h)}else if(we||oa(a,c,h,!1),S=(h&a.childLanes)!==0,we||S){if(S=re,S!==null&&(d=oy(S,h),d!==0&&d!==L.retryLane))throw L.retryLane=d,ar(a,d),ci(S,a,d),fg;Zg(A)||Eu(),c=yg(a,c,h)}else Zg(A)?(c.flags|=192,c.child=a.child,c=null):(a=L.treeContext,oe=Ui(A.nextSibling),Ue=c,jt=!0,fs=null,ki=!1,a!==null&&n1(c,a),c=mg(c,d.children),c.flags|=4096);return c}return m?(vs(),A=d.fallback,m=c.mode,L=a.child,q=L.sibling,d=On(L,{mode:"hidden",children:d.children}),d.subtreeFlags=L.subtreeFlags&65011712,q!==null?A=On(q,A):(A=or(A,m,h,null),A.flags|=2),A.return=c,d.return=c,d.sibling=A,c.child=d,Ko(null,d),d=c.child,A=a.child.memoizedState,A===null?A=pg(h):(m=A.cachePool,m!==null?(L=Se._currentValue,m=m.parent!==L?{parent:L,pool:L}:m):m=c1(),A={baseLanes:A.baseLanes|h,cachePool:m}),d.memoizedState=A,d.childLanes=_g(a,S,h),c.memoizedState=gg,Ko(a.child,d)):(ys(c),h=a.child,a=h.sibling,h=On(h,{mode:"visible",children:d.children}),h.return=c,h.sibling=null,a!==null&&(S=c.deletions,S===null?(c.deletions=[a],c.flags|=16):S.push(a)),c.child=h,c.memoizedState=null,h)}function mg(a,c){return c=_u({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function _u(a,c){return a=vi(22,a,null,c),a.lanes=0,a}function yg(a,c,h){return gr(c,a.child,null,h),a=mg(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function S2(a,c,h){a.lanes|=c;var d=a.alternate;d!==null&&(d.lanes|=c),Nd(a.return,c,h)}function vg(a,c,h,d,m,y){var S=a.memoizedState;S===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:d,tail:h,tailMode:m,treeForkCount:y}:(S.isBackwards=c,S.rendering=null,S.renderingStartTime=0,S.last=d,S.tail=h,S.tailMode=m,S.treeForkCount=y)}function T2(a,c,h){var d=c.pendingProps,m=d.revealOrder,y=d.tail;d=d.children;var S=ve.current,A=(S&2)!==0;if(A?(S=S&1|2,c.flags|=128):S&=1,Z(ve,S),ze(a,c,d,h),d=jt?Bo:0,!A&&a!==null&&(a.flags&128)!==0)t:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&S2(a,h,c);else if(a.tag===19)S2(a,h,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break t;for(;a.sibling===null;){if(a.return===null||a.return===c)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(m){case"forwards":for(h=c.child,m=null;h!==null;)a=h.alternate,a!==null&&su(a)===null&&(m=h),h=h.sibling;h=m,h===null?(m=c.child,c.child=null):(m=h.sibling,h.sibling=null),vg(c,!1,m,h,y,d);break;case"backwards":case"unstable_legacy-backwards":for(h=null,m=c.child,c.child=null;m!==null;){if(a=m.alternate,a!==null&&su(a)===null){c.child=m;break}a=m.sibling,m.sibling=h,h=m,m=a}vg(c,!0,h,null,y,d);break;case"together":vg(c,!1,null,null,void 0,d);break;default:c.memoizedState=null}return c.child}function Un(a,c,h){if(a!==null&&(c.dependencies=a.dependencies),Ss|=c.lanes,(h&c.childLanes)===0)if(a!==null){if(oa(a,c,h,!1),(h&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(n(153));if(c.child!==null){for(a=c.child,h=On(a,a.pendingProps),c.child=h,h.return=c;a.sibling!==null;)a=a.sibling,h=h.sibling=On(a,a.pendingProps),h.return=c;h.sibling=null}return c.child}function bg(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&Kc(a)))}function mM(a,c,h){switch(c.tag){case 3:Mt(c,c.stateNode.containerInfo),gs(c,Se,a.memoizedState.cache),lr();break;case 27:case 5:kt(c);break;case 4:Mt(c,c.stateNode.containerInfo);break;case 10:gs(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,Gd(c),null;break;case 13:var d=c.memoizedState;if(d!==null)return d.dehydrated!==null?(ys(c),c.flags|=128,null):(h&c.child.childLanes)!==0?x2(a,c,h):(ys(c),a=Un(a,c,h),a!==null?a.sibling:null);ys(c);break;case 19:var m=(a.flags&128)!==0;if(d=(h&c.childLanes)!==0,d||(oa(a,c,h,!1),d=(h&c.childLanes)!==0),m){if(d)return T2(a,c,h);c.flags|=128}if(m=c.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Z(ve,ve.current),d)break;return null;case 22:return c.lanes=0,p2(a,c,h,c.pendingProps);case 24:gs(c,Se,a.memoizedState.cache)}return Un(a,c,h)}function w2(a,c,h){if(a!==null)if(a.memoizedProps!==c.pendingProps)we=!0;else{if(!bg(a,h)&&(c.flags&128)===0)return we=!1,mM(a,c,h);we=(a.flags&131072)!==0}else we=!1,jt&&(c.flags&1048576)!==0&&i1(c,Bo,c.index);switch(c.lanes=0,c.tag){case 16:t:{var d=c.pendingProps;if(a=fr(c.elementType),c.type=a,typeof a=="function")Ed(a)?(d=_r(a,d),c.tag=1,c=v2(null,c,a,d,h)):(c.tag=0,c=dg(null,c,a,d,h));else{if(a!=null){var m=a.$$typeof;if(m===P){c.tag=11,c=f2(null,c,a,d,h);break t}else if(m===Y){c.tag=14,c=d2(null,c,a,d,h);break t}}throw c=pt(a)||a,Error(n(306,c,""))}}return c;case 0:return dg(a,c,c.type,c.pendingProps,h);case 1:return d=c.type,m=_r(d,c.pendingProps),v2(a,c,d,m,h);case 3:t:{if(Mt(c,c.stateNode.containerInfo),a===null)throw Error(n(387));d=c.pendingProps;var y=c.memoizedState;m=y.element,zd(a,c),Go(c,d,null,h);var S=c.memoizedState;if(d=S.cache,gs(c,Se,d),d!==y.cache&&Dd(c,[Se],h,!0),$o(),d=S.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:S.cache},c.updateQueue.baseState=y,c.memoizedState=y,c.flags&256){c=b2(a,c,d,h);break t}else if(d!==m){m=Ni(Error(n(424)),c),Uo(m),c=b2(a,c,d,h);break t}else for(a=c.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,oe=Ui(a.firstChild),Ue=c,jt=!0,fs=null,ki=!0,h=p1(c,null,d,h),c.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(lr(),d===m){c=Un(a,c,h);break t}ze(a,c,d,h)}c=c.child}return c;case 26:return pu(a,c),a===null?(h=Lv(c.type,null,c.pendingProps,null))?c.memoizedState=h:jt||(h=c.type,a=c.pendingProps,d=Ou(mt.current).createElement(h),d[Be]=c,d[ni]=a,Ve(d,h,a),De(d),c.stateNode=d):c.memoizedState=Lv(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return kt(c),a===null&&jt&&(d=c.stateNode=Ov(c.type,c.pendingProps,mt.current),Ue=c,ki=!0,m=oe,Ms(c.type)?(Jg=m,oe=Ui(d.firstChild)):oe=m),ze(a,c,c.pendingProps.children,h),pu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&jt&&((m=d=oe)&&(d=qM(d,c.type,c.pendingProps,ki),d!==null?(c.stateNode=d,Ue=c,oe=Ui(d.firstChild),ki=!1,m=!0):m=!1),m||ds(c)),kt(c),m=c.type,y=c.pendingProps,S=a!==null?a.memoizedProps:null,d=y.children,Xg(m,y)?d=null:S!==null&&Xg(m,S)&&(c.flags|=32),c.memoizedState!==null&&(m=qd(a,c,lM,null,null,h),hl._currentValue=m),pu(a,c),ze(a,c,d,h),c.child;case 6:return a===null&&jt&&((a=h=oe)&&(h=XM(h,c.pendingProps,ki),h!==null?(c.stateNode=h,Ue=c,oe=null,a=!0):a=!1),a||ds(c)),null;case 13:return x2(a,c,h);case 4:return Mt(c,c.stateNode.containerInfo),d=c.pendingProps,a===null?c.child=gr(c,null,d,h):ze(a,c,d,h),c.child;case 11:return f2(a,c,c.type,c.pendingProps,h);case 7:return ze(a,c,c.pendingProps,h),c.child;case 8:return ze(a,c,c.pendingProps.children,h),c.child;case 12:return ze(a,c,c.pendingProps.children,h),c.child;case 10:return d=c.pendingProps,gs(c,c.type,d.value),ze(a,c,d.children,h),c.child;case 9:return m=c.type._context,d=c.pendingProps.children,ur(c),m=Fe(m),d=d(m),c.flags|=1,ze(a,c,d,h),c.child;case 14:return d2(a,c,c.type,c.pendingProps,h);case 15:return g2(a,c,c.type,c.pendingProps,h);case 19:return T2(a,c,h);case 31:return _M(a,c,h);case 22:return p2(a,c,h,c.pendingProps);case 24:return ur(c),d=Fe(Se),a===null?(m=Bd(),m===null&&(m=re,y=Ld(),m.pooledCache=y,y.refCount++,y!==null&&(m.pooledCacheLanes|=h),m=y),c.memoizedState={parent:d,cache:m},Fd(c),gs(c,Se,m)):((a.lanes&h)!==0&&(zd(a,c),Go(c,null,null,h),$o()),m=a.memoizedState,y=c.memoizedState,m.parent!==d?(m={parent:d,cache:d},c.memoizedState=m,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=m),gs(c,Se,d)):(d=y.cache,gs(c,Se,d),d!==m.cache&&Dd(c,[Se],h,!0))),ze(a,c,c.pendingProps.children,h),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function Fn(a){a.flags|=4}function xg(a,c,h,d,m){if((c=(a.mode&32)!==0)&&(c=!1),c){if(a.flags|=16777216,(m&335544128)===m)if(a.stateNode.complete)a.flags|=8192;else if(Z2())a.flags|=8192;else throw dr=tu,Ud}else a.flags&=-16777217}function E2(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!zv(c))if(Z2())a.flags|=8192;else throw dr=tu,Ud}function mu(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?sy():536870912,a.lanes|=c,va|=c)}function Zo(a,c){if(!jt)switch(a.tailMode){case"hidden":c=a.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var d=null;h!==null;)h.alternate!==null&&(d=h),h=h.sibling;d===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:d.sibling=null}}function le(a){var c=a.alternate!==null&&a.alternate.child===a.child,h=0,d=0;if(c)for(var m=a.child;m!==null;)h|=m.lanes|m.childLanes,d|=m.subtreeFlags&65011712,d|=m.flags&65011712,m.return=a,m=m.sibling;else for(m=a.child;m!==null;)h|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=a,m=m.sibling;return a.subtreeFlags|=d,a.childLanes=h,c}function yM(a,c,h){var d=c.pendingProps;switch(Rd(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return le(c),null;case 1:return le(c),null;case 3:return h=c.stateNode,d=null,a!==null&&(d=a.memoizedState.cache),c.memoizedState.cache!==d&&(c.flags|=2048),Ln(Se),Ot(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(a===null||a.child===null)&&(aa(c)?Fn(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Id())),le(c),null;case 26:var m=c.type,y=c.memoizedState;return a===null?(Fn(c),y!==null?(le(c),E2(c,y)):(le(c),xg(c,m,null,d,h))):y?y!==a.memoizedState?(Fn(c),le(c),E2(c,y)):(le(c),c.flags&=-16777217):(a=a.memoizedProps,a!==d&&Fn(c),le(c),xg(c,m,a,d,h)),null;case 27:if(an(c),h=mt.current,m=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==d&&Fn(c);else{if(!d){if(c.stateNode===null)throw Error(n(166));return le(c),null}a=at.current,aa(c)?s1(c):(a=Ov(m,d,h),c.stateNode=a,Fn(c))}return le(c),null;case 5:if(an(c),m=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==d&&Fn(c);else{if(!d){if(c.stateNode===null)throw Error(n(166));return le(c),null}if(y=at.current,aa(c))s1(c);else{var S=Ou(mt.current);switch(y){case 1:y=S.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:y=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":y=S.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":y=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":y=S.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof d.is=="string"?S.createElement("select",{is:d.is}):S.createElement("select"),d.multiple?y.multiple=!0:d.size&&(y.size=d.size);break;default:y=typeof d.is=="string"?S.createElement(m,{is:d.is}):S.createElement(m)}}y[Be]=c,y[ni]=d;t:for(S=c.child;S!==null;){if(S.tag===5||S.tag===6)y.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===c)break t;for(;S.sibling===null;){if(S.return===null||S.return===c)break t;S=S.return}S.sibling.return=S.return,S=S.sibling}c.stateNode=y;t:switch(Ve(y,m,d),m){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break t;case"img":d=!0;break t;default:d=!1}d&&Fn(c)}}return le(c),xg(c,c.type,a===null?null:a.memoizedProps,c.pendingProps,h),null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==d&&Fn(c);else{if(typeof d!="string"&&c.stateNode===null)throw Error(n(166));if(a=mt.current,aa(c)){if(a=c.stateNode,h=c.memoizedProps,d=null,m=Ue,m!==null)switch(m.tag){case 27:case 5:d=m.memoizedProps}a[Be]=c,a=!!(a.nodeValue===h||d!==null&&d.suppressHydrationWarning===!0||xv(a.nodeValue,h)),a||ds(c,!0)}else a=Ou(a).createTextNode(d),a[Be]=c,c.stateNode=a}return le(c),null;case 31:if(h=c.memoizedState,a===null||a.memoizedState!==null){if(d=aa(c),h!==null){if(a===null){if(!d)throw Error(n(318));if(a=c.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[Be]=c}else lr(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;le(c),a=!1}else h=Id(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=h),a=!0;if(!a)return c.flags&256?(xi(c),c):(xi(c),null);if((c.flags&128)!==0)throw Error(n(558))}return le(c),null;case 13:if(d=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(m=aa(c),d!==null&&d.dehydrated!==null){if(a===null){if(!m)throw Error(n(318));if(m=c.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(n(317));m[Be]=c}else lr(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;le(c),m=!1}else m=Id(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=m),m=!0;if(!m)return c.flags&256?(xi(c),c):(xi(c),null)}return xi(c),(c.flags&128)!==0?(c.lanes=h,c):(h=d!==null,a=a!==null&&a.memoizedState!==null,h&&(d=c.child,m=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(m=d.alternate.memoizedState.cachePool.pool),y=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==m&&(d.flags|=2048)),h!==a&&h&&(c.child.flags|=8192),mu(c,c.updateQueue),le(c),null);case 4:return Ot(),a===null&&Hg(c.stateNode.containerInfo),le(c),null;case 10:return Ln(c.type),le(c),null;case 19:if(B(ve),d=c.memoizedState,d===null)return le(c),null;if(m=(c.flags&128)!==0,y=d.rendering,y===null)if(m)Zo(d,!1);else{if(ge!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(y=su(a),y!==null){for(c.flags|=128,Zo(d,!1),a=y.updateQueue,c.updateQueue=a,mu(c,a),c.subtreeFlags=0,a=h,h=c.child;h!==null;)Jy(h,a),h=h.sibling;return Z(ve,ve.current&1|2),jt&&Nn(c,d.treeForkCount),c.child}a=a.sibling}d.tail!==null&&pi()>Su&&(c.flags|=128,m=!0,Zo(d,!1),c.lanes=4194304)}else{if(!m)if(a=su(y),a!==null){if(c.flags|=128,m=!0,a=a.updateQueue,c.updateQueue=a,mu(c,a),Zo(d,!0),d.tail===null&&d.tailMode==="hidden"&&!y.alternate&&!jt)return le(c),null}else 2*pi()-d.renderingStartTime>Su&&h!==536870912&&(c.flags|=128,m=!0,Zo(d,!1),c.lanes=4194304);d.isBackwards?(y.sibling=c.child,c.child=y):(a=d.last,a!==null?a.sibling=y:c.child=y,d.last=y)}return d.tail!==null?(a=d.tail,d.rendering=a,d.tail=a.sibling,d.renderingStartTime=pi(),a.sibling=null,h=ve.current,Z(ve,m?h&1|2:h&1),jt&&Nn(c,d.treeForkCount),a):(le(c),null);case 22:case 23:return xi(c),$d(),d=c.memoizedState!==null,a!==null?a.memoizedState!==null!==d&&(c.flags|=8192):d&&(c.flags|=8192),d?(h&536870912)!==0&&(c.flags&128)===0&&(le(c),c.subtreeFlags&6&&(c.flags|=8192)):le(c),h=c.updateQueue,h!==null&&mu(c,h.retryQueue),h=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),d=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(d=c.memoizedState.cachePool.pool),d!==h&&(c.flags|=2048),a!==null&&B(hr),null;case 24:return h=null,a!==null&&(h=a.memoizedState.cache),c.memoizedState.cache!==h&&(c.flags|=2048),Ln(Se),le(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function vM(a,c){switch(Rd(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Ln(Se),Ot(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return an(c),null;case 31:if(c.memoizedState!==null){if(xi(c),c.alternate===null)throw Error(n(340));lr()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 13:if(xi(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(n(340));lr()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return B(ve),null;case 4:return Ot(),null;case 10:return Ln(c.type),null;case 22:case 23:return xi(c),$d(),a!==null&&B(hr),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return Ln(Se),null;case 25:return null;default:return null}}function A2(a,c){switch(Rd(c),c.tag){case 3:Ln(Se),Ot();break;case 26:case 27:case 5:an(c);break;case 4:Ot();break;case 31:c.memoizedState!==null&&xi(c);break;case 13:xi(c);break;case 19:B(ve);break;case 10:Ln(c.type);break;case 22:case 23:xi(c),$d(),a!==null&&B(hr);break;case 24:Ln(Se)}}function Qo(a,c){try{var h=c.updateQueue,d=h!==null?h.lastEffect:null;if(d!==null){var m=d.next;h=m;do{if((h.tag&a)===a){d=void 0;var y=h.create,S=h.inst;d=y(),S.destroy=d}h=h.next}while(h!==m)}}catch(A){Jt(c,c.return,A)}}function bs(a,c,h){try{var d=c.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var y=m.next;d=y;do{if((d.tag&a)===a){var S=d.inst,A=S.destroy;if(A!==void 0){S.destroy=void 0,m=c;var L=h,q=A;try{q()}catch(it){Jt(m,L,it)}}}d=d.next}while(d!==y)}}catch(it){Jt(c,c.return,it)}}function M2(a){var c=a.updateQueue;if(c!==null){var h=a.stateNode;try{m1(c,h)}catch(d){Jt(a,a.return,d)}}}function C2(a,c,h){h.props=_r(a.type,a.memoizedProps),h.state=a.memoizedState;try{h.componentWillUnmount()}catch(d){Jt(a,c,d)}}function Jo(a,c){try{var h=a.ref;if(h!==null){switch(a.tag){case 26:case 27:case 5:var d=a.stateNode;break;case 30:d=a.stateNode;break;default:d=a.stateNode}typeof h=="function"?a.refCleanup=h(d):h.current=d}}catch(m){Jt(a,c,m)}}function un(a,c){var h=a.ref,d=a.refCleanup;if(h!==null)if(typeof d=="function")try{d()}catch(m){Jt(a,c,m)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(m){Jt(a,c,m)}else h.current=null}function R2(a){var c=a.type,h=a.memoizedProps,d=a.stateNode;try{t:switch(c){case"button":case"input":case"select":case"textarea":h.autoFocus&&d.focus();break t;case"img":h.src?d.src=h.src:h.srcSet&&(d.srcset=h.srcSet)}}catch(m){Jt(a,a.return,m)}}function Sg(a,c,h){try{var d=a.stateNode;VM(d,a.type,h,c),d[ni]=c}catch(m){Jt(a,a.return,m)}}function P2(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ms(a.type)||a.tag===4}function Tg(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||P2(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ms(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function wg(a,c,h){var d=a.tag;if(d===5||d===6)a=a.stateNode,c?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(a,c):(c=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,c.appendChild(a),h=h._reactRootContainer,h!=null||c.onclick!==null||(c.onclick=Pn));else if(d!==4&&(d===27&&Ms(a.type)&&(h=a.stateNode,c=null),a=a.child,a!==null))for(wg(a,c,h),a=a.sibling;a!==null;)wg(a,c,h),a=a.sibling}function yu(a,c,h){var d=a.tag;if(d===5||d===6)a=a.stateNode,c?h.insertBefore(a,c):h.appendChild(a);else if(d!==4&&(d===27&&Ms(a.type)&&(h=a.stateNode),a=a.child,a!==null))for(yu(a,c,h),a=a.sibling;a!==null;)yu(a,c,h),a=a.sibling}function I2(a){var c=a.stateNode,h=a.memoizedProps;try{for(var d=a.type,m=c.attributes;m.length;)c.removeAttributeNode(m[0]);Ve(c,d,h),c[Be]=a,c[ni]=h}catch(y){Jt(a,a.return,y)}}var zn=!1,Ee=!1,Eg=!1,O2=typeof WeakSet=="function"?WeakSet:Set,Le=null;function bM(a,c){if(a=a.containerInfo,Wg=Fu,a=$y(a),yd(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else t:{h=(h=a.ownerDocument)&&h.defaultView||window;var d=h.getSelection&&h.getSelection();if(d&&d.rangeCount!==0){h=d.anchorNode;var m=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{h.nodeType,y.nodeType}catch{h=null;break t}var S=0,A=-1,L=-1,q=0,it=0,rt=a,X=null;e:for(;;){for(var tt;rt!==h||m!==0&&rt.nodeType!==3||(A=S+m),rt!==y||d!==0&&rt.nodeType!==3||(L=S+d),rt.nodeType===3&&(S+=rt.nodeValue.length),(tt=rt.firstChild)!==null;)X=rt,rt=tt;for(;;){if(rt===a)break e;if(X===h&&++q===m&&(A=S),X===y&&++it===d&&(L=S),(tt=rt.nextSibling)!==null)break;rt=X,X=rt.parentNode}rt=tt}h=A===-1||L===-1?null:{start:A,end:L}}else h=null}h=h||{start:0,end:0}}else h=null;for(qg={focusedElem:a,selectionRange:h},Fu=!1,Le=c;Le!==null;)if(c=Le,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,Le=a;else for(;Le!==null;){switch(c=Le,y=c.alternate,a=c.flags,c.tag){case 0:if((a&4)!==0&&(a=c.updateQueue,a=a!==null?a.events:null,a!==null))for(h=0;h<a.length;h++)m=a[h],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&y!==null){a=void 0,h=c,m=y.memoizedProps,y=y.memoizedState,d=h.stateNode;try{var vt=_r(h.type,m);a=d.getSnapshotBeforeUpdate(vt,y),d.__reactInternalSnapshotBeforeUpdate=a}catch(Et){Jt(h,h.return,Et)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,h=a.nodeType,h===9)Kg(a);else if(h===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Kg(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=c.sibling,a!==null){a.return=c.return,Le=a;break}Le=c.return}}function N2(a,c,h){var d=h.flags;switch(h.tag){case 0:case 11:case 15:jn(a,h),d&4&&Qo(5,h);break;case 1:if(jn(a,h),d&4)if(a=h.stateNode,c===null)try{a.componentDidMount()}catch(S){Jt(h,h.return,S)}else{var m=_r(h.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(m,c,a.__reactInternalSnapshotBeforeUpdate)}catch(S){Jt(h,h.return,S)}}d&64&&M2(h),d&512&&Jo(h,h.return);break;case 3:if(jn(a,h),d&64&&(a=h.updateQueue,a!==null)){if(c=null,h.child!==null)switch(h.child.tag){case 27:case 5:c=h.child.stateNode;break;case 1:c=h.child.stateNode}try{m1(a,c)}catch(S){Jt(h,h.return,S)}}break;case 27:c===null&&d&4&&I2(h);case 26:case 5:jn(a,h),c===null&&d&4&&R2(h),d&512&&Jo(h,h.return);break;case 12:jn(a,h);break;case 31:jn(a,h),d&4&&k2(a,h);break;case 13:jn(a,h),d&4&&B2(a,h),d&64&&(a=h.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(h=RM.bind(null,h),YM(a,h))));break;case 22:if(d=h.memoizedState!==null||zn,!d){c=c!==null&&c.memoizedState!==null||Ee,m=zn;var y=Ee;zn=d,(Ee=c)&&!y?Hn(a,h,(h.subtreeFlags&8772)!==0):jn(a,h),zn=m,Ee=y}break;case 30:break;default:jn(a,h)}}function D2(a){var c=a.alternate;c!==null&&(a.alternate=null,D2(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&ed(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var ce=null,ri=!1;function Vn(a,c,h){for(h=h.child;h!==null;)L2(a,c,h),h=h.sibling}function L2(a,c,h){if(_i&&typeof _i.onCommitFiberUnmount=="function")try{_i.onCommitFiberUnmount(To,h)}catch{}switch(h.tag){case 26:Ee||un(h,c),Vn(a,c,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Ee||un(h,c);var d=ce,m=ri;Ms(h.type)&&(ce=h.stateNode,ri=!1),Vn(a,c,h),ll(h.stateNode),ce=d,ri=m;break;case 5:Ee||un(h,c);case 6:if(d=ce,m=ri,ce=null,Vn(a,c,h),ce=d,ri=m,ce!==null)if(ri)try{(ce.nodeType===9?ce.body:ce.nodeName==="HTML"?ce.ownerDocument.body:ce).removeChild(h.stateNode)}catch(y){Jt(h,c,y)}else try{ce.removeChild(h.stateNode)}catch(y){Jt(h,c,y)}break;case 18:ce!==null&&(ri?(a=ce,Mv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,h.stateNode),Ma(a)):Mv(ce,h.stateNode));break;case 4:d=ce,m=ri,ce=h.stateNode.containerInfo,ri=!0,Vn(a,c,h),ce=d,ri=m;break;case 0:case 11:case 14:case 15:bs(2,h,c),Ee||bs(4,h,c),Vn(a,c,h);break;case 1:Ee||(un(h,c),d=h.stateNode,typeof d.componentWillUnmount=="function"&&C2(h,c,d)),Vn(a,c,h);break;case 21:Vn(a,c,h);break;case 22:Ee=(d=Ee)||h.memoizedState!==null,Vn(a,c,h),Ee=d;break;default:Vn(a,c,h)}}function k2(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Ma(a)}catch(h){Jt(c,c.return,h)}}}function B2(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Ma(a)}catch(h){Jt(c,c.return,h)}}function xM(a){switch(a.tag){case 31:case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new O2),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new O2),c;default:throw Error(n(435,a.tag))}}function vu(a,c){var h=xM(a);c.forEach(function(d){if(!h.has(d)){h.add(d);var m=PM.bind(null,a,d);d.then(m,m)}})}function ai(a,c){var h=c.deletions;if(h!==null)for(var d=0;d<h.length;d++){var m=h[d],y=a,S=c,A=S;t:for(;A!==null;){switch(A.tag){case 27:if(Ms(A.type)){ce=A.stateNode,ri=!1;break t}break;case 5:ce=A.stateNode,ri=!1;break t;case 3:case 4:ce=A.stateNode.containerInfo,ri=!0;break t}A=A.return}if(ce===null)throw Error(n(160));L2(y,S,m),ce=null,ri=!1,y=m.alternate,y!==null&&(y.return=null),m.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)U2(c,a),c=c.sibling}var Xi=null;function U2(a,c){var h=a.alternate,d=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ai(c,a),oi(a),d&4&&(bs(3,a,a.return),Qo(3,a),bs(5,a,a.return));break;case 1:ai(c,a),oi(a),d&512&&(Ee||h===null||un(h,h.return)),d&64&&zn&&(a=a.updateQueue,a!==null&&(d=a.callbacks,d!==null&&(h=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=h===null?d:h.concat(d))));break;case 26:var m=Xi;if(ai(c,a),oi(a),d&512&&(Ee||h===null||un(h,h.return)),d&4){var y=h!==null?h.memoizedState:null;if(d=a.memoizedState,h===null)if(d===null)if(a.stateNode===null){t:{d=a.type,h=a.memoizedProps,m=m.ownerDocument||m;e:switch(d){case"title":y=m.getElementsByTagName("title")[0],(!y||y[Ao]||y[Be]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=m.createElement(d),m.head.insertBefore(y,m.querySelector("head > title"))),Ve(y,d,h),y[Be]=a,De(y),d=y;break t;case"link":var S=Uv("link","href",m).get(d+(h.href||""));if(S){for(var A=0;A<S.length;A++)if(y=S[A],y.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&y.getAttribute("rel")===(h.rel==null?null:h.rel)&&y.getAttribute("title")===(h.title==null?null:h.title)&&y.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){S.splice(A,1);break e}}y=m.createElement(d),Ve(y,d,h),m.head.appendChild(y);break;case"meta":if(S=Uv("meta","content",m).get(d+(h.content||""))){for(A=0;A<S.length;A++)if(y=S[A],y.getAttribute("content")===(h.content==null?null:""+h.content)&&y.getAttribute("name")===(h.name==null?null:h.name)&&y.getAttribute("property")===(h.property==null?null:h.property)&&y.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&y.getAttribute("charset")===(h.charSet==null?null:h.charSet)){S.splice(A,1);break e}}y=m.createElement(d),Ve(y,d,h),m.head.appendChild(y);break;default:throw Error(n(468,d))}y[Be]=a,De(y),d=y}a.stateNode=d}else Fv(m,a.type,a.stateNode);else a.stateNode=Bv(m,d,a.memoizedProps);else y!==d?(y===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):y.count--,d===null?Fv(m,a.type,a.stateNode):Bv(m,d,a.memoizedProps)):d===null&&a.stateNode!==null&&Sg(a,a.memoizedProps,h.memoizedProps)}break;case 27:ai(c,a),oi(a),d&512&&(Ee||h===null||un(h,h.return)),h!==null&&d&4&&Sg(a,a.memoizedProps,h.memoizedProps);break;case 5:if(ai(c,a),oi(a),d&512&&(Ee||h===null||un(h,h.return)),a.flags&32){m=a.stateNode;try{Kr(m,"")}catch(vt){Jt(a,a.return,vt)}}d&4&&a.stateNode!=null&&(m=a.memoizedProps,Sg(a,m,h!==null?h.memoizedProps:m)),d&1024&&(Eg=!0);break;case 6:if(ai(c,a),oi(a),d&4){if(a.stateNode===null)throw Error(n(162));d=a.memoizedProps,h=a.stateNode;try{h.nodeValue=d}catch(vt){Jt(a,a.return,vt)}}break;case 3:if(Lu=null,m=Xi,Xi=Nu(c.containerInfo),ai(c,a),Xi=m,oi(a),d&4&&h!==null&&h.memoizedState.isDehydrated)try{Ma(c.containerInfo)}catch(vt){Jt(a,a.return,vt)}Eg&&(Eg=!1,F2(a));break;case 4:d=Xi,Xi=Nu(a.stateNode.containerInfo),ai(c,a),oi(a),Xi=d;break;case 12:ai(c,a),oi(a);break;case 31:ai(c,a),oi(a),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,vu(a,d)));break;case 13:ai(c,a),oi(a),a.child.flags&8192&&a.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(xu=pi()),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,vu(a,d)));break;case 22:m=a.memoizedState!==null;var L=h!==null&&h.memoizedState!==null,q=zn,it=Ee;if(zn=q||m,Ee=it||L,ai(c,a),Ee=it,zn=q,oi(a),d&8192)t:for(c=a.stateNode,c._visibility=m?c._visibility&-2:c._visibility|1,m&&(h===null||L||zn||Ee||mr(a)),h=null,c=a;;){if(c.tag===5||c.tag===26){if(h===null){L=h=c;try{if(y=L.stateNode,m)S=y.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{A=L.stateNode;var rt=L.memoizedProps.style,X=rt!=null&&rt.hasOwnProperty("display")?rt.display:null;A.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(vt){Jt(L,L.return,vt)}}}else if(c.tag===6){if(h===null){L=c;try{L.stateNode.nodeValue=m?"":L.memoizedProps}catch(vt){Jt(L,L.return,vt)}}}else if(c.tag===18){if(h===null){L=c;try{var tt=L.stateNode;m?Cv(tt,!0):Cv(L.stateNode,!1)}catch(vt){Jt(L,L.return,vt)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break t;for(;c.sibling===null;){if(c.return===null||c.return===a)break t;h===c&&(h=null),c=c.return}h===c&&(h=null),c.sibling.return=c.return,c=c.sibling}d&4&&(d=a.updateQueue,d!==null&&(h=d.retryQueue,h!==null&&(d.retryQueue=null,vu(a,h))));break;case 19:ai(c,a),oi(a),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,vu(a,d)));break;case 30:break;case 21:break;default:ai(c,a),oi(a)}}function oi(a){var c=a.flags;if(c&2){try{for(var h,d=a.return;d!==null;){if(P2(d)){h=d;break}d=d.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var m=h.stateNode,y=Tg(a);yu(a,y,m);break;case 5:var S=h.stateNode;h.flags&32&&(Kr(S,""),h.flags&=-33);var A=Tg(a);yu(a,A,S);break;case 3:case 4:var L=h.stateNode.containerInfo,q=Tg(a);wg(a,q,L);break;default:throw Error(n(161))}}catch(it){Jt(a,a.return,it)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function F2(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;F2(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function jn(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)N2(a,c.alternate,c),c=c.sibling}function mr(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:bs(4,c,c.return),mr(c);break;case 1:un(c,c.return);var h=c.stateNode;typeof h.componentWillUnmount=="function"&&C2(c,c.return,h),mr(c);break;case 27:ll(c.stateNode);case 26:case 5:un(c,c.return),mr(c);break;case 22:c.memoizedState===null&&mr(c);break;case 30:mr(c);break;default:mr(c)}a=a.sibling}}function Hn(a,c,h){for(h=h&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var d=c.alternate,m=a,y=c,S=y.flags;switch(y.tag){case 0:case 11:case 15:Hn(m,y,h),Qo(4,y);break;case 1:if(Hn(m,y,h),d=y,m=d.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(q){Jt(d,d.return,q)}if(d=y,m=d.updateQueue,m!==null){var A=d.stateNode;try{var L=m.shared.hiddenCallbacks;if(L!==null)for(m.shared.hiddenCallbacks=null,m=0;m<L.length;m++)_1(L[m],A)}catch(q){Jt(d,d.return,q)}}h&&S&64&&M2(y),Jo(y,y.return);break;case 27:I2(y);case 26:case 5:Hn(m,y,h),h&&d===null&&S&4&&R2(y),Jo(y,y.return);break;case 12:Hn(m,y,h);break;case 31:Hn(m,y,h),h&&S&4&&k2(m,y);break;case 13:Hn(m,y,h),h&&S&4&&B2(m,y);break;case 22:y.memoizedState===null&&Hn(m,y,h),Jo(y,y.return);break;case 30:break;default:Hn(m,y,h)}c=c.sibling}}function Ag(a,c){var h=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==h&&(a!=null&&a.refCount++,h!=null&&Fo(h))}function Mg(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Fo(a))}function Yi(a,c,h,d){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)z2(a,c,h,d),c=c.sibling}function z2(a,c,h,d){var m=c.flags;switch(c.tag){case 0:case 11:case 15:Yi(a,c,h,d),m&2048&&Qo(9,c);break;case 1:Yi(a,c,h,d);break;case 3:Yi(a,c,h,d),m&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Fo(a)));break;case 12:if(m&2048){Yi(a,c,h,d),a=c.stateNode;try{var y=c.memoizedProps,S=y.id,A=y.onPostCommit;typeof A=="function"&&A(S,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(L){Jt(c,c.return,L)}}else Yi(a,c,h,d);break;case 31:Yi(a,c,h,d);break;case 13:Yi(a,c,h,d);break;case 23:break;case 22:y=c.stateNode,S=c.alternate,c.memoizedState!==null?y._visibility&2?Yi(a,c,h,d):tl(a,c):y._visibility&2?Yi(a,c,h,d):(y._visibility|=2,_a(a,c,h,d,(c.subtreeFlags&10256)!==0||!1)),m&2048&&Ag(S,c);break;case 24:Yi(a,c,h,d),m&2048&&Mg(c.alternate,c);break;default:Yi(a,c,h,d)}}function _a(a,c,h,d,m){for(m=m&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var y=a,S=c,A=h,L=d,q=S.flags;switch(S.tag){case 0:case 11:case 15:_a(y,S,A,L,m),Qo(8,S);break;case 23:break;case 22:var it=S.stateNode;S.memoizedState!==null?it._visibility&2?_a(y,S,A,L,m):tl(y,S):(it._visibility|=2,_a(y,S,A,L,m)),m&&q&2048&&Ag(S.alternate,S);break;case 24:_a(y,S,A,L,m),m&&q&2048&&Mg(S.alternate,S);break;default:_a(y,S,A,L,m)}c=c.sibling}}function tl(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var h=a,d=c,m=d.flags;switch(d.tag){case 22:tl(h,d),m&2048&&Ag(d.alternate,d);break;case 24:tl(h,d),m&2048&&Mg(d.alternate,d);break;default:tl(h,d)}c=c.sibling}}var el=8192;function ma(a,c,h){if(a.subtreeFlags&el)for(a=a.child;a!==null;)V2(a,c,h),a=a.sibling}function V2(a,c,h){switch(a.tag){case 26:ma(a,c,h),a.flags&el&&a.memoizedState!==null&&oC(h,Xi,a.memoizedState,a.memoizedProps);break;case 5:ma(a,c,h);break;case 3:case 4:var d=Xi;Xi=Nu(a.stateNode.containerInfo),ma(a,c,h),Xi=d;break;case 22:a.memoizedState===null&&(d=a.alternate,d!==null&&d.memoizedState!==null?(d=el,el=16777216,ma(a,c,h),el=d):ma(a,c,h));break;default:ma(a,c,h)}}function j2(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function il(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var h=0;h<c.length;h++){var d=c[h];Le=d,$2(d,a)}j2(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)H2(a),a=a.sibling}function H2(a){switch(a.tag){case 0:case 11:case 15:il(a),a.flags&2048&&bs(9,a,a.return);break;case 3:il(a);break;case 12:il(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,bu(a)):il(a);break;default:il(a)}}function bu(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var h=0;h<c.length;h++){var d=c[h];Le=d,$2(d,a)}j2(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:bs(8,c,c.return),bu(c);break;case 22:h=c.stateNode,h._visibility&2&&(h._visibility&=-3,bu(c));break;default:bu(c)}a=a.sibling}}function $2(a,c){for(;Le!==null;){var h=Le;switch(h.tag){case 0:case 11:case 15:bs(8,h,c);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var d=h.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Fo(h.memoizedState.cache)}if(d=h.child,d!==null)d.return=h,Le=d;else t:for(h=a;Le!==null;){d=Le;var m=d.sibling,y=d.return;if(D2(d),d===h){Le=null;break t}if(m!==null){m.return=y,Le=m;break t}Le=y}}}var SM={getCacheForType:function(a){var c=Fe(Se),h=c.data.get(a);return h===void 0&&(h=a(),c.data.set(a,h)),h},cacheSignal:function(){return Fe(Se).controller.signal}},TM=typeof WeakMap=="function"?WeakMap:Map,qt=0,re=null,Bt=null,zt=0,Qt=0,Si=null,xs=!1,ya=!1,Cg=!1,$n=0,ge=0,Ss=0,yr=0,Rg=0,Ti=0,va=0,nl=null,li=null,Pg=!1,xu=0,G2=0,Su=1/0,Tu=null,Ts=null,Ie=0,ws=null,ba=null,Gn=0,Ig=0,Og=null,W2=null,sl=0,Ng=null;function wi(){return(qt&2)!==0&&zt!==0?zt&-zt:C.T!==null?Fg():ly()}function q2(){if(Ti===0)if((zt&536870912)===0||jt){var a=Ic;Ic<<=1,(Ic&3932160)===0&&(Ic=262144),Ti=a}else Ti=536870912;return a=bi.current,a!==null&&(a.flags|=32),Ti}function ci(a,c,h){(a===re&&(Qt===2||Qt===9)||a.cancelPendingCommit!==null)&&(xa(a,0),Es(a,zt,Ti,!1)),Eo(a,h),((qt&2)===0||a!==re)&&(a===re&&((qt&2)===0&&(yr|=h),ge===4&&Es(a,zt,Ti,!1)),hn(a))}function X2(a,c,h){if((qt&6)!==0)throw Error(n(327));var d=!h&&(c&127)===0&&(c&a.expiredLanes)===0||wo(a,c),m=d?AM(a,c):Lg(a,c,!0),y=d;do{if(m===0){ya&&!d&&Es(a,c,0,!1);break}else{if(h=a.current.alternate,y&&!wM(h)){m=Lg(a,c,!1),y=!1;continue}if(m===2){if(y=c,a.errorRecoveryDisabledLanes&y)var S=0;else S=a.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){c=S;t:{var A=a;m=nl;var L=A.current.memoizedState.isDehydrated;if(L&&(xa(A,S).flags|=256),S=Lg(A,S,!1),S!==2){if(Cg&&!L){A.errorRecoveryDisabledLanes|=y,yr|=y,m=4;break t}y=li,li=m,y!==null&&(li===null?li=y:li.push.apply(li,y))}m=S}if(y=!1,m!==2)continue}}if(m===1){xa(a,0),Es(a,c,0,!0);break}t:{switch(d=a,y=m,y){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:Es(d,c,Ti,!xs);break t;case 2:li=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(m=xu+300-pi(),10<m)){if(Es(d,c,Ti,!xs),Nc(d,0,!0)!==0)break t;Gn=c,d.timeoutHandle=Ev(Y2.bind(null,d,h,li,Tu,Pg,c,Ti,yr,va,xs,y,"Throttled",-0,0),m);break t}Y2(d,h,li,Tu,Pg,c,Ti,yr,va,xs,y,null,-0,0)}}break}while(!0);hn(a)}function Y2(a,c,h,d,m,y,S,A,L,q,it,rt,X,tt){if(a.timeoutHandle=-1,rt=c.subtreeFlags,rt&8192||(rt&16785408)===16785408){rt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pn},V2(c,y,rt);var vt=(y&62914560)===y?xu-pi():(y&4194048)===y?G2-pi():0;if(vt=lC(rt,vt),vt!==null){Gn=y,a.cancelPendingCommit=vt(nv.bind(null,a,c,y,h,d,m,S,A,L,it,rt,null,X,tt)),Es(a,y,S,!q);return}}nv(a,c,y,h,d,m,S,A,L)}function wM(a){for(var c=a;;){var h=c.tag;if((h===0||h===11||h===15)&&c.flags&16384&&(h=c.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var d=0;d<h.length;d++){var m=h[d],y=m.getSnapshot;m=m.value;try{if(!yi(y(),m))return!1}catch{return!1}}if(h=c.child,c.subtreeFlags&16384&&h!==null)h.return=c,c=h;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Es(a,c,h,d){c&=~Rg,c&=~yr,a.suspendedLanes|=c,a.pingedLanes&=~c,d&&(a.warmLanes|=c),d=a.expirationTimes;for(var m=c;0<m;){var y=31-mi(m),S=1<<y;d[y]=-1,m&=~S}h!==0&&ry(a,h,c)}function wu(){return(qt&6)===0?(rl(0),!1):!0}function Dg(){if(Bt!==null){if(Qt===0)var a=Bt.return;else a=Bt,Dn=cr=null,Kd(a),ha=null,Vo=0,a=Bt;for(;a!==null;)A2(a.alternate,a),a=a.return;Bt=null}}function xa(a,c){var h=a.timeoutHandle;h!==-1&&(a.timeoutHandle=-1,$M(h)),h=a.cancelPendingCommit,h!==null&&(a.cancelPendingCommit=null,h()),Gn=0,Dg(),re=a,Bt=h=On(a.current,null),zt=c,Qt=0,Si=null,xs=!1,ya=wo(a,c),Cg=!1,va=Ti=Rg=yr=Ss=ge=0,li=nl=null,Pg=!1,(c&8)!==0&&(c|=c&32);var d=a.entangledLanes;if(d!==0)for(a=a.entanglements,d&=c;0<d;){var m=31-mi(d),y=1<<m;c|=a[m],d&=~y}return $n=c,Gc(),h}function K2(a,c){Pt=null,C.H=Yo,c===ua||c===Jc?(c=f1(),Qt=3):c===Ud?(c=f1(),Qt=4):Qt=c===fg?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Si=c,Bt===null&&(ge=1,du(a,Ni(c,a.current)))}function Z2(){var a=bi.current;return a===null?!0:(zt&4194048)===zt?Bi===null:(zt&62914560)===zt||(zt&536870912)!==0?a===Bi:!1}function Q2(){var a=C.H;return C.H=Yo,a===null?Yo:a}function J2(){var a=C.A;return C.A=SM,a}function Eu(){ge=4,xs||(zt&4194048)!==zt&&bi.current!==null||(ya=!0),(Ss&134217727)===0&&(yr&134217727)===0||re===null||Es(re,zt,Ti,!1)}function Lg(a,c,h){var d=qt;qt|=2;var m=Q2(),y=J2();(re!==a||zt!==c)&&(Tu=null,xa(a,c)),c=!1;var S=ge;t:do try{if(Qt!==0&&Bt!==null){var A=Bt,L=Si;switch(Qt){case 8:Dg(),S=6;break t;case 3:case 2:case 9:case 6:bi.current===null&&(c=!0);var q=Qt;if(Qt=0,Si=null,Sa(a,A,L,q),h&&ya){S=0;break t}break;default:q=Qt,Qt=0,Si=null,Sa(a,A,L,q)}}EM(),S=ge;break}catch(it){K2(a,it)}while(!0);return c&&a.shellSuspendCounter++,Dn=cr=null,qt=d,C.H=m,C.A=y,Bt===null&&(re=null,zt=0,Gc()),S}function EM(){for(;Bt!==null;)tv(Bt)}function AM(a,c){var h=qt;qt|=2;var d=Q2(),m=J2();re!==a||zt!==c?(Tu=null,Su=pi()+500,xa(a,c)):ya=wo(a,c);t:do try{if(Qt!==0&&Bt!==null){c=Bt;var y=Si;e:switch(Qt){case 1:Qt=0,Si=null,Sa(a,c,y,1);break;case 2:case 9:if(u1(y)){Qt=0,Si=null,ev(c);break}c=function(){Qt!==2&&Qt!==9||re!==a||(Qt=7),hn(a)},y.then(c,c);break t;case 3:Qt=7;break t;case 4:Qt=5;break t;case 7:u1(y)?(Qt=0,Si=null,ev(c)):(Qt=0,Si=null,Sa(a,c,y,7));break;case 5:var S=null;switch(Bt.tag){case 26:S=Bt.memoizedState;case 5:case 27:var A=Bt;if(S?zv(S):A.stateNode.complete){Qt=0,Si=null;var L=A.sibling;if(L!==null)Bt=L;else{var q=A.return;q!==null?(Bt=q,Au(q)):Bt=null}break e}}Qt=0,Si=null,Sa(a,c,y,5);break;case 6:Qt=0,Si=null,Sa(a,c,y,6);break;case 8:Dg(),ge=6;break t;default:throw Error(n(462))}}MM();break}catch(it){K2(a,it)}while(!0);return Dn=cr=null,C.H=d,C.A=m,qt=h,Bt!==null?0:(re=null,zt=0,Gc(),ge)}function MM(){for(;Bt!==null&&!KA();)tv(Bt)}function tv(a){var c=w2(a.alternate,a,$n);a.memoizedProps=a.pendingProps,c===null?Au(a):Bt=c}function ev(a){var c=a,h=c.alternate;switch(c.tag){case 15:case 0:c=y2(h,c,c.pendingProps,c.type,void 0,zt);break;case 11:c=y2(h,c,c.pendingProps,c.type.render,c.ref,zt);break;case 5:Kd(c);default:A2(h,c),c=Bt=Jy(c,$n),c=w2(h,c,$n)}a.memoizedProps=a.pendingProps,c===null?Au(a):Bt=c}function Sa(a,c,h,d){Dn=cr=null,Kd(c),ha=null,Vo=0;var m=c.return;try{if(pM(a,m,c,h,zt)){ge=1,du(a,Ni(h,a.current)),Bt=null;return}}catch(y){if(m!==null)throw Bt=m,y;ge=1,du(a,Ni(h,a.current)),Bt=null;return}c.flags&32768?(jt||d===1?a=!0:ya||(zt&536870912)!==0?a=!1:(xs=a=!0,(d===2||d===9||d===3||d===6)&&(d=bi.current,d!==null&&d.tag===13&&(d.flags|=16384))),iv(c,a)):Au(c)}function Au(a){var c=a;do{if((c.flags&32768)!==0){iv(c,xs);return}a=c.return;var h=yM(c.alternate,c,$n);if(h!==null){Bt=h;return}if(c=c.sibling,c!==null){Bt=c;return}Bt=c=a}while(c!==null);ge===0&&(ge=5)}function iv(a,c){do{var h=vM(a.alternate,a);if(h!==null){h.flags&=32767,Bt=h;return}if(h=a.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!c&&(a=a.sibling,a!==null)){Bt=a;return}Bt=a=h}while(a!==null);ge=6,Bt=null}function nv(a,c,h,d,m,y,S,A,L){a.cancelPendingCommit=null;do Mu();while(Ie!==0);if((qt&6)!==0)throw Error(n(327));if(c!==null){if(c===a.current)throw Error(n(177));if(y=c.lanes|c.childLanes,y|=Td,a4(a,h,y,S,A,L),a===re&&(Bt=re=null,zt=0),ba=c,ws=a,Gn=h,Ig=y,Og=m,W2=d,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,IM(Rc,function(){return lv(),null})):(a.callbackNode=null,a.callbackPriority=0),d=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||d){d=C.T,C.T=null,m=N.p,N.p=2,S=qt,qt|=4;try{bM(a,c,h)}finally{qt=S,N.p=m,C.T=d}}Ie=1,sv(),rv(),av()}}function sv(){if(Ie===1){Ie=0;var a=ws,c=ba,h=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||h){h=C.T,C.T=null;var d=N.p;N.p=2;var m=qt;qt|=4;try{U2(c,a);var y=qg,S=$y(a.containerInfo),A=y.focusedElem,L=y.selectionRange;if(S!==A&&A&&A.ownerDocument&&Hy(A.ownerDocument.documentElement,A)){if(L!==null&&yd(A)){var q=L.start,it=L.end;if(it===void 0&&(it=q),"selectionStart"in A)A.selectionStart=q,A.selectionEnd=Math.min(it,A.value.length);else{var rt=A.ownerDocument||document,X=rt&&rt.defaultView||window;if(X.getSelection){var tt=X.getSelection(),vt=A.textContent.length,Et=Math.min(L.start,vt),ie=L.end===void 0?Et:Math.min(L.end,vt);!tt.extend&&Et>ie&&(S=ie,ie=Et,Et=S);var H=jy(A,Et),F=jy(A,ie);if(H&&F&&(tt.rangeCount!==1||tt.anchorNode!==H.node||tt.anchorOffset!==H.offset||tt.focusNode!==F.node||tt.focusOffset!==F.offset)){var W=rt.createRange();W.setStart(H.node,H.offset),tt.removeAllRanges(),Et>ie?(tt.addRange(W),tt.extend(F.node,F.offset)):(W.setEnd(F.node,F.offset),tt.addRange(W))}}}}for(rt=[],tt=A;tt=tt.parentNode;)tt.nodeType===1&&rt.push({element:tt,left:tt.scrollLeft,top:tt.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<rt.length;A++){var nt=rt[A];nt.element.scrollLeft=nt.left,nt.element.scrollTop=nt.top}}Fu=!!Wg,qg=Wg=null}finally{qt=m,N.p=d,C.T=h}}a.current=c,Ie=2}}function rv(){if(Ie===2){Ie=0;var a=ws,c=ba,h=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||h){h=C.T,C.T=null;var d=N.p;N.p=2;var m=qt;qt|=4;try{N2(a,c.alternate,c)}finally{qt=m,N.p=d,C.T=h}}Ie=3}}function av(){if(Ie===4||Ie===3){Ie=0,ZA();var a=ws,c=ba,h=Gn,d=W2;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Ie=5:(Ie=0,ba=ws=null,ov(a,a.pendingLanes));var m=a.pendingLanes;if(m===0&&(Ts=null),Jf(h),c=c.stateNode,_i&&typeof _i.onCommitFiberRoot=="function")try{_i.onCommitFiberRoot(To,c,void 0,(c.current.flags&128)===128)}catch{}if(d!==null){c=C.T,m=N.p,N.p=2,C.T=null;try{for(var y=a.onRecoverableError,S=0;S<d.length;S++){var A=d[S];y(A.value,{componentStack:A.stack})}}finally{C.T=c,N.p=m}}(Gn&3)!==0&&Mu(),hn(a),m=a.pendingLanes,(h&261930)!==0&&(m&42)!==0?a===Ng?sl++:(sl=0,Ng=a):sl=0,rl(0)}}function ov(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Fo(c)))}function Mu(){return sv(),rv(),av(),lv()}function lv(){if(Ie!==5)return!1;var a=ws,c=Ig;Ig=0;var h=Jf(Gn),d=C.T,m=N.p;try{N.p=32>h?32:h,C.T=null,h=Og,Og=null;var y=ws,S=Gn;if(Ie=0,ba=ws=null,Gn=0,(qt&6)!==0)throw Error(n(331));var A=qt;if(qt|=4,H2(y.current),z2(y,y.current,S,h),qt=A,rl(0,!1),_i&&typeof _i.onPostCommitFiberRoot=="function")try{_i.onPostCommitFiberRoot(To,y)}catch{}return!0}finally{N.p=m,C.T=d,ov(a,c)}}function cv(a,c,h){c=Ni(h,c),c=hg(a.stateNode,c,2),a=ms(a,c,2),a!==null&&(Eo(a,2),hn(a))}function Jt(a,c,h){if(a.tag===3)cv(a,a,h);else for(;c!==null;){if(c.tag===3){cv(c,a,h);break}else if(c.tag===1){var d=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ts===null||!Ts.has(d))){a=Ni(h,a),h=u2(2),d=ms(c,h,2),d!==null&&(h2(h,d,c,a),Eo(d,2),hn(d));break}}c=c.return}}function kg(a,c,h){var d=a.pingCache;if(d===null){d=a.pingCache=new TM;var m=new Set;d.set(c,m)}else m=d.get(c),m===void 0&&(m=new Set,d.set(c,m));m.has(h)||(Cg=!0,m.add(h),a=CM.bind(null,a,c,h),c.then(a,a))}function CM(a,c,h){var d=a.pingCache;d!==null&&d.delete(c),a.pingedLanes|=a.suspendedLanes&h,a.warmLanes&=~h,re===a&&(zt&h)===h&&(ge===4||ge===3&&(zt&62914560)===zt&&300>pi()-xu?(qt&2)===0&&xa(a,0):Rg|=h,va===zt&&(va=0)),hn(a)}function uv(a,c){c===0&&(c=sy()),a=ar(a,c),a!==null&&(Eo(a,c),hn(a))}function RM(a){var c=a.memoizedState,h=0;c!==null&&(h=c.retryLane),uv(a,h)}function PM(a,c){var h=0;switch(a.tag){case 31:case 13:var d=a.stateNode,m=a.memoizedState;m!==null&&(h=m.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(c),uv(a,h)}function IM(a,c){return Yf(a,c)}var Cu=null,Ta=null,Bg=!1,Ru=!1,Ug=!1,As=0;function hn(a){a!==Ta&&a.next===null&&(Ta===null?Cu=Ta=a:Ta=Ta.next=a),Ru=!0,Bg||(Bg=!0,NM())}function rl(a,c){if(!Ug&&Ru){Ug=!0;do for(var h=!1,d=Cu;d!==null;){if(a!==0){var m=d.pendingLanes;if(m===0)var y=0;else{var S=d.suspendedLanes,A=d.pingedLanes;y=(1<<31-mi(42|a)+1)-1,y&=m&~(S&~A),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(h=!0,gv(d,y))}else y=zt,y=Nc(d,d===re?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||wo(d,y)||(h=!0,gv(d,y));d=d.next}while(h);Ug=!1}}function OM(){hv()}function hv(){Ru=Bg=!1;var a=0;As!==0&&HM()&&(a=As);for(var c=pi(),h=null,d=Cu;d!==null;){var m=d.next,y=fv(d,c);y===0?(d.next=null,h===null?Cu=m:h.next=m,m===null&&(Ta=h)):(h=d,(a!==0||(y&3)!==0)&&(Ru=!0)),d=m}Ie!==0&&Ie!==5||rl(a),As!==0&&(As=0)}function fv(a,c){for(var h=a.suspendedLanes,d=a.pingedLanes,m=a.expirationTimes,y=a.pendingLanes&-62914561;0<y;){var S=31-mi(y),A=1<<S,L=m[S];L===-1?((A&h)===0||(A&d)!==0)&&(m[S]=r4(A,c)):L<=c&&(a.expiredLanes|=A),y&=~A}if(c=re,h=zt,h=Nc(a,a===c?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),d=a.callbackNode,h===0||a===c&&(Qt===2||Qt===9)||a.cancelPendingCommit!==null)return d!==null&&d!==null&&Kf(d),a.callbackNode=null,a.callbackPriority=0;if((h&3)===0||wo(a,h)){if(c=h&-h,c===a.callbackPriority)return c;switch(d!==null&&Kf(d),Jf(h)){case 2:case 8:h=iy;break;case 32:h=Rc;break;case 268435456:h=ny;break;default:h=Rc}return d=dv.bind(null,a),h=Yf(h,d),a.callbackPriority=c,a.callbackNode=h,c}return d!==null&&d!==null&&Kf(d),a.callbackPriority=2,a.callbackNode=null,2}function dv(a,c){if(Ie!==0&&Ie!==5)return a.callbackNode=null,a.callbackPriority=0,null;var h=a.callbackNode;if(Mu()&&a.callbackNode!==h)return null;var d=zt;return d=Nc(a,a===re?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),d===0?null:(X2(a,d,c),fv(a,pi()),a.callbackNode!=null&&a.callbackNode===h?dv.bind(null,a):null)}function gv(a,c){if(Mu())return null;X2(a,c,!0)}function NM(){GM(function(){(qt&6)!==0?Yf(ey,OM):hv()})}function Fg(){if(As===0){var a=la;a===0&&(a=Pc,Pc<<=1,(Pc&261888)===0&&(Pc=256)),As=a}return As}function pv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Bc(""+a)}function _v(a,c){var h=c.ownerDocument.createElement("input");return h.name=c.name,h.value=c.value,a.id&&h.setAttribute("form",a.id),c.parentNode.insertBefore(h,c),a=new FormData(a),h.parentNode.removeChild(h),a}function DM(a,c,h,d,m){if(c==="submit"&&h&&h.stateNode===m){var y=pv((m[ni]||null).action),S=d.submitter;S&&(c=(c=S[ni]||null)?pv(c.formAction):S.getAttribute("formAction"),c!==null&&(y=c,S=null));var A=new Vc("action","action",null,d,m);a.push({event:A,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(As!==0){var L=S?_v(m,S):new FormData(m);rg(h,{pending:!0,data:L,method:m.method,action:y},null,L)}}else typeof y=="function"&&(A.preventDefault(),L=S?_v(m,S):new FormData(m),rg(h,{pending:!0,data:L,method:m.method,action:y},y,L))},currentTarget:m}]})}}for(var zg=0;zg<Sd.length;zg++){var Vg=Sd[zg],LM=Vg.toLowerCase(),kM=Vg[0].toUpperCase()+Vg.slice(1);qi(LM,"on"+kM)}qi(qy,"onAnimationEnd"),qi(Xy,"onAnimationIteration"),qi(Yy,"onAnimationStart"),qi("dblclick","onDoubleClick"),qi("focusin","onFocus"),qi("focusout","onBlur"),qi(Q4,"onTransitionRun"),qi(J4,"onTransitionStart"),qi(tM,"onTransitionCancel"),qi(Ky,"onTransitionEnd"),Xr("onMouseEnter",["mouseout","mouseover"]),Xr("onMouseLeave",["mouseout","mouseover"]),Xr("onPointerEnter",["pointerout","pointerover"]),Xr("onPointerLeave",["pointerout","pointerover"]),ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ir("onBeforeInput",["compositionend","keypress","textInput","paste"]),ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var al="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(al));function mv(a,c){c=(c&4)!==0;for(var h=0;h<a.length;h++){var d=a[h],m=d.event;d=d.listeners;t:{var y=void 0;if(c)for(var S=d.length-1;0<=S;S--){var A=d[S],L=A.instance,q=A.currentTarget;if(A=A.listener,L!==y&&m.isPropagationStopped())break t;y=A,m.currentTarget=q;try{y(m)}catch(it){$c(it)}m.currentTarget=null,y=L}else for(S=0;S<d.length;S++){if(A=d[S],L=A.instance,q=A.currentTarget,A=A.listener,L!==y&&m.isPropagationStopped())break t;y=A,m.currentTarget=q;try{y(m)}catch(it){$c(it)}m.currentTarget=null,y=L}}}}function Ut(a,c){var h=c[td];h===void 0&&(h=c[td]=new Set);var d=a+"__bubble";h.has(d)||(yv(c,a,2,!1),h.add(d))}function jg(a,c,h){var d=0;c&&(d|=4),yv(h,a,d,c)}var Pu="_reactListening"+Math.random().toString(36).slice(2);function Hg(a){if(!a[Pu]){a[Pu]=!0,hy.forEach(function(h){h!=="selectionchange"&&(BM.has(h)||jg(h,!1,a),jg(h,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Pu]||(c[Pu]=!0,jg("selectionchange",!1,c))}}function yv(a,c,h,d){switch(qv(c)){case 2:var m=hC;break;case 8:m=fC;break;default:m=sp}h=m.bind(null,c,h,a),m=void 0,!cd||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(m=!0),d?m!==void 0?a.addEventListener(c,h,{capture:!0,passive:m}):a.addEventListener(c,h,!0):m!==void 0?a.addEventListener(c,h,{passive:m}):a.addEventListener(c,h,!1)}function $g(a,c,h,d,m){var y=d;if((c&1)===0&&(c&2)===0&&d!==null)t:for(;;){if(d===null)return;var S=d.tag;if(S===3||S===4){var A=d.stateNode.containerInfo;if(A===m)break;if(S===4)for(S=d.return;S!==null;){var L=S.tag;if((L===3||L===4)&&S.stateNode.containerInfo===m)return;S=S.return}for(;A!==null;){if(S=Gr(A),S===null)return;if(L=S.tag,L===5||L===6||L===26||L===27){d=y=S;continue t}A=A.parentNode}}d=d.return}Ty(function(){var q=y,it=od(h),rt=[];t:{var X=Zy.get(a);if(X!==void 0){var tt=Vc,vt=a;switch(a){case"keypress":if(Fc(h)===0)break t;case"keydown":case"keyup":tt=P4;break;case"focusin":vt="focus",tt=dd;break;case"focusout":vt="blur",tt=dd;break;case"beforeblur":case"afterblur":tt=dd;break;case"click":if(h.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=Ay;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=y4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=N4;break;case qy:case Xy:case Yy:tt=x4;break;case Ky:tt=L4;break;case"scroll":case"scrollend":tt=_4;break;case"wheel":tt=B4;break;case"copy":case"cut":case"paste":tt=T4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=Cy;break;case"toggle":case"beforetoggle":tt=F4}var Et=(c&4)!==0,ie=!Et&&(a==="scroll"||a==="scrollend"),H=Et?X!==null?X+"Capture":null:X;Et=[];for(var F=q,W;F!==null;){var nt=F;if(W=nt.stateNode,nt=nt.tag,nt!==5&&nt!==26&&nt!==27||W===null||H===null||(nt=Co(F,H),nt!=null&&Et.push(ol(F,nt,W))),ie)break;F=F.return}0<Et.length&&(X=new tt(X,vt,null,h,it),rt.push({event:X,listeners:Et}))}}if((c&7)===0){t:{if(X=a==="mouseover"||a==="pointerover",tt=a==="mouseout"||a==="pointerout",X&&h!==ad&&(vt=h.relatedTarget||h.fromElement)&&(Gr(vt)||vt[$r]))break t;if((tt||X)&&(X=it.window===it?it:(X=it.ownerDocument)?X.defaultView||X.parentWindow:window,tt?(vt=h.relatedTarget||h.toElement,tt=q,vt=vt?Gr(vt):null,vt!==null&&(ie=r(vt),Et=vt.tag,vt!==ie||Et!==5&&Et!==27&&Et!==6)&&(vt=null)):(tt=null,vt=q),tt!==vt)){if(Et=Ay,nt="onMouseLeave",H="onMouseEnter",F="mouse",(a==="pointerout"||a==="pointerover")&&(Et=Cy,nt="onPointerLeave",H="onPointerEnter",F="pointer"),ie=tt==null?X:Mo(tt),W=vt==null?X:Mo(vt),X=new Et(nt,F+"leave",tt,h,it),X.target=ie,X.relatedTarget=W,nt=null,Gr(it)===q&&(Et=new Et(H,F+"enter",vt,h,it),Et.target=W,Et.relatedTarget=ie,nt=Et),ie=nt,tt&&vt)e:{for(Et=UM,H=tt,F=vt,W=0,nt=H;nt;nt=Et(nt))W++;nt=0;for(var wt=F;wt;wt=Et(wt))nt++;for(;0<W-nt;)H=Et(H),W--;for(;0<nt-W;)F=Et(F),nt--;for(;W--;){if(H===F||F!==null&&H===F.alternate){Et=H;break e}H=Et(H),F=Et(F)}Et=null}else Et=null;tt!==null&&vv(rt,X,tt,Et,!1),vt!==null&&ie!==null&&vv(rt,ie,vt,Et,!0)}}t:{if(X=q?Mo(q):window,tt=X.nodeName&&X.nodeName.toLowerCase(),tt==="select"||tt==="input"&&X.type==="file")var Gt=ky;else if(Dy(X))if(By)Gt=Y4;else{Gt=q4;var Tt=W4}else tt=X.nodeName,!tt||tt.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?q&&rd(q.elementType)&&(Gt=ky):Gt=X4;if(Gt&&(Gt=Gt(a,q))){Ly(rt,Gt,h,it);break t}Tt&&Tt(a,X,q),a==="focusout"&&q&&X.type==="number"&&q.memoizedProps.value!=null&&sd(X,"number",X.value)}switch(Tt=q?Mo(q):window,a){case"focusin":(Dy(Tt)||Tt.contentEditable==="true")&&(ta=Tt,vd=q,ko=null);break;case"focusout":ko=vd=ta=null;break;case"mousedown":bd=!0;break;case"contextmenu":case"mouseup":case"dragend":bd=!1,Gy(rt,h,it);break;case"selectionchange":if(Z4)break;case"keydown":case"keyup":Gy(rt,h,it)}var Nt;if(pd)t:{switch(a){case"compositionstart":var Vt="onCompositionStart";break t;case"compositionend":Vt="onCompositionEnd";break t;case"compositionupdate":Vt="onCompositionUpdate";break t}Vt=void 0}else Jr?Oy(a,h)&&(Vt="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(Vt="onCompositionStart");Vt&&(Ry&&h.locale!=="ko"&&(Jr||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&Jr&&(Nt=wy()):(us=it,ud="value"in us?us.value:us.textContent,Jr=!0)),Tt=Iu(q,Vt),0<Tt.length&&(Vt=new My(Vt,a,null,h,it),rt.push({event:Vt,listeners:Tt}),Nt?Vt.data=Nt:(Nt=Ny(h),Nt!==null&&(Vt.data=Nt)))),(Nt=V4?j4(a,h):H4(a,h))&&(Vt=Iu(q,"onBeforeInput"),0<Vt.length&&(Tt=new My("onBeforeInput","beforeinput",null,h,it),rt.push({event:Tt,listeners:Vt}),Tt.data=Nt)),DM(rt,a,q,h,it)}mv(rt,c)})}function ol(a,c,h){return{instance:a,listener:c,currentTarget:h}}function Iu(a,c){for(var h=c+"Capture",d=[];a!==null;){var m=a,y=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||y===null||(m=Co(a,h),m!=null&&d.unshift(ol(a,m,y)),m=Co(a,c),m!=null&&d.push(ol(a,m,y))),a.tag===3)return d;a=a.return}return[]}function UM(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function vv(a,c,h,d,m){for(var y=c._reactName,S=[];h!==null&&h!==d;){var A=h,L=A.alternate,q=A.stateNode;if(A=A.tag,L!==null&&L===d)break;A!==5&&A!==26&&A!==27||q===null||(L=q,m?(q=Co(h,y),q!=null&&S.unshift(ol(h,q,L))):m||(q=Co(h,y),q!=null&&S.push(ol(h,q,L)))),h=h.return}S.length!==0&&a.push({event:c,listeners:S})}var FM=/\r\n?/g,zM=/\u0000|\uFFFD/g;function bv(a){return(typeof a=="string"?a:""+a).replace(FM,`
`).replace(zM,"")}function xv(a,c){return c=bv(c),bv(a)===c}function ee(a,c,h,d,m,y){switch(h){case"children":typeof d=="string"?c==="body"||c==="textarea"&&d===""||Kr(a,d):(typeof d=="number"||typeof d=="bigint")&&c!=="body"&&Kr(a,""+d);break;case"className":Lc(a,"class",d);break;case"tabIndex":Lc(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Lc(a,h,d);break;case"style":xy(a,d,y);break;case"data":if(c!=="object"){Lc(a,"data",d);break}case"src":case"href":if(d===""&&(c!=="a"||h!=="href")){a.removeAttribute(h);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(h);break}d=Bc(""+d),a.setAttribute(h,d);break;case"action":case"formAction":if(typeof d=="function"){a.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(h==="formAction"?(c!=="input"&&ee(a,c,"name",m.name,m,null),ee(a,c,"formEncType",m.formEncType,m,null),ee(a,c,"formMethod",m.formMethod,m,null),ee(a,c,"formTarget",m.formTarget,m,null)):(ee(a,c,"encType",m.encType,m,null),ee(a,c,"method",m.method,m,null),ee(a,c,"target",m.target,m,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(h);break}d=Bc(""+d),a.setAttribute(h,d);break;case"onClick":d!=null&&(a.onclick=Pn);break;case"onScroll":d!=null&&Ut("scroll",a);break;case"onScrollEnd":d!=null&&Ut("scrollend",a);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(h=d.__html,h!=null){if(m.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"multiple":a.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":a.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){a.removeAttribute("xlink:href");break}h=Bc(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(h,""+d):a.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(h,""):a.removeAttribute(h);break;case"capture":case"download":d===!0?a.setAttribute(h,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(h,d):a.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?a.setAttribute(h,d):a.removeAttribute(h);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?a.removeAttribute(h):a.setAttribute(h,d);break;case"popover":Ut("beforetoggle",a),Ut("toggle",a),Dc(a,"popover",d);break;case"xlinkActuate":Rn(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Rn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Rn(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Rn(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Rn(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Rn(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Rn(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Rn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Rn(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Dc(a,"is",d);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=g4.get(h)||h,Dc(a,h,d))}}function Gg(a,c,h,d,m,y){switch(h){case"style":xy(a,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(h=d.__html,h!=null){if(m.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"children":typeof d=="string"?Kr(a,d):(typeof d=="number"||typeof d=="bigint")&&Kr(a,""+d);break;case"onScroll":d!=null&&Ut("scroll",a);break;case"onScrollEnd":d!=null&&Ut("scrollend",a);break;case"onClick":d!=null&&(a.onclick=Pn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fy.hasOwnProperty(h))t:{if(h[0]==="o"&&h[1]==="n"&&(m=h.endsWith("Capture"),c=h.slice(2,m?h.length-7:void 0),y=a[ni]||null,y=y!=null?y[h]:null,typeof y=="function"&&a.removeEventListener(c,y,m),typeof d=="function")){typeof y!="function"&&y!==null&&(h in a?a[h]=null:a.hasAttribute(h)&&a.removeAttribute(h)),a.addEventListener(c,d,m);break t}h in a?a[h]=d:d===!0?a.setAttribute(h,""):Dc(a,h,d)}}}function Ve(a,c,h){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ut("error",a),Ut("load",a);var d=!1,m=!1,y;for(y in h)if(h.hasOwnProperty(y)){var S=h[y];if(S!=null)switch(y){case"src":d=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ee(a,c,y,S,h,null)}}m&&ee(a,c,"srcSet",h.srcSet,h,null),d&&ee(a,c,"src",h.src,h,null);return;case"input":Ut("invalid",a);var A=y=S=m=null,L=null,q=null;for(d in h)if(h.hasOwnProperty(d)){var it=h[d];if(it!=null)switch(d){case"name":m=it;break;case"type":S=it;break;case"checked":L=it;break;case"defaultChecked":q=it;break;case"value":y=it;break;case"defaultValue":A=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(n(137,c));break;default:ee(a,c,d,it,h,null)}}my(a,y,A,L,q,S,m,!1);return;case"select":Ut("invalid",a),d=S=y=null;for(m in h)if(h.hasOwnProperty(m)&&(A=h[m],A!=null))switch(m){case"value":y=A;break;case"defaultValue":S=A;break;case"multiple":d=A;default:ee(a,c,m,A,h,null)}c=y,h=S,a.multiple=!!d,c!=null?Yr(a,!!d,c,!1):h!=null&&Yr(a,!!d,h,!0);return;case"textarea":Ut("invalid",a),y=m=d=null;for(S in h)if(h.hasOwnProperty(S)&&(A=h[S],A!=null))switch(S){case"value":d=A;break;case"defaultValue":m=A;break;case"children":y=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(n(91));break;default:ee(a,c,S,A,h,null)}vy(a,d,m,y);return;case"option":for(L in h)h.hasOwnProperty(L)&&(d=h[L],d!=null)&&(L==="selected"?a.selected=d&&typeof d!="function"&&typeof d!="symbol":ee(a,c,L,d,h,null));return;case"dialog":Ut("beforetoggle",a),Ut("toggle",a),Ut("cancel",a),Ut("close",a);break;case"iframe":case"object":Ut("load",a);break;case"video":case"audio":for(d=0;d<al.length;d++)Ut(al[d],a);break;case"image":Ut("error",a),Ut("load",a);break;case"details":Ut("toggle",a);break;case"embed":case"source":case"link":Ut("error",a),Ut("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in h)if(h.hasOwnProperty(q)&&(d=h[q],d!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ee(a,c,q,d,h,null)}return;default:if(rd(c)){for(it in h)h.hasOwnProperty(it)&&(d=h[it],d!==void 0&&Gg(a,c,it,d,h,void 0));return}}for(A in h)h.hasOwnProperty(A)&&(d=h[A],d!=null&&ee(a,c,A,d,h,null))}function VM(a,c,h,d){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,y=null,S=null,A=null,L=null,q=null,it=null;for(tt in h){var rt=h[tt];if(h.hasOwnProperty(tt)&&rt!=null)switch(tt){case"checked":break;case"value":break;case"defaultValue":L=rt;default:d.hasOwnProperty(tt)||ee(a,c,tt,null,d,rt)}}for(var X in d){var tt=d[X];if(rt=h[X],d.hasOwnProperty(X)&&(tt!=null||rt!=null))switch(X){case"type":y=tt;break;case"name":m=tt;break;case"checked":q=tt;break;case"defaultChecked":it=tt;break;case"value":S=tt;break;case"defaultValue":A=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(n(137,c));break;default:tt!==rt&&ee(a,c,X,tt,d,rt)}}nd(a,S,A,L,q,it,y,m);return;case"select":tt=S=A=X=null;for(y in h)if(L=h[y],h.hasOwnProperty(y)&&L!=null)switch(y){case"value":break;case"multiple":tt=L;default:d.hasOwnProperty(y)||ee(a,c,y,null,d,L)}for(m in d)if(y=d[m],L=h[m],d.hasOwnProperty(m)&&(y!=null||L!=null))switch(m){case"value":X=y;break;case"defaultValue":A=y;break;case"multiple":S=y;default:y!==L&&ee(a,c,m,y,d,L)}c=A,h=S,d=tt,X!=null?Yr(a,!!h,X,!1):!!d!=!!h&&(c!=null?Yr(a,!!h,c,!0):Yr(a,!!h,h?[]:"",!1));return;case"textarea":tt=X=null;for(A in h)if(m=h[A],h.hasOwnProperty(A)&&m!=null&&!d.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:ee(a,c,A,null,d,m)}for(S in d)if(m=d[S],y=h[S],d.hasOwnProperty(S)&&(m!=null||y!=null))switch(S){case"value":X=m;break;case"defaultValue":tt=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(n(91));break;default:m!==y&&ee(a,c,S,m,d,y)}yy(a,X,tt);return;case"option":for(var vt in h)X=h[vt],h.hasOwnProperty(vt)&&X!=null&&!d.hasOwnProperty(vt)&&(vt==="selected"?a.selected=!1:ee(a,c,vt,null,d,X));for(L in d)X=d[L],tt=h[L],d.hasOwnProperty(L)&&X!==tt&&(X!=null||tt!=null)&&(L==="selected"?a.selected=X&&typeof X!="function"&&typeof X!="symbol":ee(a,c,L,X,d,tt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Et in h)X=h[Et],h.hasOwnProperty(Et)&&X!=null&&!d.hasOwnProperty(Et)&&ee(a,c,Et,null,d,X);for(q in d)if(X=d[q],tt=h[q],d.hasOwnProperty(q)&&X!==tt&&(X!=null||tt!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(n(137,c));break;default:ee(a,c,q,X,d,tt)}return;default:if(rd(c)){for(var ie in h)X=h[ie],h.hasOwnProperty(ie)&&X!==void 0&&!d.hasOwnProperty(ie)&&Gg(a,c,ie,void 0,d,X);for(it in d)X=d[it],tt=h[it],!d.hasOwnProperty(it)||X===tt||X===void 0&&tt===void 0||Gg(a,c,it,X,d,tt);return}}for(var H in h)X=h[H],h.hasOwnProperty(H)&&X!=null&&!d.hasOwnProperty(H)&&ee(a,c,H,null,d,X);for(rt in d)X=d[rt],tt=h[rt],!d.hasOwnProperty(rt)||X===tt||X==null&&tt==null||ee(a,c,rt,X,d,tt)}function Sv(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function jM(){if(typeof performance.getEntriesByType=="function"){for(var a=0,c=0,h=performance.getEntriesByType("resource"),d=0;d<h.length;d++){var m=h[d],y=m.transferSize,S=m.initiatorType,A=m.duration;if(y&&A&&Sv(S)){for(S=0,A=m.responseEnd,d+=1;d<h.length;d++){var L=h[d],q=L.startTime;if(q>A)break;var it=L.transferSize,rt=L.initiatorType;it&&Sv(rt)&&(L=L.responseEnd,S+=it*(L<A?1:(A-q)/(L-q)))}if(--d,c+=8*(y+S)/(m.duration/1e3),a++,10<a)break}}if(0<a)return c/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Wg=null,qg=null;function Ou(a){return a.nodeType===9?a:a.ownerDocument}function Tv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function wv(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function Xg(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Yg=null;function HM(){var a=window.event;return a&&a.type==="popstate"?a===Yg?!1:(Yg=a,!0):(Yg=null,!1)}var Ev=typeof setTimeout=="function"?setTimeout:void 0,$M=typeof clearTimeout=="function"?clearTimeout:void 0,Av=typeof Promise=="function"?Promise:void 0,GM=typeof queueMicrotask=="function"?queueMicrotask:typeof Av<"u"?function(a){return Av.resolve(null).then(a).catch(WM)}:Ev;function WM(a){setTimeout(function(){throw a})}function Ms(a){return a==="head"}function Mv(a,c){var h=c,d=0;do{var m=h.nextSibling;if(a.removeChild(h),m&&m.nodeType===8)if(h=m.data,h==="/$"||h==="/&"){if(d===0){a.removeChild(m),Ma(c);return}d--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")d++;else if(h==="html")ll(a.ownerDocument.documentElement);else if(h==="head"){h=a.ownerDocument.head,ll(h);for(var y=h.firstChild;y;){var S=y.nextSibling,A=y.nodeName;y[Ao]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&y.rel.toLowerCase()==="stylesheet"||h.removeChild(y),y=S}}else h==="body"&&ll(a.ownerDocument.body);h=m}while(h);Ma(c)}function Cv(a,c){var h=a;a=0;do{var d=h.nextSibling;if(h.nodeType===1?c?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(c?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),d&&d.nodeType===8)if(h=d.data,h==="/$"){if(a===0)break;a--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||a++;h=d}while(h)}function Kg(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var h=c;switch(c=c.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Kg(h),ed(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}a.removeChild(h)}}function qM(a,c,h,d){for(;a.nodeType===1;){var m=h;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!d&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(d){if(!a[Ao])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(y=a.getAttribute("rel"),y==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(y!==m.rel||a.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||a.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||a.getAttribute("title")!==(m.title==null?null:m.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(y=a.getAttribute("src"),(y!==(m.src==null?null:m.src)||a.getAttribute("type")!==(m.type==null?null:m.type)||a.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&y&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var y=m.name==null?null:""+m.name;if(m.type==="hidden"&&a.getAttribute("name")===y)return a}else return a;if(a=Ui(a.nextSibling),a===null)break}return null}function XM(a,c,h){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!h||(a=Ui(a.nextSibling),a===null))return null;return a}function Rv(a,c){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Ui(a.nextSibling),a===null))return null;return a}function Zg(a){return a.data==="$?"||a.data==="$~"}function Qg(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function YM(a,c){var h=a.ownerDocument;if(a.data==="$~")a._reactRetry=c;else if(a.data!=="$?"||h.readyState!=="loading")c();else{var d=function(){c(),h.removeEventListener("DOMContentLoaded",d)};h.addEventListener("DOMContentLoaded",d),a._reactRetry=d}}function Ui(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return a}var Jg=null;function Pv(a){a=a.nextSibling;for(var c=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"||h==="/&"){if(c===0)return Ui(a.nextSibling);c--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||c++}a=a.nextSibling}return null}function Iv(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(c===0)return a;c--}else h!=="/$"&&h!=="/&"||c++}a=a.previousSibling}return null}function Ov(a,c,h){switch(c=Ou(h),a){case"html":if(a=c.documentElement,!a)throw Error(n(452));return a;case"head":if(a=c.head,!a)throw Error(n(453));return a;case"body":if(a=c.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function ll(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);ed(a)}var Fi=new Map,Nv=new Set;function Nu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Wn=N.d;N.d={f:KM,r:ZM,D:QM,C:JM,L:tC,m:eC,X:nC,S:iC,M:sC};function KM(){var a=Wn.f(),c=wu();return a||c}function ZM(a){var c=Wr(a);c!==null&&c.tag===5&&c.type==="form"?K1(c):Wn.r(a)}var wa=typeof document>"u"?null:document;function Dv(a,c,h){var d=wa;if(d&&typeof c=="string"&&c){var m=Ii(c);m='link[rel="'+a+'"][href="'+m+'"]',typeof h=="string"&&(m+='[crossorigin="'+h+'"]'),Nv.has(m)||(Nv.add(m),a={rel:a,crossOrigin:h,href:c},d.querySelector(m)===null&&(c=d.createElement("link"),Ve(c,"link",a),De(c),d.head.appendChild(c)))}}function QM(a){Wn.D(a),Dv("dns-prefetch",a,null)}function JM(a,c){Wn.C(a,c),Dv("preconnect",a,c)}function tC(a,c,h){Wn.L(a,c,h);var d=wa;if(d&&a&&c){var m='link[rel="preload"][as="'+Ii(c)+'"]';c==="image"&&h&&h.imageSrcSet?(m+='[imagesrcset="'+Ii(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(m+='[imagesizes="'+Ii(h.imageSizes)+'"]')):m+='[href="'+Ii(a)+'"]';var y=m;switch(c){case"style":y=Ea(a);break;case"script":y=Aa(a)}Fi.has(y)||(a=p({rel:"preload",href:c==="image"&&h&&h.imageSrcSet?void 0:a,as:c},h),Fi.set(y,a),d.querySelector(m)!==null||c==="style"&&d.querySelector(cl(y))||c==="script"&&d.querySelector(ul(y))||(c=d.createElement("link"),Ve(c,"link",a),De(c),d.head.appendChild(c)))}}function eC(a,c){Wn.m(a,c);var h=wa;if(h&&a){var d=c&&typeof c.as=="string"?c.as:"script",m='link[rel="modulepreload"][as="'+Ii(d)+'"][href="'+Ii(a)+'"]',y=m;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Aa(a)}if(!Fi.has(y)&&(a=p({rel:"modulepreload",href:a},c),Fi.set(y,a),h.querySelector(m)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(ul(y)))return}d=h.createElement("link"),Ve(d,"link",a),De(d),h.head.appendChild(d)}}}function iC(a,c,h){Wn.S(a,c,h);var d=wa;if(d&&a){var m=qr(d).hoistableStyles,y=Ea(a);c=c||"default";var S=m.get(y);if(!S){var A={loading:0,preload:null};if(S=d.querySelector(cl(y)))A.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":c},h),(h=Fi.get(y))&&tp(a,h);var L=S=d.createElement("link");De(L),Ve(L,"link",a),L._p=new Promise(function(q,it){L.onload=q,L.onerror=it}),L.addEventListener("load",function(){A.loading|=1}),L.addEventListener("error",function(){A.loading|=2}),A.loading|=4,Du(S,c,d)}S={type:"stylesheet",instance:S,count:1,state:A},m.set(y,S)}}}function nC(a,c){Wn.X(a,c);var h=wa;if(h&&a){var d=qr(h).hoistableScripts,m=Aa(a),y=d.get(m);y||(y=h.querySelector(ul(m)),y||(a=p({src:a,async:!0},c),(c=Fi.get(m))&&ep(a,c),y=h.createElement("script"),De(y),Ve(y,"link",a),h.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(m,y))}}function sC(a,c){Wn.M(a,c);var h=wa;if(h&&a){var d=qr(h).hoistableScripts,m=Aa(a),y=d.get(m);y||(y=h.querySelector(ul(m)),y||(a=p({src:a,async:!0,type:"module"},c),(c=Fi.get(m))&&ep(a,c),y=h.createElement("script"),De(y),Ve(y,"link",a),h.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(m,y))}}function Lv(a,c,h,d){var m=(m=mt.current)?Nu(m):null;if(!m)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(c=Ea(h.href),h=qr(m).hoistableStyles,d=h.get(c),d||(d={type:"style",instance:null,count:0,state:null},h.set(c,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){a=Ea(h.href);var y=qr(m).hoistableStyles,S=y.get(a);if(S||(m=m.ownerDocument||m,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(a,S),(y=m.querySelector(cl(a)))&&!y._p&&(S.instance=y,S.state.loading=5),Fi.has(a)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Fi.set(a,h),y||rC(m,a,h,S.state))),c&&d===null)throw Error(n(528,""));return S}if(c&&d!==null)throw Error(n(529,""));return null;case"script":return c=h.async,h=h.src,typeof h=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Aa(h),h=qr(m).hoistableScripts,d=h.get(c),d||(d={type:"script",instance:null,count:0,state:null},h.set(c,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function Ea(a){return'href="'+Ii(a)+'"'}function cl(a){return'link[rel="stylesheet"]['+a+"]"}function kv(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function rC(a,c,h,d){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?d.loading=1:(c=a.createElement("link"),d.preload=c,c.addEventListener("load",function(){return d.loading|=1}),c.addEventListener("error",function(){return d.loading|=2}),Ve(c,"link",h),De(c),a.head.appendChild(c))}function Aa(a){return'[src="'+Ii(a)+'"]'}function ul(a){return"script[async]"+a}function Bv(a,c,h){if(c.count++,c.instance===null)switch(c.type){case"style":var d=a.querySelector('style[data-href~="'+Ii(h.href)+'"]');if(d)return c.instance=d,De(d),d;var m=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return d=(a.ownerDocument||a).createElement("style"),De(d),Ve(d,"style",m),Du(d,h.precedence,a),c.instance=d;case"stylesheet":m=Ea(h.href);var y=a.querySelector(cl(m));if(y)return c.state.loading|=4,c.instance=y,De(y),y;d=kv(h),(m=Fi.get(m))&&tp(d,m),y=(a.ownerDocument||a).createElement("link"),De(y);var S=y;return S._p=new Promise(function(A,L){S.onload=A,S.onerror=L}),Ve(y,"link",d),c.state.loading|=4,Du(y,h.precedence,a),c.instance=y;case"script":return y=Aa(h.src),(m=a.querySelector(ul(y)))?(c.instance=m,De(m),m):(d=h,(m=Fi.get(y))&&(d=p({},h),ep(d,m)),a=a.ownerDocument||a,m=a.createElement("script"),De(m),Ve(m,"link",d),a.head.appendChild(m),c.instance=m);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(d=c.instance,c.state.loading|=4,Du(d,h.precedence,a));return c.instance}function Du(a,c,h){for(var d=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=d.length?d[d.length-1]:null,y=m,S=0;S<d.length;S++){var A=d[S];if(A.dataset.precedence===c)y=A;else if(y!==m)break}y?y.parentNode.insertBefore(a,y.nextSibling):(c=h.nodeType===9?h.head:h,c.insertBefore(a,c.firstChild))}function tp(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function ep(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Lu=null;function Uv(a,c,h){if(Lu===null){var d=new Map,m=Lu=new Map;m.set(h,d)}else m=Lu,d=m.get(h),d||(d=new Map,m.set(h,d));if(d.has(a))return d;for(d.set(a,null),h=h.getElementsByTagName(a),m=0;m<h.length;m++){var y=h[m];if(!(y[Ao]||y[Be]||a==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var S=y.getAttribute(c)||"";S=a+S;var A=d.get(S);A?A.push(y):d.set(S,[y])}}return d}function Fv(a,c,h){a=a.ownerDocument||a,a.head.insertBefore(h,c==="title"?a.querySelector("head > title"):null)}function aC(a,c,h){if(h===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;return c.rel==="stylesheet"?(a=c.disabled,typeof c.precedence=="string"&&a==null):!0;case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function zv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function oC(a,c,h,d){if(h.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var m=Ea(d.href),y=c.querySelector(cl(m));if(y){c=y._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(a.count++,a=ku.bind(a),c.then(a,a)),h.state.loading|=4,h.instance=y,De(y);return}y=c.ownerDocument||c,d=kv(d),(m=Fi.get(m))&&tp(d,m),y=y.createElement("link"),De(y);var S=y;S._p=new Promise(function(A,L){S.onload=A,S.onerror=L}),Ve(y,"link",d),h.instance=y}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(h,c),(c=h.state.preload)&&(h.state.loading&3)===0&&(a.count++,h=ku.bind(a),c.addEventListener("load",h),c.addEventListener("error",h))}}var ip=0;function lC(a,c){return a.stylesheets&&a.count===0&&Uu(a,a.stylesheets),0<a.count||0<a.imgCount?function(h){var d=setTimeout(function(){if(a.stylesheets&&Uu(a,a.stylesheets),a.unsuspend){var y=a.unsuspend;a.unsuspend=null,y()}},6e4+c);0<a.imgBytes&&ip===0&&(ip=62500*jM());var m=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Uu(a,a.stylesheets),a.unsuspend)){var y=a.unsuspend;a.unsuspend=null,y()}},(a.imgBytes>ip?50:800)+c);return a.unsuspend=h,function(){a.unsuspend=null,clearTimeout(d),clearTimeout(m)}}:null}function ku(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Uu(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Bu=null;function Uu(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Bu=new Map,c.forEach(cC,a),Bu=null,ku.call(a))}function cC(a,c){if(!(c.state.loading&4)){var h=Bu.get(a);if(h)var d=h.get(null);else{h=new Map,Bu.set(a,h);for(var m=a.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<m.length;y++){var S=m[y];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(h.set(S.dataset.precedence,S),d=S)}d&&h.set(null,d)}m=c.instance,S=m.getAttribute("data-precedence"),y=h.get(S)||d,y===d&&h.set(null,m),h.set(S,m),this.count++,d=ku.bind(this),m.addEventListener("load",d),m.addEventListener("error",d),y?y.parentNode.insertBefore(m,y.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(m,a.firstChild)),c.state.loading|=4}}var hl={$$typeof:E,Provider:null,Consumer:null,_currentValue:D,_currentValue2:D,_threadCount:0};function uC(a,c,h,d,m,y,S,A,L){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Zf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zf(0),this.hiddenUpdates=Zf(null),this.identifierPrefix=d,this.onUncaughtError=m,this.onCaughtError=y,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Vv(a,c,h,d,m,y,S,A,L,q,it,rt){return a=new uC(a,c,h,S,L,q,it,rt,A),c=1,y===!0&&(c|=24),y=vi(3,null,null,c),a.current=y,y.stateNode=a,c=Ld(),c.refCount++,a.pooledCache=c,c.refCount++,y.memoizedState={element:d,isDehydrated:h,cache:c},Fd(y),a}function jv(a){return a?(a=na,a):na}function Hv(a,c,h,d,m,y){m=jv(m),d.context===null?d.context=m:d.pendingContext=m,d=_s(c),d.payload={element:h},y=y===void 0?null:y,y!==null&&(d.callback=y),h=ms(a,d,c),h!==null&&(ci(h,a,c),Ho(h,a,c))}function $v(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<c?h:c}}function np(a,c){$v(a,c),(a=a.alternate)&&$v(a,c)}function Gv(a){if(a.tag===13||a.tag===31){var c=ar(a,67108864);c!==null&&ci(c,a,67108864),np(a,67108864)}}function Wv(a){if(a.tag===13||a.tag===31){var c=wi();c=Qf(c);var h=ar(a,c);h!==null&&ci(h,a,c),np(a,c)}}var Fu=!0;function hC(a,c,h,d){var m=C.T;C.T=null;var y=N.p;try{N.p=2,sp(a,c,h,d)}finally{N.p=y,C.T=m}}function fC(a,c,h,d){var m=C.T;C.T=null;var y=N.p;try{N.p=8,sp(a,c,h,d)}finally{N.p=y,C.T=m}}function sp(a,c,h,d){if(Fu){var m=rp(d);if(m===null)$g(a,c,d,zu,h),Xv(a,d);else if(gC(m,a,c,h,d))d.stopPropagation();else if(Xv(a,d),c&4&&-1<dC.indexOf(a)){for(;m!==null;){var y=Wr(m);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var S=er(y.pendingLanes);if(S!==0){var A=y;for(A.pendingLanes|=2,A.entangledLanes|=2;S;){var L=1<<31-mi(S);A.entanglements[1]|=L,S&=~L}hn(y),(qt&6)===0&&(Su=pi()+500,rl(0))}}break;case 31:case 13:A=ar(y,2),A!==null&&ci(A,y,2),wu(),np(y,2)}if(y=rp(d),y===null&&$g(a,c,d,zu,h),y===m)break;m=y}m!==null&&d.stopPropagation()}else $g(a,c,d,null,h)}}function rp(a){return a=od(a),ap(a)}var zu=null;function ap(a){if(zu=null,a=Gr(a),a!==null){var c=r(a);if(c===null)a=null;else{var h=c.tag;if(h===13){if(a=o(c),a!==null)return a;a=null}else if(h===31){if(a=l(c),a!==null)return a;a=null}else if(h===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return zu=a,null}function qv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(QA()){case ey:return 2;case iy:return 8;case Rc:case JA:return 32;case ny:return 268435456;default:return 32}default:return 32}}var op=!1,Cs=null,Rs=null,Ps=null,fl=new Map,dl=new Map,Is=[],dC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Xv(a,c){switch(a){case"focusin":case"focusout":Cs=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Ps=null;break;case"pointerover":case"pointerout":fl.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":dl.delete(c.pointerId)}}function gl(a,c,h,d,m,y){return a===null||a.nativeEvent!==y?(a={blockedOn:c,domEventName:h,eventSystemFlags:d,nativeEvent:y,targetContainers:[m]},c!==null&&(c=Wr(c),c!==null&&Gv(c)),a):(a.eventSystemFlags|=d,c=a.targetContainers,m!==null&&c.indexOf(m)===-1&&c.push(m),a)}function gC(a,c,h,d,m){switch(c){case"focusin":return Cs=gl(Cs,a,c,h,d,m),!0;case"dragenter":return Rs=gl(Rs,a,c,h,d,m),!0;case"mouseover":return Ps=gl(Ps,a,c,h,d,m),!0;case"pointerover":var y=m.pointerId;return fl.set(y,gl(fl.get(y)||null,a,c,h,d,m)),!0;case"gotpointercapture":return y=m.pointerId,dl.set(y,gl(dl.get(y)||null,a,c,h,d,m)),!0}return!1}function Yv(a){var c=Gr(a.target);if(c!==null){var h=r(c);if(h!==null){if(c=h.tag,c===13){if(c=o(h),c!==null){a.blockedOn=c,cy(a.priority,function(){Wv(h)});return}}else if(c===31){if(c=l(h),c!==null){a.blockedOn=c,cy(a.priority,function(){Wv(h)});return}}else if(c===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Vu(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var h=rp(a.nativeEvent);if(h===null){h=a.nativeEvent;var d=new h.constructor(h.type,h);ad=d,h.target.dispatchEvent(d),ad=null}else return c=Wr(h),c!==null&&Gv(c),a.blockedOn=h,!1;c.shift()}return!0}function Kv(a,c,h){Vu(a)&&h.delete(c)}function pC(){op=!1,Cs!==null&&Vu(Cs)&&(Cs=null),Rs!==null&&Vu(Rs)&&(Rs=null),Ps!==null&&Vu(Ps)&&(Ps=null),fl.forEach(Kv),dl.forEach(Kv)}function ju(a,c){a.blockedOn===c&&(a.blockedOn=null,op||(op=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,pC)))}var Hu=null;function Zv(a){Hu!==a&&(Hu=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Hu===a&&(Hu=null);for(var c=0;c<a.length;c+=3){var h=a[c],d=a[c+1],m=a[c+2];if(typeof d!="function"){if(ap(d||h)===null)continue;break}var y=Wr(h);y!==null&&(a.splice(c,3),c-=3,rg(y,{pending:!0,data:m,method:h.method,action:d},d,m))}}))}function Ma(a){function c(L){return ju(L,a)}Cs!==null&&ju(Cs,a),Rs!==null&&ju(Rs,a),Ps!==null&&ju(Ps,a),fl.forEach(c),dl.forEach(c);for(var h=0;h<Is.length;h++){var d=Is[h];d.blockedOn===a&&(d.blockedOn=null)}for(;0<Is.length&&(h=Is[0],h.blockedOn===null);)Yv(h),h.blockedOn===null&&Is.shift();if(h=(a.ownerDocument||a).$$reactFormReplay,h!=null)for(d=0;d<h.length;d+=3){var m=h[d],y=h[d+1],S=m[ni]||null;if(typeof y=="function")S||Zv(h);else if(S){var A=null;if(y&&y.hasAttribute("formAction")){if(m=y,S=y[ni]||null)A=S.formAction;else if(ap(m)!==null)continue}else A=S.action;typeof A=="function"?h[d+1]=A:(h.splice(d,3),d-=3),Zv(h)}}}function Qv(){function a(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(S){return m=S})},focusReset:"manual",scroll:"manual"})}function c(){m!==null&&(m(),m=null),d||setTimeout(h,20)}function h(){if(!d&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,m=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(h,100),function(){d=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),m!==null&&(m(),m=null)}}}function lp(a){this._internalRoot=a}$u.prototype.render=lp.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(n(409));var h=c.current,d=wi();Hv(h,d,a,c,null,null)},$u.prototype.unmount=lp.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;Hv(a.current,2,null,a,null,null),wu(),c[$r]=null}};function $u(a){this._internalRoot=a}$u.prototype.unstable_scheduleHydration=function(a){if(a){var c=ly();a={blockedOn:null,target:a,priority:c};for(var h=0;h<Is.length&&c!==0&&c<Is[h].priority;h++);Is.splice(h,0,a),h===0&&Yv(a)}};var Jv=t.version;if(Jv!=="19.2.4")throw Error(n(527,Jv,"19.2.4"));N.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=f(c),a=a!==null?g(a):null,a=a===null?null:a.stateNode,a};var _C={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:C,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gu.isDisabled&&Gu.supportsFiber)try{To=Gu.inject(_C),_i=Gu}catch{}}return _l.createRoot=function(a,c){if(!s(a))throw Error(n(299));var h=!1,d="",m=a2,y=o2,S=l2;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(d=c.identifierPrefix),c.onUncaughtError!==void 0&&(m=c.onUncaughtError),c.onCaughtError!==void 0&&(y=c.onCaughtError),c.onRecoverableError!==void 0&&(S=c.onRecoverableError)),c=Vv(a,1,!1,null,null,h,d,null,m,y,S,Qv),a[$r]=c.current,Hg(a),new lp(c)},_l.hydrateRoot=function(a,c,h){if(!s(a))throw Error(n(299));var d=!1,m="",y=a2,S=o2,A=l2,L=null;return h!=null&&(h.unstable_strictMode===!0&&(d=!0),h.identifierPrefix!==void 0&&(m=h.identifierPrefix),h.onUncaughtError!==void 0&&(y=h.onUncaughtError),h.onCaughtError!==void 0&&(S=h.onCaughtError),h.onRecoverableError!==void 0&&(A=h.onRecoverableError),h.formState!==void 0&&(L=h.formState)),c=Vv(a,1,!0,c,h??null,d,m,L,y,S,A,Qv),c.context=jv(null),h=c.current,d=wi(),d=Qf(d),m=_s(d),m.callback=null,ms(h,m,d),h=d,c.current.lanes=h,Eo(c,h),hn(c),a[$r]=c.current,Hg(a),new $u(c)},_l.version="19.2.4",_l}var cb;function EC(){if(cb)return hp.exports;cb=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),hp.exports=wC(),hp.exports}var AC=EC();function Zh(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const x_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ub=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ub&&parseFloat(ub[1]);const hb=globalThis,fb=globalThis.process||{},MC=globalThis.navigator||{};function aT(i){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function Vr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||aT()}function CC(i){return Vr()?aT()?"Electron":(MC.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const oT="4.1.0";function RC(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class PC{constructor(t,e,n="sessionStorage"){this.storage=RC(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function IC(i){let t;return i<10?t=`${i.toFixed(2)}ms`:i<100?t=`${i.toFixed(1)}ms`:i<1e3?t=`${i.toFixed(0)}ms`:t=`${(i/1e3).toFixed(2)}s`,t}function OC(i,t=8){const e=Math.max(t-i.length,0);return`${" ".repeat(e)}${i}`}var Qh;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Qh||(Qh={}));const NC=10;function db(i){return typeof i!="string"?i:(i=i.toUpperCase(),Qh[i]||Qh.WHITE)}function DC(i,t,e){return!Vr&&typeof i=="string"&&(t&&(i=`\x1B[${db(t)}m${i}\x1B[39m`),e&&(i=`\x1B[${db(e)+NC}m${i}\x1B[49m`)),i}function LC(i,t=["constructor"]){const e=Object.getPrototypeOf(i),n=Object.getOwnPropertyNames(e),s=i;for(const r of n){const o=s[r];typeof o=="function"&&(t.find(l=>r===l)||(s[r]=o.bind(i)))}}function S_(i,t){if(!i)throw new Error("Assertion failed")}function Ca(){let i;if(Vr()&&hb.performance)i=hb?.performance?.now?.();else if("hrtime"in fb){const t=fb?.hrtime?.();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}const Ra={debug:Vr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},kC={enabled:!0,level:0};function Pa(){}const gb={},pb={once:!0};class gc{constructor({id:t}={id:""}){this.VERSION=oT,this._startTs=Ca(),this._deltaTs=Ca(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new PC(`__probe-${this.id}__`,kC),this.timeStamp(`${this.id} started`),LC(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ca()-this._startTs).toPrecision(10))}getDelta(){return Number((Ca()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Ra.warn,arguments,pb)}error(t){return this._getLogFunction(0,t,Ra.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Ra.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Ra.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Ra.debug||Ra.info,arguments,pb)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Pa,n&&[n],{tag:UC(e)}):Pa}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Pa)}group(t,e,n={collapsed:!1}){const s=_b({logLevel:t,message:e,opts:n}),{collapsed:r}=n;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e,n={}){return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Pa)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=lT(t)}_getLogFunction(t,e,n,s,r){if(this._shouldLog(t)){r=_b({logLevel:t,message:e,args:s,opts:r}),n=n||r.method,S_(n),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Ca();const o=r.tag||r.message;if(r.once&&o)if(!gb[o])gb[o]=Ca();else return Pa;return e=BC(this.id,r.message,r),n.bind(console,e,...r.args)}return Pa}}gc.VERSION=oT;function lT(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return S_(Number.isFinite(t)&&t>=0),t}function _b(i){const{logLevel:t,message:e}=i;i.logLevel=lT(t);const n=i.args?Array.from(i.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const s=typeof i.message;return S_(s==="string"||s==="object"),Object.assign(i,{args:n},i.opts)}function BC(i,t,e){if(typeof t=="string"){const n=e.time?OC(IC(e.total)):"";t=e.time?`${i}: ${n}  ${t}`:`${i}: ${t}`,t=DC(t,e.color,e.background)}return t}function UC(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const pp="4.3.3",FC=pp[0]>="0"&&pp[0]<="9"?`v${pp}`:"";function zC(){const i=new gc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=FC,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const VC=zC();function jC(i,t){return cT(i||{},t)}function cT(i,t,e=0){if(e>3)return t;const n={...i};for(const[s,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?n[s]=cT(n[s]||{},t[s],e+1):n[s]=t[s];return n}const HC="latest";function $C(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const GC=$C();function qs(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const Ar=typeof process!="object"||String(process)!=="[object process]"||process.browser,WC=typeof window<"u"&&typeof window.orientation<"u",mb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);mb&&parseFloat(mb[1]);class qC{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){qs(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){qs(this.isRunning),this.isRunning=!1,this._reject(t)}}class _p{terminate(){}}const mp=new Map;function XC(i){qs(i.source&&!i.url||!i.source&&i.url);let t=mp.get(i.source||i.url);return t||(i.url&&(t=YC(i.url),mp.set(i.url,t)),i.source&&(t=uT(i.source),mp.set(i.source,t))),qs(t),t}function YC(i){if(!i.startsWith("http"))return i;const t=KC(i);return uT(t)}function uT(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function KC(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function hT(i,t=!0,e){const n=e||new Set;if(i){if(yb(i))n.add(i);else if(yb(i.buffer))n.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(t&&typeof i=="object")for(const s in i)hT(i[s],t,n)}}return e===void 0?Array.from(n):[]}function yb(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const yp=()=>{};class v0{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Ar||typeof _p<"u"&&!Ar}constructor(t){const{name:e,source:n,url:s}=t;qs(n||s),this.name=e,this.source=n,this.url=s,this.onMessage=yp,this.onError=r=>console.log(r),this.worker=Ar?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=yp,this.onError=yp,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||hT(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=XC({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new _p(n,{eval:!1})}else if(this.source)t=new _p(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class ZC{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return v0.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(s,r,o)=>s.done(o),n=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new qC(e.name,t);t.onMessage=s=>e.onMessage(n,s.type,s.payload),t.onError=s=>e.onError(n,s),e.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Ar||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new v0({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return WC?this.maxMobileConcurrency:this.maxConcurrency}}const QC={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Us{props;workerPools=new Map;static _workerFarm;static isSupported(){return v0.isSupported()}static getWorkerFarm(t={}){return Us._workerFarm=Us._workerFarm||new Us({}),Us._workerFarm.setProps(t),Us._workerFarm}constructor(t){this.props={...QC},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:s}=t;let r=this.workerPools.get(e);return r||(r=new ZC({name:e,source:n,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function JC(i,t={}){const e=t[i.id]||{},n=Ar?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let s=e.workerUrl;if(!s&&i.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(Ar?s=`modules/${i.module}/dist/${n}`:s=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!s){let r=i.version;r==="latest"&&(r=HC);const o=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${i.module}${o}/dist/${n}`}return qs(s),s}function tR(i,t=GC){qs(i,"no worker provided");const e=i.version;return!(!t||!e)}const vp={};function eR(i,t){return!Us.isSupported()||!Ar&&!t?._nodeWorkers?!1:i.worker&&t?.worker}async function iR(i,t,e,n,s){const r=i.id,o=JC(i,e),u=Us.getWorkerFarm(e).getWorkerPool({name:r,url:o});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const f=await u.startJob("process-on-worker",nR.bind(null,s));return f.postMessage("process",{input:t,options:e,context:n}),await(await f.result).result}async function nR(i,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:s,input:r,options:o}=n;try{const l=await i(r,o);t.postMessage("done",{id:s,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:s,error:u})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function sR(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(i),s=new Uint8Array(t);for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}function rR(...i){return aR(i)}function aR(i){const t=i.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),e=t.reduce((r,o)=>r+o.byteLength,0),n=new Uint8Array(e);let s=0;for(const r of t)n.set(r,s),s+=r.byteLength;return n.buffer}async function oR(i){const t=[];for await(const e of i)t.push(e);return rR(...t)}function vb(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class bb{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=vb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(vb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class pc{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let s=this.stats[e];return s||(t instanceof bb?s=t:s=new bb(e,n),this.stats[e]=s),s}}const lR="Queued Requests",cR="Active Requests",uR="Cancelled Requests",hR="Queued Requests Ever",fR="Active Requests Ever",dR={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class gR{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...dR,...t},this.stats=new pc({id:this.props.id}),this.stats.get(lR),this.stats.get(cR),this.stats.get(uR),this.stats.get(hR),this.stats.get(fR)}scheduleRequest(t,e=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},s=new Promise(r=>(n.resolve=r,n));return this.requestQueue.push(n),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){const{handle:e,resolve:n}=t;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let pR="";const xb={};function _R(i){for(const t in xb)if(i.startsWith(t)){const e=xb[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${pR}${i}`),i}function mR(i){return i&&typeof i=="object"&&i.isBuffer}function fT(i){if(mR(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function dT(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function yR(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}const vR=i=>typeof i=="boolean",Dl=i=>typeof i=="function",_c=i=>i!==null&&typeof i=="object",Sb=i=>_c(i)&&i.constructor==={}.constructor,bR=i=>!!i&&typeof i[Symbol.iterator]=="function",xR=i=>i&&typeof i[Symbol.asyncIterator]=="function",jr=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Hr=i=>typeof Blob<"u"&&i instanceof Blob,SR=i=>i&&typeof i=="object"&&i.isBuffer,TR=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||_c(i)&&Dl(i.tee)&&Dl(i.cancel)&&Dl(i.getReader),wR=i=>_c(i)&&Dl(i.read)&&Dl(i.pipe)&&vR(i.readable),gT=i=>TR(i)||wR(i);class ER extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}reason;url;response}const AR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MR=/^([-\w.]+\/[-\w.+]+)/;function Tb(i,t){return i.toLowerCase()===t.toLowerCase()}function CR(i){const t=MR.exec(i);return t?t[1]:i}function wb(i){const t=AR.exec(i);return t?t[1]:""}const pT=/\?.*/;function RR(i){const t=i.match(pT);return t&&t[0]}function T_(i){return i.replace(pT,"")}function PR(i){if(i.length<50)return i;const t=i.slice(i.length-15);return`${i.substr(0,32)}...${t}`}function Rf(i){return jr(i)?i.url:Hr(i)?i.name||"":typeof i=="string"?i:""}function w_(i){if(jr(i)){const t=i,e=t.headers.get("content-type")||"",n=T_(t.url);return CR(e)||wb(n)}return Hr(i)?i.type||"":typeof i=="string"?wb(i):""}function IR(i){return jr(i)?i.headers["content-length"]||-1:Hr(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function _T(i){if(jr(i))return i;const t={},e=IR(i);e>=0&&(t["content-length"]=String(e));const n=Rf(i),s=w_(i);s&&(t["content-type"]=s);const r=await DR(i);r&&(t["x-first-bytes"]=r),typeof i=="string"&&(i=new TextEncoder().encode(i));const o=new Response(i,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function OR(i){if(!i.ok)throw await NR(i)}async function NR(i){const t=PR(i.url);let e=`Failed to fetch resource (${i.status}) ${i.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const n={reason:i.statusText,url:i.url,response:i};try{const s=i.headers.get("Content-Type");n.reason=!i.bodyUsed&&s?.includes("application/json")?await i.json():await i.text()}catch{}return new ER(e,n)}async function DR(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const e=i.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=r=>n(r?.target?.result),s.readAsDataURL(e)})}if(i instanceof ArrayBuffer){const e=i.slice(0,5);return`data:base64,${LR(e)}`}return null}function LR(i){let t="";const e=new Uint8Array(i);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function kR(i){return!BR(i)&&!UR(i)}function BR(i){return i.startsWith("http:")||i.startsWith("https:")}function UR(i){return i.startsWith("data:")}async function Eb(i,t){if(typeof i=="string"){const e=_R(i);return kR(e)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(e,t):await fetch(e,t)}return await _T(i)}const Ab=new gc({id:"loaders.gl"});class FR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class zR{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const mT={fetch:null,mimeType:void 0,nothrow:!1,log:new zR,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:x_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},VR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function yT(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function vT(){const i=yT();return i.globalOptions=i.globalOptions||{...mT},i.globalOptions}function jR(i,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],HR(i,e),GR(t,i,n)}function HR(i,t){Mb(i,null,mT,VR,t);for(const e of t){const n=i&&i[e.id]||{},s=e.options&&e.options[e.id]||{},r=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};Mb(n,e.id,s,r,t)}}function Mb(i,t,e,n,s){const r=t||"Top level",o=t?`${t}.`:"";for(const l in i){const u=!t&&_c(i[l]),f=l==="baseUri"&&!t,g=l==="workerUrl"&&t;if(!(l in e)&&!f&&!g){if(l in n)Ab.warn(`${r} loader option '${o}${l}' no longer supported, use '${n[l]}'`)();else if(!u){const p=$R(l,s);Ab.warn(`${r} loader option '${o}${l}' not recognized. ${p}`)()}}}}function $R(i,t){const e=i.toLowerCase();let n="";for(const s of t)for(const r in s.options){if(i===r)return`Did you mean '${s.id}.${r}'?`;const o=r.toLowerCase();(e.startsWith(o)||o.startsWith(e))&&(n=n||`Did you mean '${s.id}.${r}'?`)}return n}function GR(i,t,e){const s={...i.options||{}};return WR(s,e),s.log===null&&(s.log=new FR),Cb(s,vT()),Cb(s,t),s}function Cb(i,t){for(const e in t)if(e in t){const n=t[e];Sb(n)&&Sb(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function WR(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function E_(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i?.extensions)):!1}function A_(i){Zh(i,"null loader"),Zh(E_(i),"invalid loader");let t;return Array.isArray(i)&&(t=i[1],i=i[0],i={...i,options:{...i.options,...t}}),(i?.parseTextSync||i?.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const bT=()=>{const i=yT();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function qR(i){const t=bT();i=Array.isArray(i)?i:[i];for(const e of i){const n=A_(e);t.find(s=>n===s)||t.unshift(n)}}function XR(){return bT()}const YR=/\.([^.]+)$/;async function KR(i,t=[],e,n){if(!xT(i))return null;let s=Rb(i,t,{...e,nothrow:!0},n);if(s)return s;if(Hr(i)&&(i=await i.slice(0,10).arrayBuffer(),s=Rb(i,t,e,n)),!s&&!e?.nothrow)throw new Error(ST(i));return s}function Rb(i,t=[],e,n){if(!xT(i))return null;if(t&&!Array.isArray(t))return A_(t);let s=[];t&&(s=s.concat(t)),e?.ignoreRegisteredLoaders||s.push(...XR()),QR(s);const r=ZR(i,s,e,n);if(!r&&!e?.nothrow)throw new Error(ST(i));return r}function ZR(i,t,e,n){const s=Rf(i),r=w_(i),o=T_(s)||n?.url;let l=null,u="";return e?.mimeType&&(l=bp(t,e?.mimeType),u=`match forced by supplied MIME type ${e?.mimeType}`),l=l||JR(t,o),u=u||(l?`matched url ${o}`:""),l=l||bp(t,r),u=u||(l?`matched MIME type ${r}`:""),l=l||eP(t,i),u=u||(l?`matched initial data ${TT(i)}`:""),e?.fallbackMimeType&&(l=l||bp(t,e?.fallbackMimeType),u=u||(l?`matched fallback MIME type ${r}`:"")),u&&VC.log(1,`selectLoader selected ${l?.name}: ${u}.`),l}function xT(i){return!(i instanceof Response&&i.status===204)}function ST(i){const t=Rf(i),e=w_(i);let n="No valid loader found (";n+=t?`${dT(t)}, `:"no url provided, ",n+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const s=i?TT(i):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function QR(i){for(const t of i)A_(t)}function JR(i,t){const e=t&&YR.exec(t),n=e&&e[1];return n?tP(i,n):null}function tP(i,t){t=t.toLowerCase();for(const e of i)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function bp(i,t){for(const e of i)if(e.mimeTypes?.some(n=>Tb(t,n))||Tb(t,`application/x.${e.id}`))return e;return null}function eP(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if(iP(t,e))return e}else if(ArrayBuffer.isView(t)){if(Pb(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&Pb(t,0,e))return e;return null}function iP(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>i.startsWith(n))}function Pb(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>nP(i,t,e,s))}function nP(i,t,e,n){if(n instanceof ArrayBuffer)return sR(n,i,n.byteLength);switch(typeof n){case"function":return n(i);case"string":const s=b0(i,t,n.length);return n===s;default:return!1}}function TT(i,t=5){return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?b0(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?b0(i,0,t):""}function b0(i,t,e){if(i.byteLength<t+e)return"";const n=new DataView(i);let s="";for(let r=0;r<e;r++)s+=String.fromCharCode(n.getUint8(t+r));return s}const sP=256*1024;function*rP(i,t){const e=t?.chunkSize||sP;let n=0;const s=new TextEncoder;for(;n<i.length;){const r=Math.min(i.length-n,e),o=i.slice(n,n+r);n+=r,yield s.encode(o)}}const aP=256*1024;function*oP(i,t={}){const{chunkSize:e=aP}=t;let n=0;for(;n<i.byteLength;){const s=Math.min(i.byteLength-n,e),r=new ArrayBuffer(s),o=new Uint8Array(i,n,s);new Uint8Array(r).set(o),n+=s,yield r}}const lP=1024*1024;async function*cP(i,t){const e=t?.chunkSize||lP;let n=0;for(;n<i.size;){const s=n+e,r=await i.slice(n,s).arrayBuffer();n=s,yield r}}function Ib(i,t){return x_?uP(i,t):hP(i)}async function*uP(i,t){const e=i.getReader();let n;try{for(;;){const s=n||e.read();t?._streamReadAhead&&(n=e.read());const{done:r,value:o}=await s;if(r)return;yield fT(o)}}catch{e.releaseLock()}}async function*hP(i,t){for await(const e of i)yield fT(e)}function fP(i,t){if(typeof i=="string")return rP(i,t);if(i instanceof ArrayBuffer)return oP(i,t);if(Hr(i))return cP(i,t);if(gT(i))return Ib(i,t);if(jr(i))return Ib(i.body,t);throw new Error("makeIterator")}const wT="Cannot convert supplied data type";function dP(i,t,e){if(t.text&&typeof i=="string")return i;if(SR(i)&&(i=i.buffer),i instanceof ArrayBuffer){const n=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let n=i.buffer;const s=i.byteLength||i.length;return(i.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(i.byteOffset,i.byteOffset+s)),n}throw new Error(wT)}async function gP(i,t,e){const n=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||n)return dP(i,t);if(Hr(i)&&(i=await _T(i)),jr(i)){const s=i;return await OR(s),t.binary?await s.arrayBuffer():await s.text()}if(gT(i)&&(i=fP(i,e)),bR(i)||xR(i))return oR(i);throw new Error(wT)}function ET(i,t){const e=vT(),n=i||e;return typeof n.fetch=="function"?n.fetch:_c(n.fetch)?s=>Eb(s,n.fetch):t?.fetch?t?.fetch:Eb}function pP(i,t,e){if(e)return e;const n={fetch:ET(t,i),...i};if(n.url){const s=T_(n.url);n.baseUrl=s,n.queryString=RR(n.url),n.filename=dT(s),n.baseUrl=yR(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function _P(i,t){if(i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:void 0}async function Jh(i,t,e,n){t&&!Array.isArray(t)&&!E_(t)&&(n=void 0,e=t,t=void 0),i=await i,e=e||{};const s=Rf(i),o=_P(t,n),l=await KR(i,o,e);return l?(e=jR(e,l,o,s),n=pP({url:s,_parse:Jh,loaders:o},e,n||null),await mP(l,i,e,n)):null}async function mP(i,t,e,n){if(tR(i),e=jC(i.options,e),jr(t)){const r=t,{ok:o,redirected:l,status:u,statusText:f,type:g,url:p}=r,_=Object.fromEntries(r.headers.entries());n.response={headers:_,ok:o,redirected:l,status:u,statusText:f,type:g,url:p}}t=await gP(t,i,e);const s=i;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,e,n);if(eR(i,e))return await iR(i,t,e,n,Jh);if(s.parseText&&typeof t=="string")return await s.parseText(t,e,n);if(s.parse)return await s.parse(t,e,n);throw qs(!s.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}function yP(i){let t=1/0,e=1/0,n=1/0,s=-1/0,r=-1/0,o=-1/0;const l=i.POSITION?i.POSITION.value:[],u=l&&l.length;for(let f=0;f<u;f+=3){const g=l[f],p=l[f+1],_=l[f+2];t=g<t?g:t,e=p<e?p:e,n=_<n?_:n,s=g>s?g:s,r=p>r?p:r,o=_>o?_:o}return[[t,e,n],[s,r,o]]}async function tf(i,t,e,n){let s,r;!Array.isArray(t)&&!E_(t)?(s=[],r=t):(s=t,r=e);const o=ET(r);let l=i;return typeof i=="string"&&(l=await o(i)),Hr(i)&&(l=await o(i)),Array.isArray(s)?await Jh(l,s,r):await Jh(l,s,r)}const vP="4.3.3",bP=globalThis.loaders?.parseImageNode,x0=typeof Image<"u",S0=typeof ImageBitmap<"u",xP=!!bP,T0=x_?!0:xP;function SP(i){switch(i){case"auto":return S0||x0||T0;case"imagebitmap":return S0;case"image":return x0;case"data":return T0;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function TP(){if(S0)return"imagebitmap";if(x0)return"image";if(T0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function wP(i){const t=AP(i);if(!t)throw new Error("Not an image");return t}function EP(i){switch(wP(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function AP(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const MP=/^data:image\/svg\+xml/,CP=/\.svg((\?|#).*)?$/;function M_(i){return i&&(MP.test(i)||CP.test(i))}function RP(i,t){if(M_(t)){let n=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return AT(i,t)}function AT(i,t){if(M_(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function MT(i,t,e){const n=RP(i,e),s=self.URL||self.webkitURL,r=typeof n!="string"&&s.createObjectURL(n);try{return await PP(r||n,t)}finally{r&&s.revokeObjectURL(r)}}async function PP(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,s)=>{try{e.onload=()=>n(e),e.onerror=r=>{const o=r instanceof Error?r.message:"error";s(new Error(o))}}catch(r){s(r)}})}const IP={};let Ob=!0;async function OP(i,t,e){let n;M_(e)?n=await MT(i,t,e):n=AT(i,e);const s=t&&t.imagebitmap;return await NP(n,s)}async function NP(i,t=null){if((DP(t)||!Ob)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),Ob=!1}return await createImageBitmap(i)}function DP(i){for(const t in i||IP)return!1;return!0}function LP(i){return!FP(i,"ftyp",4)||(i[8]&96)===0?null:kP(i)}function kP(i){switch(BP(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function BP(i,t,e){return String.fromCharCode(...i.slice(t,e))}function UP(i){return[...i].map(t=>t.charCodeAt(0))}function FP(i,t,e=0){const n=UP(t);for(let s=0;s<n.length;++s)if(n[s]!==i[s+e])return!1;return!0}const bn=!1,Ll=!0;function CT(i){const t=mc(i);return VP(t)||$P(t)||jP(t)||HP(t)||zP(t)}function zP(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=LP(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function VP(i){const t=mc(i);return t.byteLength>=24&&t.getUint32(0,bn)===2303741511?{mimeType:"image/png",width:t.getUint32(16,bn),height:t.getUint32(20,bn)}:null}function jP(i){const t=mc(i);return t.byteLength>=10&&t.getUint32(0,bn)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Ll),height:t.getUint16(8,Ll)}:null}function HP(i){const t=mc(i);return t.byteLength>=14&&t.getUint16(0,bn)===16973&&t.getUint32(2,Ll)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ll),height:t.getUint32(22,Ll)}:null}function $P(i){const t=mc(i);if(!(t.byteLength>=3&&t.getUint16(0,bn)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=GP();let r=2;for(;r+9<t.byteLength;){const o=t.getUint16(r,bn);if(s.has(o))return{mimeType:"image/jpeg",height:t.getUint16(r+5,bn),width:t.getUint16(r+7,bn)};if(!n.has(o))return null;r+=2,r+=t.getUint16(r,bn)}return null}function GP(){const i=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)i.add(e);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function mc(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function WP(i,t){const{mimeType:e}=CT(i)||{},n=globalThis.loaders?.parseImageNode;return Zh(n),await n(i,e)}async function qP(i,t,e){t=t||{};const s=(t.image||{}).type||"auto",{url:r}=e||{},o=XP(s);let l;switch(o){case"imagebitmap":l=await OP(i,t,r);break;case"image":l=await MT(i,t,r);break;case"data":l=await WP(i);break;default:Zh(!1)}return s==="data"&&(l=EP(l)),l}function XP(i){switch(i){case"auto":case"data":return TP();default:return SP(i),i}}const YP=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],KP=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],ZP={image:{type:"auto",decode:!0}},QP={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:vP,mimeTypes:KP,extensions:YP,parse:qP,tests:[i=>!!CT(new DataView(i))],options:ZP},Lt=new gc({id:"deck"});let w0={};function JP(i){w0=i}function Ze(i,t,e,n){Lt.level>0&&w0[i]&&w0[i].call(null,t,e,n)}function t6(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const e6={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:t6,parseTextSync:JSON.parse};function i6(){const i="9.2.6",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${i}`);return t||(Lt.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:Lt,_registerLoggers:JP},qR([e6,[QP,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const n6=i6();function C_(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const xp={number:{type:"number",validate(i,t){return Number.isFinite(i)&&typeof t=="object"&&(t.max===void 0||i<=t.max)&&(t.min===void 0||i>=t.min)}},array:{type:"array",validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function s6(i){const t={};for(const[e,n]of Object.entries(i))t[e]=r6(n);return t}function r6(i){let t=Nb(i);if(t!=="object")return{value:i,...xp[t],type:t};if(typeof i=="object")return i?i.type!==void 0?{...i,...xp[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(t=Nb(i.value),{...i,...xp[t],type:t}):{type:"object",value:null};throw new Error("props")}function Nb(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const a6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,o6=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,l6={vertex:a6,fragment:o6},Db=/void\s+main\s*\([^)]*\)\s*\{\n?/,Lb=/}\n?[^{}]*$/,Sp=[],Ih="__LUMA_INJECT_DECLARATIONS__";function c6(i){const t={vertex:{},fragment:{}};for(const e in i){let n=i[e];const s=u6(e);typeof n=="string"&&(n={order:0,injection:n}),t[s][e]=n}return t}function u6(i){const t=i.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ef(i,t,e,n=!1){const s=t==="vertex";for(const r in e){const o=e[r];o.sort((u,f)=>u.order-f.order),Sp.length=o.length;for(let u=0,f=o.length;u<f;++u)Sp[u]=o[u].injection;const l=`${Sp.join(`
`)}
`;switch(r){case"vs:#decl":s&&(i=i.replace(Ih,l));break;case"vs:#main-start":s&&(i=i.replace(Db,u=>u+l));break;case"vs:#main-end":s&&(i=i.replace(Lb,u=>l+u));break;case"fs:#decl":s||(i=i.replace(Ih,l));break;case"fs:#main-start":s||(i=i.replace(Db,u=>u+l));break;case"fs:#main-end":s||(i=i.replace(Lb,u=>l+u));break;default:i=i.replace(r,u=>u+l)}}return i=i.replace(Ih,""),n&&(i=i.replace(/\}\s*$/,r=>r+l6[t])),i}function nf(i){i.map(t=>h6(t))}function h6(i){if(i.instance)return;nf(i.dependencies||[]);const{propTypes:t={},deprecations:e=[],inject:n={}}=i,s={normalizedInjections:c6(n),parsedDeprecations:f6(e)};t&&(s.propValidators=s6(t)),i.instance=s;let r={};t&&(r=Object.entries(t).reduce((o,[l,u])=>{const f=u?.value;return f&&(o[l]=f),o},{})),i.defaultUniforms={...i.defaultUniforms,...r}}function RT(i,t,e){i.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}function f6(i){return i.forEach(t=>{t.type==="function"?t.regex=new RegExp(`\\b${t.old}\\(`):t.regex=new RegExp(`${t.type} ${t.old};`)}),i}function R_(i){nf(i);const t={},e={};PT({modules:i,level:0,moduleMap:t,moduleDepth:e});const n=Object.keys(e).sort((s,r)=>e[r]-e[s]).map(s=>t[s]);return nf(n),n}function PT(i){const{modules:t,level:e,moduleMap:n,moduleDepth:s}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)n[r.name]=r,(s[r.name]===void 0||s[r.name]<e)&&(s[r.name]=e);for(const r of t)r.dependencies&&PT({modules:r.dependencies,level:e+1,moduleMap:n,moduleDepth:s})}function d6(i){switch(i?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function g6(i,t){if(Number(i.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return i=kb(i,p6),i;case"fragment":return i=kb(i,_6),i;default:throw new Error(t)}}const IT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],p6=[...IT,[E0("attribute"),"in $1"],[E0("varying"),"out $1"]],_6=[...IT,[E0("varying"),"in $1"]];function kb(i,t){for(const[e,n]of t)i=i.replace(e,n);return i}function E0(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function OT(i,t){let e="";for(const n in i){const s=i[n];if(e+=`void ${s.signature} {
`,s.header&&(e+=`  ${s.header}`),t[n]){const r=t[n];r.sort((o,l)=>o.order-l.order);for(const o of r)e+=`  ${o.injection}
`}s.footer&&(e+=`  ${s.footer}`),e+=`}
`}return e}function NT(i){const t={vertex:{},fragment:{}};for(const e of i){let n,s;typeof e!="string"?(n=e,s=n.hook):(n={},s=e),s=s.trim();const[r,o]=s.split(":"),l=s.replace(/\(.+/,""),u=Object.assign(n,{signature:o});switch(r){case"vs":t.vertex[l]=u;break;case"fs":t.fragment[l]=u;break;default:throw new Error(r)}}return t}function m6(i,t){return{name:y6(i,t),language:"glsl",version:v6(i)}}function y6(i,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return n?n[1]:t}function v6(i){let t=100;const e=i.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const DT=`

${Ih}
`,b6=`precision highp float;
`;function x6(i){const t=R_(i.modules||[]);return{source:T6(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:t}),getUniforms:LT(t)}}function S6(i){const{vs:t,fs:e}=i,n=R_(i.modules||[]);return{vs:Bb(i.platformInfo,{...i,source:t,stage:"vertex",modules:n}),fs:Bb(i.platformInfo,{...i,source:e,stage:"fragment",modules:n}),getUniforms:LT(n)}}function T6(i,t){const{source:e,stage:n,modules:s,hookFunctions:r=[],inject:o={},log:l}=t;C_(typeof e=="string","shader source must be a string");const u=e;let f="";const g=NT(r),p={},_={},v={};for(const x in o){const T=typeof o[x]=="string"?{injection:o[x],order:0}:o[x],w=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(w){const M=w[2],E=w[3];M?E==="decl"?_[x]=[T]:v[x]=[T]:p[x]=[T]}else v[x]=[T]}const b=s;for(const x of b){l&&RT(x,u,l);const T=kT(x,"wgsl");f+=T;const w=x.injections?.[n]||{};for(const M in w){const E=/^(v|f)s:#([\w-]+)$/.exec(M);if(E){const k=E[2]==="decl"?_:v;k[M]=k[M]||[],k[M].push(w[M])}else p[M]=p[M]||[],p[M].push(w[M])}}return f+=DT,f=ef(f,n,_),f+=OT(g[n],p),f+=u,f=ef(f,n,v),f}function Bb(i,t){const{source:e,stage:n,language:s="glsl",modules:r,defines:o={},hookFunctions:l=[],inject:u={},prologue:f=!0,log:g}=t;C_(typeof e=="string","shader source must be a string");const p=s==="glsl"?m6(e).version:-1,_=i.shaderLanguageVersion,v=p===100?"#version 100":"#version 300 es",x=e.split(`
`).slice(1).join(`
`),T={};r.forEach(U=>{Object.assign(T,U.defines)}),Object.assign(T,o);let w="";switch(s){case"wgsl":break;case"glsl":w=f?`${v}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${d6(i)}
${n==="fragment"?b6:""}

// ----- APPLICATION DEFINES -------------------------

${w6(T)}

`:`${v}
`;break}const M=NT(l),E={},P={},k={};for(const U in u){const Y=typeof u[U]=="string"?{injection:u[U],order:0}:u[U],et=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(et){const K=et[2],ut=et[3];K?ut==="decl"?P[U]=[Y]:k[U]=[Y]:E[U]=[Y]}else k[U]=[Y]}for(const U of r){g&&RT(U,x,g);const Y=kT(U,n);w+=Y;const et=U.instance?.normalizedInjections[n]||{};for(const K in et){const ut=/^(v|f)s:#([\w-]+)$/.exec(K);if(ut){const _t=ut[2]==="decl"?P:k;_t[K]=_t[K]||[],_t[K].push(et[K])}else E[K]=E[K]||[],E[K].push(et[K])}}return w+="// ----- MAIN SHADER SOURCE -------------------------",w+=DT,w=ef(w,n,P),w+=OT(M[n],E),w+=x,w=ef(w,n,k),s==="glsl"&&p!==_&&(w=g6(w,n)),w.trim()}function LT(i){return function(e){const n={};for(const s of i){const r=s.getUniforms?.(e,n);Object.assign(n,r)}return n}}function w6(i={}){let t="";for(const e in i){const n=i[e];(n||Number.isFinite(n))&&(t+=`#define ${e.toUpperCase()} ${i[e]}
`)}return t}function kT(i,t){let e;switch(t){case"vertex":e=i.vs||"";break;case"fragment":e=i.fs||"";break;case"wgsl":e=i.source||"";break;default:C_(!1)}if(!i.name)throw new Error("Shader module must have a name");const n=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${i.name} ---------------

`;return t!=="wgsl"&&(s+=`#define MODULE_${n}
`),s+=`${e}
`,s}const E6=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,A6=/^\s*\#\s*endif\s*$/;function M6(i,t){const e=i.split(`
`),n=[];let s=!0,r=null;for(const o of e){const l=o.match(E6),u=o.match(A6);l?(r=l[1],s=!!t?.defines?.[r]):u?s=!0:s&&n.push(o)}return n.join(`
`)}class Tr{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Tr.defaultShaderAssembler=Tr.defaultShaderAssembler||new Tr,Tr.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const e=this._getModuleList(t.modules),n=this._hookFunctions,{source:s,getUniforms:r}=x6({...t,source:t.source,modules:e,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?M6(s):s,getUniforms:r,modules:e}}assembleGLSLShaderPair(t){const e=this._getModuleList(t.modules),n=this._hookFunctions;return{...S6({...t,vs:t.vs,fs:t.fs,modules:e,hookFunctions:n}),modules:e}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),n={};let s=0;for(let r=0,o=this._defaultModules.length;r<o;++r){const l=this._defaultModules[r],u=l.name;e[s++]=l,n[u]=!0}for(let r=0,o=t.length;r<o;++r){const l=t[r],u=l.name;n[u]||(e[s++]=l,n[u]=!0)}return e.length=s,nf(e),e}}const C6=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,R6=`#version 300 es
${C6}`;function P6(i){const{input:t,inputChannels:e,output:n}={};if(!t)return R6;if(!e)throw new Error("inputChannels");const s=I6(e),r=O6(t,e);return`#version 300 es
in ${s} ${t};
out vec4 ${n};
void main() {
  ${n} = ${r};
}`}function I6(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function O6(i,t){switch(t){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${t}`)}}class N6{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new pc({id:t})),this.stats.get(t)}}const BT=new N6,ot=new gc({id:"luma.gl"}),Tp={};function Pf(i="id"){Tp[i]=Tp[i]||1;const t=Tp[i]++;return`${i}-${t}`}let se=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,n){if(!t)throw new Error("no device");this._device=t,this.props=D6(e,n);const s=this.props.id!=="undefined"?this.props.id:Pf(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function D6(i,t){const e={...t};for(const n in i)i[n]!==void 0&&(e[n]=i[n]);return e}let fe=class Oh extends se{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,e){const n={...e};(e.usage||0)&Oh.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":e.data instanceof Uint8Array&&(n.indexType="uint8")),delete n.data,super(t,n,Oh.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,e,n){const s=ArrayBuffer.isView(t)?t.buffer:t,r=Math.min(t?t.byteLength:n,Oh.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(r):e===0&&n===s.byteLength?this.debugData=s.slice(0,r):this.debugData=s.slice(e,e+r)}static defaultProps={...se.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}};function UT(i){const[t,e,n]=O_[i],s=i.includes("norm"),r=!s&&!i.startsWith("float"),o=i.startsWith("s");return{signedType:t,primitiveType:e,byteLength:n,normalized:s,integer:r,signed:o}}function L6(i){const t=i;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}function k6(i,t){switch(t){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function P_(i){const t=ArrayBuffer.isView(i)?i.constructor:i;if(t===Uint8ClampedArray)return"uint8";const e=Object.values(O_).find(n=>t===n[4]);if(!e)throw new Error(t.name);return e[0]}function I_(i){const[,,,,t]=O_[i];return t}const O_={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function N_(i){let t;i.endsWith("-webgl")&&(i.replace("-webgl",""),t=!0);const[e,n]=i.split("x"),s=e,r=n?parseInt(n):1,o=UT(s),l={type:s,components:r,byteLength:o.byteLength*r,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(l.webglOnly=!0),l}function B6(i,t,e){const n=e?L6(i):i;switch(n){case"unorm8":return t===1?"unorm8":t===3?"unorm8x3-webgl":`${n}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(t===1||t===3)throw new Error(`size: ${t}`);return`${n}x${t}`;default:return t===1?n:`${n}x${t}`}}function U6(i,t,e){if(!t||t>4)throw new Error(`size ${t}`);const n=t,s=P_(i);return B6(s,n,e)}function F6(i){let t;switch(i.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?t:`${t}x${i.components}`}const qe="texture-compression-bc",ne="texture-compression-astc",fn="texture-compression-etc2",z6="texture-compression-etc1-webgl",Wu="texture-compression-pvrtc-webgl",wp="texture-compression-atc-webgl",qu="float32-renderable-webgl",Ep="float16-renderable-webgl",V6="rgb9e5ufloat-renderable-webgl",Ap="snorm8-renderable-webgl",ml="norm16-renderable-webgl",Mp="snorm16-renderable-webgl",Xu="float32-filterable",Ub="float16-filterable-webgl";function FT(i){const t=$6[i];if(!t)throw new Error(`Unsupported texture format ${i}`);return t}const j6={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Ap},rg8snorm:{render:Ap},"rgb8snorm-webgl":{},rgba8snorm:{render:Ap},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:ml},rg16unorm:{render:ml},"rgb16unorm-webgl":{f:ml},rgba16unorm:{render:ml},r16snorm:{f:Mp},rg16snorm:{render:Mp},"rgb16snorm-webgl":{f:ml},rgba16snorm:{render:Mp},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Ep,filter:"float16-filterable-webgl"},rg16float:{render:Ep,filter:Ub},rgba16float:{render:Ep,filter:Ub},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:qu,filter:Xu},rg32float:{render:!1,filter:Xu},"rgb32float-webgl":{render:qu,filter:Xu},rgba32float:{render:qu,filter:Xu},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:V6},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:qu},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},H6={"bc1-rgb-unorm-webgl":{f:qe},"bc1-rgb-unorm-srgb-webgl":{f:qe},"bc1-rgba-unorm":{f:qe},"bc1-rgba-unorm-srgb":{f:qe},"bc2-rgba-unorm":{f:qe},"bc2-rgba-unorm-srgb":{f:qe},"bc3-rgba-unorm":{f:qe},"bc3-rgba-unorm-srgb":{f:qe},"bc4-r-unorm":{f:qe},"bc4-r-snorm":{f:qe},"bc5-rg-unorm":{f:qe},"bc5-rg-snorm":{f:qe},"bc6h-rgb-ufloat":{f:qe},"bc6h-rgb-float":{f:qe},"bc7-rgba-unorm":{f:qe},"bc7-rgba-unorm-srgb":{f:qe},"etc2-rgb8unorm":{f:fn},"etc2-rgb8unorm-srgb":{f:fn},"etc2-rgb8a1unorm":{f:fn},"etc2-rgb8a1unorm-srgb":{f:fn},"etc2-rgba8unorm":{f:fn},"etc2-rgba8unorm-srgb":{f:fn},"eac-r11unorm":{f:fn},"eac-r11snorm":{f:fn},"eac-rg11unorm":{f:fn},"eac-rg11snorm":{f:fn},"astc-4x4-unorm":{f:ne},"astc-4x4-unorm-srgb":{f:ne},"astc-5x4-unorm":{f:ne},"astc-5x4-unorm-srgb":{f:ne},"astc-5x5-unorm":{f:ne},"astc-5x5-unorm-srgb":{f:ne},"astc-6x5-unorm":{f:ne},"astc-6x5-unorm-srgb":{f:ne},"astc-6x6-unorm":{f:ne},"astc-6x6-unorm-srgb":{f:ne},"astc-8x5-unorm":{f:ne},"astc-8x5-unorm-srgb":{f:ne},"astc-8x6-unorm":{f:ne},"astc-8x6-unorm-srgb":{f:ne},"astc-8x8-unorm":{f:ne},"astc-8x8-unorm-srgb":{f:ne},"astc-10x5-unorm":{f:ne},"astc-10x5-unorm-srgb":{f:ne},"astc-10x6-unorm":{f:ne},"astc-10x6-unorm-srgb":{f:ne},"astc-10x8-unorm":{f:ne},"astc-10x8-unorm-srgb":{f:ne},"astc-10x10-unorm":{f:ne},"astc-10x10-unorm-srgb":{f:ne},"astc-12x10-unorm":{f:ne},"astc-12x10-unorm-srgb":{f:ne},"astc-12x12-unorm":{f:ne},"astc-12x12-unorm-srgb":{f:ne},"pvrtc-rgb4unorm-webgl":{f:Wu},"pvrtc-rgba4unorm-webgl":{f:Wu},"pvrtc-rbg2unorm-webgl":{f:Wu},"pvrtc-rgba2unorm-webgl":{f:Wu},"etc1-rbg-unorm-webgl":{f:z6},"atc-rgb-unorm-webgl":{f:wp},"atc-rgba-unorm-webgl":{f:wp},"atc-rgbai-unorm-webgl":{f:wp}},$6={...j6,...H6},G6=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],W6=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class q6{getInfo(t){return Fb(t)}isColor(t){return t.startsWith("rgba")||t.startsWith("bgra")||t.startsWith("rgb")}isDepthStencil(t){return t.startsWith("depth")||t.startsWith("stencil")}isCompressed(t){return G6.some(e=>t.startsWith(e))}getCapabilities(t){const e=FT(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},s=Fb(t),r=t.startsWith("depth")||t.startsWith("stencil"),o=s?.signed,l=s?.integer,u=s?.webgl;return n.render&&=!o,n.filter&&=!r&&!o&&!l&&!u,n}}const Ka=new q6;function Fb(i){let t=X6(i);if(Ka.isCompressed(i)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=Y6(i);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const e=W6.exec(i);if(e){const[,n,s,r,o,l]=e,u=`${r}${s}`,f=UT(u),g=f.byteLength*8,p=n.length,_=[g,p>=2?g:0,p>=3?g:0,p>=4?g:0];t={format:i,attachment:t.attachment,dataType:f.signedType,components:p,channels:n,integer:f.integer,signed:f.signed,normalized:f.normalized,bitsPerChannel:_,bytesPerPixel:f.byteLength*n.length,packed:t.packed,srgb:t.srgb},l==="-webgl"&&(t.webgl=!0),o==="-srgb"&&(t.srgb=!0)}return i.endsWith("-webgl")&&(t.webgl=!0),i.endsWith("-srgb")&&(t.srgb=!0),t}function X6(i){const t=FT(i),e=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:i,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:e,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function Y6(i){const e=/.*-(\d+)x(\d+)-.*/.exec(i);if(e){const[,n,s]=e;return{blockWidth:Number(n),blockHeight:Number(s)}}return null}function K6(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function Z6(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class Q6{}class J6{features;disabledFeatures;constructor(t=[],e){this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class Ir{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(t,e)=>{},onResize:(t,e)=>{const[n,s]=t.getDevicePixelSize();ot.log(1,`${t} resized => ${n}x${s}px`)()},onPositionChange:(t,e)=>{const[n,s]=t.getPosition();ot.log(1,`${t} repositioned => ${n},${s}`)()},onVisibilityChange:t=>ot.log(1,`${t} Visibility changed ${t.isVisible}`)(),onDevicePixelRatioChange:(t,e)=>ot.log(1,`${t} DPR changed ${e.oldRatio} => ${t.devicePixelRatio}`)(),debug:ot.get("debug")||void 0,debugShaders:ot.get("debug-shaders")||void 0,debugFramebuffers:!!ot.get("debug-framebuffers"),debugFactories:!!ot.get("debug-factories"),debugWebGL:!!ot.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=BT;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(t){this.props={...Ir.defaultProps,...t},this.id=this.props.id||Pf(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(t){return N_(t)}isVertexFormatSupported(t){return!0}getTextureFormatInfo(t){return Ka.getInfo(t)}getTextureFormatCapabilities(t){let e=this._textureCaps[t];if(!e){const n=this._getDeviceTextureFormatCapabilities(t);e=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[t]=e}return e}getMipLevelCount(t,e,n=1){const s=Math.max(t,e,n);return 1+Math.floor(Math.log2(s))}isExternalImage(t){return K6(t)}getExternalImageSize(t){return Z6(t)}isTextureFormatSupported(t){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return Ka.isCompressed(t)}pushDebugGroup(t){this.commandEncoder.pushDebugGroup(t)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(t){this.commandEncoder?.insertDebugMarker(t)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(t,e,...n){return this.props.onError(t,e)?()=>{}:ot.error(t.message,e,...n)}debug(){if(this.props.debug)debugger;else ot.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(t){return this.commandEncoder.beginRenderPass(t)}beginComputePass(t){return this.commandEncoder.beginComputePass(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_getDeviceTextureFormatCapabilities(t){const e=Ka.getCapabilities(t),n=r=>(typeof r=="string"?this.features.has(r):r)??!0,s=n(e.create);return{format:t,create:s,render:s&&n(e.render),filter:s&&n(e.filter),blend:s&&n(e.blend),store:s&&n(e.store)}}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};if((t.usage||0)&fe.INDEX&&(t.indexType||(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array?e.indexType="uint16":t.data instanceof Uint8Array&&(e.data=new Uint16Array(t.data),e.indexType="uint16")),!e.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return e}}const t5="set luma.log.level=1 (or higher) to trace rendering",zb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class sf{static defaultProps={...Ir.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=BT;log=ot;VERSION="9.2.6";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ot.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ot.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ot.error("This version of luma.gl has already been initialized")()}ot.log(1,`${this.VERSION} - ${t5}`)(),globalThis.luma=this}async createDevice(t={}){const e={...sf.defaultProps,...t},n=this.selectAdapter(e.type,e.adapters);if(!n)throw new Error(zb);return e.waitForPageLoad&&await n.pageLoaded,await n.create(e)}async attachDevice(t,e){const n=this._getTypeFromHandle(t,e.adapters),s=n&&this.selectAdapter(n,e.adapters);if(!s)throw new Error(zb);return await s?.attach?.(t,e)}registerAdapters(t){for(const e of t)this.preregisteredAdapters.set(e.type,e)}getSupportedAdapters(t=[]){const e=this._getAdapterMap(t);return Array.from(e).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(t=[]){const e=["webgpu","webgl","null"],n=this._getAdapterMap(t);for(const s of e)if(n.get(s)?.isSupported?.())return s;return null}selectAdapter(t,e=[]){let n=t;t==="best-available"&&(n=this.getBestAvailableAdapterType(e));const s=this._getAdapterMap(e);return n&&s.get(n)||null}enforceWebGL2(t=!0,e=[]){const s=this._getAdapterMap(e).get("webgl");s||ot.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(t)}setDefaultDeviceProps(t){Object.assign(sf.defaultProps,t)}_getAdapterMap(t=[]){const e=new Map(this.preregisteredAdapters);for(const n of t)e.set(n.type,n);return e}_getTypeFromHandle(t,e=[]){return t instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&t instanceof GPUDevice||t?.queue?"webgpu":t===null?"null":(t instanceof WebGLRenderingContext?ot.warn("WebGL1 is not supported",t)():ot.warn("Unknown handle type",t)(),null)}}const A0=new sf;class e5{get pageLoaded(){return s5()}}const i5=Vr()&&typeof document<"u",n5=()=>i5&&document.readyState==="complete";let Yu=null;function s5(){return Yu||(n5()||typeof window>"u"?Yu=Promise.resolve():Yu=new Promise(i=>window.addEventListener("load",()=>i()))),Yu}function r5(){let i,t;return{promise:new Promise((n,s)=>{i=n,t=s}),resolve:i,reject:t}}class wr{static isHTMLCanvas(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}static isOffscreenCanvas(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=r5();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...wr.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,Vr()?t.canvas?typeof t.canvas=="string"?this.canvas=o5(t.canvas):this.canvas=t.canvas:this.canvas=l5(t):this.canvas={width:t.width||1,height:t.height||1},wr.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):wr.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],wr.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(t){return"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const t=this.device.limits.maxTextureDimension2D;return[t,t]}setDrawingBufferSize(t,e){this.canvas.width=t,this.canvas.height=e,this.drawingBufferWidth=t,this.drawingBufferHeight=e}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(t,e=!0){const n=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return c5(t,n,s,r,e)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[t,e]=this.getDevicePixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),[e]=this.getCSSSize();return e?t/e:1}catch{return 1}}resize(t){this.setDrawingBufferSize(t.width,t.height)}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}_handleIntersection(t){const e=t.find(s=>s.target===this.canvas);if(!e)return;const n=e.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(t){const e=t.find(u=>u.target===this.canvas);if(!e)return;this.cssWidth=e.contentBoxSize[0].inlineSize,this.cssHeight=e.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),s=e.devicePixelContentBoxSize?.[0].inlineSize||e.contentBoxSize[0].inlineSize*devicePixelRatio,r=e.devicePixelContentBoxSize?.[0].blockSize||e.contentBoxSize[0].blockSize*devicePixelRatio,[o,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,o)),this.devicePixelHeight=Math.max(1,Math.min(r,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const t=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*t,this.cssHeight*t)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(t=100){const e=setInterval(()=>{this.destroyed?clearInterval(e):this.updatePosition()},t)}updatePosition(){const t=this.htmlCanvas?.getBoundingClientRect();if(t){const e=[t.left,t.top];if(this._position??=e,e[0]!==this._position[0]||e[1]!==this._position[1]){const s=this._position;this._position=e,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function a5(i){if(typeof i=="string"){const t=document.getElementById(i);if(!t)throw new Error(`${i} is not an HTML element`);return t}return i||document.body}function o5(i){const t=document.getElementById(i);if(!wr.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function l5(i){const{width:t,height:e}=i,n=document.createElement("canvas");n.id=Pf("lumagl-auto-created-canvas"),n.width=t||1,n.height=e||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(e)?`${e}px`:"100%",i?.visible||(n.style.visibility="hidden");const s=a5(i?.container||null);return s.insertBefore(n,s.firstChild),n}function c5(i,t,e,n,s){const r=i,o=Vb(r[0],t,e);let l=jb(r[1],t,n,s),u=Vb(r[0]+1,t,e);const f=u===e-1?u:u-1;u=jb(r[1]+1,t,n,s);let g;return s?(u=u===0?u:u+1,g=l,l=u):g=u===n-1?u:u-1,{x:o,y:l,width:Math.max(f-o+1,1),height:Math.max(g-l+1,1)}}function Vb(i,t,e){return Math.min(Math.round(i*t),e-1)}function jb(i,t,e,n){return n?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}class Or extends se{static defaultProps={...se.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){e=Or.normalizeProps(t,e),super(t,e,Or.defaultProps)}static normalizeProps(t,e){return e}}const u5={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Re extends se{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(t,e){if(e=Re.normalizeProps(t,e),super(t,e,Re.defaultProps),this.dimension=this.props.dimension,this.baseDimension=u5[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(e.data)){const n=t.getExternalImageSize(e.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&ot.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}setSampler(t){this.sampler=t instanceof Or?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,e){const n={...e},{width:s,height:r}=n;return typeof s=="number"&&(n.width=Math.max(1,Math.ceil(s))),typeof r=="number"&&(n.height=Math.max(1,Math.ceil(r))),n}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:e,height:n,depth:s}=this,r={...Re.defaultCopyDataOptions,width:e,height:n,depth:s,...t},o=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!o.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return r.bytesPerRow=t.bytesPerRow||e*(o.bytesPerPixel||4),r.rowsPerImage=t.rowsPerImage||n,r}_normalizeCopyExternalImageOptions(t){const e=this.device.getExternalImageSize(t.image),n={...Re.defaultCopyExternalImageOptions,...e,...t};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...se.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Re.TEXTURE|Re.RENDER_ATTACHMENT|Re.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class If extends se{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,If.defaultProps)}static defaultProps={...se.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function h5(i,t,e){let n="";const s=t.split(/\r?\n/),r=i.slice().sort((o,l)=>o.lineNum-l.lineNum);switch(e?.showSourceCode||"no"){case"all":let o=0;for(let l=1;l<=s.length;l++)for(n+=zT(s[l-1],l,e);r.length>o&&r[o].lineNum===l;){const u=r[o++];n+=Cp(u,s,u.lineNum,{...e,inlineSource:!1})}for(;r.length>o;){const l=r[o++];n+=Cp(l,[],0,{...e,inlineSource:!1})}return n;case"issues":case"no":for(const l of i)n+=Cp(l,s,l.lineNum,{inlineSource:e?.showSourceCode!=="no"});return n}}function Cp(i,t,e,n){if(n?.inlineSource){const r=f5(t,e),o=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${r}${o}${i.type.toUpperCase()}: ${i.message}

`}const s=i.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function f5(i,t,e){let n="";for(let s=t-2;s<=t;s++){const r=i[s-1];r!==void 0&&(n+=zT(r,t,e))}return n}function zT(i,t,e){const n=e?.html?g5(i):i;return`${d5(String(t),4)}: ${n}${e?.html?"<br/>":`
`}`}function d5(i,t){let e="";for(let n=i.length;n<t;++n)e+=" ";return e+i}function g5(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Of extends se{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,e){e={...e,debugShaders:e.debugShaders||t.props.debugShaders||"errors"},super(t,{id:p5(e),...e},Of.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const e=await this.getCompilationInfo();t==="warnings"&&e?.length===0||this._displayShaderLog(e,this.id)}_displayShaderLog(t,e){if(typeof document>"u"||!document?.createElement)return;const n=e,s=`${this.stage} shader "${n}"`;let r=h5(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),l.onclick=()=>{const f=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(f)}}static defaultProps={...se.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function p5(i){return _5(i.source)||i.id||Pf(`unnamed ${i.stage}-shader`)}function _5(i,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return n?n[1]:t}class Nf extends se{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,e={}){super(t,e,Nf.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const e=this.colorAttachments.map(s=>s.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:e,depthStencilAttachment:n})}resize(t){let e=!t;if(t){const[n,s]=Array.isArray(t)?t:[t.width,t.height];e=e||s!==this.height||n!==this.width,this.width=n,this.height=s}e&&(ot.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,n)=>{if(typeof e=="string"){const s=this.createColorTexture(e,n);return this.attachResource(s),s.view}return e instanceof Re?e.view:e});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const e=this.createDepthStencilTexture(t);this.attachResource(e),this.depthStencilAttachment=e.view}else t instanceof Re?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,e){return this.device.createTexture({id:`${this.id}-color-attachment-${e}`,usage:Re.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Re.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,e){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const s=this.colorAttachments[n].texture.clone({width:t,height:e});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:t,height:e});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...se.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Mr extends se{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,e){super(t,e,Mr.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...se.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Sr extends se{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){e=Sr.normalizeProps(t,e),super(t,e,Sr.defaultProps)}static normalizeProps(t,e){return e}static defaultProps={...se.defaultProps,framebuffer:null,parameters:void 0,clearColor:Sr.defaultClearColor,clearColors:void 0,clearDepth:Sr.defaultClearDepth,clearStencil:Sr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class rf extends se{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,e){super(t,e,rf.defaultProps),this.shaderLayout=e.shaderLayout}static defaultProps={...se.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class D_ extends se{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,D_.defaultProps)}static defaultProps={...se.defaultProps,measureExecutionTime:void 0}}class L_ extends se{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,L_.defaultProps)}static defaultProps={...se.defaultProps}}function VT(i){return b5[i]}function m5(i){const[t,e]=v5[i],n=t==="i32"||t==="u32",s=t!=="u32",r=y5[t]*e;return{primitiveType:t,components:e,byteLength:r,integer:n,signed:s}}const y5={f32:4,f16:2,i32:4,u32:4},v5={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},b5={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function jT(i,t){const e={};for(const n of i.attributes){const s=S5(i,t,n.name);s&&(e[n.name]=s)}return e}function x5(i,t,e=16){const n=jT(i,t),s=new Array(e).fill(null);for(const r of Object.values(n))s[r.location]=r;return s}function S5(i,t,e){const n=T5(i,e),s=w5(t,e);if(!n)return null;const r=m5(n.type),o=F6(r),l=s?.vertexFormat||o,u=N_(l);return{attributeName:s?.attributeName||n.name,bufferName:s?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:r.primitiveType,shaderComponents:r.components,vertexFormat:l,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:r.integer,stepMode:s?.stepMode||n.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function T5(i,t){const e=i.attributes.find(n=>n.name===t);return e||ot.warn(`shader layout attribute "${t}" not present in shader`),e||null}function w5(i,t){E5(i);let e=A5(i,t);return e||(e=M5(i,t),e)?e:(ot.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function E5(i){for(const t of i)(t.attributes&&t.format||!t.attributes&&!t.format)&&ot.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function A5(i,t){for(const e of i)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function M5(i,t){for(const e of i){let n=e.byteStride;if(typeof e.byteStride!="number")for(const r of e.attributes||[]){const o=N_(r.format);n+=o.byteLength}const s=e.attributes?.find(r=>r.attribute===t);if(s)return{attributeName:s.attribute,bufferName:e.name,stepMode:e.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:n}}return null}class k_ extends se{static defaultProps={...se.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,e){super(t,e,k_.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=x5(e.shaderLayout,e.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,e){this.device.reportError(new Error("constant attributes not supported"),this)()}}class B_ extends se{static defaultProps={...se.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,B_.defaultProps)}}class U_ extends se{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,U_.defaultProps)}static defaultProps={...se.defaultProps,type:void 0,count:void 0}}let Ku;function HT(i){return(!Ku||Ku.byteLength<i)&&(Ku=new ArrayBuffer(i)),Ku}function C5(i,t){const e=HT(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function R5(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function af(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":R5(i)}const P5=1024;class I5{layout={};byteLength;constructor(t,e={}){let n=0;for(const[r,o]of Object.entries(t)){const l=VT(o),{type:u,components:f}=l,g=f*(e?.[r]??1);n=k6(n,g);const p=n;n+=g,this.layout[r]={type:u,size:g,offset:p}}n+=(4-n%4)%4;const s=n*4;this.byteLength=Math.max(s,P5)}getData(t){const e=HT(this.byteLength),n={i32:new Int32Array(e),u32:new Uint32Array(e),f32:new Float32Array(e),f16:new Uint16Array(e)};for(const[s,r]of Object.entries(t)){const o=this.layout[s];if(!o){ot.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:u,offset:f}=o,g=n[l];if(u===1){if(typeof r!="number"&&typeof r!="boolean"){ot.warn(`Supplied value for single component uniform ${s} is not a number: ${r}`)();continue}g[f]=Number(r)}else{if(!af(r)){ot.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${r}`)();continue}g.set(r,f)}}return new Uint8Array(e,0,this.byteLength)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function O5(i,t,e=16){if(i!==t)return!1;const n=i,s=t;if(!af(n))return!1;if(af(s)&&n.length===s.length){for(let r=0;r<n.length;++r)if(s[r]!==n[r])return!1}return!0}function N5(i){return af(i)?i.slice():i}class D5{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){const e=t?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===t?.name);if(!e)throw new Error(t?.name);const n=e;for(const s of n.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(t){for(const[e,n]of Object.entries(t))this._setUniform(e,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){O5(this.uniforms[t],e)||(this.uniforms[t]=N5(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class L5{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[e,n]of Object.entries(t)){const s=e,r=new I5(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(s,r);const o=new D5({name:e});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,n]of Object.entries(t))this.uniformBlocks.get(e)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){const e=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(e)}createUniformBuffer(t,e,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(e),r=t.createBuffer({usage:fe.UNIFORM|fe.COPY_DST,byteLength:s}),o=this.getUniformBufferData(e);return r.write(o),r}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const n=this.getUniformBufferByteLength(e),s=t.createBuffer({usage:fe.UNIFORM|fe.COPY_DST,byteLength:n});this.uniformBuffers.set(e,s)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(e);t||=n}return t&&ot.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t);let n=this.uniformBuffers.get(t),s=!1;if(n&&e?.needsRedraw){s||=e.needsRedraw;const r=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(r);const o=this.uniformBlocks.get(t)?.getAllUniforms();ot.log(4,`Writing to uniform buffer ${String(t)}`,r,o)()}return s}}class ji{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Hb{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class zs extends ji{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class $s extends ji{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class M0 extends ji{constructor(t,e,n){super(t,n),this.format=e}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Nr extends ji{constructor(t,e,n,s){super(t,n),this.format=e,this.access=s}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var Bs;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Bs||(Bs={}));class Zu{constructor(t,e,n,s,r,o,l){this.name=t,this.type=e,this.group=n,this.binding=s,this.attributes=r,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class k5{constructor(t,e){this.name=t,this.type=e}}class B5{constructor(t,e,n,s){this.name=t,this.type=e,this.locationType=n,this.location=s,this.interpolation=null}}class $b{constructor(t,e,n,s){this.name=t,this.type=e,this.locationType=n,this.location=s}}class U5{constructor(t,e,n,s){this.name=t,this.type=e,this.attributes=n,this.id=s}}class F5{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n}}class z5{constructor(t,e=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e,this.attributes=n}}class V5{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function j5(i){var t=(32768&i)>>15,e=(31744&i)>>10,n=1023&i;return e==0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):e==31?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,e-15)*(1+n/Math.pow(2,10))}const $T=new Float32Array(1),H5=new Int32Array($T.buffer),Xe=new Uint16Array(1);function $5(i){$T[0]=i;const t=H5[0],e=t>>31&1;let n=t>>23&255,s=8388607&t;if(n===255)return Xe[0]=e<<15|31744|(s!==0?512:0),Xe[0];if(n===0){if(s===0)return Xe[0]=e<<15,Xe[0];s|=8388608;let r=113;for(;!(8388608&s);)s<<=1,r--;return n=127-r,s&=8388607,n>0?(s=(s>>126-n)+(s>>127-n&1),Xe[0]=e<<15|n<<10|s>>13,Xe[0]):(Xe[0]=e<<15,Xe[0])}return n=n-127+15,n>=31?(Xe[0]=e<<15|31744,Xe[0]):n<=0?n<-10?(Xe[0]=e<<15,Xe[0]):(s=(8388608|s)>>1-n,Xe[0]=e<<15|s>>13,Xe[0]):(s>>=13,Xe[0]=e<<15|n<<10|s,Xe[0])}const F_=new Uint32Array(1),GT=new Float32Array(F_.buffer,0,1);function Gb(i){const t=112+(i>>6&31)<<23|(63&i)<<17;return F_[0]=t,GT[0]}function G5(i,t,e,n,s,r,o,l,u){const f=n*(o>>=s)*(r>>=s)+e*o+t*l;switch(u){case"r8unorm":return[Xt(i,f,"8unorm",1)[0]];case"r8snorm":return[Xt(i,f,"8snorm",1)[0]];case"r8uint":return[Xt(i,f,"8uint",1)[0]];case"r8sint":return[Xt(i,f,"8sint",1)[0]];case"rg8unorm":{const g=Xt(i,f,"8unorm",2);return[g[0],g[1]]}case"rg8snorm":{const g=Xt(i,f,"8snorm",2);return[g[0],g[1]]}case"rg8uint":{const g=Xt(i,f,"8uint",2);return[g[0],g[1]]}case"rg8sint":{const g=Xt(i,f,"8sint",2);return[g[0],g[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const g=Xt(i,f,"8unorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8snorm":{const g=Xt(i,f,"8snorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8uint":{const g=Xt(i,f,"8uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba8sint":{const g=Xt(i,f,"8sint",4);return[g[0],g[1],g[2],g[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const g=Xt(i,f,"8unorm",4);return[g[2],g[1],g[0],g[3]]}case"r16uint":return[Xt(i,f,"16uint",1)[0]];case"r16sint":return[Xt(i,f,"16sint",1)[0]];case"r16float":return[Xt(i,f,"16float",1)[0]];case"rg16uint":{const g=Xt(i,f,"16uint",2);return[g[0],g[1]]}case"rg16sint":{const g=Xt(i,f,"16sint",2);return[g[0],g[1]]}case"rg16float":{const g=Xt(i,f,"16float",2);return[g[0],g[1]]}case"rgba16uint":{const g=Xt(i,f,"16uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16sint":{const g=Xt(i,f,"16sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16float":{const g=Xt(i,f,"16float",4);return[g[0],g[1],g[2],g[3]]}case"r32uint":return[Xt(i,f,"32uint",1)[0]];case"r32sint":return[Xt(i,f,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Xt(i,f,"32float",1)[0]];case"rg32uint":{const g=Xt(i,f,"32uint",2);return[g[0],g[1]]}case"rg32sint":{const g=Xt(i,f,"32sint",2);return[g[0],g[1]]}case"rg32float":{const g=Xt(i,f,"32float",2);return[g[0],g[1]]}case"rgba32uint":{const g=Xt(i,f,"32uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32sint":{const g=Xt(i,f,"32sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32float":{const g=Xt(i,f,"32float",4);return[g[0],g[1],g[2],g[3]]}case"rg11b10ufloat":{const g=new Uint32Array(i.buffer,f,1)[0],p=(4192256&g)>>11,_=(4290772992&g)>>22;return[Gb(2047&g),Gb(p),(function(v){const b=112+(v>>5&31)<<23|(31&v)<<18;return F_[0]=b,GT[0]})(_),1]}}return null}function Xt(i,t,e,n){const s=[0,0,0,0];for(let r=0;r<n;++r)switch(e){case"8unorm":s[r]=i[t]/255,t++;break;case"8snorm":s[r]=i[t]/255*2-1,t++;break;case"8uint":s[r]=i[t],t++;break;case"8sint":s[r]=i[t]-127,t++;break;case"16uint":s[r]=i[t]|i[t+1]<<8,t+=2;break;case"16sint":s[r]=(i[t]|i[t+1]<<8)-32768,t+=2;break;case"16float":s[r]=j5(i[t]|i[t+1]<<8),t+=2;break;case"32uint":case"32sint":s[r]=i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24,t+=4;break;case"32float":s[r]=new Float32Array(i.buffer,t,1)[0],t+=4}return s}function Yt(i,t,e,n,s){for(let r=0;r<n;++r)switch(e){case"8unorm":i[t]=255*s[r],t++;break;case"8snorm":i[t]=.5*(s[r]+1)*255,t++;break;case"8uint":i[t]=s[r],t++;break;case"8sint":i[t]=s[r]+127,t++;break;case"16uint":new Uint16Array(i.buffer,t,1)[0]=s[r],t+=2;break;case"16sint":new Int16Array(i.buffer,t,1)[0]=s[r],t+=2;break;case"16float":{const o=$5(s[r]);new Uint16Array(i.buffer,t,1)[0]=o,t+=2;break}case"32uint":new Uint32Array(i.buffer,t,1)[0]=s[r],t+=4;break;case"32sint":new Int32Array(i.buffer,t,1)[0]=s[r],t+=4;break;case"32float":new Float32Array(i.buffer,t,1)[0]=s[r],t+=4}return s}const Rp={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};let Mn=class WT{constructor(){this.id=WT._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,e){if(t){e(of.instance);for(const n of t)n instanceof Array?this.searchBlock(n,e):n.search(e);e(lf.instance)}}constEvaluate(t,e){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}};Mn._id=0;class of extends Mn{}of.instance=new of;class lf extends Mn{}lf.instance=new lf;const qT=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ue extends Mn{constructor(){super()}}class Jl extends ue{constructor(t,e,n,s,r,o){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=n,this.body=s,this.startLine=r,this.endLine=o}get astNodeType(){return"function"}search(t){if(this.attributes)for(const e of this.attributes)t(e);t(this);for(const e of this.args)t(e);this.searchBlock(this.body,t)}}class W5 extends ue{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}let XT=class extends ue{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},C0=class extends ue{constructor(t,e){super(),this.body=t,this.loopId=e}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}};class YT extends ue{constructor(t,e,n,s){super(),this.init=t,this.condition=e,this.increment=n,this.body=s}get astNodeType(){return"for"}search(t){var e,n,s;(e=this.init)===null||e===void 0||e.search(t),(n=this.condition)===null||n===void 0||n.search(t),(s=this.increment)===null||s===void 0||s.search(t),this.searchBlock(this.body,t)}}class Zn extends ue{constructor(t,e,n,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}let z_=class extends ue{constructor(t,e,n){super(),this.attributes=null,this.name=t,this.type=e,this.value=n}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}};class kl extends ue{constructor(t,e,n,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Nh extends ue{constructor(t,e,n,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"const"}constEvaluate(t,e){return this.value.constEvaluate(t,e)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var Ba,El,G,V;(i=>{i.increment="++",i.decrement="--"})(Ba||(Ba={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for IncrementOperator");return i[e]}})(Ba||(Ba={}));class KT extends ue{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(El||(El={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for AssignOperator");return e}})(El||(El={}));class ZT extends ue{constructor(t,e,n){super(),this.operator=t,this.variable=e,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class V_ extends ue{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}isBuiltin(){return qT.has(this.name)}search(t){for(const e of this.args)e.search(t);t(this)}}class QT extends ue{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}search(t){var e;this.searchBlock(this.body,t),(e=this.continuing)===null||e===void 0||e.search(t)}}let JT=class extends ue{constructor(t,e){super(),this.condition=t,this.cases=e}get astNodeType(){return"switch"}search(t){t(this);for(const e of this.cases)e.search(t)}};class tw extends ue{constructor(t,e,n,s){super(),this.condition=t,this.body=e,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class ew extends ue{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class q5 extends ue{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class X5 extends ue{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class iw extends ue{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class j_ extends ue{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Y5 extends ue{constructor(){super()}get astNodeType(){return"discard"}}class nw extends ue{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class sw extends ue{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class st extends ue{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const s=st._priority.get(e.name);st._priority.get(t[n].name)<s&&(e=t[n])}return e.name==="x32"?st.i32:e}getTypeName(){return this.name}}st.x32=new st("x32"),st.f32=new st("f32"),st.i32=new st("i32"),st.u32=new st("u32"),st.f16=new st("f16"),st.bool=new st("bool"),st.void=new st("void"),st._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Wb extends st{constructor(t){super(t)}}class Yn extends st{constructor(t,e,n,s){super(t),this.members=e,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}search(t){for(const e of this.members)t(e)}}class $ extends st{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}$.vec2f=new $("vec2",st.f32,null),$.vec3f=new $("vec3",st.f32,null),$.vec4f=new $("vec4",st.f32,null),$.vec2i=new $("vec2",st.i32,null),$.vec3i=new $("vec3",st.i32,null),$.vec4i=new $("vec4",st.i32,null),$.vec2u=new $("vec2",st.u32,null),$.vec3u=new $("vec3",st.u32,null),$.vec4u=new $("vec4",st.u32,null),$.vec2h=new $("vec2",st.f16,null),$.vec3h=new $("vec3",st.f16,null),$.vec4h=new $("vec4",st.f16,null),$.vec2b=new $("vec2",st.bool,null),$.vec3b=new $("vec3",st.bool,null),$.vec4b=new $("vec4",st.bool,null),$.mat2x2f=new $("mat2x2",st.f32,null),$.mat2x3f=new $("mat2x3",st.f32,null),$.mat2x4f=new $("mat2x4",st.f32,null),$.mat3x2f=new $("mat3x2",st.f32,null),$.mat3x3f=new $("mat3x3",st.f32,null),$.mat3x4f=new $("mat3x4",st.f32,null),$.mat4x2f=new $("mat4x2",st.f32,null),$.mat4x3f=new $("mat4x3",st.f32,null),$.mat4x4f=new $("mat4x4",st.f32,null),$.mat2x2h=new $("mat2x2",st.f16,null),$.mat2x3h=new $("mat2x3",st.f16,null),$.mat2x4h=new $("mat2x4",st.f16,null),$.mat3x2h=new $("mat3x2",st.f16,null),$.mat3x3h=new $("mat3x3",st.f16,null),$.mat3x4h=new $("mat3x4",st.f16,null),$.mat4x2h=new $("mat4x2",st.f16,null),$.mat4x3h=new $("mat4x3",st.f16,null),$.mat4x4h=new $("mat4x4",st.f16,null),$.mat2x2i=new $("mat2x2",st.i32,null),$.mat2x3i=new $("mat2x3",st.i32,null),$.mat2x4i=new $("mat2x4",st.i32,null),$.mat3x2i=new $("mat3x2",st.i32,null),$.mat3x3i=new $("mat3x3",st.i32,null),$.mat3x4i=new $("mat3x4",st.i32,null),$.mat4x2i=new $("mat4x2",st.i32,null),$.mat4x3i=new $("mat4x3",st.i32,null),$.mat4x4i=new $("mat4x4",st.i32,null),$.mat2x2u=new $("mat2x2",st.u32,null),$.mat2x3u=new $("mat2x3",st.u32,null),$.mat2x4u=new $("mat2x4",st.u32,null),$.mat3x2u=new $("mat3x2",st.u32,null),$.mat3x3u=new $("mat3x3",st.u32,null),$.mat3x4u=new $("mat3x4",st.u32,null),$.mat4x2u=new $("mat4x2",st.u32,null),$.mat4x3u=new $("mat4x3",st.u32,null),$.mat4x4u=new $("mat4x4",st.u32,null);class Dh extends st{constructor(t,e,n,s){super(t),this.storage=e,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class Bl extends st{constructor(t,e,n,s){super(t),this.attributes=e,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Al extends st{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"sampler"}}class rn extends Mn{constructor(){super(),this.postfix=null}}class Dr extends rn{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class yn extends rn{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}constEvaluate(t,e){return e&&(e[0]=this.type),t.evalExpression(this,t.context)}}class H_ extends rn{constructor(t,e){super(),this.cachedReturnValue=null,this.name=t,this.args=e}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return qT.has(this.name)}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){for(const e of this.args)e.search(t);t(this)}}class Ci extends rn{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,e){return t.evalExpression(this,t.context)}}class rw extends rn{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}constEvaluate(t,e){if(this.initializer){const n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}}class Oe extends rn{constructor(t,e){super(),this.value=t,this.type=e}get astNodeType(){return"literalExpr"}constEvaluate(t,e){return e!==void 0&&(e[0]=this.type),this.value}get isScalar(){return this.value instanceof z}get isVector(){return this.value instanceof O||this.value instanceof At}get scalarValue(){return this.value instanceof z?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof O||this.value instanceof At?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class aw extends rn{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class no extends rn{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class ow extends rn{constructor(){super()}}class Ce extends ow{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class Zi extends ow{constructor(t,e,n){super(),this.operator=t,this.left=e,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,e){return t.name===e.name?t:t.name==="f32"||e.name==="f32"?st.f32:t.name==="u32"||e.name==="u32"?st.u32:st.i32}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class lw extends Mn{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}}class Lh extends rn{constructor(){super()}get astNodeType(){return"default"}}class cw extends lw{constructor(t,e){super(e),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class uw extends lw{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class qb extends Mn{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"argument"}}class K5 extends Mn{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Xb extends Mn{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"member"}}class hw extends Mn{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}class Wi{constructor(t,e){this.parent=null,this.typeInfo=t,this.parent=e,this.id=Wi._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,e,n,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,e,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Wi._id=0;class R0 extends Wi{constructor(){super(new ji("void",null),null)}toString(){return"void"}}R0.void=new R0;class Ia extends Wi{constructor(t){super(new M0("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,e,n,s){this.reference.setDataValue(t,e,n,s)}getSubData(t,e,n){return e?this.reference.getSubData(t,e,n):this}toString(){return`&${this.reference.toString()}`}}class z extends Wi{constructor(t,e,n=null){super(e,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",e)}clone(){if(this.data instanceof Float32Array)return new z(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new z(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new z(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,e,n,s){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(e instanceof z))return void console.error("SetDataValue: Invalid value",e);let r=e.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?r=Math.floor(r):this.typeInfo.name==="bool"&&(r=r?1:0),this.data[0]=r}getSubData(t,e,n){return e?(console.error("getSubData: Scalar data does not support postfix",e),null):this}toString(){return`${this.value}`}}function Z5(i,t,e){const n=t.length;return n===2?e==="f32"?new O(new Float32Array(t),i.getTypeInfo("vec2f")):e==="i32"||e==="bool"?new O(new Int32Array(t),i.getTypeInfo("vec2i")):e==="u32"?new O(new Uint32Array(t),i.getTypeInfo("vec2u")):e==="f16"?new O(new Float32Array(t),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${e}`),null):n===3?e==="f32"?new O(new Float32Array(t),i.getTypeInfo("vec3f")):e==="i32"||e==="bool"?new O(new Int32Array(t),i.getTypeInfo("vec3i")):e==="u32"?new O(new Uint32Array(t),i.getTypeInfo("vec3u")):e==="f16"?new O(new Float32Array(t),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${e}`),null):n===4?e==="f32"?new O(new Float32Array(t),i.getTypeInfo("vec4f")):e==="i32"||e==="bool"?new O(new Int32Array(t),i.getTypeInfo("vec4i")):e==="u32"?new O(new Uint32Array(t),i.getTypeInfo("vec4u")):e==="f16"?new O(new Float32Array(t),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${e}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class O extends Wi{constructor(t,e,n=null){if(super(e,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(t):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(t):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(t):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(t):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(t):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new O(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new O(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new O(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,e,n,s){n instanceof Dr?console.error("TODO: Set vector postfix"):e instanceof O?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;let s=t.getTypeInfo("f32");if(this.typeInfo instanceof Nr)s=this.typeInfo.format||s;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?s=t.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?s=t.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?s=t.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?s=t.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?s=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let r=this;for(;e!==null&&r!==null;){if(e instanceof no){const o=e.index;let l=-1;if(o instanceof Oe){if(!(o.value instanceof z))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=t.evalExpression(o,n);if(!(u instanceof z))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=r.data.length)return console.error("GetSubData: Index out of range",l),null;if(r.data instanceof Float32Array){const u=new Float32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new z(u,s)}if(r.data instanceof Int32Array){const u=new Int32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new z(u,s)}if(r.data instanceof Uint32Array){const u=new Uint32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new z(u,s)}throw"GetSubData: Invalid data type"}if(!(e instanceof Dr))return console.error("GetSubData: Unknown postfix",e),null;{const o=e.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let f=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new z(f,s,this)}if(this.data instanceof Int32Array){let f=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new z(f,s,this)}if(this.data instanceof Uint32Array){let f=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new z(f,s,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);r=Z5(t,l,s.name)}e=e.postfix}return r}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class At extends Wi{constructor(t,e,n=null){super(e,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new At(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,e,n,s){n instanceof Dr?console.error("TODO: Set matrix postfix"):e instanceof At?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;const s=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof Nr)this.typeInfo.format;else if(s.endsWith("f"))t.getTypeInfo("f32");else if(s.endsWith("i"))t.getTypeInfo("i32");else if(s.endsWith("u"))t.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;t.getTypeInfo("f16")}if(e instanceof no){const r=e.index;let o=-1;if(r instanceof Oe){if(!(r.value instanceof z))return console.error(`GetDataValue: Invalid array index ${r.value}`),null;o=r.value.value}else{const f=t.evalExpression(r,n);if(!(f instanceof z))return console.error("GetDataValue: Unknown index type",r),null;o=f.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=s.endsWith("h")?"h":"f";let u;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")u=new O(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),t.getTypeInfo(`vec2${l}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")u=new O(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),t.getTypeInfo(`vec3${l}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;u=new O(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),t.getTypeInfo(`vec4${l}`))}return e.postfix?u.getSubData(t,e.postfix,n):u}return console.error("GetDataValue: Invalid postfix",e),null}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class me extends Wi{constructor(t,e,n=0,s=null){super(e,s),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new me(t.buffer,this.typeInfo,0,null)}setDataValue(t,e,n,s){if(e===null)return void console.log("setDataValue: NULL data.");let r=this.offset,o=this.typeInfo;for(;n;){if(n instanceof no)if(o instanceof $s){const l=n.index;if(l instanceof Oe){if(!(l.value instanceof z))return void console.error(`SetDataValue: Invalid index type ${l.value}`);r+=l.value.value*o.stride}else{const u=t.evalExpression(l,s);if(!(u instanceof z))return void console.error("SetDataValue: Unknown index type",l);r+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(n instanceof Dr))return void console.error("SetDataValue: Unknown postfix type",n);{const l=n.value;if(o instanceof zs){let u=!1;for(const f of o.members)if(f.name===l){r+=f.offset,o=f.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof ji){const u=o.getTypeName();let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);f=3}if(!(e instanceof z))return void console.error("SetDataValue: Invalid value",e);const g=e.value;return u==="vec2f"?void(new Float32Array(this.buffer,r,2)[f]=g):u==="vec3f"?void(new Float32Array(this.buffer,r,3)[f]=g):u==="vec4f"?void(new Float32Array(this.buffer,r,4)[f]=g):u==="vec2i"?void(new Int32Array(this.buffer,r,2)[f]=g):u==="vec3i"?void(new Int32Array(this.buffer,r,3)[f]=g):u==="vec4i"?void(new Int32Array(this.buffer,r,4)[f]=g):u==="vec2u"?void(new Uint32Array(this.buffer,r,2)[f]=g):u==="vec3u"?void(new Uint32Array(this.buffer,r,3)[f]=g):u==="vec4u"?void(new Uint32Array(this.buffer,r,4)[f]=g):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}n=n.postfix}this.setData(t,e,o,r,s)}setData(t,e,n,s,r){const o=n.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool"){if(o==="vec2f"||o==="vec2h"){const l=new Float32Array(this.buffer,s,2);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(o==="vec3f"||o==="vec3h"){const l=new Float32Array(this.buffer,s,3);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(o==="vec4f"||o==="vec4h"){const l=new Float32Array(this.buffer,s,4);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(o==="vec2i"){const l=new Int32Array(this.buffer,s,2);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(o==="vec3i"){const l=new Int32Array(this.buffer,s,3);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(o==="vec4i"){const l=new Int32Array(this.buffer,s,4);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(o==="vec2u"){const l=new Uint32Array(this.buffer,s,2);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(o==="vec3u"){const l=new Uint32Array(this.buffer,s,3);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(o==="vec4u"){const l=new Uint32Array(this.buffer,s,4);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(o==="vec2b"){const l=new Uint32Array(this.buffer,s,2);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(o==="vec3b"){const l=new Uint32Array(this.buffer,s,3);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(o==="vec4b"){const l=new Uint32Array(this.buffer,s,4);return void(e instanceof O?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(o==="mat2x2f"||o==="mat2x2h"){const l=new Float32Array(this.buffer,s,4);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(o==="mat2x3f"||o==="mat2x3h"){const l=new Float32Array(this.buffer,s,6);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(o==="mat2x4f"||o==="mat2x4h"){const l=new Float32Array(this.buffer,s,8);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(o==="mat3x2f"||o==="mat3x2h"){const l=new Float32Array(this.buffer,s,6);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(o==="mat3x3f"||o==="mat3x3h"){const l=new Float32Array(this.buffer,s,9);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8]))}if(o==="mat3x4f"||o==="mat3x4h"){const l=new Float32Array(this.buffer,s,12);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(o==="mat4x2f"||o==="mat4x2h"){const l=new Float32Array(this.buffer,s,8);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(o==="mat4x3f"||o==="mat4x3h"){const l=new Float32Array(this.buffer,s,12);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(o==="mat4x4f"||o==="mat4x4h"){const l=new Float32Array(this.buffer,s,16);return void(e instanceof At?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11],l[12]=e.data[12],l[13]=e.data[13],l[14]=e.data[14],l[15]=e.data[15]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11],l[12]=e[12],l[13]=e[13],l[14]=e[14],l[15]=e[15]))}if(e instanceof me){if(n===e.typeInfo)return void new Uint8Array(this.buffer,s,e.buffer.byteLength).set(new Uint8Array(e.buffer));console.error("SetDataValue: Type mismatch",o,e.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else e instanceof z&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof z&&(new Uint32Array(this.buffer,s,1)[0]=e.value);else e instanceof z&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof z&&(new Float32Array(this.buffer,s,1)[0]=e.value)}getSubData(t,e,n){var s,r,o;if(e===null)return this;let l=this.offset,u=this.typeInfo;for(;e;){if(e instanceof no){const g=e.index,p=g instanceof rn?t.evalExpression(g,n):g;let _=0;if(p instanceof z?_=p.value:typeof p=="number"?_=p:console.error("GetDataValue: Invalid index type",g),u instanceof $s)l+=_*u.stride,u=u.format;else{const v=u.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(l+=16*_,u=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(e instanceof Dr))return console.error("GetDataValue: Unknown postfix type",e),null;{const g=e.value;if(u instanceof zs){let p=!1;for(const _ of u.members)if(_.name===g){l+=_.offset,u=_.type,p=!0;break}if(!p)return console.error(`GetDataValue: Member ${g} not found`),null}else if(u instanceof ji){const p=u.getTypeName();if(p==="vec2f"||p==="vec3f"||p==="vec4f"||p==="vec2i"||p==="vec3i"||p==="vec4i"||p==="vec2u"||p==="vec3u"||p==="vec4u"||p==="vec2b"||p==="vec3b"||p==="vec4b"||p==="vec2h"||p==="vec3h"||p==="vec4h"||p==="vec2"||p==="vec3"||p==="vec4"){if(g.length>0&&g.length<5){let _="f";const v=[];for(let b=0;b<g.length;++b){const x=g[b].toLowerCase();let T=0;if(x==="x"||x==="r")T=0;else if(x==="y"||x==="g")T=1;else if(x==="z"||x==="b")T=2;else{if(x!=="w"&&x!=="a")return console.error(`Unknown member ${g}`),null;T=3}if(g.length===1){if(p.endsWith("f"))return this.buffer.byteLength<l+4*T+4?(console.log("Insufficient buffer data"),null):new z(new Float32Array(this.buffer,l+4*T,1),t.getTypeInfo("f32"),this);if(p.endsWith("h"))return new z(new Float32Array(this.buffer,l+4*T,1),t.getTypeInfo("f16"),this);if(p.endsWith("i"))return new z(new Int32Array(this.buffer,l+4*T,1),t.getTypeInfo("i32"),this);if(p.endsWith("b"))return new z(new Int32Array(this.buffer,l+4*T,1),t.getTypeInfo("bool"),this);if(p.endsWith("u"))return new z(new Uint32Array(this.buffer,l+4*T,1),t.getTypeInfo("i32"),this)}if(p==="vec2f")v.push(new Float32Array(this.buffer,l,2)[T]);else if(p==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const w=new Float32Array(this.buffer,l,3);v.push(w[T])}else if(p==="vec4f")v.push(new Float32Array(this.buffer,l,4)[T]);else if(p==="vec2i")_="i",v.push(new Int32Array(this.buffer,l,2)[T]);else if(p==="vec3i")_="i",v.push(new Int32Array(this.buffer,l,3)[T]);else if(p==="vec4i")_="i",v.push(new Int32Array(this.buffer,l,4)[T]);else if(p==="vec2u"){_="u";const w=new Uint32Array(this.buffer,l,2);v.push(w[T])}else p==="vec3u"?(_="u",v.push(new Uint32Array(this.buffer,l,3)[T])):p==="vec4u"&&(_="u",v.push(new Uint32Array(this.buffer,l,4)[T]))}return v.length===2?u=t.getTypeInfo(`vec2${_}`):v.length===3?u=t.getTypeInfo(`vec3${_}`):v.length===4?u=t.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new O(v,u,null)}return console.error(`GetDataValue: Unknown member ${g}`),null}return console.error(`GetDataValue: Type ${p} is not a struct`),null}}}e=e.postfix}const f=u.getTypeName();return f==="f32"?new z(new Float32Array(this.buffer,l,1),u,this):f==="i32"?new z(new Int32Array(this.buffer,l,1),u,this):f==="u32"?new z(new Uint32Array(this.buffer,l,1),u,this):f==="vec2f"?new O(new Float32Array(this.buffer,l,2),u,this):f==="vec3f"?new O(new Float32Array(this.buffer,l,3),u,this):f==="vec4f"?new O(new Float32Array(this.buffer,l,4),u,this):f==="vec2i"?new O(new Int32Array(this.buffer,l,2),u,this):f==="vec3i"?new O(new Int32Array(this.buffer,l,3),u,this):f==="vec4i"?new O(new Int32Array(this.buffer,l,4),u,this):f==="vec2u"?new O(new Uint32Array(this.buffer,l,2),u,this):f==="vec3u"?new O(new Uint32Array(this.buffer,l,3),u,this):f==="vec4u"?new O(new Uint32Array(this.buffer,l,4),u,this):u instanceof Nr&&u.name==="atomic"?((s=u.format)===null||s===void 0?void 0:s.name)==="u32"?new z(new Uint32Array(this.buffer,l,1)[0],u.format,this):((r=u.format)===null||r===void 0?void 0:r.name)==="i32"?new z(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new me(this.buffer,u,l,this)}toString(){let t="";if(this.typeInfo instanceof $s)if(this.typeInfo.format.name==="f32"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="i32"){const e=new Int32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="u32"){const e=new Uint32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="vec2f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}]`;for(let n=1;n<e.length/2;++n)t+=`, [${e[2*n]}, ${e[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}, ${e[n+3]}]`}else t="[...]";else this.typeInfo instanceof zs?t+="{...}":t="[...]";return t}}class Kn extends Wi{constructor(t,e,n,s){super(e,null),this.data=t,this.descriptor=n,this.view=s}clone(){return new Kn(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.width)!==null&&e!==void 0?e:0}get height(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.height)!==null&&e!==void 0?e:0}get depthOrArrayLayers(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.depthOrArrayLayers)!==null&&e!==void 0?e:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const e=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<e.length;++n)e[n]=Math.max(1,e[n]>>t);return e}get texelByteSize(){const t=this.format,e=Rp[t];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,e=Rp[t];return!!e&&e.isDepthStencil}getGpuSize(){const t=this.format,e=Rp[t],n=this.width;if(!t||n<=0||!e)return-1;const s=this.height,r=this.depthOrArrayLayers,o=this.dimension;return n/e.blockWidth*(o==="1d"?1:s/e.blockHeight)*e.bytesPerBlock*r}getPixel(t,e,n=0,s=0){const r=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[s];return G5(new Uint8Array(u),t,e,n,s,l,o,r,this.format)}setPixel(t,e,n,s,r){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,f=this.data[s];(function(g,p,_,v,b,x,T,w,M,E){const P=v*(T>>=b)*(x>>=b)+_*T+p*w;switch(M){case"r8unorm":return void Yt(g,P,"8unorm",1,E);case"r8snorm":return void Yt(g,P,"8snorm",1,E);case"r8uint":return void Yt(g,P,"8uint",1,E);case"r8sint":return void Yt(g,P,"8sint",1,E);case"rg8unorm":return void Yt(g,P,"8unorm",2,E);case"rg8snorm":return void Yt(g,P,"8snorm",2,E);case"rg8uint":return void Yt(g,P,"8uint",2,E);case"rg8sint":return void Yt(g,P,"8sint",2,E);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Yt(g,P,"8unorm",4,E);case"rgba8snorm":return void Yt(g,P,"8snorm",4,E);case"rgba8uint":return void Yt(g,P,"8uint",4,E);case"rgba8sint":return void Yt(g,P,"8sint",4,E);case"r16uint":return void Yt(g,P,"16uint",1,E);case"r16sint":return void Yt(g,P,"16sint",1,E);case"r16float":return void Yt(g,P,"16float",1,E);case"rg16uint":return void Yt(g,P,"16uint",2,E);case"rg16sint":return void Yt(g,P,"16sint",2,E);case"rg16float":return void Yt(g,P,"16float",2,E);case"rgba16uint":return void Yt(g,P,"16uint",4,E);case"rgba16sint":return void Yt(g,P,"16sint",4,E);case"rgba16float":return void Yt(g,P,"16float",4,E);case"r32uint":return void Yt(g,P,"32uint",1,E);case"r32sint":return void Yt(g,P,"32sint",1,E);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Yt(g,P,"32float",1,E);case"rg32uint":return void Yt(g,P,"32uint",2,E);case"rg32sint":return void Yt(g,P,"32sint",2,E);case"rg32float":return void Yt(g,P,"32float",2,E);case"rgba32uint":return void Yt(g,P,"32uint",4,E);case"rgba32sint":return void Yt(g,P,"32sint",4,E);case"rgba32float":return void Yt(g,P,"32float",4,E);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(f),t,e,n,s,u,l,o,this.format,r)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(V||(V={}));class j{constructor(t,e,n){this.name=t,this.type=e,this.rule=n}toString(){return this.name}}class R{}G=R,R.none=new j("",V.reserved,""),R.eof=new j("EOF",V.token,""),R.reserved={asm:new j("asm",V.reserved,"asm"),bf16:new j("bf16",V.reserved,"bf16"),do:new j("do",V.reserved,"do"),enum:new j("enum",V.reserved,"enum"),f16:new j("f16",V.reserved,"f16"),f64:new j("f64",V.reserved,"f64"),handle:new j("handle",V.reserved,"handle"),i8:new j("i8",V.reserved,"i8"),i16:new j("i16",V.reserved,"i16"),i64:new j("i64",V.reserved,"i64"),mat:new j("mat",V.reserved,"mat"),premerge:new j("premerge",V.reserved,"premerge"),regardless:new j("regardless",V.reserved,"regardless"),typedef:new j("typedef",V.reserved,"typedef"),u8:new j("u8",V.reserved,"u8"),u16:new j("u16",V.reserved,"u16"),u64:new j("u64",V.reserved,"u64"),unless:new j("unless",V.reserved,"unless"),using:new j("using",V.reserved,"using"),vec:new j("vec",V.reserved,"vec"),void:new j("void",V.reserved,"void")},R.keywords={array:new j("array",V.keyword,"array"),atomic:new j("atomic",V.keyword,"atomic"),bool:new j("bool",V.keyword,"bool"),f32:new j("f32",V.keyword,"f32"),i32:new j("i32",V.keyword,"i32"),mat2x2:new j("mat2x2",V.keyword,"mat2x2"),mat2x3:new j("mat2x3",V.keyword,"mat2x3"),mat2x4:new j("mat2x4",V.keyword,"mat2x4"),mat3x2:new j("mat3x2",V.keyword,"mat3x2"),mat3x3:new j("mat3x3",V.keyword,"mat3x3"),mat3x4:new j("mat3x4",V.keyword,"mat3x4"),mat4x2:new j("mat4x2",V.keyword,"mat4x2"),mat4x3:new j("mat4x3",V.keyword,"mat4x3"),mat4x4:new j("mat4x4",V.keyword,"mat4x4"),ptr:new j("ptr",V.keyword,"ptr"),sampler:new j("sampler",V.keyword,"sampler"),sampler_comparison:new j("sampler_comparison",V.keyword,"sampler_comparison"),struct:new j("struct",V.keyword,"struct"),texture_1d:new j("texture_1d",V.keyword,"texture_1d"),texture_2d:new j("texture_2d",V.keyword,"texture_2d"),texture_2d_array:new j("texture_2d_array",V.keyword,"texture_2d_array"),texture_3d:new j("texture_3d",V.keyword,"texture_3d"),texture_cube:new j("texture_cube",V.keyword,"texture_cube"),texture_cube_array:new j("texture_cube_array",V.keyword,"texture_cube_array"),texture_multisampled_2d:new j("texture_multisampled_2d",V.keyword,"texture_multisampled_2d"),texture_storage_1d:new j("texture_storage_1d",V.keyword,"texture_storage_1d"),texture_storage_2d:new j("texture_storage_2d",V.keyword,"texture_storage_2d"),texture_storage_2d_array:new j("texture_storage_2d_array",V.keyword,"texture_storage_2d_array"),texture_storage_3d:new j("texture_storage_3d",V.keyword,"texture_storage_3d"),texture_depth_2d:new j("texture_depth_2d",V.keyword,"texture_depth_2d"),texture_depth_2d_array:new j("texture_depth_2d_array",V.keyword,"texture_depth_2d_array"),texture_depth_cube:new j("texture_depth_cube",V.keyword,"texture_depth_cube"),texture_depth_cube_array:new j("texture_depth_cube_array",V.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new j("texture_depth_multisampled_2d",V.keyword,"texture_depth_multisampled_2d"),texture_external:new j("texture_external",V.keyword,"texture_external"),u32:new j("u32",V.keyword,"u32"),vec2:new j("vec2",V.keyword,"vec2"),vec3:new j("vec3",V.keyword,"vec3"),vec4:new j("vec4",V.keyword,"vec4"),bitcast:new j("bitcast",V.keyword,"bitcast"),block:new j("block",V.keyword,"block"),break:new j("break",V.keyword,"break"),case:new j("case",V.keyword,"case"),continue:new j("continue",V.keyword,"continue"),continuing:new j("continuing",V.keyword,"continuing"),default:new j("default",V.keyword,"default"),diagnostic:new j("diagnostic",V.keyword,"diagnostic"),discard:new j("discard",V.keyword,"discard"),else:new j("else",V.keyword,"else"),enable:new j("enable",V.keyword,"enable"),fallthrough:new j("fallthrough",V.keyword,"fallthrough"),false:new j("false",V.keyword,"false"),fn:new j("fn",V.keyword,"fn"),for:new j("for",V.keyword,"for"),function:new j("function",V.keyword,"function"),if:new j("if",V.keyword,"if"),let:new j("let",V.keyword,"let"),const:new j("const",V.keyword,"const"),loop:new j("loop",V.keyword,"loop"),while:new j("while",V.keyword,"while"),private:new j("private",V.keyword,"private"),read:new j("read",V.keyword,"read"),read_write:new j("read_write",V.keyword,"read_write"),return:new j("return",V.keyword,"return"),requires:new j("requires",V.keyword,"requires"),storage:new j("storage",V.keyword,"storage"),switch:new j("switch",V.keyword,"switch"),true:new j("true",V.keyword,"true"),alias:new j("alias",V.keyword,"alias"),type:new j("type",V.keyword,"type"),uniform:new j("uniform",V.keyword,"uniform"),var:new j("var",V.keyword,"var"),override:new j("override",V.keyword,"override"),workgroup:new j("workgroup",V.keyword,"workgroup"),write:new j("write",V.keyword,"write"),r8unorm:new j("r8unorm",V.keyword,"r8unorm"),r8snorm:new j("r8snorm",V.keyword,"r8snorm"),r8uint:new j("r8uint",V.keyword,"r8uint"),r8sint:new j("r8sint",V.keyword,"r8sint"),r16uint:new j("r16uint",V.keyword,"r16uint"),r16sint:new j("r16sint",V.keyword,"r16sint"),r16float:new j("r16float",V.keyword,"r16float"),rg8unorm:new j("rg8unorm",V.keyword,"rg8unorm"),rg8snorm:new j("rg8snorm",V.keyword,"rg8snorm"),rg8uint:new j("rg8uint",V.keyword,"rg8uint"),rg8sint:new j("rg8sint",V.keyword,"rg8sint"),r32uint:new j("r32uint",V.keyword,"r32uint"),r32sint:new j("r32sint",V.keyword,"r32sint"),r32float:new j("r32float",V.keyword,"r32float"),rg16uint:new j("rg16uint",V.keyword,"rg16uint"),rg16sint:new j("rg16sint",V.keyword,"rg16sint"),rg16float:new j("rg16float",V.keyword,"rg16float"),rgba8unorm:new j("rgba8unorm",V.keyword,"rgba8unorm"),rgba8unorm_srgb:new j("rgba8unorm_srgb",V.keyword,"rgba8unorm_srgb"),rgba8snorm:new j("rgba8snorm",V.keyword,"rgba8snorm"),rgba8uint:new j("rgba8uint",V.keyword,"rgba8uint"),rgba8sint:new j("rgba8sint",V.keyword,"rgba8sint"),bgra8unorm:new j("bgra8unorm",V.keyword,"bgra8unorm"),bgra8unorm_srgb:new j("bgra8unorm_srgb",V.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new j("rgb10a2unorm",V.keyword,"rgb10a2unorm"),rg11b10float:new j("rg11b10float",V.keyword,"rg11b10float"),rg32uint:new j("rg32uint",V.keyword,"rg32uint"),rg32sint:new j("rg32sint",V.keyword,"rg32sint"),rg32float:new j("rg32float",V.keyword,"rg32float"),rgba16uint:new j("rgba16uint",V.keyword,"rgba16uint"),rgba16sint:new j("rgba16sint",V.keyword,"rgba16sint"),rgba16float:new j("rgba16float",V.keyword,"rgba16float"),rgba32uint:new j("rgba32uint",V.keyword,"rgba32uint"),rgba32sint:new j("rgba32sint",V.keyword,"rgba32sint"),rgba32float:new j("rgba32float",V.keyword,"rgba32float"),static_assert:new j("static_assert",V.keyword,"static_assert")},R.tokens={decimal_float_literal:new j("decimal_float_literal",V.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new j("hex_float_literal",V.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new j("int_literal",V.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new j("uint_literal",V.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new j("name",V.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new j("ident",V.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new j("and",V.token,"&"),and_and:new j("and_and",V.token,"&&"),arrow:new j("arrow ",V.token,"->"),attr:new j("attr",V.token,"@"),forward_slash:new j("forward_slash",V.token,"/"),bang:new j("bang",V.token,"!"),bracket_left:new j("bracket_left",V.token,"["),bracket_right:new j("bracket_right",V.token,"]"),brace_left:new j("brace_left",V.token,"{"),brace_right:new j("brace_right",V.token,"}"),colon:new j("colon",V.token,":"),comma:new j("comma",V.token,","),equal:new j("equal",V.token,"="),equal_equal:new j("equal_equal",V.token,"=="),not_equal:new j("not_equal",V.token,"!="),greater_than:new j("greater_than",V.token,">"),greater_than_equal:new j("greater_than_equal",V.token,">="),shift_right:new j("shift_right",V.token,">>"),less_than:new j("less_than",V.token,"<"),less_than_equal:new j("less_than_equal",V.token,"<="),shift_left:new j("shift_left",V.token,"<<"),modulo:new j("modulo",V.token,"%"),minus:new j("minus",V.token,"-"),minus_minus:new j("minus_minus",V.token,"--"),period:new j("period",V.token,"."),plus:new j("plus",V.token,"+"),plus_plus:new j("plus_plus",V.token,"++"),or:new j("or",V.token,"|"),or_or:new j("or_or",V.token,"||"),paren_left:new j("paren_left",V.token,"("),paren_right:new j("paren_right",V.token,")"),semicolon:new j("semicolon",V.token,";"),star:new j("star",V.token,"*"),tilde:new j("tilde",V.token,"~"),underscore:new j("underscore",V.token,"_"),xor:new j("xor",V.token,"^"),plus_equal:new j("plus_equal",V.token,"+="),minus_equal:new j("minus_equal",V.token,"-="),times_equal:new j("times_equal",V.token,"*="),division_equal:new j("division_equal",V.token,"/="),modulo_equal:new j("modulo_equal",V.token,"%="),and_equal:new j("and_equal",V.token,"&="),or_equal:new j("or_equal",V.token,"|="),xor_equal:new j("xor_equal",V.token,"^="),shift_right_equal:new j("shift_right_equal",V.token,">>="),shift_left_equal:new j("shift_left_equal",V.token,"<<=")},R.simpleTokens={"@":G.tokens.attr,"{":G.tokens.brace_left,"}":G.tokens.brace_right,":":G.tokens.colon,",":G.tokens.comma,"(":G.tokens.paren_left,")":G.tokens.paren_right,";":G.tokens.semicolon},R.literalTokens={"&":G.tokens.and,"&&":G.tokens.and_and,"->":G.tokens.arrow,"/":G.tokens.forward_slash,"!":G.tokens.bang,"[":G.tokens.bracket_left,"]":G.tokens.bracket_right,"=":G.tokens.equal,"==":G.tokens.equal_equal,"!=":G.tokens.not_equal,">":G.tokens.greater_than,">=":G.tokens.greater_than_equal,">>":G.tokens.shift_right,"<":G.tokens.less_than,"<=":G.tokens.less_than_equal,"<<":G.tokens.shift_left,"%":G.tokens.modulo,"-":G.tokens.minus,"--":G.tokens.minus_minus,".":G.tokens.period,"+":G.tokens.plus,"++":G.tokens.plus_plus,"|":G.tokens.or,"||":G.tokens.or_or,"*":G.tokens.star,"~":G.tokens.tilde,_:G.tokens.underscore,"^":G.tokens.xor,"+=":G.tokens.plus_equal,"-=":G.tokens.minus_equal,"*=":G.tokens.times_equal,"/=":G.tokens.division_equal,"%=":G.tokens.modulo_equal,"&=":G.tokens.and_equal,"|=":G.tokens.or_equal,"^=":G.tokens.xor_equal,">>=":G.tokens.shift_right_equal,"<<=":G.tokens.shift_left_equal},R.regexTokens={decimal_float_literal:G.tokens.decimal_float_literal,hex_float_literal:G.tokens.hex_float_literal,int_literal:G.tokens.int_literal,uint_literal:G.tokens.uint_literal,ident:G.tokens.ident},R.storage_class=[G.keywords.function,G.keywords.private,G.keywords.workgroup,G.keywords.uniform,G.keywords.storage],R.access_mode=[G.keywords.read,G.keywords.write,G.keywords.read_write],R.sampler_type=[G.keywords.sampler,G.keywords.sampler_comparison],R.sampled_texture_type=[G.keywords.texture_1d,G.keywords.texture_2d,G.keywords.texture_2d_array,G.keywords.texture_3d,G.keywords.texture_cube,G.keywords.texture_cube_array],R.multisampled_texture_type=[G.keywords.texture_multisampled_2d],R.storage_texture_type=[G.keywords.texture_storage_1d,G.keywords.texture_storage_2d,G.keywords.texture_storage_2d_array,G.keywords.texture_storage_3d],R.depth_texture_type=[G.keywords.texture_depth_2d,G.keywords.texture_depth_2d_array,G.keywords.texture_depth_cube,G.keywords.texture_depth_cube_array,G.keywords.texture_depth_multisampled_2d],R.texture_external_type=[G.keywords.texture_external],R.any_texture_type=[...G.sampled_texture_type,...G.multisampled_texture_type,...G.storage_texture_type,...G.depth_texture_type,...G.texture_external_type],R.texel_format=[G.keywords.r8unorm,G.keywords.r8snorm,G.keywords.r8uint,G.keywords.r8sint,G.keywords.r16uint,G.keywords.r16sint,G.keywords.r16float,G.keywords.rg8unorm,G.keywords.rg8snorm,G.keywords.rg8uint,G.keywords.rg8sint,G.keywords.r32uint,G.keywords.r32sint,G.keywords.r32float,G.keywords.rg16uint,G.keywords.rg16sint,G.keywords.rg16float,G.keywords.rgba8unorm,G.keywords.rgba8unorm_srgb,G.keywords.rgba8snorm,G.keywords.rgba8uint,G.keywords.rgba8sint,G.keywords.bgra8unorm,G.keywords.bgra8unorm_srgb,G.keywords.rgb10a2unorm,G.keywords.rg11b10float,G.keywords.rg32uint,G.keywords.rg32sint,G.keywords.rg32float,G.keywords.rgba16uint,G.keywords.rgba16sint,G.keywords.rgba16float,G.keywords.rgba32uint,G.keywords.rgba32sint,G.keywords.rgba32float],R.const_literal=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal,G.keywords.true,G.keywords.false],R.literal_or_ident=[G.tokens.ident,G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal,G.tokens.name],R.element_count_expression=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.ident],R.template_types=[G.keywords.vec2,G.keywords.vec3,G.keywords.vec4,G.keywords.mat2x2,G.keywords.mat2x3,G.keywords.mat2x4,G.keywords.mat3x2,G.keywords.mat3x3,G.keywords.mat3x4,G.keywords.mat4x2,G.keywords.mat4x3,G.keywords.mat4x4,G.keywords.atomic,G.keywords.bitcast,...G.any_texture_type],R.attribute_name=[G.tokens.ident,G.keywords.block,G.keywords.diagnostic],R.assignment_operators=[G.tokens.equal,G.tokens.plus_equal,G.tokens.minus_equal,G.tokens.times_equal,G.tokens.division_equal,G.tokens.modulo_equal,G.tokens.and_equal,G.tokens.or_equal,G.tokens.xor_equal,G.tokens.shift_right_equal,G.tokens.shift_left_equal],R.increment_operators=[G.tokens.plus_plus,G.tokens.minus_minus];class Yb{constructor(t,e,n,s,r){this.type=t,this.lexeme=e,this.line=n,this.start=s,this.end=r}toString(){return this.lexeme}isTemplateType(){return R.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==R.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Q5{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Yb(R.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const e=R.simpleTokens[t];if(e)return this._addToken(e),!0;let n=R.none;const s=this._isAlpha(t),r=t==="_";if(this._isAlphaNumeric(t)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)t+=this._advance(),o=this._peekAhead()}if(s){const o=R.keywords[t];if(o)return this._addToken(o),!0}if(s||r)return this._addToken(R.tokens.ident),!0;for(;;){let o=this._findType(t);const l=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(l=="=")return this._current++,t+=l,this._addToken(R.tokens.minus_equal),!0;if(l=="-")return this._current++,t+=l,this._addToken(R.tokens.minus_minus),!0;const u=this._tokens.length-1;if((R.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==R.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(t==">"&&(l==">"||l=="=")){let u=!1,f=this._tokens.length-1;for(let g=0;g<5&&f>=0&&R.assignment_operators.indexOf(this._tokens[f].type)===-1;++g,--f)if(this._tokens[f].type===R.tokens.less_than){f>0&&this._tokens[f-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===R.none){let u=t,f=0;const g=2;for(let p=0;p<g;++p)if(u+=this._peekAhead(p),o=this._findType(u),o!==R.none){f=p;break}if(o===R.none)return n!==R.none&&(this._current--,this._addToken(n),!0);t=u,this._current+=f+1}if(n=o,this._isAtEnd())break;t+=this._advance()}return n!==R.none&&(this._addToken(n),!0)}_findType(t){for(const n in R.regexTokens){const s=R.regexTokens[n];if(this._match(t,s.rule))return s}return R.literalTokens[t]||R.none}_match(t,e){const n=e.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new Yb(t,e,this._line,this._start,this._current))}}function dt(i){return Array.isArray(i)||i?.buffer instanceof ArrayBuffer}const cf=new Float32Array(1),J5=new Uint32Array(cf.buffer),tI=new Uint32Array(cf.buffer),uf=new Int32Array(1),eI=new Float32Array(uf.buffer),iI=new Uint32Array(uf.buffer),hf=new Uint32Array(1),nI=new Float32Array(hf.buffer),sI=new Int32Array(hf.buffer);function Kb(i,t,e){if(t===e)return i;if(t==="f32"){if(e==="i32"||e==="x32")return cf[0]=i,J5[0];if(e==="u32")return cf[0]=i,tI[0]}else if(t==="i32"||t==="x32"){if(e==="f32")return uf[0]=i,eI[0];if(e==="u32")return uf[0]=i,iI[0]}else if(t==="u32"){if(e==="f32")return hf[0]=i,nI[0];if(e==="i32"||e==="x32")return hf[0]=i,sI[0]}return console.error(`Unsupported cast from ${t} to ${e}`),i}class rI{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class Qu{constructor(t,e){this.align=t,this.size=e}}class xn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new V5,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const e of t)e instanceof Jl&&this._functions.set(e.name,new rI(e));for(const e of t)if(e instanceof Yn){const n=this.getTypeInfo(e,null);n instanceof zs&&this.structs.push(n)}for(const e of t)if(e instanceof j_)this.aliases.push(this._getAliasInfo(e));else{if(e instanceof z_){const n=e,s=this._getAttributeNum(n.attributes,"id",0),r=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new U5(n.name,r,n.attributes,s));continue}if(this._isUniformVar(e)){const n=e,s=this._getAttributeNum(n.attributes,"group",0),r=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=new Zu(n.name,o,s,r,n.attributes,Bs.Uniform,n.access);l.access||(l.access="read"),this.uniforms.push(l);continue}if(this._isStorageVar(e)){const n=e,s=this._getAttributeNum(n.attributes,"group",0),r=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(o),u=new Zu(n.name,o,s,r,n.attributes,l?Bs.StorageTexture:Bs.Storage,n.access);u.access||(u.access="read"),this.storage.push(u);continue}if(this._isTextureVar(e)){const n=e,s=this._getAttributeNum(n.attributes,"group",0),r=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(o),u=new Zu(n.name,o,s,r,n.attributes,l?Bs.StorageTexture:Bs.Texture,n.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(e)){const n=e,s=this._getAttributeNum(n.attributes,"group",0),r=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=new Zu(n.name,o,s,r,n.attributes,Bs.Sampler,n.access);this.samplers.push(l);continue}}for(const e of t)if(e instanceof Jl){const n=this._getAttribute(e,"vertex"),s=this._getAttribute(e,"fragment"),r=this._getAttribute(e,"compute"),o=n||s||r,l=new z5(e.name,o?.name,e.attributes);l.attributes=e.attributes,l.startLine=e.startLine,l.endLine=e.endLine,this.functions.push(l),this._functions.get(e.name).info=l,o&&(this._functions.get(e.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(e,!!o),l.inputs=this._getInputs(e.args),l.outputs=this._getOutputs(e.returnType),this.entry[o.name].push(l)),l.arguments=e.args.map(u=>new F5(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=e.returnType?this.getTypeInfo(e.returnType,e.attributes):null;continue}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search(n=>{var s,r,o;if(n instanceof hw){if(n.value)if(dt(n.value))for(const l of n.value)for(const u of this.overrides)l===u.name&&((s=e.info)===null||s===void 0||s.overrides.push(u));else for(const l of this.overrides)n.value===l.name&&((r=e.info)===null||r===void 0||r.overrides.push(l))}else if(n instanceof Ci)for(const l of this.overrides)n.name===l.name&&((o=e.info)===null||o===void 0||o.overrides.push(l))});for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(t){for(const e of this.functions)if(e.name==t)return e;return null}getStructInfo(t){for(const e of this.structs)if(e.name==t)return e;return null}getOverrideInfo(t){for(const e of this.overrides)if(e.name==t)return e;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var n;for(const s of t.calls){const r=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;r&&e.add(r)}}findResource(t,e,n){if(n){for(const s of this.entry.compute)if(s.name===n){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.vertex)if(s.name===n){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.fragment)if(s.name===n){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}}for(const s of this.uniforms)if(s.group==t&&s.binding==e)return s;for(const s of this.storage)if(s.group==t&&s.binding==e)return s;for(const s of this.textures)if(s.group==t&&s.binding==e)return s;for(const s of this.samplers)if(s.group==t&&s.binding==e)return s;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this.getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const n=[],s=this,r=[];return t.search(o=>{if(o instanceof of)r.push({});else if(o instanceof lf)r.pop();else if(o instanceof Zn){const l=o;e&&l.type!==null&&this._markStructsFromAST(l.type),r.length>0&&(r[r.length-1][l.name]=l)}else if(o instanceof yn){const l=o;e&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof kl){const l=o;e&&l.type!==null&&this._markStructsFromAST(l.type),r.length>0&&(r[r.length-1][l.name]=l)}else if(o instanceof Ci){const l=o;if(r.length>0&&r[r.length-1][l.name])return;const u=s._findResource(l.name);u&&n.push(u)}else if(o instanceof H_){const l=o,u=s._functions.get(l.name);u&&(e&&(u.inUse=!0),t.calls.add(u.node),u.resources===null&&(u.resources=s._findResources(u.node,e)),n.push(...u.resources))}else if(o instanceof V_){const l=o,u=s._functions.get(l.name);u&&(e&&(u.inUse=!0),t.calls.add(u.node),u.resources===null&&(u.resources=s._findResources(u.node,e)),n.push(...u.resources))}}),[...new Map(n.map(o=>[o.name,o])).values()]}getBindGroups(){const t=[];function e(n,s){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),s>=t[n].length&&(t[n].length=s+1)}for(const n of this.uniforms)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.storage)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.textures)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.samplers)e(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Yn)this._getStructOutputs(t,e);else{const n=this._getOutputInfo(t);n!==null&&e.push(n)}return e}_getStructOutputs(t,e){for(const n of t.members)if(n.type instanceof Yn)this._getStructOutputs(n.type,e);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const r=this.getTypeInfo(n.type,n.type.attributes),o=this._parseInt(s.value),l=new $b(n.name,r,s.name,o);e.push(l)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this.getTypeInfo(t,t.attributes),s=this._parseInt(e.value);return new $b("",n,e.name,s)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const n of t)if(n.type instanceof Yn)this._getStructInputs(n.type,e);else{const s=this._getInputInfo(n);s!==null&&e.push(s)}return e}_getStructInputs(t,e){for(const n of t.members)if(n.type instanceof Yn)this._getStructInputs(n.type,e);else{const s=this._getInputInfo(n);s!==null&&e.push(s)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this._getAttribute(t,"interpolation"),s=this.getTypeInfo(t.type,t.attributes),r=this._parseInt(e.value),o=new B5(t.name,s,e.name,r);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new k5(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const e of this.structs)if(e.name==t)return e;for(const e of this.aliases)if(e.name==t)return e.type;return null}getTypeInfo(t,e=null){if(this._types.has(t))return this._types.get(t);if(t instanceof Dh){const s=t.type?this.getTypeInfo(t.type,t.attributes):null,r=new M0(t.name,s,e);return this._types.set(t,r),this._updateTypeInfo(r),r}if(t instanceof Bl){const s=t,r=s.format?this.getTypeInfo(s.format,s.attributes):null,o=new $s(s.name,e);return o.format=r,o.count=s.count,this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof Yn){const s=t,r=new zs(s.name,e);r.startLine=s.startLine,r.endLine=s.endLine;for(const o of s.members){const l=this.getTypeInfo(o.type,o.attributes);r.members.push(new Hb(o.name,l,o.attributes))}return this._types.set(t,r),this._updateTypeInfo(r),r}if(t instanceof Al){const s=t,r=s.format instanceof st,o=s.format?r?this.getTypeInfo(s.format,null):new ji(s.format,null):null,l=new Nr(s.name,o,e,s.access);return this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof $){const s=t,r=s.format?this.getTypeInfo(s.format,null):null,o=new Nr(s.name,r,e,s.access);return this._types.set(t,o),this._updateTypeInfo(o),o}const n=new ji(t.name,e);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var e,n,s;const r=this._getTypeSize(t);if(t.size=(e=r?.size)!==null&&e!==void 0?e:0,t instanceof $s&&t.format){const o=this._getTypeSize(t.format);t.stride=Math.max((n=o?.size)!==null&&n!==void 0?n:0,(s=o?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(t.format)}t instanceof M0&&this._updateTypeInfo(t.format),t instanceof zs&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let n=0,s=0,r=0,o=0;for(let l=0,u=t.members.length;l<u;++l){const f=t.members[l],g=this._getTypeSize(f);if(!g)continue;(e=this._getAlias(f.type.name))!==null&&e!==void 0||f.type;const p=g.align,_=g.size;n=this._roundUp(p,n+s),s=_,r=n,o=Math.max(o,p),f.offset=n,f.size=_,this._updateTypeInfo(f.type)}t.size=this._roundUp(o,r+s),t.align=o}_getTypeSize(t){var e,n;if(t==null)return null;const s=this._getAttributeNum(t.attributes,"size",0),r=this._getAttributeNum(t.attributes,"align",0);if(t instanceof Hb&&(t=t.type),t instanceof ji){const o=this._getAlias(t.name);o!==null&&(t=o)}{const o=xn._typeInfo[t.name];if(o!==void 0){const l=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new Qu(Math.max(r,o.align/l),Math.max(s,o.size/l))}}{const o=xn._typeInfo[t.name.substring(0,t.name.length-1)];if(o){const l=t.name[t.name.length-1]==="h"?2:1;return new Qu(Math.max(r,o.align/l),Math.max(s,o.size/l))}}if(t instanceof $s){let o=t,l=8,u=8;const f=this._getTypeSize(o.format);return f!==null&&(u=f.size,l=f.align),u=o.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,u)),s&&(u=s),new Qu(Math.max(r,l),Math.max(s,u))}if(t instanceof zs){let o=0,l=0,u=0,f=0,g=0;for(const p of t.members){const _=this._getTypeSize(p.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+f),f=_.size,g=u)}return l=this._roundUp(o,g+f),new Qu(Math.max(r,o),Math.max(s,l))}return null}_isUniformVar(t){return t instanceof Zn&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Zn&&t.storage=="storage"}_isTextureVar(t){return t instanceof Zn&&t.type!==null&&xn._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Zn&&t.type!==null&&xn._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const n=t;if(!n||!n.attributes)return null;const s=n.attributes;for(let r of s)if(r.name==e)return r;return null}_getAttributeNum(t,e,n){if(t===null)return n;for(let s of t)if(s.name==e){let r=s!==null&&s.value!==null?s.value:n;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):n}return n}_roundUp(t,e){return Math.ceil(e/t)*t}}xn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},xn._textureTypes=R.any_texture_type.map(i=>i.name),xn._samplerTypes=R.sampler_type.map(i=>i.name);let $_=0;class G_{constructor(t,e,n){this.id=$_++,this.name=t,this.value=e,this.node=n}clone(){return new G_(this.name,this.value,this.node)}}class W_{constructor(t){this.id=$_++,this.name=t.name,this.node=t}clone(){return new W_(this.node)}}class q_{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=$_++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var e;return this.variables.has(t)?(e=this.variables.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var e;return this.functions.has(t)?(e=this.functions.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getFunction(t):null}createVariable(t,e,n){this.variables.set(t,new G_(t,e,n??null))}setVariable(t,e,n){const s=this.getVariable(t);s!==null?s.value=e:this.createVariable(t,e,n)}getVariableValue(t){var e;const n=this.getVariable(t);return(e=n?.value)!==null&&e!==void 0?e:null}clone(){return new q_(this)}}class aI{evalExpression(t,e){return null}getTypeInfo(t){return null}getVariableName(t,e){return""}}class oI{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,e){const n=this.exec.evalExpression(t.args[0],e);let s=!0;if(n instanceof O)return n.data.forEach(r=>{r||(s=!1)}),new z(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O){const s=n.data.some(r=>r);return new z(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,e){const n=this.exec.evalExpression(t.args[2],e);if(!(n instanceof z))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],e):this.exec.evalExpression(t.args[0],e)}ArrayLength(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.evalExpression(n,e);if(s instanceof me&&s.typeInfo.size===0){const r=s.typeInfo,o=s.buffer.byteLength/r.stride;return new z(o,this.getTypeInfo("u32"))}return new z(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.abs(r)),n.typeInfo);const s=n;return new z(Math.abs(s.value),s.typeInfo)}Acos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.acos(r)),n.typeInfo);const s=n;return new z(Math.acos(s.value),n.typeInfo)}Acosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.acosh(r)),n.typeInfo);const s=n;return new z(Math.acosh(s.value),n.typeInfo)}Asin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.asin(r)),n.typeInfo);const s=n;return new z(Math.asin(s.value),n.typeInfo)}Asinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.asinh(r)),n.typeInfo);const s=n;return new z(Math.asinh(s.value),n.typeInfo)}Atan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.atan(r)),n.typeInfo);const s=n;return new z(Math.atan(s.value),n.typeInfo)}Atanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.atanh(r)),n.typeInfo);const s=n;return new z(Math.atanh(s.value),n.typeInfo)}Atan2(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O)return new O(n.data.map((l,u)=>Math.atan2(l,s.data[u])),n.typeInfo);const r=n,o=s;return new z(Math.atan2(r.value,o.value),n.typeInfo)}Ceil(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.ceil(r)),n.typeInfo);const s=n;return new z(Math.ceil(s.value),n.typeInfo)}_clamp(t,e,n){return Math.min(Math.max(t,e),n)}Clamp(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(n instanceof O&&s instanceof O&&r instanceof O)return new O(n.data.map((f,g)=>this._clamp(f,s.data[g],r.data[g])),n.typeInfo);const o=n,l=s,u=r;return new z(this._clamp(o.value,l.value,u.value),n.typeInfo)}Cos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.cos(r)),n.typeInfo);const s=n;return new z(Math.cos(s.value),n.typeInfo)}Cosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.cosh(r)),n.typeInfo);const s=n;return new z(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.clz32(r)),n.typeInfo);const s=n;return new z(Math.clz32(s.value),n.typeInfo)}_countOneBits(t){let e=0;for(;t!==0;)1&t&&e++,t>>=1;return e}CountOneBits(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>this._countOneBits(r)),n.typeInfo);const s=n;return new z(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let e=0;for(;!(1&t);)t>>=1,e++;return e}CountTrailingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>this._countTrailingZeros(r)),n.typeInfo);const s=n;return new z(this._countTrailingZeros(s.value),n.typeInfo)}Cross(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O){if(n.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const r=n.data,o=s.data;return new O([r[1]*o[2]-o[1]*r[2],r[2]*o[0]-o[2]*r[0],r[0]*o[1]-o[0]*r[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,e){const n=this.exec.evalExpression(t.args[0],e),s=180/Math.PI;return n instanceof O?new O(n.data.map(r=>r*s),n.typeInfo):new z(n.value*s,this.getTypeInfo("f32"))}Determinant(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof At){const s=n.data,r=n.typeInfo.getTypeName(),o=r.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h")return new z(s[0]*s[3]-s[1]*s[2],o);if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h")return new z(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);if(r==="mat2x4"||r==="mat2x4f"||r==="mat2x4h")console.error(`TODO: Determinant for ${r}`);else if(r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h")console.error(`TODO: Determinant for ${r}`);else{if(r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h")return new z(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);r==="mat3x4"||r==="mat3x4f"||r==="mat3x4h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h"?console.error(`TODO: Determinant for ${r}`):r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h"||console.error(`TODO: Determinant for ${r}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O){let l=0;for(let u=0;u<n.data.length;++u)l+=(n.data[u]-s.data[u])*(n.data[u]-s.data[u]);return new z(Math.sqrt(l),this.getTypeInfo("f32"))}const r=n,o=s;return new z(Math.abs(r.value-o.value),n.typeInfo)}_dot(t,e){let n=0;for(let s=0;s<t.length;++s)n+=e[s]*t[s];return n}Dot(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);return n instanceof O&&s instanceof O?new z(this._dot(n.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,e){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,e){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.exp(r)),n.typeInfo);const s=n;return new z(Math.exp(s.value),n.typeInfo)}Exp2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.pow(2,r)),n.typeInfo);const s=n;return new z(Math.pow(2,s.value),n.typeInfo)}ExtractBits(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const o=s.value,l=r.value;if(n instanceof O)return new O(n.data.map(f=>f>>o&(1<<l)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const u=n.value;return new z(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(n instanceof O&&s instanceof O&&r instanceof O){const o=this._dot(s.data,r.data);return new O(o<0?Array.from(n.data):n.data.map(l=>-l),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>this._firstLeadingBit(r)),n.typeInfo);const s=n;return new z(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>this._firstTrailingBit(r)),n.typeInfo);const s=n;return new z(this._firstTrailingBit(s.value),n.typeInfo)}Floor(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.floor(r)),n.typeInfo);const s=n;return new z(Math.floor(s.value),n.typeInfo)}Fma(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(n instanceof O&&s instanceof O&&r instanceof O)return n.data.length!==s.data.length||n.data.length!==r.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new O(n.data.map((f,g)=>f*s.data[g]+r.data[g]),n.typeInfo);const o=n,l=s,u=r;return new z(o.value*l.value+u.value,o.typeInfo)}Fract(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>r-Math.floor(r)),n.typeInfo);const s=n;return new z(s.value-Math.floor(s.value),n.typeInfo)}Frexp(t,e){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e),o=this.exec.evalExpression(t.args[3],e);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const l=r.value,u=(1<<o.value)-1<<l,f=~u;if(n instanceof O&&s instanceof O)return new O(n.data.map((_,v)=>_&f|s.data[v]<<l&u),n.typeInfo);const g=n.value,p=s.value;return new z(g&f|p<<l&u,n.typeInfo)}InverseSqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>1/Math.sqrt(r)),n.typeInfo);const s=n;return new z(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(t,e){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O){let r=0;return n.data.forEach(o=>{r+=o*o}),new z(Math.sqrt(r),this.getTypeInfo("f32"))}const s=n;return new z(Math.abs(s.value),n.typeInfo)}Log(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.log(r)),n.typeInfo);const s=n;return new z(Math.log(s.value),n.typeInfo)}Log2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.log2(r)),n.typeInfo);const s=n;return new z(Math.log2(s.value),n.typeInfo)}Max(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O)return new O(n.data.map((l,u)=>Math.max(l,s.data[u])),n.typeInfo);const r=n,o=s;return new z(Math.max(r.value,o.value),n.typeInfo)}Min(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O)return new O(n.data.map((l,u)=>Math.min(l,s.data[u])),n.typeInfo);const r=n,o=s;return new z(Math.min(r.value,o.value),n.typeInfo)}Mix(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(n instanceof O&&s instanceof O&&r instanceof O)return new O(n.data.map((u,f)=>n.data[f]*(1-r.data[f])+s.data[f]*r.data[f]),n.typeInfo);const o=s,l=r;return new z(n.value*(1-l.value)+o.value*l.value,n.typeInfo)}Modf(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O)return new O(n.data.map((o,l)=>o%s.data[l]),n.typeInfo);const r=s;return new z(n.value%r.value,n.typeInfo)}Normalize(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O){const s=this.Length(t,e).value;return new O(n.data.map(r=>r/s),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O)return new O(n.data.map((l,u)=>Math.pow(l,s.data[u])),n.typeInfo);const r=n,o=s;return new z(Math.pow(r.value,o.value),n.typeInfo)}QuantizeToF16(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof O?new O(n.data.map(s=>s),n.typeInfo):new z(n.value,n.typeInfo)}Radians(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof O?new O(n.data.map(s=>s*Math.PI/180),n.typeInfo):new z(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,e){let n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(n instanceof O&&s instanceof O){const r=this._dot(n.data,s.data);return new O(n.data.map((o,l)=>o-2*r*s.data[l]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,e){let n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(n instanceof O&&s instanceof O&&r instanceof z){const o=this._dot(s.data,n.data);return new O(n.data.map((l,u)=>{const f=1-r.value*r.value*(1-o*o);if(f<0)return 0;const g=Math.sqrt(f);return r.value*l-(r.value*o+g)*s.data[u]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,e){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.round(r)),n.typeInfo);const s=n;return new z(Math.round(s.value),n.typeInfo)}Saturate(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.min(Math.max(r,0),1)),n.typeInfo);const s=n;return new z(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.sign(r)),n.typeInfo);const s=n;return new z(Math.sign(s.value),n.typeInfo)}Sin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.sin(r)),n.typeInfo);const s=n;return new z(Math.sin(s.value),n.typeInfo)}Sinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.sinh(r)),n.typeInfo);const s=n;return new z(Math.sinh(s.value),n.typeInfo)}_smoothstep(t,e,n){const s=Math.min(Math.max((n-t)/(e-t),0),1);return s*s*(3-2*s)}SmoothStep(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(r instanceof O&&n instanceof O&&s instanceof O)return new O(r.data.map((f,g)=>this._smoothstep(n.data[g],s.data[g],f)),r.typeInfo);const o=n,l=s,u=r;return new z(this._smoothstep(o.value,l.value,u.value),r.typeInfo)}Sqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.sqrt(r)),n.typeInfo);const s=n;return new z(Math.sqrt(s.value),n.typeInfo)}Step(t,e){const n=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(s instanceof O&&n instanceof O)return new O(s.data.map((o,l)=>o<n.data[l]?0:1),s.typeInfo);const r=n;return new z(s.value<r.value?0:1,r.typeInfo)}Tan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.tan(r)),n.typeInfo);const s=n;return new z(Math.tan(s.value),n.typeInfo)}Tanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.tanh(r)),n.typeInfo);const s=n;return new z(Math.tanh(s.value),n.typeInfo)}_getTransposeType(t){const e=t.getTypeName();return e==="mat2x2f"||e==="mat2x2h"?t:e==="mat2x3f"?this.getTypeInfo("mat3x2f"):e==="mat2x3h"?this.getTypeInfo("mat3x2h"):e==="mat2x4f"?this.getTypeInfo("mat4x2f"):e==="mat2x4h"?this.getTypeInfo("mat4x2h"):e==="mat3x2f"?this.getTypeInfo("mat2x3f"):e==="mat3x2h"?this.getTypeInfo("mat2x3h"):e==="mat3x3f"||e==="mat3x3h"?t:e==="mat3x4f"?this.getTypeInfo("mat4x3f"):e==="mat3x4h"?this.getTypeInfo("mat4x3h"):e==="mat4x2f"?this.getTypeInfo("mat2x4f"):e==="mat4x2h"?this.getTypeInfo("mat2x4h"):e==="mat4x3f"?this.getTypeInfo("mat3x4f"):e==="mat4x3h"?this.getTypeInfo("mat3x4h"):(e==="mat4x4f"||e==="mat4x4h"||console.error(`Invalid matrix type ${e}`),t)}Transpose(t,e){const n=this.exec.evalExpression(t.args[0],e);if(!(n instanceof At))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const s=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const r=n.data;return new At([r[0],r[2],r[1],r[3]],s)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const r=n.data;return new At([r[0],r[3],r[6],r[1],r[4],r[7]],s)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const r=n.data;return new At([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13]],s)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const r=n.data;return new At([r[0],r[3],r[1],r[4],r[2],r[5]],s)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const r=n.data;return new At([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]],s)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const r=n.data;return new At([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14]],s)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const r=n.data;return new At([r[0],r[4],r[1],r[5],r[2],r[6]],s)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const r=n.data;return new At([r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]],s)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const r=n.data;return new At([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]],s)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof O)return new O(n.data.map(r=>Math.trunc(r)),n.typeInfo);const s=n;return new z(Math.trunc(s.value),n.typeInfo)}Dpdx(t,e){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,e){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,e){return console.error("TODO: dpdxFine"),null}Dpdy(t,e){return console.error("TODO: dpdy"),null}DpdyCoarse(t,e){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,e){return console.error("TODO: dpdyFine"),null}Fwidth(t,e){return console.error("TODO: fwidth"),null}FwidthCoarse(t,e){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,e){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,e){const n=t.args[0],s=t.args.length>1?this.exec.evalExpression(t.args[1],e).value:0;if(n instanceof Ci){const r=n.name,o=e.getVariableValue(r);if(o instanceof Kn){if(s<0||s>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const l=o.getMipLevelSize(s),u=o.dimension;return u==="1d"?new z(l[0],this.getTypeInfo("u32")):u==="3d"?new O(l,this.getTypeInfo("vec3u")):u==="2d"?new O(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${t.line}`),null)}return console.error(`Texture ${r} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,e){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,e){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,e){const n=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length>2?this.exec.evalExpression(t.args[2],e).value:0;if(!(s instanceof O)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof Ci){const o=n.name,l=e.getVariableValue(o);if(l instanceof Kn){const u=Math.floor(s.data[0]),f=Math.floor(s.data[1]);if(u<0||u>=l.width||f<0||f>=l.height)return console.error(`Texture ${o} out of bounds. Line ${t.line}`),null;const g=l.getPixel(u,f,0,r);return g===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new O(g,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,e){const n=t.args[0];if(n instanceof Ci){const s=n.name,r=e.getVariableValue(s);return r instanceof Kn?new z(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,e){const n=t.args[0];if(n instanceof Ci){const s=n.name,r=e.getVariableValue(s);return r instanceof Kn?new z(r.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,e){const n=t.args[0];if(n instanceof Ci){const s=n.name,r=e.getVariableValue(s);return r instanceof Kn?new z(r.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,e){return console.error("TODO: textureSample"),null}TextureSampleBias(t,e){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,e){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,e){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,e){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,e){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,e){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,e){const n=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length===4?this.exec.evalExpression(t.args[2],e).value:0,o=t.args.length===4?this.exec.evalExpression(t.args[3],e).data:this.exec.evalExpression(t.args[2],e).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(s instanceof O)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof Ci){const l=n.name,u=e.getVariableValue(l);if(u instanceof Kn){const f=u.getMipLevelSize(0),g=Math.floor(s.data[0]),p=Math.floor(s.data[1]);return g<0||g>=f[0]||p<0||p>=f[1]?(console.error(`Texture ${l} out of bounds. Line ${t.line}`),null):(u.setPixel(g,p,0,r,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e);return e.getVariable(s).value.getSubData(this.exec,n.postfix,e)}AtomicStore(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e);return u instanceof z&&l instanceof z&&(u.value=l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),null}AtomicAdd(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value+=l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicSub(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value-=l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicMax(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=Math.max(u.value,l.value)),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicMin(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=Math.min(u.value,l.value)),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicAnd(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=u.value&l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicOr(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=u.value|l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicXor(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=u.value^l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicExchange(t,e){let n=t.args[0];n instanceof Ce&&(n=n.right);const s=this.exec.getVariableName(n,e),r=e.getVariable(s);let o=t.args[1];const l=this.exec.evalExpression(o,e),u=r.value.getSubData(this.exec,n.postfix,e),f=new z(u.value,u.typeInfo);return u instanceof z&&l instanceof z&&(u.value=l.value),r.value instanceof me&&r.value.setDataValue(this.exec,u,n.postfix,e),f}AtomicCompareExchangeWeak(t,e){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,e){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,e){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,e){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,e){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,e){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,e){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,e){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,e){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,e){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,e){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,e){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,e){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,e){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,e){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,e){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,e){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,e){return null}TextureBarrier(t,e){return null}WorkgroupBarrier(t,e){return null}WorkgroupUniformLoad(t,e){return null}SubgroupAdd(t,e){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,e){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,e){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,e){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,e){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,e){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,e){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,e){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,e){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,e){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,e){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,e){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,e){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,e){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,e){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,e){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,e){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,e){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,e){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,e){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,e){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,e){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,e){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,e){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,e){return console.error("TODO: quadSwapY"),null}}const Pp={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ti={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ye extends aI{constructor(t,e){var n;super(),this.ast=t??[],this.reflection=new xn,this.reflection.updateAST(this.ast),this.context=(n=e?.clone())!==null&&n!==void 0?n:new q_,this.builtins=new oI(this),this.typeInfo={bool:this.getTypeInfo(st.bool),i32:this.getTypeInfo(st.i32),u32:this.getTypeInfo(st.u32),f32:this.getTypeInfo(st.f32),f16:this.getTypeInfo(st.f16),vec2f:this.getTypeInfo($.vec2f),vec2u:this.getTypeInfo($.vec2u),vec2i:this.getTypeInfo($.vec2i),vec2h:this.getTypeInfo($.vec2h),vec3f:this.getTypeInfo($.vec3f),vec3u:this.getTypeInfo($.vec3u),vec3i:this.getTypeInfo($.vec3i),vec3h:this.getTypeInfo($.vec3h),vec4f:this.getTypeInfo($.vec4f),vec4u:this.getTypeInfo($.vec4u),vec4i:this.getTypeInfo($.vec4i),vec4h:this.getTypeInfo($.vec4h),mat2x2f:this.getTypeInfo($.mat2x2f),mat2x3f:this.getTypeInfo($.mat2x3f),mat2x4f:this.getTypeInfo($.mat2x4f),mat3x2f:this.getTypeInfo($.mat3x2f),mat3x3f:this.getTypeInfo($.mat3x3f),mat3x4f:this.getTypeInfo($.mat3x4f),mat4x2f:this.getTypeInfo($.mat4x2f),mat4x3f:this.getTypeInfo($.mat4x3f),mat4x4f:this.getTypeInfo($.mat4x4f)}}getVariableValue(t){var e,n;const s=(n=(e=this.context.getVariable(t))===null||e===void 0?void 0:e.value)!==null&&n!==void 0?n:null;if(s===null)return null;if(s instanceof z)return s.value;if(s instanceof O||s instanceof At)return Array.from(s.data);if(s instanceof me&&s.typeInfo instanceof $s){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,e,n,s){const r=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,r),this._execStatements(this.ast,r);const o=r.getFunction(t);if(!o)return void console.error(`Function ${t} not found`);if(typeof e=="number")e=[e,1,1];else{if(e.length===0)return void console.error("Invalid dispatch count");e.length===1?e=[e[0],1,1]:e.length===2?e=[e[0],e[1],1]:e.length>3&&(e=[e[0],e[1],e[2]])}const l=e[0],u=e[1],f=e[2],g=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new O(e,g));const p=this.reflection.getFunctionInfo(t);p===null&&console.error(`Function ${t} not found in reflection data`);for(const _ in n)for(const v in n[_]){const b=n[_][v];r.variables.forEach(x=>{var T;const w=x.node;if(w?.attributes){let M=null,E=null;for(const P of w.attributes)P.name==="binding"?M=P.value:P.name==="group"&&(E=P.value);if(v==M&&_==E){let P=!1;for(const k of p.resources)if(k.name===x.name&&k.group===parseInt(_)&&k.binding===parseInt(v)){P=!0;break}if(P)if(b.texture!==void 0&&b.descriptor!==void 0){const k=new Kn(b.texture,this.getTypeInfo(w.type),b.descriptor,(T=b.texture.view)!==null&&T!==void 0?T:null);x.value=k}else b.uniform!==void 0?x.value=new me(b.uniform,this.getTypeInfo(w.type)):x.value=new me(b,this.getTypeInfo(w.type))}}})}for(let _=0;_<f;++_)for(let v=0;v<u;++v)for(let b=0;b<l;++b)r.setVariable("@workgroup_id",new O([b,v,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[b,v,_],r)}execStatement(t,e){if(t instanceof ew)return this.evalExpression(t.value,e);if(t instanceof nw){if(t.condition){const n=this.evalExpression(t.condition,e);if(!(n instanceof z))throw new Error("Invalid break-if condition");if(!n.value)return null}return Ye._breakObj}if(t instanceof sw)return Ye._continueObj;if(t instanceof kl)this._let(t,e);else if(t instanceof Zn)this._var(t,e);else if(t instanceof Nh)this._const(t,e);else if(t instanceof Jl)this._function(t,e);else{if(t instanceof tw)return this._if(t,e);if(t instanceof JT)return this._switch(t,e);if(t instanceof YT)return this._for(t,e);if(t instanceof XT)return this._while(t,e);if(t instanceof QT)return this._loop(t,e);if(t instanceof C0){const n=e.clone();return n.currentFunctionName=e.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof ZT)this._assign(t,e);else if(t instanceof KT)this._increment(t,e);else{if(t instanceof Yn)return null;if(t instanceof z_){const n=t.name;e.getVariable(n)===null&&e.setVariable(n,new z(0,this.getTypeInfo("u32")))}else if(t instanceof V_)this._call(t,e);else{if(t instanceof iw||t instanceof j_)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,e){return t instanceof Zi?this._evalBinaryOp(t,e):t instanceof Oe?this._evalLiteral(t,e):t instanceof Ci?this._evalVariable(t,e):t instanceof H_?this._evalCall(t,e):t instanceof yn?this._evalCreate(t,e):t instanceof rw?this._evalConst(t,e):t instanceof aw?this._evalBitcast(t,e):t instanceof Ce?this._evalUnaryOp(t,e):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var e;if(t instanceof st){const s=this.reflection.getTypeInfo(t);if(s!==null)return s}let n=(e=this.typeInfo[t])!==null&&e!==void 0?e:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,e){for(const n in t){const s=t[n],r=this.reflection.getOverrideInfo(n);r!==null?(r.type===null&&(r.type=this.getTypeInfo("u32")),r.type.name==="u32"||r.type.name==="i32"||r.type.name==="f32"||r.type.name==="f16"?e.setVariable(n,new z(s,r.type)):r.type.name==="bool"?e.setVariable(n,new z(s?1:0,r.type)):r.type.name==="vec2"||r.type.name==="vec3"||r.type.name==="vec4"||r.type.name==="vec2f"||r.type.name==="vec3f"||r.type.name==="vec4f"||r.type.name==="vec2i"||r.type.name==="vec3i"||r.type.name==="vec4i"||r.type.name==="vec2u"||r.type.name==="vec3u"||r.type.name==="vec4u"||r.type.name==="vec2h"||r.type.name==="vec3h"||r.type.name==="vec4h"?e.setVariable(n,new O(s,r.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,e,n){const s=[1,1,1];for(const g of t.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const p=n.getVariableValue(g.value[0]);s[0]=p instanceof z?p.value:parseInt(g.value[0])}if(g.value.length>1){const p=n.getVariableValue(g.value[1]);s[1]=p instanceof z?p.value:parseInt(g.value[1])}if(g.value.length>2){const p=n.getVariableValue(g.value[2]);s[2]=p instanceof z?p.value:parseInt(g.value[2])}}const r=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new O(s,r));const l=s[0],u=s[1],f=s[2];for(let g=0,p=0;g<f;++g)for(let _=0;_<u;++_)for(let v=0;v<l;++v,++p){const b=[v,_,g],x=[v+e[0]*s[0],_+e[1]*s[1],g+e[2]*s[2]];n.setVariable("@local_invocation_id",new O(b,r)),n.setVariable("@global_invocation_id",new O(x,r)),n.setVariable("@local_invocation_index",new z(p,o)),this._dispatchExec(t,n)}}_dispatchExec(t,e){for(const n of t.node.args)for(const s of n.attributes)if(s.name==="builtin"){const r=`@${s.value}`,o=e.getVariable(r);o!==void 0&&e.variables.set(n.name,o)}this._execStatements(t.node.body,e)}getVariableName(t,e){for(;t instanceof Ce;)t=t.right;return t instanceof Ci?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,e){for(const n of t){if(n instanceof Array){const r=e.clone(),o=this._execStatements(n,r);if(o)return o;continue}const s=this.execStatement(n,e);if(s)return s}return null}_call(t,e){const n=e.clone();n.currentFunctionName=t.name;const s=e.getFunction(t.name);if(s){for(let r=0;r<s.node.args.length;++r){const o=s.node.args[r],l=this.evalExpression(t.args[r],n);n.setVariable(o.name,l,o)}this._execStatements(s.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,e)}_increment(t,e){const n=this.getVariableName(t.variable,e),s=e.getVariable(n);s?t.operator==="++"?s.value instanceof z?s.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?s.value instanceof z?s.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,e){if(t instanceof Ci){const n=this.getVariableName(t,e),s=e.getVariable(n);return s===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):s.value.getSubData(this,t.postfix,e)}if(t instanceof Ce){if(t.operator==="*"){const n=this._getVariableData(t.right,e);return n instanceof Ia?n.reference.getSubData(this,t.postfix,e):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const n=this._getVariableData(t.right,e);return new Ia(n)}}return null}_assign(t,e){let n=null,s="<var>",r=null;if(t.variable instanceof Ce){const u=this._getVariableData(t.variable,e),f=this.evalExpression(t.value,e),g=t.operator;if(g==="="){if(u instanceof z||u instanceof O||u instanceof At){if(f instanceof z||f instanceof O||f instanceof At&&u.data.length===f.data.length)return void u.data.set(f.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(u instanceof me&&f instanceof me&&u.buffer.byteLength-u.offset>=f.buffer.byteLength-f.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(f.buffer,f.offset,f.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(g==="+=")return u instanceof z||u instanceof O||u instanceof At?f instanceof z||f instanceof O||f instanceof At?void u.data.set(f.data.map((p,_)=>u.data[_]+p)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(g==="-=")return(u instanceof z||u instanceof O||u instanceof At)&&(f instanceof z||f instanceof O||f instanceof At)?void u.data.set(f.data.map((p,_)=>u.data[_]-p)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof Ce){if(t.variable.operator==="*"){s=this.getVariableName(t.variable.right,e);const u=e.getVariable(s);if(!(u&&u.value instanceof Ia))return void console.error(`Variable ${s} is not a pointer. Line ${t.line}`);n=u.value.reference;let f=t.variable.postfix;if(!f){let g=t.variable.right;for(;g instanceof Ce;){if(g.postfix){f=g.postfix;break}g=g.right}}f&&(n=n.getSubData(this,f,e))}}else{r=t.variable.postfix,s=this.getVariableName(t.variable,e);const u=e.getVariable(s);if(u===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);n=u.value}if(n instanceof Ia&&(n=n.reference),n===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);const o=this.evalExpression(t.value,e),l=t.operator;if(l!=="="){const u=n.getSubData(this,r,e);if(u instanceof O&&o instanceof z){const f=u.data,g=o.value;if(l==="+=")for(let p=0;p<f.length;++p)f[p]+=g;else if(l==="-=")for(let p=0;p<f.length;++p)f[p]-=g;else if(l==="*=")for(let p=0;p<f.length;++p)f[p]*=g;else if(l==="/=")for(let p=0;p<f.length;++p)f[p]/=g;else if(l==="%=")for(let p=0;p<f.length;++p)f[p]%=g;else if(l==="&=")for(let p=0;p<f.length;++p)f[p]&=g;else if(l==="|=")for(let p=0;p<f.length;++p)f[p]|=g;else if(l==="^=")for(let p=0;p<f.length;++p)f[p]^=g;else if(l==="<<=")for(let p=0;p<f.length;++p)f[p]<<=g;else if(l===">>=")for(let p=0;p<f.length;++p)f[p]>>=g;else console.error(`Invalid operator ${l}. Line ${t.line}`)}else if(u instanceof O&&o instanceof O){const f=u.data,g=o.data;if(f.length!==g.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(l==="+=")for(let p=0;p<f.length;++p)f[p]+=g[p];else if(l==="-=")for(let p=0;p<f.length;++p)f[p]-=g[p];else if(l==="*=")for(let p=0;p<f.length;++p)f[p]*=g[p];else if(l==="/=")for(let p=0;p<f.length;++p)f[p]/=g[p];else if(l==="%=")for(let p=0;p<f.length;++p)f[p]%=g[p];else if(l==="&=")for(let p=0;p<f.length;++p)f[p]&=g[p];else if(l==="|=")for(let p=0;p<f.length;++p)f[p]|=g[p];else if(l==="^=")for(let p=0;p<f.length;++p)f[p]^=g[p];else if(l==="<<=")for(let p=0;p<f.length;++p)f[p]<<=g[p];else if(l===">>=")for(let p=0;p<f.length;++p)f[p]>>=g[p];else console.error(`Invalid operator ${l}. Line ${t.line}`)}else{if(!(u instanceof z&&o instanceof z))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${t.line}`)}return void(n instanceof me&&n.setDataValue(this,u,r,e))}if(n instanceof me)n.setDataValue(this,o,r,e);else if(r){if(!(n instanceof O||n instanceof At))return void console.error(`Variable ${s} is not a vector or matrix. Line ${t.line}`);if(r instanceof no){const u=this.evalExpression(r.index,e).value;if(n instanceof O){if(!(o instanceof z))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[u]=o.value}else{if(!(n instanceof At))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const f=this.evalExpression(r.index,e).value;if(f<0)return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(o instanceof O))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const g=n.typeInfo.getTypeName();if(g==="mat2x2"||g==="mat2x2f"||g==="mat2x2h"){if(!(f<2&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[2*f]=o.data[0],n.data[2*f+1]=o.data[1]}else if(g==="mat2x3"||g==="mat2x3f"||g==="mat2x3h"){if(!(f<2&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[3*f]=o.data[0],n.data[3*f+1]=o.data[1],n.data[3*f+2]=o.data[2]}else if(g==="mat2x4"||g==="mat2x4f"||g==="mat2x4h"){if(!(f<2&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[4*f]=o.data[0],n.data[4*f+1]=o.data[1],n.data[4*f+2]=o.data[2],n.data[4*f+3]=o.data[3]}else if(g==="mat3x2"||g==="mat3x2f"||g==="mat3x2h"){if(!(f<3&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[2*f]=o.data[0],n.data[2*f+1]=o.data[1]}else if(g==="mat3x3"||g==="mat3x3f"||g==="mat3x3h"){if(!(f<3&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[3*f]=o.data[0],n.data[3*f+1]=o.data[1],n.data[3*f+2]=o.data[2]}else if(g==="mat3x4"||g==="mat3x4f"||g==="mat3x4h"){if(!(f<3&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[4*f]=o.data[0],n.data[4*f+1]=o.data[1],n.data[4*f+2]=o.data[2],n.data[4*f+3]=o.data[3]}else if(g==="mat4x2"||g==="mat4x2f"||g==="mat4x2h"){if(!(f<4&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[2*f]=o.data[0],n.data[2*f+1]=o.data[1]}else if(g==="mat4x3"||g==="mat4x3f"||g==="mat4x3h"){if(!(f<4&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[3*f]=o.data[0],n.data[3*f+1]=o.data[1],n.data[3*f+2]=o.data[2]}else{if(g!=="mat4x4"&&g!=="mat4x4f"&&g!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(f<4&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);n.data[4*f]=o.data[0],n.data[4*f+1]=o.data[1],n.data[4*f+2]=o.data[2],n.data[4*f+3]=o.data[3]}}}}}else if(r instanceof Dr){const u=r.value;if(!(n instanceof O))return void console.error(`Invalid assignment to ${u}. Variable ${s} is not a vector. Line ${t.line}`);if(o instanceof z){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${t.line}`);if(u==="x")n.data[0]=o.value;else if(u==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${t.line}`);n.data[1]=o.value}else if(u==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${t.line}`);n.data[2]=o.value}else if(u==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${t.line}`);n.data[3]=o.value}}else{if(!(o instanceof O))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${t.line}`);for(let f=0;f<u.length;++f){const g=u[f];if(g==="x"||g==="r")n.data[0]=o.data[f];else if(g==="y"||g==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${t.line}`);n.data[1]=o.data[f]}else if(g==="z"||g==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${t.line}`);n.data[2]=o.data[f]}else{if(g!=="w"&&g!=="a")return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${t.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${t.line}`);n.data[3]=o.data[f]}}}}}else n instanceof z&&o instanceof z?n.value=o.value:n instanceof O&&o instanceof O||n instanceof At&&o instanceof At?n.data.set(o.data):console.error(`Invalid assignment to ${s}. Line ${t.line}`)}_function(t,e){const n=new W_(t);e.functions.set(t.name,n)}_const(t,e){let n=null;t.value!==null&&(n=this.evalExpression(t.value,e)),e.createVariable(t.name,n,t)}_let(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ce||(n=n.clone())}else{const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const r=new yn(t.type,[]);n=this._evalCreate(r,e)}}e.createVariable(t.name,n,t)}_var(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ce||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||t.type instanceof Bl||t.type instanceof Yn||t.type instanceof $){const r=new yn(t.type,[]);n=this._evalCreate(r,e)}}e.createVariable(t.name,n,t)}_switch(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof z))return console.error(`Invalid if condition. Line ${t.line}`),null;let s=null;for(const r of t.cases)if(r instanceof cw)for(const o of r.selectors){if(o instanceof Lh){s=r;continue}const l=this.evalExpression(o,e);if(!(l instanceof z))return console.error(`Invalid case selector. Line ${t.line}`),null;if(l.value===n.value)return this._execStatements(r.body,e)}else r instanceof uw&&(s=r);return s?this._execStatements(s.body,e):null}_if(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof z))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,e);for(const s of t.elseif){const r=this.evalExpression(s.condition,e);if(!(r instanceof z))return console.error(`Invalid if condition. Line ${t.line}`),null;if(r.value)return this._execStatements(s.body,e)}return t.else?this._execStatements(t.else,e):null}_getScalarValue(t){return t instanceof z?t.value:(console.error("Expected scalar value.",t),0)}_for(t,e){for(e=e.clone(),this.execStatement(t.init,e);this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===Ye._breakObj)break;if(n!==null&&n!==Ye._continueObj)return n;this.execStatement(t.increment,e)}return null}_loop(t,e){for(e=e.clone();;){const n=this._execStatements(t.body,e);if(n===Ye._breakObj)break;if(n===Ye._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,e)===Ye._breakObj)break}else if(n!==null)return n}return null}_while(t,e){for(e=e.clone();this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===Ye._breakObj)break;if(n!==Ye._continueObj&&n!==null)return n}return null}_evalBitcast(t,e){const n=this.evalExpression(t.value,e),s=t.type;if(n instanceof z){const r=Kb(n.value,n.typeInfo.name,s.name);return new z(r,this.getTypeInfo(s))}if(n instanceof O){const r=n.typeInfo.getTypeName();let o="";if(r.endsWith("f"))o="f32";else if(r.endsWith("i"))o="i32";else if(r.endsWith("u"))o="u32";else if(r.endsWith("b"))o="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${r}. Line ${t.line}`),null;o="f16"}const l=s.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${t.line}`),null;u="f16"}const f=(function(g,p,_){if(p===_)return g;const v=new Array(g.length);for(let b=0;b<g.length;b++)v[b]=Kb(g[b],p,_);return v})(Array.from(n.data),o,u);return new O(f,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,e){return e.getVariableValue(t.name).clone().getSubData(this,t.postfix,e)}_evalCreate(t,e){var n;if(t instanceof yn){if(t.type===null)return R0.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,e);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,e);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,e)}}const s=t instanceof yn?t.type.name:t.name,r=t instanceof yn?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(r===null)return console.error(`Unknown type ${s}. Line ${t.line}`),null;if(r.size===0)return null;const o=new me(new ArrayBuffer(r.size),r,0);if(r instanceof zs){if(t.args)for(let l=0;l<t.args.length;++l){const u=r.members[l],f=t.args[l],g=this.evalExpression(f,e);o.setData(this,g,u.type,u.offset,e)}}else if(r instanceof $s){let l=0;if(t.args)for(let u=0;u<t.args.length;++u){const f=t.args[u],g=this.evalExpression(f,e);r.format===null&&(((n=g.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?r.format=this.getTypeInfo("i32"):r.format=g.typeInfo),o.setData(this,g,r.format,l,e),l+=r.stride}}else console.error(`Unknown type "${s}". Line ${t.line}`);return t instanceof yn?o.getSubData(this,t.postfix,e):o}_evalLiteral(t,e){const n=this.getTypeInfo(t.type),s=n.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new z(t.scalarValue,n):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(t,e):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(t,e):t.value}_evalVariable(t,e){const n=e.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,e)}_maxFormatTypeInfo(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const s=Ye._priority.get(e.name);Ye._priority.get(t[n].name)<s&&(e=t[n])}return e.name==="x32"?this.getTypeInfo("i32"):e}_evalUnaryOp(t,e){const n=this.evalExpression(t.right,e);if(t.operator==="&")return new Ia(n);if(t.operator==="*")return n instanceof Ia?n.reference.getSubData(this,t.postfix,e):(console.error(`Invalid dereference. Line ${t.line}`),null);const s=n instanceof z?n.value:n instanceof O?Array.from(n.data):null;switch(t.operator){case"+":{if(dt(s)){const l=s.map((u,f)=>+u);return new O(l,n.typeInfo)}const r=s,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new z(+r,o)}case"-":{if(dt(s)){const l=s.map((u,f)=>-u);return new O(l,n.typeInfo)}const r=s,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new z(-r,o)}case"!":{if(dt(s)){const l=s.map((u,f)=>u?0:1);return new O(l,n.typeInfo)}const r=s,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new z(r?0:1,o)}case"~":{if(dt(s)){const l=s.map((u,f)=>~u);return new O(l,n.typeInfo)}const r=s,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new z(~r,o)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,e){const n=this.evalExpression(t.left,e),s=this.evalExpression(t.right,e),r=n instanceof z?n.value:n instanceof O||n instanceof At?Array.from(n.data):null,o=s instanceof z?s.value:s instanceof O||s instanceof At?Array.from(s.data):null;switch(t.operator){case"+":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v+p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_+g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g+_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l+u,f)}case"-":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v-p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_-g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g-_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l-u,f)}case"*":{if(dt(r)&&dt(o)){const g=r,p=o;if(n instanceof At&&s instanceof At){const _=(function(T,w,M,E){if(ti[w.name]===void 0||ti[E.name]===void 0)return null;const P=ti[w.name][0],k=ti[w.name][1],U=ti[E.name][0];if(P!==ti[E.name][1])return null;const Y=new Array(U*k);for(let et=0;et<k;et++)for(let K=0;K<U;K++){let ut=0;for(let ht=0;ht<P;ht++)ut+=T[ht*k+et]*M[K*P+ht];Y[et*U+K]=ut}return Y})(g,n.typeInfo,p,s.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const v=ti[s.typeInfo.name][0],b=ti[n.typeInfo.name][1],x=this.getTypeInfo(`mat${v}x${b}f`);return new At(_,x)}if(n instanceof At&&s instanceof O){const _=(function(v,b,x,T){if(ti[b.name]===void 0||Pp[T.name]===void 0)return null;const w=ti[b.name][0],M=ti[b.name][1];if(w!==x.length)return null;const E=new Array(M);for(let P=0;P<M;P++){let k=0;for(let U=0;U<w;U++)k+=v[U*M+P]*x[U];E[P]=k}return E})(g,n.typeInfo,p,s.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new O(_,s.typeInfo)}if(n instanceof O&&s instanceof At){const _=(function(v,b,x,T){if(Pp[b.name]===void 0||ti[T.name]===void 0)return null;const w=ti[T.name][0],M=ti[T.name][1];if(M!==v.length)return null;const E=[];for(let P=0;P<w;P++){let k=0;for(let U=0;U<M;U++)k+=v[U]*x[U*w+P];E[P]=k}return E})(g,n.typeInfo,p,s.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new O(_,n.typeInfo)}{if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v*p[b]);return new O(_,n.typeInfo)}}if(dt(r)){const g=o,p=r.map((_,v)=>_*g);return n instanceof At?new At(p,n.typeInfo):new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g*_);return s instanceof At?new At(p,s.typeInfo):new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l*u,f)}case"%":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v%p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_%g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g%_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l%u,f)}case"/":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v/p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_/g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g/_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l/u,f)}case"&":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v&p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_&g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g&_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l&u,f)}case"|":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v|p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_|g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g|_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l|u,f)}case"^":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v^p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_^g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g^_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l^u,f)}case"<<":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v<<p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_<<g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g<<_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l<<u,f)}case">>":{if(dt(r)&&dt(o)){const g=r,p=o;if(g.length!==p.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const _=g.map((v,b)=>v>>p[b]);return new O(_,n.typeInfo)}if(dt(r)){const g=o,p=r.map((_,v)=>_>>g);return new O(p,n.typeInfo)}if(dt(o)){const g=r,p=o.map((_,v)=>g>>_);return new O(p,s.typeInfo)}const l=r,u=o,f=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new z(l>>u,f)}case">":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g>u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f>l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l>f?1:0);return new O(u,s.typeInfo)}return new z(r>o?1:0,this.getTypeInfo("bool"));case"<":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g<u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f<l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l<f?1:0);return new O(u,s.typeInfo)}return new z(r<o?1:0,this.getTypeInfo("bool"));case"==":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g===u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f==l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l==f?1:0);return new O(u,s.typeInfo)}return new z(r===o?1:0,this.getTypeInfo("bool"));case"!=":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g!==u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f!==l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l!==f?1:0);return new O(u,s.typeInfo)}return new z(r!==o?1:0,this.getTypeInfo("bool"));case">=":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g>=u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f>=l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l>=f?1:0);return new O(u,s.typeInfo)}return new z(r>=o?1:0,this.getTypeInfo("bool"));case"<=":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g<=u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f<=l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l<=f?1:0);return new O(u,s.typeInfo)}return new z(r<=o?1:0,this.getTypeInfo("bool"));case"&&":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g&&u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f&&l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l&&f?1:0);return new O(u,s.typeInfo)}return new z(r&&o?1:0,this.getTypeInfo("bool"));case"||":if(dt(r)&&dt(o)){const l=r,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((g,p)=>g||u[p]?1:0);return new O(f,n.typeInfo)}if(dt(r)){const l=o,u=r.map((f,g)=>f||l?1:0);return new O(u,n.typeInfo)}if(dt(o)){const l=r,u=o.map((f,g)=>l||f?1:0);return new O(u,s.typeInfo)}return new z(r||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,e){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const n=e.clone();n.currentFunctionName=t.name;const s=e.getFunction(t.name);if(!s)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,e):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let r=0;r<s.node.args.length;++r){const o=s.node.args[r],l=this.evalExpression(t.args[r],n);n.createVariable(o.name,l,o)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(t,e){switch(t.name){case"all":return this.builtins.All(t,e);case"any":return this.builtins.Any(t,e);case"select":return this.builtins.Select(t,e);case"arrayLength":return this.builtins.ArrayLength(t,e);case"abs":return this.builtins.Abs(t,e);case"acos":return this.builtins.Acos(t,e);case"acosh":return this.builtins.Acosh(t,e);case"asin":return this.builtins.Asin(t,e);case"asinh":return this.builtins.Asinh(t,e);case"atan":return this.builtins.Atan(t,e);case"atanh":return this.builtins.Atanh(t,e);case"atan2":return this.builtins.Atan2(t,e);case"ceil":return this.builtins.Ceil(t,e);case"clamp":return this.builtins.Clamp(t,e);case"cos":return this.builtins.Cos(t,e);case"cosh":return this.builtins.Cosh(t,e);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,e);case"countOneBits":return this.builtins.CountOneBits(t,e);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,e);case"cross":return this.builtins.Cross(t,e);case"degrees":return this.builtins.Degrees(t,e);case"determinant":return this.builtins.Determinant(t,e);case"distance":return this.builtins.Distance(t,e);case"dot":return this.builtins.Dot(t,e);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,e);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,e);case"exp":return this.builtins.Exp(t,e);case"exp2":return this.builtins.Exp2(t,e);case"extractBits":return this.builtins.ExtractBits(t,e);case"faceForward":return this.builtins.FaceForward(t,e);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,e);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,e);case"floor":return this.builtins.Floor(t,e);case"fma":return this.builtins.Fma(t,e);case"fract":return this.builtins.Fract(t,e);case"frexp":return this.builtins.Frexp(t,e);case"insertBits":return this.builtins.InsertBits(t,e);case"inverseSqrt":return this.builtins.InverseSqrt(t,e);case"ldexp":return this.builtins.Ldexp(t,e);case"length":return this.builtins.Length(t,e);case"log":return this.builtins.Log(t,e);case"log2":return this.builtins.Log2(t,e);case"max":return this.builtins.Max(t,e);case"min":return this.builtins.Min(t,e);case"mix":return this.builtins.Mix(t,e);case"modf":return this.builtins.Modf(t,e);case"normalize":return this.builtins.Normalize(t,e);case"pow":return this.builtins.Pow(t,e);case"quantizeToF16":return this.builtins.QuantizeToF16(t,e);case"radians":return this.builtins.Radians(t,e);case"reflect":return this.builtins.Reflect(t,e);case"refract":return this.builtins.Refract(t,e);case"reverseBits":return this.builtins.ReverseBits(t,e);case"round":return this.builtins.Round(t,e);case"saturate":return this.builtins.Saturate(t,e);case"sign":return this.builtins.Sign(t,e);case"sin":return this.builtins.Sin(t,e);case"sinh":return this.builtins.Sinh(t,e);case"smoothstep":return this.builtins.SmoothStep(t,e);case"sqrt":return this.builtins.Sqrt(t,e);case"step":return this.builtins.Step(t,e);case"tan":return this.builtins.Tan(t,e);case"tanh":return this.builtins.Tanh(t,e);case"transpose":return this.builtins.Transpose(t,e);case"trunc":return this.builtins.Trunc(t,e);case"dpdx":return this.builtins.Dpdx(t,e);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,e);case"dpdxFine":return this.builtins.DpdxFine(t,e);case"dpdy":return this.builtins.Dpdy(t,e);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,e);case"dpdyFine":return this.builtins.DpdyFine(t,e);case"fwidth":return this.builtins.Fwidth(t,e);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,e);case"fwidthFine":return this.builtins.FwidthFine(t,e);case"textureDimensions":return this.builtins.TextureDimensions(t,e);case"textureGather":return this.builtins.TextureGather(t,e);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,e);case"textureLoad":return this.builtins.TextureLoad(t,e);case"textureNumLayers":return this.builtins.TextureNumLayers(t,e);case"textureNumLevels":return this.builtins.TextureNumLevels(t,e);case"textureNumSamples":return this.builtins.TextureNumSamples(t,e);case"textureSample":return this.builtins.TextureSample(t,e);case"textureSampleBias":return this.builtins.TextureSampleBias(t,e);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,e);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,e);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,e);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,e);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,e);case"textureStore":return this.builtins.TextureStore(t,e);case"atomicLoad":return this.builtins.AtomicLoad(t,e);case"atomicStore":return this.builtins.AtomicStore(t,e);case"atomicAdd":return this.builtins.AtomicAdd(t,e);case"atomicSub":return this.builtins.AtomicSub(t,e);case"atomicMax":return this.builtins.AtomicMax(t,e);case"atomicMin":return this.builtins.AtomicMin(t,e);case"atomicAnd":return this.builtins.AtomicAnd(t,e);case"atomicOr":return this.builtins.AtomicOr(t,e);case"atomicXor":return this.builtins.AtomicXor(t,e);case"atomicExchange":return this.builtins.AtomicExchange(t,e);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,e);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,e);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,e);case"pack4xI8":return this.builtins.Pack4xI8(t,e);case"pack4xU8":return this.builtins.Pack4xU8(t,e);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,e);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,e);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,e);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,e);case"pack2x16float":return this.builtins.Pack2x16float(t,e);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,e);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,e);case"unpack4xI8":return this.builtins.Unpack4xI8(t,e);case"unpack4xU8":return this.builtins.Unpack4xU8(t,e);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,e);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,e);case"unpack2x16float":return this.builtins.Unpack2x16float(t,e);case"storageBarrier":return this.builtins.StorageBarrier(t,e);case"textureBarrier":return this.builtins.TextureBarrier(t,e);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,e);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,e);case"subgroupAdd":return this.builtins.SubgroupAdd(t,e);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,e);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,e);case"subgroupAll":return this.builtins.SubgroupAll(t,e);case"subgroupAnd":return this.builtins.SubgroupAnd(t,e);case"subgroupAny":return this.builtins.SubgroupAny(t,e);case"subgroupBallot":return this.builtins.SubgroupBallot(t,e);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,e);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,e);case"subgroupElect":return this.builtins.SubgroupElect(t,e);case"subgroupMax":return this.builtins.SubgroupMax(t,e);case"subgroupMin":return this.builtins.SubgroupMin(t,e);case"subgroupMul":return this.builtins.SubgroupMul(t,e);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,e);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,e);case"subgroupOr":return this.builtins.SubgroupOr(t,e);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,e);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,e);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,e);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,e);case"subgroupXor":return this.builtins.SubgroupXor(t,e);case"quadBroadcast":return this.builtins.QuadBroadcast(t,e);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,e);case"quadSwapX":return this.builtins.QuadSwapX(t,e);case"quadSwapY":return this.builtins.QuadSwapY(t,e)}const n=e.getFunction(t.name);if(n){const s=e.clone();for(let r=0;r<n.node.args.length;++r){const o=n.node.args[r],l=this.evalExpression(t.args[r],s);s.setVariable(o.name,l,o)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(t,e){if(!t.args||t.args.length===0)return new z(0,this.getTypeInfo(t.type));const n=this.evalExpression(t.args[0],e);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,e).clone()}_callConstructorVec(t,e){const n=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=Pp[s];if(r===void 0)return console.error(`Invalid vec constructor ${s}. Line ${t.line}`),null;const o=[];if(t instanceof Oe)if(t.isVector){const l=t.vectorValue;for(const u of l)o.push(u)}else o.push(t.scalarValue);else if(t.args)for(const l of t.args){const u=this.evalExpression(l,e);if(u instanceof O){const f=u.data;for(let g=0;g<f.length;++g){let p=f[g];o.push(p)}}else if(u instanceof z){let f=u.value;o.push(f)}}if(t.type instanceof $&&t.type.format===null&&(t.type.format=$.f32),o.length===0){const l=new Array(r).fill(0);return new O(l,n).getSubData(this,t.postfix,e)}if(o.length===1)for(;o.length<r;)o.push(o[0]);return o.length<r?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new O(o.length>r?o.slice(0,r):o,n).getSubData(this,t.postfix,e)}_callConstructorMatrix(t,e){const n=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=ti[s];if(r===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${t.line}`),null;const o=[];if(t instanceof Oe)if(t.isVector){const l=t.vectorValue;for(const u of l)o.push(u)}else o.push(t.scalarValue);else if(t.args)for(const l of t.args){const u=this.evalExpression(l,e);u instanceof O?o.push(...u.data):u instanceof z?o.push(u.value):u instanceof At&&o.push(...u.data)}if(n instanceof Nr&&n.format===null&&(n.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(r[2]).fill(0);return new At(l,n).getSubData(this,t.postfix,e)}return o.length!==r[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new At(o,n).getSubData(this,t.postfix,e)}}Ye._breakObj=new Wi(new ji("BREAK",null),null),Ye._continueObj=new Wi(new ji("CONTINUE",null),null),Ye._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class lI{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class cI{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new lI,this._exec=new Ye,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;e.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const s=n.arrayType,r=n.countNode;if(r instanceof Ci){const o=r.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);s.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of e)n.search(s=>{s instanceof Xb||s instanceof Dh?s.type=this._forwardType(s.type):s instanceof Bl?s.format=this._forwardType(s.format):s instanceof Zn||s instanceof kl||s instanceof Nh?s.type=this._forwardType(s.type):s instanceof Jl?s.returnType=this._forwardType(s.returnType):s instanceof qb&&(s.type=this._forwardType(s.type))});return e}_forwardType(t){if(t instanceof Wb){const e=this._getType(t.name);if(e)return e}else t instanceof Dh?t.type=this._forwardType(t.type):t instanceof Bl&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const e=new Q5(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,e){return t.line=e??this._currentLine,t}_error(t,e){return{token:t,message:e,toString:()=>`${e}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==R.eof}_match(t){if(t instanceof j)return!!this._check(t)&&(this._advance(),!0);for(let e=0,n=t.length;e<n;++e){const s=t[e];if(this._check(s))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),`${e}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const n=e.type;let s=!1;for(const r of t){if(n===r)return!0;r===R.tokens.name&&(s=!0)}if(s){const r=R.tokens.name.rule.exec(e.lexeme);if(r&&r.index==0&&r[0]==e.lexeme)return!0}return!1}if(e.type===t)return!0;if(t===R.tokens.name){const n=R.tokens.name.rule.exec(e.lexeme);return n&&n.index==0&&n[0]==e.lexeme}return!1}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(R.tokens.semicolon)&&!this._isAtEnd(););if(this._match(R.keywords.alias)){const e=this._type_alias();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(R.keywords.diagnostic)){const e=this._diagnostic();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(R.keywords.requires)){const e=this._requires_directive();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(R.keywords.enable)){const e=this._enable_directive();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const t=this._attribute();if(this._check(R.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(R.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(R.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(R.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(R.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}if(this._check(R.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}return null}_function_decl(){if(!this._match(R.keywords.fn))return null;const t=this._currentLine,e=this._consume(R.tokens.ident,"Expected function name.").toString();this._consume(R.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(R.tokens.paren_right))do{if(this._check(R.tokens.paren_right))break;const l=this._attribute(),u=this._consume(R.tokens.name,"Expected argument name.").toString();this._consume(R.tokens.colon,"Expected ':' for argument type.");const f=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=f,n.push(this._updateNode(new qb(u,g,l))))}while(this._match(R.tokens.comma));this._consume(R.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(R.tokens.arrow)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}const r=this._compound_statement(),o=this._currentLine;return this._updateNode(new Jl(e,n,s,r,t,o),t)}_compound_statement(){const t=[];for(this._consume(R.tokens.brace_left,"Expected '{' for block.");!this._check(R.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(R.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(R.tokens.semicolon)&&!this._isAtEnd(););if(this._check(R.tokens.attr)&&this._attribute(),this._check(R.keywords.if))return this._if_statement();if(this._check(R.keywords.switch))return this._switch_statement();if(this._check(R.keywords.loop))return this._loop_statement();if(this._check(R.keywords.for))return this._for_statement();if(this._check(R.keywords.while))return this._while_statement();if(this._check(R.keywords.continuing))return this._continuing_statement();if(this._check(R.keywords.static_assert))return this._static_assert_statement();if(this._check(R.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(R.keywords.return))t=this._return_statement();else if(this._check([R.keywords.var,R.keywords.let,R.keywords.const]))t=this._variable_statement();else if(this._match(R.keywords.discard))t=this._updateNode(new Y5);else if(this._match(R.keywords.break)){const e=this._updateNode(new nw);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e,this._check(R.keywords.if)&&(this._advance(),e.condition=this._optional_paren_expression())}else if(this._match(R.keywords.continue)){const e=this._updateNode(new sw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${e.line}`);{const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(R.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(R.keywords.static_assert))return null;const t=this._currentLine,e=this._optional_paren_expression();return this._updateNode(new W5(e),t)}_while_statement(){if(!this._match(R.keywords.while))return null;const t=this._updateNode(new XT(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(R.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(R.keywords.continuing))return null;const e=this._currentLine,n=this._compound_statement();return this._updateNode(new C0(n,t),e)}_for_statement(){if(!this._match(R.keywords.for))return null;this._consume(R.tokens.paren_left,"Expected '('.");const t=this._updateNode(new YT(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(R.tokens.semicolon)?null:this._for_init(),this._consume(R.tokens.semicolon,"Expected ';'."),t.condition=this._check(R.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(R.tokens.semicolon,"Expected ';'."),t.increment=this._check(R.tokens.paren_right)?null:this._for_increment(),this._consume(R.tokens.paren_right,"Expected ')'."),this._check(R.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(R.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(R.tokens.equal)&&(e=this._short_circuit_or_expression()),this._updateNode(new Zn(t.name,t.type,t.storage,t.access,e),t.line)}if(this._match(R.keywords.let)){const t=this._currentLine,e=this._consume(R.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(R.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(R.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new kl(e,n,null,null,s),t)}if(this._match(R.keywords.const)){const t=this._currentLine,e=this._consume(R.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(R.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(R.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return n===null&&s instanceof Oe&&(n=s.type),this._updateNode(new Nh(e,n,null,null,s),t)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(R.increment_operators))return this._current=t,null;const n=this._consume(R.increment_operators,"Expected increment operator");return this._updateNode(new KT(n.type===R.tokens.plus_plus?Ba.increment:Ba.decrement,e))}_assignment_statement(){let t=null;const e=this._currentLine;if(this._check(R.tokens.brace_right))return null;let n=this._match(R.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;const s=this._consume(R.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new ZT(El.parse(s.lexeme),t,r),e)}_func_call_statement(){if(!this._check(R.tokens.ident))return null;const t=this._currentLine,e=this._current,n=this._consume(R.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=e,null):this._updateNode(new V_(n.lexeme,s),t)}_loop_statement(){if(!this._match(R.keywords.loop))return null;this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new QT([],null));this._currentLoop.push(t);let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let n of e)t.body.push(n);else t.body.push(e);if(e instanceof C0){t.continuing=e;break}e=this._statement()}return this._currentLoop.pop(),this._consume(R.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(R.keywords.switch))return null;const t=this._updateNode(new JT(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(R.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let e=!1;for(;this._check([R.keywords.default,R.keywords.case]);){if(this._match(R.keywords.case)){const n=this._case_selectors();for(const r of n)if(r instanceof Lh){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");e=!0;break}this._match(R.tokens.colon),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(R.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new cw(n,s)))}if(this._match(R.keywords.default)){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(R.tokens.colon),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(R.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new uw(n)))}}return t}_case_selectors(){const t=[];for(this._match(R.keywords.default)?t.push(this._updateNode(new Lh)):t.push(this._shift_expression());this._match(R.tokens.comma);)this._match(R.keywords.default)?t.push(this._updateNode(new Lh)):t.push(this._shift_expression());return t}_case_body(){if(this._match(R.keywords.fallthrough))return this._consume(R.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(R.keywords.if))return null;const t=this._currentLine,e=this._optional_paren_expression();this._check(R.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(R.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let r=null;return this._match(R.keywords.else)&&(this._check(R.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new tw(e,n,s,r),t)}_match_elseif(){return this._tokens[this._current].type===R.keywords.else&&this._tokens[this._current+1].type===R.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new K5(e,n))),this._match_elseif()&&(this._check(R.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(R.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new ew(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(R.tokens.or_or);)t=this._updateNode(new Zi(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(R.tokens.and_and);)t=this._updateNode(new Zi(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(R.tokens.or);)t=this._updateNode(new Zi(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(R.tokens.xor);)t=this._updateNode(new Zi(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(R.tokens.and);)t=this._updateNode(new Zi(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([R.tokens.equal_equal,R.tokens.not_equal])?this._updateNode(new Zi(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([R.tokens.less_than,R.tokens.greater_than,R.tokens.less_than_equal,R.tokens.greater_than_equal]);)t=this._updateNode(new Zi(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([R.tokens.shift_left,R.tokens.shift_right]);)t=this._updateNode(new Zi(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([R.tokens.plus,R.tokens.minus]);)t=this._updateNode(new Zi(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([R.tokens.star,R.tokens.forward_slash,R.tokens.modulo]);)t=this._updateNode(new Zi(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([R.tokens.minus,R.tokens.bang,R.tokens.tilde,R.tokens.star,R.tokens.and])?this._updateNode(new Ce(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(R.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(R.tokens.bracket_right,"Expected ']'.");const e=this._updateNode(new no(t)),n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(R.tokens.period)){const t=this._consume(R.tokens.name,"Expected member name."),e=this._postfix_expression(),n=this._updateNode(new Dr(t.lexeme));return e&&(n.postfix=e),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const e=this._getStruct(t);if(e!==null)return e;switch(t){case"void":return st.void;case"bool":return st.bool;case"i32":return st.i32;case"u32":return st.u32;case"f32":return st.f32;case"f16":return st.f16;case"vec2f":return $.vec2f;case"vec3f":return $.vec3f;case"vec4f":return $.vec4f;case"vec2i":return $.vec2i;case"vec3i":return $.vec3i;case"vec4i":return $.vec4i;case"vec2u":return $.vec2u;case"vec3u":return $.vec3u;case"vec4u":return $.vec4u;case"vec2h":return $.vec2h;case"vec3h":return $.vec3h;case"vec4h":return $.vec4h;case"mat2x2f":return $.mat2x2f;case"mat2x3f":return $.mat2x3f;case"mat2x4f":return $.mat2x4f;case"mat3x2f":return $.mat3x2f;case"mat3x3f":return $.mat3x3f;case"mat3x4f":return $.mat3x4f;case"mat4x2f":return $.mat4x2f;case"mat4x3f":return $.mat4x3f;case"mat4x4f":return $.mat4x4f;case"mat2x2h":return $.mat2x2h;case"mat2x3h":return $.mat2x3h;case"mat2x4h":return $.mat2x4h;case"mat3x2h":return $.mat3x2h;case"mat3x3h":return $.mat3x3h;case"mat3x4h":return $.mat3x4h;case"mat4x2h":return $.mat4x2h;case"mat4x3h":return $.mat4x3h;case"mat4x4h":return $.mat4x4h;case"mat2x2i":return $.mat2x2i;case"mat2x3i":return $.mat2x3i;case"mat2x4i":return $.mat2x4i;case"mat3x2i":return $.mat3x2i;case"mat3x3i":return $.mat3x3i;case"mat3x4i":return $.mat3x4i;case"mat4x2i":return $.mat4x2i;case"mat4x3i":return $.mat4x3i;case"mat4x4i":return $.mat4x4i;case"mat2x2u":return $.mat2x2u;case"mat2x3u":return $.mat2x3u;case"mat2x4u":return $.mat2x4u;case"mat3x2u":return $.mat3x2u;case"mat3x3u":return $.mat3x3u;case"mat3x4u":return $.mat3x4u;case"mat4x2u":return $.mat4x2u;case"mat4x3u":return $.mat4x3u;case"mat4x4u":return $.mat4x4u}return null}_validateTypeRange(t,e){if(e.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(e.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(R.tokens.ident)){const n=this._previous().toString();if(this._check(R.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getType(n);return r!==null?this._updateNode(new yn(r,s)):this._updateNode(new H_(n,s))}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return this._updateNode(new rw(n,s.value))}return this._updateNode(new Ci(n))}if(this._match(R.tokens.int_literal)){const n=this._previous().toString();let s=n.endsWith("i")||n.endsWith("i")?st.i32:n.endsWith("u")||n.endsWith("U")?st.u32:st.x32;const r=parseInt(n);return this._validateTypeRange(r,s),this._updateNode(new Oe(new z(r,this._exec.getTypeInfo(s)),s))}if(this._match(R.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,st.u32),this._updateNode(new Oe(new z(n,this._exec.getTypeInfo(st.u32)),st.u32))}if(this._match([R.tokens.decimal_float_literal,R.tokens.hex_float_literal])){let n=this._previous().toString(),s=n.endsWith("h");s&&(n=n.substring(0,n.length-1));const r=parseFloat(n);this._validateTypeRange(r,s?st.f16:st.f32);const o=s?st.f16:st.f32;return this._updateNode(new Oe(new z(r,this._exec.getTypeInfo(o)),o))}if(this._match([R.keywords.true,R.keywords.false])){let n=this._previous().toString()===R.keywords.true.rule;return this._updateNode(new Oe(new z(n?1:0,this._exec.getTypeInfo(st.bool)),st.bool))}if(this._check(R.tokens.paren_left))return this._paren_expression();if(this._match(R.keywords.bitcast)){this._consume(R.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(R.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new aw(n,s))}const t=this._type_decl(),e=this._argument_expression_list();return this._updateNode(new yn(t,e))}_argument_expression_list(){if(!this._match(R.tokens.paren_left))return null;const t=[];do{if(this._check(R.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(R.tokens.comma));return this._consume(R.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(R.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(R.tokens.paren_right),t}_paren_expression(){this._consume(R.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(R.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(R.keywords.struct))return null;const t=this._currentLine,e=this._consume(R.tokens.ident,"Expected name for struct.").toString();this._consume(R.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(R.tokens.brace_right);){const o=this._attribute(),l=this._consume(R.tokens.name,"Expected variable name.").toString();this._consume(R.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=u),this._check(R.tokens.brace_right)?this._match(R.tokens.comma):this._consume(R.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Xb(l,f,o)))}this._consume(R.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,r=this._updateNode(new Yn(e,n,t,s),t);return this._context.structs.set(e,r),r}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(R.tokens.equal)){const e=this._const_expression();t.value=e}if(t.type!==null&&t.value instanceof Oe){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof Oe&&(t.type=t.value.type.name==="x32"?st.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(R.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(R.keywords.const))return null;const e=this._consume(R.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(R.tokens.colon)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}let r=null;this._consume(R.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[st.f32],f=o.constEvaluate(this._exec,u);f instanceof z&&this._validateTypeRange(f.value,u[0]),u[0]instanceof $&&u[0].format===null&&f.typeInfo instanceof Nr&&f.typeInfo.format!==null&&(f.typeInfo.format.name==="f16"?u[0].format=st.f16:f.typeInfo.format.name==="f32"?u[0].format=st.f32:f.typeInfo.format.name==="i32"?u[0].format=st.i32:f.typeInfo.format.name==="u32"?u[0].format=st.u32:f.typeInfo.format.name==="bool"?u[0].format=st.bool:console.error(`TODO: impelement template format type ${f.typeInfo.format.name}`)),r=this._updateNode(new Oe(f,u[0])),this._exec.context.setVariable(e.toString(),f)}catch{r=o}if(s!==null&&r instanceof Oe){if(r.type.name!=="x32"&&s.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${s.name}. Line:${this._currentLine}`);r.type=s,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else s===null&&r instanceof Oe&&(s=(t=r?.type)!==null&&t!==void 0?t:st.f32,s===st.x32&&(s=st.i32));const l=this._updateNode(new Nh(e.toString(),s,"","",r),n);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(R.keywords.let))return null;const t=this._currentLine,e=this._consume(R.tokens.name,"Expected variable name");let n=null;if(this._match(R.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}let s=null;if(this._match(R.tokens.equal)&&(s=this._const_expression()),n!==null&&s instanceof Oe){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else n===null&&s instanceof Oe&&(n=s.type.name==="x32"?st.i32:s.type);return s instanceof Oe&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new kl(e.toString(),n,"","",s),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(R.keywords.var))return null;const t=this._currentLine;let e="",n="";this._match(R.tokens.less_than)&&(e=this._consume(R.storage_class,"Expected storage_class.").toString(),this._match(R.tokens.comma)&&(n=this._consume(R.access_mode,"Expected access_mode.").toString()),this._consume(R.tokens.greater_than,"Expected '>'."));const s=this._consume(R.tokens.name,"Expected variable name");let r=null;if(this._match(R.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}return this._updateNode(new Zn(s.toString(),r,e,n,null),t)}_override_decl(){if(!this._match(R.keywords.override))return null;const t=this._consume(R.tokens.name,"Expected variable name");let e=null;if(this._match(R.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}return this._updateNode(new z_(t.toString(),e,null))}_diagnostic(){this._consume(R.tokens.paren_left,"Expected '('");const t=this._consume(R.tokens.ident,"Expected severity control name.");this._consume(R.tokens.comma,"Expected ','");let e=this._consume(R.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(R.tokens.period)&&(e+=`.${this._consume(R.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(R.tokens.paren_right,"Expected ')'"),this._updateNode(new iw(t.toString(),e))}_enable_directive(){const t=this._consume(R.tokens.ident,"identity expected.");return this._updateNode(new q5(t.toString()))}_requires_directive(){const t=[this._consume(R.tokens.ident,"identity expected.").toString()];for(;this._match(R.tokens.comma);){const e=this._consume(R.tokens.ident,"identity expected.");t.push(e.toString())}return this._updateNode(new X5(t))}_type_alias(){const t=this._consume(R.tokens.ident,"identity expected.");this._consume(R.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const n=this._updateNode(new j_(t.toString(),e));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([R.tokens.ident,...R.texel_format,R.keywords.bool,R.keywords.f32,R.keywords.i32,R.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const s=this._updateNode(new Wb(n));return this._forwardTypeCount++,s}return this._updateNode(new st(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(R.template_types)){let n=this._advance().toString(),s=null,r=null;return this._match(R.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(R.tokens.comma)&&(r=this._consume(R.access_mode,"Expected access_mode for pointer").toString()),this._consume(R.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new $(n,s,r))}if(this._match(R.keywords.ptr)){let n=this._previous().toString();this._consume(R.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(R.storage_class,"Expected storage_class for pointer");this._consume(R.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let o=null;return this._match(R.tokens.comma)&&(o=this._consume(R.access_mode,"Expected access_mode for pointer").toString()),this._consume(R.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Dh(n,s.toString(),r,o))}const e=this._attribute();if(this._match(R.keywords.array)){let n=null,s=-1;const r=this._previous();let o=null;if(this._match(R.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let u="";if(this._match(R.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(R.tokens.greater_than,"Expected '>' for array."),s=u?parseInt(u):0}const l=this._updateNode(new Bl(r.toString(),e,n,s));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(R.sampler_type))return this._updateNode(new Al(this._previous().toString(),null,null));if(this._match(R.depth_texture_type))return this._updateNode(new Al(this._previous().toString(),null,null));if(this._match(R.sampled_texture_type)||this._match(R.multisampled_texture_type)){const t=this._previous();this._consume(R.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(R.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Al(t.toString(),e,null))}if(this._match(R.storage_texture_type)){const t=this._previous();this._consume(R.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(R.texel_format,"Invalid texel format.").toString();this._consume(R.tokens.comma,"Expected ',' after texel format.");const n=this._consume(R.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(R.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Al(t.toString(),e,n))}return null}_attribute(){let t=[];for(;this._match(R.tokens.attr);){const e=this._consume(R.attribute_name,"Expected attribute name"),n=this._updateNode(new hw(e.toString(),null));if(this._match(R.tokens.paren_left)){if(n.value=this._consume(R.literal_or_ident,"Expected attribute value").toString(),this._check(R.tokens.comma)){this._advance();do{const s=this._consume(R.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(R.tokens.comma))}this._consume(R.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class uI extends xn{constructor(t){super(),t&&this.update(t)}update(t){const e=new cI().parse(t);this.updateAST(e)}}function hI(i){const t={attributes:[],bindings:[]};let e;try{e=fI(i)}catch(r){return ot.error(r.message)(),t}for(const r of e.uniforms){const o=[];for(const l of r.type?.members||[])o.push({name:l.name,type:Zb(l.type)});t.bindings.push({type:"uniform",name:r.name,group:r.group,location:r.binding,members:o})}for(const r of e.textures)t.bindings.push({type:"texture",name:r.name,group:r.group,location:r.binding});for(const r of e.samplers)t.bindings.push({type:"sampler",name:r.name,group:r.group,location:r.binding});const n=e.entry.vertex[0],s=n?.inputs.length||0;for(let r=0;r<s;r++){const o=n.inputs[r];if(o.locationType==="location"){const l=Zb(o.type);t.attributes.push({name:o.name,location:Number(o.location),type:l})}}return t}function Zb(i){return i?.format?`${i.name}<${i.format.name}>`:i.name}function fI(i){try{return new uI(i)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&t?.message&&(e+=`: ${t.message} `),typeof t=="object"&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}const dI={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...dI}};const di=globalThis.mathgl.config;function gI(i,{precision:t=di.precision}={}){return i=pI(i),`${parseFloat(i.toPrecision(t))}`}function Lr(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Sn(i,t,e){return mI(i,n=>Math.max(t,Math.min(e,n)))}function ff(i,t,e){return Lr(i)?i.map((n,s)=>ff(n,t[s],e)):e*t+(1-e)*i}function Qn(i,t,e){const n=di.EPSILON;try{if(i===t)return!0;if(Lr(i)&&Lr(t)){if(i.length!==t.length)return!1;for(let s=0;s<i.length;++s)if(!Qn(i[s],t[s]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=di.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{di.EPSILON=n}}function pI(i){return Math.round(i/di.EPSILON)*di.EPSILON}function _I(i){return i.clone?i.clone():new Array(i.length)}function mI(i,t,e){if(Lr(i)){const n=i;e=e||_I(n);for(let s=0;s<e.length&&s<n.length;++s){const r=typeof i=="number"?i:i[s];e[s]=t(r,s,e)}return e}return t(i)}class X_ extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Lr(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(di)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+gI(this[n],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Qn(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const r=t[s],o=typeof e=="number"?e:e[s];this[s]=r+n*(o-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=e[n];return this.check()}subtract(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=e[n];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(di.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function yI(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function ae(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function Ul(i,t,e=""){if(di.debug&&!yI(i,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return i}function tc(i,t){if(!i)throw new Error(`math.gl assertion ${t}`)}class fw extends X_{get x(){return this[0]}set x(t){this[0]=ae(t)}get y(){return this[1]}set y(t){this[1]=ae(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-t[n];e+=s*s}return ae(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return ae(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=e[n];return this.check()}divide(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return tc(t>=0&&t<this.ELEMENTS,"index is out of range"),ae(this[t])}setComponent(t,e){return tc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const Fl=1e-6;let nn=typeof Float32Array<"u"?Float32Array:Array;function vI(){const i=new nn(2);return nn!=Float32Array&&(i[0]=0,i[1]=0),i}function Qb(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function bI(i,t){return i[0]=-t[0],i[1]=-t[1],i}function dw(i,t,e,n){const s=t[0],r=t[1];return i[0]=s+n*(e[0]-s),i[1]=r+n*(e[1]-r),i}function xI(i,t,e){const n=t[0],s=t[1];return i[0]=e[0]*n+e[3]*s+e[6],i[1]=e[1]*n+e[4]*s+e[7],i}function SI(i,t,e){const n=t[0],s=t[1];return i[0]=e[0]*n+e[4]*s+e[12],i[1]=e[1]*n+e[5]*s+e[13],i}(function(){const i=vI();return function(t,e,n,s,r,o){let l,u;for(e||(e=2),n||(n=0),s?u=Math.min(s*e+n,t.length):u=t.length,l=n;l<u;l+=e)i[0]=t[l],i[1]=t[l+1],r(i,i,o),t[l]=i[0],t[l+1]=i[1];return t}})();function TI(i,t,e){const n=t[0],s=t[1],r=e[3]*n+e[7]*s||1;return i[0]=(e[0]*n+e[4]*s)/r,i[1]=(e[1]*n+e[5]*s)/r,i}function gw(i,t,e){const n=t[0],s=t[1],r=t[2],o=e[3]*n+e[7]*s+e[11]*r||1;return i[0]=(e[0]*n+e[4]*s+e[8]*r)/o,i[1]=(e[1]*n+e[5]*s+e[9]*r)/o,i[2]=(e[2]*n+e[6]*s+e[10]*r)/o,i}function wI(i,t,e){const n=t[0],s=t[1];return i[0]=e[0]*n+e[2]*s,i[1]=e[1]*n+e[3]*s,i[2]=t[2],i}function EI(i,t,e){const n=t[0],s=t[1];return i[0]=e[0]*n+e[2]*s,i[1]=e[1]*n+e[3]*s,i[2]=t[2],i[3]=t[3],i}function pw(i,t,e){const n=t[0],s=t[1],r=t[2];return i[0]=e[0]*n+e[3]*s+e[6]*r,i[1]=e[1]*n+e[4]*s+e[7]*r,i[2]=e[2]*n+e[5]*s+e[8]*r,i[3]=t[3],i}function _w(){const i=new nn(3);return nn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function AI(i){const t=i[0],e=i[1],n=i[2];return Math.sqrt(t*t+e*e+n*n)}function Jb(i,t,e){const n=new nn(3);return n[0]=i,n[1]=t,n[2]=e,n}function MI(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function CI(i){const t=i[0],e=i[1],n=i[2];return t*t+e*e+n*n}function RI(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function PI(i,t){const e=t[0],n=t[1],s=t[2];let r=e*e+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i}function mw(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function kh(i,t,e){const n=t[0],s=t[1],r=t[2],o=e[0],l=e[1],u=e[2];return i[0]=s*u-r*l,i[1]=r*o-n*u,i[2]=n*l-s*o,i}function II(i,t,e,n){const s=t[0],r=t[1],o=t[2];return i[0]=s+n*(e[0]-s),i[1]=r+n*(e[1]-r),i[2]=o+n*(e[2]-o),i}function Y_(i,t,e){const n=t[0],s=t[1],r=t[2];let o=e[3]*n+e[7]*s+e[11]*r+e[15];return o=o||1,i[0]=(e[0]*n+e[4]*s+e[8]*r+e[12])/o,i[1]=(e[1]*n+e[5]*s+e[9]*r+e[13])/o,i[2]=(e[2]*n+e[6]*s+e[10]*r+e[14])/o,i}function yw(i,t,e){const n=t[0],s=t[1],r=t[2];return i[0]=n*e[0]+s*e[3]+r*e[6],i[1]=n*e[1]+s*e[4]+r*e[7],i[2]=n*e[2]+s*e[5]+r*e[8],i}function vw(i,t,e){const n=e[0],s=e[1],r=e[2],o=e[3],l=t[0],u=t[1],f=t[2];let g=s*f-r*u,p=r*l-n*f,_=n*u-s*l,v=s*_-r*p,b=r*g-n*_,x=n*p-s*g;const T=o*2;return g*=T,p*=T,_*=T,v*=2,b*=2,x*=2,i[0]=l+g+v,i[1]=u+p+b,i[2]=f+_+x,i}function OI(i,t,e,n){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0],r[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),r[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),i[0]=r[0]+e[0],i[1]=r[1]+e[1],i[2]=r[2]+e[2],i}function NI(i,t,e,n){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),r[1]=s[1],r[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),i[0]=r[0]+e[0],i[1]=r[1]+e[1],i[2]=r[2]+e[2],i}function DI(i,t,e,n){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),r[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),r[2]=s[2],i[0]=r[0]+e[0],i[1]=r[1]+e[1],i[2]=r[2]+e[2],i}function LI(i,t){const e=i[0],n=i[1],s=i[2],r=t[0],o=t[1],l=t[2],u=Math.sqrt((e*e+n*n+s*s)*(r*r+o*o+l*l)),f=u&&mw(i,t)/u;return Math.acos(Math.min(Math.max(f,-1),1))}const bw=MI,xw=AI,Ip=CI;(function(){const i=_w();return function(t,e,n,s,r,o){let l,u;for(e||(e=3),n||(n=0),s?u=Math.min(s*e+n,t.length):u=t.length,l=n;l<u;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],r(i,i,o),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const Op=[0,0,0];let Ju;class yt extends fw{static get ZERO(){return Ju||(Ju=new yt(0,0,0),Object.freeze(Ju)),Ju}constructor(t=0,e=0,n=0){super(-0,-0,-0),arguments.length===1&&Lr(t)?this.copy(t):(di.debug&&(ae(t),ae(e),ae(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return di.debug&&(ae(t.x),ae(t.y),ae(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ae(t)}angle(t){return LI(this,t)}cross(t){return kh(this,this,t),this.check()}rotateX({radians:t,origin:e=Op}){return OI(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Op}){return NI(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Op}){return DI(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Y_(this,this,t),this.check()}transformAsVector(t){return gw(this,this,t),this.check()}transformByMatrix3(t){return yw(this,this,t),this.check()}transformByMatrix2(t){return wI(this,this,t),this.check()}transformByQuaternion(t){return vw(this,this,t),this.check()}}let th;class K_ extends fw{static get ZERO(){return th||(th=new K_(0,0,0,0),Object.freeze(th)),th}constructor(t=0,e=0,n=0,s=0){super(-0,-0,-0,-0),Lr(t)&&arguments.length===1?this.copy(t):(di.debug&&(ae(t),ae(e),ae(n),ae(s)),this[0]=t,this[1]=e,this[2]=n,this[3]=s)}set(t,e,n,s){return this[0]=t,this[1]=e,this[2]=n,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return di.debug&&(ae(t.x),ae(t.y),ae(t.z),ae(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ae(t)}get w(){return this[3]}set w(t){this[3]=ae(t)}transform(t){return Y_(this,this,t),this.check()}transformByMatrix3(t){return pw(this,this,t),this.check()}transformByMatrix2(t){return EI(this,this,t),this.check()}transformByQuaternion(t){return vw(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class Sw extends X_{toString(){let t="[";if(di.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=ae(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[n+s];return e}setColumn(t,e){const n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=e[s];return this}}function kI(){const i=new nn(9);return nn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function BI(i,t){if(i===t){const e=t[1],n=t[2],s=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=n,i[7]=s}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function UI(i,t){const e=t[0],n=t[1],s=t[2],r=t[3],o=t[4],l=t[5],u=t[6],f=t[7],g=t[8],p=g*o-l*f,_=-g*r+l*u,v=f*r-o*u;let b=e*p+n*_+s*v;return b?(b=1/b,i[0]=p*b,i[1]=(-g*n+s*f)*b,i[2]=(l*n-s*o)*b,i[3]=_*b,i[4]=(g*e-s*u)*b,i[5]=(-l*e+s*r)*b,i[6]=v*b,i[7]=(-f*e+n*u)*b,i[8]=(o*e-n*r)*b,i):null}function FI(i){const t=i[0],e=i[1],n=i[2],s=i[3],r=i[4],o=i[5],l=i[6],u=i[7],f=i[8];return t*(f*r-o*u)+e*(-f*s+o*l)+n*(u*s-r*l)}function t3(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3],l=t[4],u=t[5],f=t[6],g=t[7],p=t[8],_=e[0],v=e[1],b=e[2],x=e[3],T=e[4],w=e[5],M=e[6],E=e[7],P=e[8];return i[0]=_*n+v*o+b*f,i[1]=_*s+v*l+b*g,i[2]=_*r+v*u+b*p,i[3]=x*n+T*o+w*f,i[4]=x*s+T*l+w*g,i[5]=x*r+T*u+w*p,i[6]=M*n+E*o+P*f,i[7]=M*s+E*l+P*g,i[8]=M*r+E*u+P*p,i}function zI(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3],l=t[4],u=t[5],f=t[6],g=t[7],p=t[8],_=e[0],v=e[1];return i[0]=n,i[1]=s,i[2]=r,i[3]=o,i[4]=l,i[5]=u,i[6]=_*n+v*o+f,i[7]=_*s+v*l+g,i[8]=_*r+v*u+p,i}function VI(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3],l=t[4],u=t[5],f=t[6],g=t[7],p=t[8],_=Math.sin(e),v=Math.cos(e);return i[0]=v*n+_*o,i[1]=v*s+_*l,i[2]=v*r+_*u,i[3]=v*o-_*n,i[4]=v*l-_*s,i[5]=v*u-_*r,i[6]=f,i[7]=g,i[8]=p,i}function e3(i,t,e){const n=e[0],s=e[1];return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=s*t[3],i[4]=s*t[4],i[5]=s*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function jI(i,t){const e=t[0],n=t[1],s=t[2],r=t[3],o=e+e,l=n+n,u=s+s,f=e*o,g=n*o,p=n*l,_=s*o,v=s*l,b=s*u,x=r*o,T=r*l,w=r*u;return i[0]=1-p-b,i[3]=g-w,i[6]=_+T,i[1]=g+w,i[4]=1-f-b,i[7]=v-x,i[2]=_-T,i[5]=v+x,i[8]=1-f-p,i}var P0;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(P0||(P0={}));const HI=Object.freeze([1,0,0,0,1,0,0,0,1]);class $e extends Sw{static get IDENTITY(){return GI()}static get ZERO(){return $I()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return P0}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(HI)}fromObject(t){return this.check()}fromQuaternion(t){return jI(this,t),this.check()}set(t,e,n,s,r,o,l,u,f){return this[0]=t,this[1]=e,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=l,this[7]=u,this[8]=f,this.check()}setRowMajor(t,e,n,s,r,o,l,u,f){return this[0]=t,this[1]=s,this[2]=l,this[3]=e,this[4]=r,this[5]=u,this[6]=n,this[7]=o,this[8]=f,this.check()}determinant(){return FI(this)}transpose(){return BI(this,this),this.check()}invert(){return UI(this,this),this.check()}multiplyLeft(t){return t3(this,t,this),this.check()}multiplyRight(t){return t3(this,this,t),this.check()}rotate(t){return VI(this,this,t),this.check()}scale(t){return Array.isArray(t)?e3(this,this,t):e3(this,this,[t,t]),this.check()}translate(t){return zI(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=xI(e||[-0,-0],t,this);break;case 3:n=yw(e||[-0,-0,-0],t,this);break;case 4:n=pw(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ul(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let eh,ih=null;function $I(){return eh||(eh=new $e([0,0,0,0,0,0,0,0,0]),Object.freeze(eh)),eh}function GI(){return ih||(ih=new $e,Object.freeze(ih)),ih}function WI(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qI(i,t){if(i===t){const e=t[1],n=t[2],s=t[3],r=t[6],o=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=n,i[9]=r,i[11]=t[14],i[12]=s,i[13]=o,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function I0(i,t){const e=t[0],n=t[1],s=t[2],r=t[3],o=t[4],l=t[5],u=t[6],f=t[7],g=t[8],p=t[9],_=t[10],v=t[11],b=t[12],x=t[13],T=t[14],w=t[15],M=e*l-n*o,E=e*u-s*o,P=e*f-r*o,k=n*u-s*l,U=n*f-r*l,Y=s*f-r*u,et=g*x-p*b,K=g*T-_*b,ut=g*w-v*b,ht=p*T-_*x,_t=p*w-v*x,St=_*w-v*T;let pt=M*St-E*_t+P*ht+k*ut-U*K+Y*et;return pt?(pt=1/pt,i[0]=(l*St-u*_t+f*ht)*pt,i[1]=(s*_t-n*St-r*ht)*pt,i[2]=(x*Y-T*U+w*k)*pt,i[3]=(_*U-p*Y-v*k)*pt,i[4]=(u*ut-o*St-f*K)*pt,i[5]=(e*St-s*ut+r*K)*pt,i[6]=(T*P-b*Y-w*E)*pt,i[7]=(g*Y-_*P+v*E)*pt,i[8]=(o*_t-l*ut+f*et)*pt,i[9]=(n*ut-e*_t-r*et)*pt,i[10]=(b*U-x*P+w*M)*pt,i[11]=(p*P-g*U-v*M)*pt,i[12]=(l*K-o*ht-u*et)*pt,i[13]=(e*ht-n*K+s*et)*pt,i[14]=(x*E-b*k-T*M)*pt,i[15]=(g*k-p*E+_*M)*pt,i):null}function XI(i){const t=i[0],e=i[1],n=i[2],s=i[3],r=i[4],o=i[5],l=i[6],u=i[7],f=i[8],g=i[9],p=i[10],_=i[11],v=i[12],b=i[13],x=i[14],T=i[15],w=t*o-e*r,M=t*l-n*r,E=e*l-n*o,P=f*b-g*v,k=f*x-p*v,U=g*x-p*b,Y=t*U-e*k+n*P,et=r*U-o*k+l*P,K=f*E-g*M+p*w,ut=v*E-b*M+x*w;return u*Y-s*et+T*K-_*ut}function Cr(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3],l=t[4],u=t[5],f=t[6],g=t[7],p=t[8],_=t[9],v=t[10],b=t[11],x=t[12],T=t[13],w=t[14],M=t[15];let E=e[0],P=e[1],k=e[2],U=e[3];return i[0]=E*n+P*l+k*p+U*x,i[1]=E*s+P*u+k*_+U*T,i[2]=E*r+P*f+k*v+U*w,i[3]=E*o+P*g+k*b+U*M,E=e[4],P=e[5],k=e[6],U=e[7],i[4]=E*n+P*l+k*p+U*x,i[5]=E*s+P*u+k*_+U*T,i[6]=E*r+P*f+k*v+U*w,i[7]=E*o+P*g+k*b+U*M,E=e[8],P=e[9],k=e[10],U=e[11],i[8]=E*n+P*l+k*p+U*x,i[9]=E*s+P*u+k*_+U*T,i[10]=E*r+P*f+k*v+U*w,i[11]=E*o+P*g+k*b+U*M,E=e[12],P=e[13],k=e[14],U=e[15],i[12]=E*n+P*l+k*p+U*x,i[13]=E*s+P*u+k*_+U*T,i[14]=E*r+P*f+k*v+U*w,i[15]=E*o+P*g+k*b+U*M,i}function df(i,t,e){const n=e[0],s=e[1],r=e[2];let o,l,u,f,g,p,_,v,b,x,T,w;return t===i?(i[12]=t[0]*n+t[4]*s+t[8]*r+t[12],i[13]=t[1]*n+t[5]*s+t[9]*r+t[13],i[14]=t[2]*n+t[6]*s+t[10]*r+t[14],i[15]=t[3]*n+t[7]*s+t[11]*r+t[15]):(o=t[0],l=t[1],u=t[2],f=t[3],g=t[4],p=t[5],_=t[6],v=t[7],b=t[8],x=t[9],T=t[10],w=t[11],i[0]=o,i[1]=l,i[2]=u,i[3]=f,i[4]=g,i[5]=p,i[6]=_,i[7]=v,i[8]=b,i[9]=x,i[10]=T,i[11]=w,i[12]=o*n+g*s+b*r+t[12],i[13]=l*n+p*s+x*r+t[13],i[14]=u*n+_*s+T*r+t[14],i[15]=f*n+v*s+w*r+t[15]),i}function Z_(i,t,e){const n=e[0],s=e[1],r=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*r,i[9]=t[9]*r,i[10]=t[10]*r,i[11]=t[11]*r,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function YI(i,t,e,n){let s=n[0],r=n[1],o=n[2],l=Math.sqrt(s*s+r*r+o*o),u,f,g,p,_,v,b,x,T,w,M,E,P,k,U,Y,et,K,ut,ht,_t,St,pt,It;return l<Fl?null:(l=1/l,s*=l,r*=l,o*=l,f=Math.sin(e),u=Math.cos(e),g=1-u,p=t[0],_=t[1],v=t[2],b=t[3],x=t[4],T=t[5],w=t[6],M=t[7],E=t[8],P=t[9],k=t[10],U=t[11],Y=s*s*g+u,et=r*s*g+o*f,K=o*s*g-r*f,ut=s*r*g-o*f,ht=r*r*g+u,_t=o*r*g+s*f,St=s*o*g+r*f,pt=r*o*g-s*f,It=o*o*g+u,i[0]=p*Y+x*et+E*K,i[1]=_*Y+T*et+P*K,i[2]=v*Y+w*et+k*K,i[3]=b*Y+M*et+U*K,i[4]=p*ut+x*ht+E*_t,i[5]=_*ut+T*ht+P*_t,i[6]=v*ut+w*ht+k*_t,i[7]=b*ut+M*ht+U*_t,i[8]=p*St+x*pt+E*It,i[9]=_*St+T*pt+P*It,i[10]=v*St+w*pt+k*It,i[11]=b*St+M*pt+U*It,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function Tw(i,t,e){const n=Math.sin(e),s=Math.cos(e),r=t[4],o=t[5],l=t[6],u=t[7],f=t[8],g=t[9],p=t[10],_=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=r*s+f*n,i[5]=o*s+g*n,i[6]=l*s+p*n,i[7]=u*s+_*n,i[8]=f*s-r*n,i[9]=g*s-o*n,i[10]=p*s-l*n,i[11]=_*s-u*n,i}function KI(i,t,e){const n=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],l=t[2],u=t[3],f=t[8],g=t[9],p=t[10],_=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=r*s-f*n,i[1]=o*s-g*n,i[2]=l*s-p*n,i[3]=u*s-_*n,i[8]=r*n+f*s,i[9]=o*n+g*s,i[10]=l*n+p*s,i[11]=u*n+_*s,i}function ww(i,t,e){const n=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],l=t[2],u=t[3],f=t[4],g=t[5],p=t[6],_=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=r*s+f*n,i[1]=o*s+g*n,i[2]=l*s+p*n,i[3]=u*s+_*n,i[4]=f*s-r*n,i[5]=g*s-o*n,i[6]=p*s-l*n,i[7]=_*s-u*n,i}function ZI(i,t){const e=t[0],n=t[1],s=t[2],r=t[4],o=t[5],l=t[6],u=t[8],f=t[9],g=t[10];return i[0]=Math.sqrt(e*e+n*n+s*s),i[1]=Math.sqrt(r*r+o*o+l*l),i[2]=Math.sqrt(u*u+f*f+g*g),i}function QI(i,t){const e=t[0],n=t[1],s=t[2],r=t[3],o=e+e,l=n+n,u=s+s,f=e*o,g=n*o,p=n*l,_=s*o,v=s*l,b=s*u,x=r*o,T=r*l,w=r*u;return i[0]=1-p-b,i[1]=g+w,i[2]=_-T,i[3]=0,i[4]=g-w,i[5]=1-f-b,i[6]=v+x,i[7]=0,i[8]=_+T,i[9]=v-x,i[10]=1-f-p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function JI(i,t,e,n,s,r,o){const l=1/(e-t),u=1/(s-n),f=1/(r-o);return i[0]=r*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r*2*u,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(s+n)*u,i[10]=(o+r)*f,i[11]=-1,i[12]=0,i[13]=0,i[14]=o*r*2*f,i[15]=0,i}function t8(i,t,e,n,s){const r=1/Math.tan(t/2);if(i[0]=r/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0){const o=1/(n-s);i[10]=(s+n)*o,i[14]=2*s*n*o}else i[10]=-1,i[14]=-2*n;return i}const e8=t8;function i8(i,t,e,n,s,r,o){const l=1/(t-e),u=1/(n-s),f=1/(r-o);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*f,i[11]=0,i[12]=(t+e)*l,i[13]=(s+n)*u,i[14]=(o+r)*f,i[15]=1,i}const n8=i8;function s8(i,t,e,n){let s,r,o,l,u,f,g,p,_,v;const b=t[0],x=t[1],T=t[2],w=n[0],M=n[1],E=n[2],P=e[0],k=e[1],U=e[2];return Math.abs(b-P)<Fl&&Math.abs(x-k)<Fl&&Math.abs(T-U)<Fl?WI(i):(p=b-P,_=x-k,v=T-U,s=1/Math.sqrt(p*p+_*_+v*v),p*=s,_*=s,v*=s,r=M*v-E*_,o=E*p-w*v,l=w*_-M*p,s=Math.sqrt(r*r+o*o+l*l),s?(s=1/s,r*=s,o*=s,l*=s):(r=0,o=0,l=0),u=_*l-v*o,f=v*r-p*l,g=p*o-_*r,s=Math.sqrt(u*u+f*f+g*g),s?(s=1/s,u*=s,f*=s,g*=s):(u=0,f=0,g=0),i[0]=r,i[1]=u,i[2]=p,i[3]=0,i[4]=o,i[5]=f,i[6]=_,i[7]=0,i[8]=l,i[9]=g,i[10]=v,i[11]=0,i[12]=-(r*b+o*x+l*T),i[13]=-(u*b+f*x+g*T),i[14]=-(p*b+_*x+v*T),i[15]=1,i)}function r8(){const i=new nn(4);return nn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function a8(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function Q_(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function o8(i){const t=i[0],e=i[1],n=i[2],s=i[3];return Math.sqrt(t*t+e*e+n*n+s*s)}function l8(i){const t=i[0],e=i[1],n=i[2],s=i[3];return t*t+e*e+n*n+s*s}function c8(i,t){const e=t[0],n=t[1],s=t[2],r=t[3];let o=e*e+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),i[0]=e*o,i[1]=n*o,i[2]=s*o,i[3]=r*o,i}function u8(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function h8(i,t,e,n){const s=t[0],r=t[1],o=t[2],l=t[3];return i[0]=s+n*(e[0]-s),i[1]=r+n*(e[1]-r),i[2]=o+n*(e[2]-o),i[3]=l+n*(e[3]-l),i}function ho(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3];return i[0]=e[0]*n+e[4]*s+e[8]*r+e[12]*o,i[1]=e[1]*n+e[5]*s+e[9]*r+e[13]*o,i[2]=e[2]*n+e[6]*s+e[10]*r+e[14]*o,i[3]=e[3]*n+e[7]*s+e[11]*r+e[15]*o,i}function f8(i,t,e){const n=t[0],s=t[1],r=t[2],o=e[0],l=e[1],u=e[2],f=e[3],g=f*n+l*r-u*s,p=f*s+u*n-o*r,_=f*r+o*s-l*n,v=-o*n-l*s-u*r;return i[0]=g*f+v*-o+p*-u-_*-l,i[1]=p*f+v*-l+_*-o-g*-u,i[2]=_*f+v*-u+g*-l-p*-o,i[3]=t[3],i}(function(){const i=r8();return function(t,e,n,s,r,o){let l,u;for(e||(e=4),n||(n=0),s?u=Math.min(s*e+n,t.length):u=t.length,l=n;l<u;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],r(i,i,o),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var O0;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(O0||(O0={}));const d8=45*Math.PI/180,g8=1,Np=.1,Dp=500,p8=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class He extends Sw{static get IDENTITY(){return m8()}static get ZERO(){return _8()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return O0}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,s,r,o,l,u,f,g,p,_,v,b,x,T){return this[0]=t,this[1]=e,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=l,this[7]=u,this[8]=f,this[9]=g,this[10]=p,this[11]=_,this[12]=v,this[13]=b,this[14]=x,this[15]=T,this.check()}setRowMajor(t,e,n,s,r,o,l,u,f,g,p,_,v,b,x,T){return this[0]=t,this[1]=r,this[2]=f,this[3]=v,this[4]=e,this[5]=o,this[6]=g,this[7]=b,this[8]=n,this[9]=l,this[10]=p,this[11]=x,this[12]=s,this[13]=u,this[14]=_,this[15]=T,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(p8)}fromObject(t){return this.check()}fromQuaternion(t){return QI(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:s,top:r,near:o=Np,far:l=Dp}=t;return l===1/0?y8(this,e,n,s,r,o):JI(this,e,n,s,r,o,l),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:s=[0,1,0]}=t;return s8(this,e,n,s),this.check()}ortho(t){const{left:e,right:n,bottom:s,top:r,near:o=Np,far:l=Dp}=t;return n8(this,e,n,s,r,o,l),this.check()}orthographic(t){const{fovy:e=d8,aspect:n=g8,focalDistance:s=1,near:r=Np,far:o=Dp}=t;i3(e);const l=e/2,u=s*Math.tan(l),f=u*n;return this.ortho({left:-f,right:f,bottom:-u,top:u,near:r,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:s=.1,far:r=500}=t;return i3(e),e8(this,e,n,s,r),this.check()}determinant(){return XI(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),s=1/n[0],r=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*r,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*r,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),s=1/n[0],r=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*r,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*r,t[8]=this[10]*o,t}transpose(){return qI(this,this),this.check()}invert(){return I0(this,this),this.check()}multiplyLeft(t){return Cr(this,t,this),this.check()}multiplyRight(t){return Cr(this,this,t),this.check()}rotateX(t){return Tw(this,this,t),this.check()}rotateY(t){return KI(this,this,t),this.check()}rotateZ(t){return ww(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return YI(this,this,t,e),this.check()}scale(t){return Z_(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return df(this,this,t),this.check()}transform(t,e){return t.length===4?(e=ho(e||[-0,-0,-0,-0],t,this),Ul(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let s;switch(n){case 2:s=SI(e||[-0,-0],t,this);break;case 3:s=Y_(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ul(s,t.length),s}transformAsVector(t,e){let n;switch(t.length){case 2:n=TI(e||[-0,-0],t,this);break;case 3:n=gw(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ul(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let nh,sh;function _8(){return nh||(nh=new He([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(nh)),nh}function m8(){return sh||(sh=new He,Object.freeze(sh)),sh}function i3(i){if(i>Math.PI*2)throw Error("expected radians")}function y8(i,t,e,n,s,r){const o=2*r/(e-t),l=2*r/(s-n),u=(e+t)/(e-t),f=(s+n)/(s-n),g=-1,p=-1,_=-2*r;return i[0]=o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=u,i[9]=f,i[10]=g,i[11]=p,i[12]=0,i[13]=0,i[14]=_,i[15]=0,i}function n3(){const i=new nn(4);return nn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function v8(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Ew(i,t,e){e=e*.5;const n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function s3(i,t,e){const n=t[0],s=t[1],r=t[2],o=t[3],l=e[0],u=e[1],f=e[2],g=e[3];return i[0]=n*g+o*l+s*f-r*u,i[1]=s*g+o*u+r*l-n*f,i[2]=r*g+o*f+n*u-s*l,i[3]=o*g-n*l-s*u-r*f,i}function b8(i,t,e){e*=.5;const n=t[0],s=t[1],r=t[2],o=t[3],l=Math.sin(e),u=Math.cos(e);return i[0]=n*u+o*l,i[1]=s*u+r*l,i[2]=r*u-s*l,i[3]=o*u-n*l,i}function x8(i,t,e){e*=.5;const n=t[0],s=t[1],r=t[2],o=t[3],l=Math.sin(e),u=Math.cos(e);return i[0]=n*u-r*l,i[1]=s*u+o*l,i[2]=r*u+n*l,i[3]=o*u-s*l,i}function S8(i,t,e){e*=.5;const n=t[0],s=t[1],r=t[2],o=t[3],l=Math.sin(e),u=Math.cos(e);return i[0]=n*u+s*l,i[1]=s*u-n*l,i[2]=r*u+o*l,i[3]=o*u-r*l,i}function T8(i,t){const e=t[0],n=t[1],s=t[2];return i[0]=e,i[1]=n,i[2]=s,i[3]=Math.sqrt(Math.abs(1-e*e-n*n-s*s)),i}function Bh(i,t,e,n){const s=t[0],r=t[1],o=t[2],l=t[3];let u=e[0],f=e[1],g=e[2],p=e[3],_,v,b,x,T;return _=s*u+r*f+o*g+l*p,_<0&&(_=-_,u=-u,f=-f,g=-g,p=-p),1-_>Fl?(v=Math.acos(_),T=Math.sin(v),b=Math.sin((1-n)*v)/T,x=Math.sin(n*v)/T):(b=1-n,x=n),i[0]=b*s+x*u,i[1]=b*r+x*f,i[2]=b*o+x*g,i[3]=b*l+x*p,i}function w8(i,t){const e=t[0],n=t[1],s=t[2],r=t[3],o=e*e+n*n+s*s+r*r,l=o?1/o:0;return i[0]=-e*l,i[1]=-n*l,i[2]=-s*l,i[3]=r*l,i}function E8(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function Aw(i,t){const e=t[0]+t[4]+t[8];let n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);const r=(s+1)%3,o=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[r*3+r]-t[o*3+o]+1),i[s]=.5*n,n=.5/n,i[3]=(t[r*3+o]-t[o*3+r])*n,i[r]=(t[r*3+s]+t[s*3+r])*n,i[o]=(t[o*3+s]+t[s*3+o])*n}return i}const A8=a8,M8=Q_,C8=u8,R8=h8,P8=o8,I8=l8,Mw=c8,O8=(function(){const i=_w(),t=Jb(1,0,0),e=Jb(0,1,0);return function(n,s,r){const o=mw(s,r);return o<-.999999?(kh(i,t,s),xw(i)<1e-6&&kh(i,e,s),PI(i,i),Ew(n,i,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(kh(i,s,r),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+o,Mw(n,n))}})();(function(){const i=n3(),t=n3();return function(e,n,s,r,o,l){return Bh(i,n,o,l),Bh(t,s,r,l),Bh(e,i,t,2*l*(1-l)),e}})();(function(){const i=kI();return function(t,e,n,s){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],Mw(t,Aw(t,i))}})();const N8=[0,0,0,1];class r3 extends X_{constructor(t=0,e=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,s){return this[0]=t,this[1]=e,this[2]=n,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Aw(this,t),this.check()}fromAxisRotation(t,e){return Ew(this,t,e),this.check()}identity(){return v8(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=ae(t)}get y(){return this[1]}set y(t){this[1]=ae(t)}get z(){return this[2]}set z(t){this[2]=ae(t)}get w(){return this[3]}set w(t){this[3]=ae(t)}len(){return P8(this)}lengthSquared(){return I8(this)}dot(t){return C8(this,t)}rotationTo(t,e){return O8(this,t,e),this.check()}add(t){return A8(this,this,t),this.check()}calculateW(){return T8(this,this),this.check()}conjugate(){return E8(this,this),this.check()}invert(){return w8(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(R8(this,t,e,n),this.check())}multiplyRight(t){return s3(this,this,t),this.check()}multiplyLeft(t){return s3(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return b8(this,this,t),this.check()}rotateY(t){return x8(this,this,t),this.check()}rotateZ(t){return S8(this,this,t),this.check()}scale(t){return M8(this,this,t),this.check()}slerp(t,e,n){let s,r,o;switch(arguments.length){case 1:({start:s=N8,target:r,ratio:o}=t);break;case 2:s=this,r=t,o=e;break;default:s=t,r=e,o=n}return Bh(this,s,r,o),this.check()}transformVector4(t,e=new K_){return f8(e,t,this),Ul(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const D8=1e-15,L8=1e-20;function Cw(i,t=[],e=0){const n=Math.fround(i),s=i-n;return t[e]=n,t[e+1]=s,t}function k8(i){return i-Math.fround(i)}function B8(i){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let n=0;n<4;++n){const s=e*4+n;Cw(i[n*4+e],t,s*2)}return t}const U8=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,F8={name:"fp32",vs:U8},z8=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,V8={ONE:1},j8={name:"fp64arithmetic",vs:z8,defaultUniforms:V8,uniformTypes:{ONE:"f32"},fp64ify:Cw,fp64LowPart:k8,fp64ifyMatrix4:B8},H8=[0,1,1,1],$8=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,G8=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,a3={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:H8},vs:$8,fs:G8,getUniforms:W8};function W8(i={},t){const e={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const n=i.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=n}if(i.highlightColor){const n=Array.from(i.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),e.highlightColor=n}return i.isActive!==void 0&&(e.isActive=!!i.isActive,e.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(e.useFloatColors=!!i.useFloatColors),e}const o3=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,q8=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,X8=5,Y8=255;var ec;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(ec||(ec={}));const zl={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:ec.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:q8,vs:o3,fs:o3,getUniforms:K8};function K8(i,t={}){if(i=i&&{...i},!i)return{...zl.defaultUniforms};i.lights&&(i={...i,...Q8(i.lights),lights:void 0});const{ambientLight:e,pointLights:n,directionalLights:s}=i||{};if(!(e||n&&n.length>0||s&&s.length>0))return{...zl.defaultUniforms,enabled:0};const o={...zl.defaultUniforms,...t,...Z8({ambientLight:e,pointLights:n,directionalLights:s})};return i.enabled!==void 0&&(o.enabled=i.enabled?1:0),o}function Z8({ambientLight:i,pointLights:t=[],directionalLights:e=[]}){const n={};n.ambientColor=Lp(i);let s=0;for(const r of t){n.lightType=ec.POINT;const o=s;n[`lightColor${o}`]=Lp(r),n[`lightPosition${o}`]=r.position,n[`lightAttenuation${o}`]=r.attenuation||[1,0,0],s++}for(const r of e){n.lightType=ec.DIRECTIONAL;const o=s;n[`lightColor${o}`]=Lp(r),n[`lightDirection${o}`]=r.direction,s++}return s>X8&&ot.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=e.length,n.pointLightCount=t.length,n}function Q8(i){const t={pointLights:[],directionalLights:[]};for(const e of i||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights?.push(e);break;case"point":t.pointLights?.push(e);break}return t}function Lp(i={}){const{color:t=[0,0,0],intensity:e=1}=i;return t.map(n=>n*e/Y8)}const Rw=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,Pw=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Iw=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Ow={props:{},name:"gouraudMaterial",vs:Pw.replace("phongMaterial","gouraudMaterial"),fs:Rw.replace("phongMaterial","gouraudMaterial"),source:Iw.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[zl],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const t={...i};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...Ow.defaultUniforms,...t}}},Nw={name:"phongMaterial",dependencies:[zl],source:Iw,vs:Rw,fs:Pw,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const t={...i};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...Nw.defaultUniforms,...t}}},l3=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,J8={name:"layer",vs:l3,fs:l3,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},tO=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,eO={name:"color",dependencies:[],source:tO,getUniforms:i=>({}),uniformTypes:{opacity:"f32"}},iO=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Dw="#define SMOOTH_EDGE_RADIUS 0.5",nO=`${Dw}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,sO=`${Dw}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Lw={name:"geometry",source:iO,vs:nO,fs:sO},rO=25;var Pe;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(Pe||(Pe={}));var Ne;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(Ne||(Ne={}));var Rt;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(Rt||(Rt={}));const aO="compute",oO="auto",N0="manipulation",Uh="none",D0="pan-x",L0="pan-y";function lO(i){if(i.includes(Uh))return Uh;const t=i.includes(D0),e=i.includes(L0);return t&&e?Uh:t||e?t?D0:L0:i.includes(N0)?N0:oO}class cO{constructor(t,e){this.actions="",this.manager=t,this.set(e)}set(t){t===aO&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const e of this.manager.recognizers)e.options.enable&&(t=t.concat(e.getTouchAction()));return lO(t.join(" "))}}function gf(i){return i.trim().split(/\s+/g)}function kp(i,t,e){if(i)for(const n of gf(t))i.addEventListener(n,e,!1)}function Bp(i,t,e){if(i)for(const n of gf(t))i.removeEventListener(n,e,!1)}function c3(i){return(i.ownerDocument||i).defaultView}function uO(i,t){let e=i;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function kw(i){const t=i.length;if(t===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let e=0,n=0,s=0;for(;s<t;)e+=i[s].clientX,n+=i[s].clientY,s++;return{x:Math.round(e/t),y:Math.round(n/t)}}function u3(i){const t=[];let e=0;for(;e<i.pointers.length;)t[e]={clientX:Math.round(i.pointers[e].clientX),clientY:Math.round(i.pointers[e].clientY)},e++;return{timeStamp:Date.now(),pointers:t,center:kw(t),deltaX:i.deltaX,deltaY:i.deltaY}}function Bw(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}function h3(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(e*e+n*n)}function hO(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.atan2(n,e)*180/Math.PI}function f3(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.atan2(n,e)*180/Math.PI}function Uw(i,t){return i===t?Ne.None:Math.abs(i)>=Math.abs(t)?i<0?Ne.Left:Ne.Right:t<0?Ne.Up:Ne.Down}function fO(i,t){const e=t.center;let n=i.offsetDelta,s=i.prevDelta;const r=i.prevInput;return(t.eventType===Pe.Start||r?.eventType===Pe.End)&&(s=i.prevDelta={x:r?.deltaX||0,y:r?.deltaY||0},n=i.offsetDelta={x:e.x,y:e.y}),{deltaX:s.x+(e.x-n.x),deltaY:s.y+(e.y-n.y)}}function Fw(i,t,e){return{x:t/i||0,y:e/i||0}}function dO(i,t){return h3(t[0],t[1])/h3(i[0],i[1])}function gO(i,t){return f3(t[1],t[0])-f3(i[1],i[0])}function pO(i,t){const e=i.lastInterval||t,n=t.timeStamp-e.timeStamp;let s,r,o,l;if(t.eventType!==Pe.Cancel&&(n>rO||e.velocity===void 0)){const u=t.deltaX-e.deltaX,f=t.deltaY-e.deltaY,g=Fw(n,u,f);r=g.x,o=g.y,s=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,l=Uw(u,f),i.lastInterval=t}else s=e.velocity,r=e.velocityX,o=e.velocityY,l=e.direction;t.velocity=s,t.velocityX=r,t.velocityY=o,t.direction=l}function _O(i,t){const{session:e}=i,{pointers:n}=t,{length:s}=n;e.firstInput||(e.firstInput=u3(t)),s>1&&!e.firstMultiple?e.firstMultiple=u3(t):s===1&&(e.firstMultiple=!1);const{firstInput:r,firstMultiple:o}=e,l=o?o.center:r.center,u=t.center=kw(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=hO(l,u),t.distance=Bw(l,u);const{deltaX:f,deltaY:g}=fO(e,t);t.deltaX=f,t.deltaY=g,t.offsetDirection=Uw(t.deltaX,t.deltaY);const p=Fw(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,t.scale=o?dO(o.pointers,n):1,t.rotation=o?gO(o.pointers,n):0,t.maxPointers=e.prevInput?t.pointers.length>e.prevInput.maxPointers?t.pointers.length:e.prevInput.maxPointers:t.pointers.length;let _=i.element;return uO(t.srcEvent.target,_)&&(_=t.srcEvent.target),t.target=_,pO(e,t),t}function mO(i,t,e){const n=e.pointers.length,s=e.changedPointers.length,r=t&Pe.Start&&n-s===0,o=t&(Pe.End|Pe.Cancel)&&n-s===0;e.isFirst=!!r,e.isFinal=!!o,r&&(i.session={}),e.eventType=t;const l=_O(i,e);i.emit("hammer.input",l),i.recognize(l),i.session.prevInput=l}let yO=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,e){mO(this.manager,t,e)}init(){kp(this.element,this.evEl,this.domHandler),kp(this.target,this.evTarget,this.domHandler),kp(c3(this.element),this.evWin,this.domHandler)}destroy(){Bp(this.element,this.evEl,this.domHandler),Bp(this.target,this.evTarget,this.domHandler),Bp(c3(this.element),this.evWin,this.domHandler)}};const vO={pointerdown:Pe.Start,pointermove:Pe.Move,pointerup:Pe.End,pointercancel:Pe.Cancel,pointerout:Pe.Cancel},bO="pointerdown",xO="pointermove pointerup pointercancel";class SO extends yO{constructor(t){super(t),this.evEl=bO,this.evWin=xO,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:e}=this;let n=!1;const s=vO[t.type],r=t.pointerType,o=r==="touch";let l=e.findIndex(u=>u.pointerId===t.pointerId);s&Pe.Start&&(t.buttons||o)?l<0&&(e.push(t),l=e.length-1):s&(Pe.End|Pe.Cancel)&&(n=!0),!(l<0)&&(e[l]=t,this.callback(s,{pointers:e,changedPointers:[t],eventType:s,pointerType:r,srcEvent:t}),n&&e.splice(l,1))}}const TO=["","webkit","Moz","MS","ms","o"];function wO(i,t){const e=t[0].toUpperCase()+t.slice(1);for(const n of TO){const s=n?n+e:t;if(s in i)return s}}const EO=1,d3=2,g3={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class AO{constructor(t,e){this.options={...g3,...e,cssProps:{...g3.cssProps,...e.cssProps},inputTarget:e.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new SO(this),this.touchAction=new cO(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?d3:EO}recognize(t){const{session:e}=this;if(e.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let n;const{recognizers:s}=this;let{curRecognizer:r}=e;(!r||r&&r.state&Rt.Recognized)&&(r=e.curRecognizer=null);let o=0;for(;o<s.length;)n=s[o],e.stopped!==d3&&(!r||n===r||n.canRecognizeWith(r))?n.recognize(t):n.reset(),!r&&n.state&(Rt.Began|Rt.Changed|Rt.Ended)&&(r=e.curRecognizer=n),o++}get(t){const{recognizers:e}=this;for(let n=0;n<e.length;n++)if(e[n].options.event===t)return e[n];return null}add(t){if(Array.isArray(t)){for(const n of t)this.add(n);return this}const e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(const n of t)this.remove(n);return this}const e=typeof t=="string"?this.get(t):t;if(e){const{recognizers:n}=this,s=n.indexOf(e);s!==-1&&(n.splice(s,1),this.touchAction.update())}return this}on(t,e){if(!t||!e)return;const{handlers:n}=this;for(const s of gf(t))n[s]=n[s]||[],n[s].push(e)}off(t,e){if(!t)return;const{handlers:n}=this;for(const s of gf(t))e?n[s]&&n[s].splice(n[s].indexOf(e),1):delete n[s]}emit(t,e){const n=this.handlers[t]&&this.handlers[t].slice();if(!n||!n.length)return;const s=e;s.type=t,s.preventDefault=function(){e.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](s),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){const{element:e}=this;if(e){for(const[n,s]of Object.entries(this.options.cssProps)){const r=wO(e.style,n);t?(this.oldCssProps[r]=e.style[r],e.style[r]=s):e.style[r]=this.oldCssProps[r]||""}t||(this.oldCssProps={})}}}let MO=1;function CO(){return MO++}function p3(i){return i&Rt.Cancelled?"cancel":i&Rt.Ended?"end":i&Rt.Changed?"move":i&Rt.Began?"start":""}class zw{constructor(t){this.options=t,this.id=CO(),this.state=Rt.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const s of t)this.recognizeWith(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{simultaneous:n}=this;return n[e.id]||(n[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const n of t)this.dropRecognizeWith(n);return this}let e;return typeof t=="string"?e=this.manager.get(t):e=t,e&&delete this.simultaneous[e.id],this}requireFailure(t){if(Array.isArray(t)){for(const s of t)this.requireFailure(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{requireFail:n}=this;return n.indexOf(e)===-1&&(n.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const n of t)this.dropRequireFailure(n);return this}let e;if(typeof t=="string"?e=this.manager.get(t):e=t,e){const n=this.requireFail.indexOf(e);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:e}=this;e<Rt.Ended&&this.manager.emit(this.options.event+p3(e),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),e>=Rt.Ended&&this.manager.emit(this.options.event+p3(e),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=Rt.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Rt.Failed|Rt.Possible)))return!1;t++}return!0}recognize(t){const e={...t};if(!this.options.enable){this.reset(),this.state=Rt.Failed;return}this.state&(Rt.Recognized|Rt.Cancelled|Rt.Failed)&&(this.state=Rt.Possible),this.state=this.process(e),this.state&(Rt.Began|Rt.Changed|Rt.Ended|Rt.Cancelled)&&this.tryEmit(e)}getEventNames(){return[this.options.event]}reset(){}}class Vw extends zw{attrTest(t){const e=this.options.pointers;return e===0||t.pointers.length===e}process(t){const{state:e}=this,{eventType:n}=t,s=e&(Rt.Began|Rt.Changed),r=this.attrTest(t);return s&&(n&Pe.Cancel||!r)?e|Rt.Cancelled:s||r?n&Pe.End?e|Rt.Ended:e&Rt.Began?e|Rt.Changed:Rt.Began:Rt.Failed}}class _3 extends zw{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[N0]}process(t){const{options:e}=this,n=t.pointers.length===e.pointers,s=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Pe.Start&&this.count===0)return this.failTimeout();if(s&&r&&n){if(t.eventType!==Pe.End)return this.failTimeout();const o=this.pTime?t.timeStamp-this.pTime<e.interval:!0,l=!this.pCenter||Bw(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!l||!o?this.count=1:this.count+=1,this._input=t,this.count%e.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Rt.Recognized,this.tryEmit(this._input)},e.interval),Rt.Began):Rt.Recognized}return Rt.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Rt.Failed},this.options.interval),Rt.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===Rt.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const RO=["","start","move","end","cancel","up","down","left","right"];class m3 extends Vw{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Ne.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,e=[];return t&Ne.Horizontal&&e.push(L0),t&Ne.Vertical&&e.push(D0),e}getEventNames(){return RO.map(t=>this.options.event+t)}directionTest(t){const{options:e}=this;let n=!0,{distance:s}=t,{direction:r}=t;const o=t.deltaX,l=t.deltaY;return r&e.direction||(e.direction&Ne.Horizontal?(r=o===0?Ne.None:o<0?Ne.Left:Ne.Right,n=o!==this.pX,s=Math.abs(t.deltaX)):(r=l===0?Ne.None:l<0?Ne.Up:Ne.Down,n=l!==this.pY,s=Math.abs(t.deltaY))),t.direction=r,n&&s>e.threshold&&!!(r&e.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&Rt.Began)||!(this.state&Rt.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const e=Ne[t.direction].toLowerCase();e&&(t.additionalEvent=this.options.event+e),super.emit(t)}}const PO=["","start","move","end","cancel","in","out"];class IO extends Vw{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[Uh]}getEventNames(){return PO.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&Rt.Began))}emit(t){if(t.scale!==1){const e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}super.emit(t)}}class Df{constructor(t,e,n){this.element=t,this.callback=e,this.options=n}}const OO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",NO=OO.indexOf("firefox")!==-1,y3=4.000244140625,DO=40,LO=.25;class kO extends Df{constructor(t,e,n){super(t,e,{enable:!0,...n}),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;globalThis.WheelEvent&&(NO&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=DO)),r!==0&&r%y3===0&&(r=Math.floor(r/y3)),s.shiftKey&&r&&(r=r*LO),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,e){t==="wheel"&&(this.options.enable=e)}}const v3=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class BO extends Df{constructor(t,e,n){super(t,e,{enable:!0,...n}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,v3.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){v3.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){switch(t){case"pointermove":this.enableMoveEvent=e;break;case"pointerover":this.enableOverEvent=e;break;case"pointerout":this.enableOutEvent=e;break;case"pointerenter":this.enableEnterEvent=e;break;case"pointerleave":this.enableLeaveEvent=e;break}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const b3=["keydown","keyup"];class UO extends Df{constructor(t,e,n){super(t,e,{enable:!0,tabIndex:0,...n}),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",b3.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){b3.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t==="keydown"&&(this.enableDownEvent=e),t==="keyup"&&(this.enableUpEvent=e)}}class FO extends Df{constructor(t,e,n){super(t,e,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t==="contextmenu"&&(this.options.enable=e)}}const x3=1,k0=2,S3=4,zO={pointerdown:x3,pointermove:k0,pointerup:S3,mousedown:x3,mousemove:k0,mouseup:S3},VO=0,jO=1,HO=2,$O=1,GO=2,WO=4;function qO(i){const t=zO[i.srcEvent.type];if(!t)return null;const{buttons:e,button:n}=i.srcEvent;let s=!1,r=!1,o=!1;return t===k0?(s=!!(e&$O),r=!!(e&WO),o=!!(e&GO)):(s=n===VO,r=n===jO,o=n===HO),{leftButton:s,middleButton:r,rightButton:o}}function XO(i,t){const e=i.center;if(!e)return null;const n=t.getBoundingClientRect(),s=n.width/t.offsetWidth||1,r=n.height/t.offsetHeight||1,o={x:(e.x-n.left-t.clientLeft)/s,y:(e.y-n.top-t.clientTop)/r};return{center:e,offsetCenter:o}}const YO={srcElement:"root",priority:0};class KO{constructor(t,e){this.handleEvent=n=>{if(this.isEmpty())return;const s=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==s.rootElement;){if(this._emit(s,r),s.handled)return;r=r.parentNode}this._emit(s,"root")},this.eventManager=t,this.recognizerName=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n,s=!1,r=!1){const{handlers:o,handlersByElement:l}=this,u={...YO,...n};let f=l.get(u.srcElement);f||(f=[],l.set(u.srcElement,f));const g={type:t,handler:e,srcElement:u.srcElement,priority:u.priority};s&&(g.once=!0),r&&(g.passive=!0),o.push(g),this._active=this._active||!g.passive;let p=f.length-1;for(;p>=0&&!(f[p].priority>=g.priority);)p--;f.splice(p+1,0,g)}remove(t,e){const{handlers:n,handlersByElement:s}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===t&&o.handler===e){n.splice(r,1);const l=s.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&s.delete(o.srcElement)}}this._active=n.some(r=>!r.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let s=!1;const r=()=>{t.handled=!0},o=()=>{t.handled=!0,s=!0},l=[];for(let u=0;u<n.length;u++){const{type:f,handler:g,once:p}=n[u];if(g({...t,type:f,stopPropagation:r,stopImmediatePropagation:o}),p&&l.push(n[u]),s)break}for(let u=0;u<l.length;u++){const{type:f,handler:g}=l[u];this.remove(f,g)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...qO(t),...XO(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}function ZO(i){if("recognizer"in i)return i;let t;const e=Array.isArray(i)?[...i]:[i];if(typeof e[0]=="function"){const n=e.shift(),s=e.shift()||{};t=new n(s)}else t=e.shift();return{recognizer:t,recognizeWith:typeof e[0]=="string"?[e[0]]:e[0],requireFailure:typeof e[1]=="string"?[e[1]]:e[1]}}class QO{constructor(t=null,e={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...e},this.events=new Map,this.element=t,!!t){this.manager=new AO(t,this.options);for(const n of this.options.recognizers){const{recognizer:s,recognizeWith:r,requireFailure:o}=ZO(n);this.manager.add(s),r&&s.recognizeWith(r),o&&s.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new kO(t,this._onOtherEvent,{enable:!1}),this.moveInput=new BO(t,this._onOtherEvent,{enable:!1}),this.keyInput=new UO(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new FO(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const s=n.get(t);s&&(s.set({enable:e}),n.touchAction.update()),this.wheelInput?.enableEventType(t,e),this.moveInput?.enableEventType(t,e),this.keyInput?.enableEventType(t,e),this.contextmenuInput?.enableEventType(t,e)}_addEventHandler(t,e,n,s,r){if(typeof t!="string"){n=e;for(const[f,g]of Object.entries(t))this._addEventHandler(f,g,n,s,r);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(t);if(!u){const f=this._getRecognizerName(t)||t;u=new KO(this,f),l.set(t,u),o&&o.on(t,u.handleEvent)}u.add(t,e,n,s,r),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const[r,o]of Object.entries(t))this._removeEventHandler(r,o);return}const{events:n}=this,s=n.get(t);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:r}=s;let o=!1;for(const l of n.values())if(l.recognizerName===r&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(r,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(e=>e.getEventNames().includes(t))?.options.event}}const Ft={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ft,"IDENTITY",{get:()=>(Lt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ri={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ts={common:0,meters:1,pixels:2},B0={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},T3={multipan:[m3,{threshold:10,direction:Ne.Vertical,pointers:2}],pinch:[IO,{},null,["multipan"]],pan:[m3,{threshold:1},["pinch"],["multipan"]],dblclick:[_3,{event:"dblclick",taps:2}],click:[_3,{event:"click"},null,["dblclick"]]};function JO(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}return!1}function yc(i){let t={},e;return n=>{for(const s in n)if(!JO(n[s],t[s])){e=i(n),t=n;break}return e}}const w3=[0,0,0,0],tN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],jw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],eN=[0,0,0],Hw=[0,0,0],iN=yc(rN);function $w(i,t,e=Hw){e.length<3&&(e=[e[0],e[1],0]);let n=e,s,r=!0;switch(t===Ft.LNGLAT_OFFSETS||t===Ft.METER_OFFSETS?s=e:s=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Ri.WEB_MERCATOR:(t===Ft.LNGLAT||t===Ft.CARTESIAN)&&(s=[0,0,0],r=!1);break;case Ri.WEB_MERCATOR_AUTO_OFFSET:t===Ft.LNGLAT?n=s:t===Ft.CARTESIAN&&(n=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],s=i.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case Ri.IDENTITY:n=i.position.map(Math.fround),n[2]=n[2]||0;break;case Ri.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:r}}function nN(i,t,e){const{viewMatrixUncentered:n,projectionMatrix:s}=i;let{viewMatrix:r,viewProjectionMatrix:o}=i,l=w3,u=w3,f=i.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:p,offsetMode:_}=$w(i,t,e);return _&&(u=i.projectPosition(g||p),f=[f[0]-u[0],f[1]-u[1],f[2]-u[2]],u[3]=1,l=ho([],u,o),r=n||r,o=Cr([],s,r),o=Cr([],o,tN)),{viewMatrix:r,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:f,shaderCoordinateOrigin:p,geospatialOrigin:g}}function sN({viewport:i,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:n=Ft.DEFAULT,coordinateOrigin:s=Hw,autoWrapLongitude:r=!1}){n===Ft.DEFAULT&&(n=i.isGeospatial?Ft.LNGLAT:Ft.CARTESIAN);const o=iN({viewport:i,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:s});return o.wrapLongitude=r,o.modelMatrix=e||jw,o}function rN({viewport:i,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:f}=nN(i,e,n),g=i.getDistanceScales(),p=[i.width*t,i.height*t],_=ho([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,v={coordinateSystem:e,projectionMode:i.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:s,pseudoMeters:!!i._pseudoMeters,viewportSize:p,devicePixelRatio:t,focalDistance:_,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:eN,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:r,modelMatrix:jw,cameraPosition:l};if(f){const b=i.getDistanceScales(f);switch(e){case Ft.METER_OFFSETS:v.commonUnitsPerWorldUnit=b.unitsPerMeter,v.commonUnitsPerWorldUnit2=b.unitsPerMeter2;break;case Ft.LNGLAT:case Ft.LNGLAT_OFFSETS:i._pseudoMeters||(v.commonUnitsPerMeter=b.unitsPerMeter),v.commonUnitsPerWorldUnit=b.unitsPerDegree,v.commonUnitsPerWorldUnit2=b.unitsPerDegree2;break;case Ft.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,b.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,b.unitsPerMeter2[2]];break}}return v}const aN=Object.keys(Ft).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${Ft[i]};`).join(""),oN=Object.keys(Ri).map(i=>`const PROJECTION_MODE_${i}: i32 = ${Ri[i]};`).join(""),lN=Object.keys(ts).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${ts[i]};`).join(""),cN=`${aN}
${oN}
${lN}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,uN=`${cN}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,hN=Object.keys(Ft).map(i=>`const int COORDINATE_SYSTEM_${i} = ${Ft[i]};`).join(""),fN=Object.keys(Ri).map(i=>`const int PROJECTION_MODE_${i} = ${Ri[i]};`).join(""),dN=Object.keys(ts).map(i=>`const int UNIT_${i.toUpperCase()} = ${ts[i]};`).join(""),gN=`${hN}
${fN}
${dN}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,pN={};function _N(i=pN){return"viewport"in i?sN(i):{}}const J_={name:"project",dependencies:[F8,Lw],source:uN,vs:gN,getUniforms:_N,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},mN=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,yN=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,fo={name:"project32",dependencies:[J_],source:mN,vs:yN};function vN(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Za(i,t){const e=ho([],t,i);return Q_(e,e,1/e[3]),e}function E3(i,t){const e=i%t;return e<0?t+e:e}function U0(i,t,e){return i<t?t:i>e?e:i}function bN(i){return Math.log(i)*Math.LOG2E}const tm=Math.log2||bN;function es(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Ji=Math.PI,Gw=Ji/4,Hi=Ji/180,F0=180/Ji,so=512,pf=4003e4,Tn=85.051129,xN=1.5;function SN(i){return tm(i)}function is(i){const[t,e]=i;es(Number.isFinite(t)),es(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Hi,s=e*Hi,r=so*(n+Ji)/(2*Ji),o=so*(Ji+Math.log(Math.tan(Gw+s*.5)))/(2*Ji);return[r,o]}function kr(i){const[t,e]=i,n=t/so*(2*Ji)-Ji,s=2*(Math.atan(Math.exp(e/so*(2*Ji)-Ji))-Gw);return[n*F0,s*F0]}function TN(i){const{latitude:t}=i;es(Number.isFinite(t));const e=Math.cos(t*Hi);return SN(pf*e)-9}function Fh(i){const t=Math.cos(i*Hi);return so/pf/t}function z0(i){const{latitude:t,longitude:e,highPrecision:n=!1}=i;es(Number.isFinite(t)&&Number.isFinite(e));const s=so,r=Math.cos(t*Hi),o=s/360,l=o/r,u=s/pf/r,f={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(n){const g=Hi*Math.tan(t*Hi)/r,p=o*g/2,_=s/pf*g,v=_/l*u;f.unitsPerDegree2=[0,p,_],f.unitsPerMeter2=[v,0,v]}return f}function Ww(i,t){const[e,n,s]=i,[r,o,l]=t,{unitsPerMeter:u,unitsPerMeter2:f}=z0({longitude:e,latitude:n,highPrecision:!0}),g=is(i);g[0]+=r*(u[0]+f[0]*o),g[1]+=o*(u[1]+f[1]*o);const p=kr(g),_=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[p[0],p[1],_]:p}function wN(i){const{height:t,pitch:e,bearing:n,altitude:s,scale:r,center:o}=i,l=vN();df(l,l,[0,0,-s]),Tw(l,l,-e*Hi),ww(l,l,n*Hi);const u=r/t;return Z_(l,l,[u,u,u]),o&&df(l,l,RI([],o)),l}function EN(i){const{width:t,height:e,altitude:n,pitch:s=0,offset:r,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:f=1}=i;let{fovy:g=ic(xN)}=i;n!==void 0&&(g=ic(n));const p=g*Hi,_=s*Hi,v=em(g);let b=v;o&&(b+=o[2]*l/Math.cos(_)/e);const x=p*(.5+(r?r[1]:0)/e),T=Math.sin(x)*b/Math.sin(U0(Math.PI/2-_-x,.01,Math.PI-.01)),w=Math.sin(_)*T+b,M=b*10,E=Math.min(w*f,M);return{fov:p,aspect:t/e,focalDistance:v,near:u,far:E}}function ic(i){return 2*Math.atan(.5/i)*F0}function em(i){return .5/Math.tan(.5*i*Hi)}function qw(i,t){const[e,n,s=0]=i;return es(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(s)),Za(t,[e,n,s,1])}function im(i,t,e=0){const[n,s,r]=i;if(es(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return Za(t,[n,s,r,1]);const o=Za(t,[n,s,0,1]),l=Za(t,[n,s,1,1]),u=o[2],f=l[2],g=u===f?0:((e||0)-u)/(f-u);return dw([],o,l,g)}function AN(i){const{width:t,height:e,bounds:n,minExtent:s=0,maxZoom:r=24,offset:o=[0,0]}=i,[[l,u],[f,g]]=n,p=MN(i.padding),_=is([l,U0(g,-Tn,Tn)]),v=is([f,U0(u,-Tn,Tn)]),b=[Math.max(Math.abs(v[0]-_[0]),s),Math.max(Math.abs(v[1]-_[1]),s)],x=[t-p.left-p.right-Math.abs(o[0])*2,e-p.top-p.bottom-Math.abs(o[1])*2];es(x[0]>0&&x[1]>0);const T=x[0]/b[0],w=x[1]/b[1],M=(p.right-p.left)/2/T,E=(p.top-p.bottom)/2/w,P=[(v[0]+_[0])/2+M,(v[1]+_[1])/2+E],k=kr(P),U=Math.min(r,tm(Math.abs(Math.min(T,w))));return es(Number.isFinite(U)),{longitude:k[0],latitude:k[1],zoom:U}}function MN(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(es(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const A3=Math.PI/180;function CN(i,t=0){const{width:e,height:n,unproject:s}=i,r={targetZ:t},o=s([0,n],r),l=s([e,n],r);let u,f;const g=i.fovy?.5*i.fovy*A3:Math.atan(.5/i.altitude),p=(90-i.pitch)*A3;return g>p-.01?(u=M3(i,0,t),f=M3(i,e,t)):(u=s([0,0],r),f=s([e,0],r)),[o,l,f,u]}function M3(i,t,e){const{pixelUnprojectionMatrix:n}=i,s=Za(n,[t,0,1,1]),r=Za(n,[t,i.height,1,1]),l=(e*i.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),u=dw([],s,r,l),f=kr(u);return f.push(e),f}const C3=512;function RN(i){const{width:t,height:e,pitch:n=0}=i;let{longitude:s,latitude:r,zoom:o,bearing:l=0}=i;(s<-180||s>180)&&(s=E3(s+180,360)-180),(l<-180||l>180)&&(l=E3(l+180,360)-180);const u=tm(e/C3);if(o<=u)o=u,r=0;else{const f=e/2/Math.pow(2,o),g=kr([0,f])[1];if(r<g)r=g;else{const p=kr([0,C3-f])[1];r>p&&(r=p)}}return{width:t,height:e,longitude:s,latitude:r,zoom:o,pitch:n,bearing:l}}const Xw=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,PN=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,IN=`
${Xw}
${PN}
`,ON=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,NN=`
${Xw}
${ON}
`,DN=yc(FN),LN=yc(zN),kN=[0,0,0,1],BN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function UN(i,t){const[e,n,s]=i,r=im([e,n,s],t);return Number.isFinite(s)?r:[r[0],r[1],0]}function FN({viewport:i,center:t}){return new He(i.viewProjectionMatrix).invert().transform(t)}function zN({viewport:i,shadowMatrices:t}){const e=[],n=i.pixelUnprojectionMatrix,s=i.isGeospatial?void 0:1,r=[[0,0,s],[i.width,0,s],[0,i.height,s],[i.width,i.height,s],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(o=>UN(o,n));for(const o of t){const l=o.clone().translate(new yt(i.center).negate()),u=r.map(g=>l.transform(g)),f=new He().ortho({left:Math.min(...u.map(g=>g[0])),right:Math.max(...u.map(g=>g[0])),bottom:Math.min(...u.map(g=>g[1])),top:Math.max(...u.map(g=>g[1])),near:Math.min(...u.map(g=>-g[2])),far:Math.max(...u.map(g=>-g[2]))});e.push(f.multiplyRight(o))}return e}function VN(i){const{shadowEnabled:t=!0,project:e}=i;if(!t||!e||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const n=J_.getUniforms(e),s=DN({viewport:e.viewport,center:n.center}),r=[],o=LN({shadowMatrices:i.shadowMatrices,viewport:e.viewport}).slice();for(let u=0;u<i.shadowMatrices.length;u++){const f=o[u],g=f.clone().translate(new yt(e.viewport.center).negate());n.coordinateSystem===Ft.LNGLAT&&n.projectionMode===Ri.WEB_MERCATOR?(o[u]=g,r[u]=s):(o[u]=f.clone().multiplyRight(BN),r[u]=g.transform(s))}const l={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||kN,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=r[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=i.shadowMaps&&i.shadowMaps[u]||i.dummyShadowMap;return l}const R3={name:"shadow",dependencies:[J_],vs:IN,fs:NN,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:VN,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},go={...a3,defaultUniforms:{...a3.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},jN=[Lw],HN=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],$N=[];function GN(i){const t=Tr.getDefaultShaderAssembler();for(const n of jN)t.addDefaultModule(n);t._hookFunctions.length=0;const e=i==="glsl"?HN:$N;for(const n of e)t.addShaderHook(n);return t}const WN=[255,255,255],qN=1;let XN=0;class YN{constructor(t={}){this.type="ambient";const{color:e=WN}=t,{intensity:n=qN}=t;this.id=t.id||`ambient-${XN++}`,this.color=e,this.intensity=n}}const KN=[255,255,255],ZN=1,QN=[0,0,-1];let JN=0;class P3{constructor(t={}){this.type="directional";const{color:e=KN}=t,{intensity:n=ZN}=t,{direction:s=QN}=t,{_shadow:r=!1}=t;this.id=t.id||`directional-${JN++}`,this.color=e,this.intensity=n,this.type="directional",this.direction=new yt(s).normalize().toArray(),this.shadow=r}getProjectedLight(t){return this}}class tD{constructor(t,e={id:"pass"}){const{id:n}=e;this.id=n,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class nm extends tD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,n]=this.device.canvasContext.getDrawingBufferSize(),s=t.clearCanvas??!0,r=t.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,l=s?0:!1,u=t.colorMask??15,f={viewport:[0,0,e,n]};t.colorMask&&(f.colorMask=u),t.scissorRect&&(f.scissorRect=t.scissorRect);const g=this.device.beginRenderPass({framebuffer:t.target,parameters:f,clearColor:r,clearDepth:o,clearStencil:l});try{return this._drawLayers(g,t)}finally{g.end(),this.device.submit()}}_drawLayers(t,e){const{target:n,shaderModuleProps:s,viewports:r,views:o,onViewportActive:l,clearStack:u=!0}=e;e.pass=e.pass||"unknown",u&&(this._lastRenderIndex=-1);const f=[];for(const g of r){const p=o&&o[g.id];l?.(g);const _=this._getDrawLayerParams(g,e),v=g.subViewports||[g];for(const b of v){const x=this._drawLayersInViewport(t,{target:n,shaderModuleProps:s,viewport:b,view:p,pass:e.pass,layers:e.layers},_);f.push(x)}}return f}_getDrawLayerParams(t,{layers:e,pass:n,isPicking:s=!1,layerFilter:r,cullRect:o,effects:l,shaderModuleProps:u},f=!1){const g=[],p=Yw(this._lastRenderIndex+1),_={layer:e[0],viewport:t,isPicking:s,renderPass:n,cullRect:o},v={};for(let b=0;b<e.length;b++){const x=e[b],T=this._shouldDrawLayer(x,_,r,v),w={shouldDrawLayer:T};T&&!f&&(w.shouldDrawLayer=!0,w.layerRenderIndex=p(x,T),w.shaderModuleProps=this._getShaderModuleProps(x,l,n,u),w.layerParameters={...x.context.deck?.props.parameters,...this.getLayerParameters(x,b,t)}),g[b]=w}return g}_drawLayersInViewport(t,{layers:e,shaderModuleProps:n,pass:s,target:r,viewport:o,view:l},u){const f=eD(this.device,{shaderModuleProps:n,target:r,viewport:o});if(l){const{clear:p,clearColor:_,clearDepth:v,clearStencil:b}=l.props;if(p){let x=[0,0,0,0],T=1,w=0;Array.isArray(_)?x=[..._.slice(0,3),_[3]||255].map(E=>E/255):_===!1&&(x=!1),v!==void 0&&(T=v),b!==void 0&&(w=b),this.device.beginRenderPass({framebuffer:r,parameters:{viewport:f,scissorRect:f},clearColor:x,clearDepth:T,clearStencil:w}).end()}}const g={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:f});for(let p=0;p<e.length;p++){const _=e[p],v=u[p],{shouldDrawLayer:b}=v;if(b&&_.props.pickable&&g.pickableCount++,_.isComposite&&g.compositeCount++,_.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:x,shaderModuleProps:T,layerParameters:w}=v;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,x),T.project&&(T.project.viewport=o),_.context.renderPass=t;try{_._drawLayer({renderPass:t,shaderModuleProps:T,uniforms:{layerIndex:x},parameters:w})}catch(M){_.raiseError(M,`drawing ${_} to ${s}`)}}}return g}shouldDrawLayer(t){return!0}getShaderModuleProps(t,e,n){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let o=t.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(e))return!1;e.layer=o,o=o.parent}if(n){const l=e.layer.id;if(l in s||(s[l]=n(e)),!s[l])return!1}return t.activateViewport(e.viewport),!0}_getShaderModuleProps(t,e,n,s){const r=this.device.canvasContext.cssToDeviceRatio(),o=t.internalState?.propsInTransition||t.props,l={layer:o,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:r,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(e)for(const u of e)I3(l,u.getShaderModuleProps?.(t,l));return I3(l,this.getShaderModuleProps(t,e,l),s)}}function Yw(i=0,t={}){const e={},n=(s,r)=>{const o=s.props._offset,l=s.id,u=s.parent&&s.parent.id;let f;if(u&&!(u in t)&&n(s.parent,!1),u in e){const g=e[u]=e[u]||Yw(t[u],t);f=g(s,r),e[l]=g}else Number.isFinite(o)?(f=o+(t[u]||0),e[l]=null):f=i;return r&&f>=i&&(i=f+1),t[l]=f,f};return n}function eD(i,{shaderModuleProps:t,target:e,viewport:n}){const s=t?.project?.devicePixelRatio??i.canvasContext.cssToDeviceRatio(),[,r]=i.canvasContext.getDrawingBufferSize(),o=e?e.height:r,l=n;return[l.x*s,o-(l.y+l.height)*s,l.width*s,l.height*s]}function I3(i,...t){for(const e of t)if(e)for(const n in e)i[n]?Object.assign(i[n],e[n]):i[n]=e[n];return i}class iD extends nm{constructor(t,e){super(t,e);const n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=t.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const e=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=t.viewports[0],r=s.width*n,o=s.height*n,l=[1,1,1,1];(r!==e.width||o!==e.height)&&e.resize({width:r,height:o}),super.render({...t,clearColor:l,target:e,pass:"shadow"})}getLayerParameters(t,e,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,e,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const nD={color:[255,255,255],intensity:1},O3=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],sD=[0,0,0,200/255];class Kw{constructor(t={}){this.id="lighting-effect",this.shadowColor=sD,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),n._addDefaultShaderModule(R3),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:n,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:e,viewports:n,onViewportActive:s,views:r,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,e){const n=this.shadow?{project:e.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:t})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:t}))},r=t.props.material;return{shadow:n,lighting:s,phongMaterial:r,gouraudMaterial:r}}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(R3))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new He().lookAt({eye:new yt(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new iD(t);this.shadowPasses[e]=n}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new YN(nD),this.directionalLights.push(new P3(O3[0]),new P3(O3[1])))}}class rD{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:n=1,type:s,padding:r=0,copy:o=!1,initialize:l=!1,maxCount:u}){const f=s||t&&t.constructor||Float32Array,g=e*n+r;if(ArrayBuffer.isView(t)){if(g<=t.length)return t;if(g*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new f(t.buffer,0,g)}let p=1/0;u&&(p=u*n+r);const _=this._allocate(f,g,l,p);return t&&o?_.set(t):l||_.fill(0,0,4),this._release(t),_}release(t){this._release(t)}_allocate(t,e,n,s){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>s&&(r=s);const o=this._pool,l=t.BYTES_PER_ELEMENT*r,u=o.findIndex(f=>f.byteLength>=l);if(u>=0){const f=new t(o.splice(u,1)[0],0,r);return n&&f.fill(0),f}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:s}=n,r=e.findIndex(o=>o.byteLength>=s);r<0?e.push(n):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,n),e.length>this.opts.poolSize&&e.shift()}}const ro=new rD;function Ml(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aD(i,t){const e=i%t;return e<0?t+e:e}function oD(i){return[i[12],i[13],i[14]]}function lD(i){return{left:Oa(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:Oa(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:Oa(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:Oa(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:Oa(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:Oa(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const N3=new yt;function Oa(i,t,e,n){N3.set(i,t,e);const s=N3.len();return{distance:n/s,normal:new yt(-i/s,-t/s,-e/s)}}function cD(i){return i-Math.fround(i)}let yl;function Up(i,t){const{size:e=1,startIndex:n=0}=t,s=t.endIndex!==void 0?t.endIndex:i.length,r=(s-n)/e;yl=ro.allocate(yl,r,{type:Float32Array,size:e*2});let o=n,l=0;for(;o<s;){for(let u=0;u<e;u++){const f=i[o++];yl[l+u]=f,yl[l+u+e]=cD(f)}l+=e*2}return yl.subarray(0,r*e*2)}function uD(i){let t=null,e=!1;for(const n of i)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const hD=Math.PI/180,fD=Ml(),D3=[0,0,0],dD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function gD({width:i,height:t,orthographic:e,fovyRadians:n,focalDistance:s,padding:r,near:o,far:l}){const u=i/t,f=e?new He().orthographic({fovy:n,aspect:u,focalDistance:s,near:o,far:l}):new He().perspective({fovy:n,aspect:u,near:o,far:l});if(r){const{left:g=0,right:p=0,top:_=0,bottom:v=0}=r,b=Sn((g+i-p)/2,0,i)-i/2,x=Sn((_+t-v)/2,0,t)-t/2;f[8]-=b*2/i,f[9]+=x*2/t}return f}class po{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||dD,this.focalDistance=t.focalDistance||1,this.position=t.position||D3,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ri.WEB_MERCATOR:Ri.WEB_MERCATOR_AUTO_OFFSET:Ri.IDENTITY}equals(t){return t instanceof po?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Qn(t.projectionMatrix,this.projectionMatrix)&&Qn(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const n=this.projectPosition(t),s=qw(n,this.pixelProjectionMatrix),[r,o]=s,l=e?o:this.height-o;return t.length===2?[r,l]:[r,l,s[2]]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[s,r,o]=t,l=e?r:this.height-r,u=n&&n*this.distanceScales.unitsPerMeter[2],f=im([s,l,o],this.pixelUnprojectionMatrix,u),[g,p,_]=this.unprojectPosition(f);return Number.isFinite(o)?[g,p,_]:Number.isFinite(n)?[g,p,n]:[g,p]}projectPosition(t){const[e,n]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,s]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,s]}projectFlat(t){if(this.isGeospatial){const e=is(t);return e[1]=Sn(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?kr(t):t}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,0],e),s=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),o=this.unproject([this.width,this.height],e);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?z0({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:n=1,height:s=1}){return t<this.x+this.width&&this.x<t+n&&e<this.y+this.height&&this.y<e+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,lD(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e,n){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=TN({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||z0({latitude:n,longitude:e}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:o}=t;let l=D3;if(r&&(l=o?new He(o).transformAsVector(r,[]):r),this.isGeospatial){const u=this.projectPosition([e,n,0]);this.center=new yt(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=fD,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:r,fovy:o=75,near:l=.1,far:u=1e3,padding:f=null,focalDistance:g=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new He().multiplyRight(e).translate(new yt(this.center).negate()),this.projectionMatrix=n||gD({width:this.width,height:this.height,orthographic:s,fovyRadians:r||o*hD,focalDistance:g,padding:f,near:l,far:u});const p=Ml();Cr(p,p,this.projectionMatrix),Cr(p,p,this.viewMatrix),this.viewProjectionMatrix=p,this.viewMatrixInverse=I0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=oD(this.viewMatrixInverse);const _=Ml(),v=Ml();Z_(_,_,[this.width/2,-this.height/2,1]),df(_,_,[1,-1,0]),Cr(v,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=I0(Ml(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Lt.warn("Pixel project matrix not invertible")()}}po.displayName="Viewport";class ns extends po{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:s=0,pitch:r=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:f,farZ:g,orthographic:p=!1,projectionMatrix:_,repeat:v=!1,worldOffset:b=0,position:x,padding:T,legacyMeterSizes:w=!1}=t;let{width:M,height:E,altitude:P=1.5}=t;const k=Math.pow(2,s);M=M||1,E=E||1;let U,Y=null;if(_)P=_[5]/2,U=ic(P);else{t.fovy?(U=t.fovy,P=em(U)):U=ic(P);let K;if(T){const{top:ut=0,bottom:ht=0}=T;K=[0,Sn((ut+E-ht)/2,0,E)-E/2]}Y=EN({width:M,height:E,scale:k,center:x&&[0,0,x[2]*Fh(e)],offset:K,pitch:r,fovy:U,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(f)&&(Y.near=f),Number.isFinite(g)&&(Y.far=g)}let et=wN({height:E,pitch:r,bearing:o,scale:k,altitude:P});b&&(et=new He().translate([512*b,0,0]).multiplyLeft(et)),super({...t,width:M,height:E,viewMatrix:et,longitude:n,latitude:e,zoom:s,...Y,fovy:U,focalDistance:P}),this.latitude=e,this.longitude=n,this.zoom=s,this.pitch=r,this.bearing=o,this.altitude=P,this.fovy=U,this.orthographic=p,this._subViewports=v?[]:null,this._pseudoMeters=w,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let s=e;s<=n;s++){const r=s?new ns({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),s=(t[2]||0)*Fh(t[1]);return[e,n,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),s=(t[2]||0)/Fh(n);return[e,n,s]}addMetersToLngLat(t,e){return Ww(t,e)}panByPosition(t,e,n){const s=im(e,this.pixelUnprojectionMatrix),r=this.projectFlat(t),o=Qb([],r,bI([],s)),l=Qb([],this.center,o),[u,f]=this.unprojectFlat(l);return{longitude:u,latitude:f}}getBounds(t={}){const e=CN(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:n,height:s}=this,{longitude:r,latitude:o,zoom:l}=AN({width:n,height:s,bounds:t,...e});return new ns({width:n,height:s,longitude:r,latitude:o,zoom:l})}}ns.displayName="WebMercatorViewport";const L3=[0,0,0];function Fp(i,t,e=!1){const n=t.projectPosition(i);if(e&&t instanceof ns){const[s,r,o=0]=i,l=t.getDistanceScales([s,r]);n[2]=o*l.unitsPerMeter[2]}return n}function pD(i){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=i;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:o}=i;return s===Ft.DEFAULT&&(s=t.isGeospatial?Ft.LNGLAT:Ft.CARTESIAN),r===void 0&&(r=s),o===void 0&&(o=n),{viewport:t,coordinateSystem:s,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:r,fromCoordinateOrigin:o}}function Zw(i,{viewport:t,modelMatrix:e,coordinateSystem:n,coordinateOrigin:s,offsetMode:r}){let[o,l,u=0]=i;switch(e&&([o,l,u]=ho([],[o,l,u,1],e)),n){case Ft.LNGLAT:return Fp([o,l,u],t,r);case Ft.LNGLAT_OFFSETS:return Fp([o+s[0],l+s[1],u+(s[2]||0)],t,r);case Ft.METER_OFFSETS:return Fp(Ww(s,[o,l,u]),t,r);case Ft.CARTESIAN:default:return t.isGeospatial?[o+s[0],l+s[1],u+s[2]]:t.projectPosition([o,l,u])}}function _D(i,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:l}=pD(t),{autoOffset:u=!0}=t,{geospatialOrigin:f=L3,shaderCoordinateOrigin:g=L3,offsetMode:p=!1}=u?$w(e,n,s):{},_=Zw(i,{viewport:e,modelMatrix:r,coordinateSystem:o,coordinateOrigin:l,offsetMode:p});if(p){const v=e.projectPosition(f||g);bw(_,_,v)}return _}let mD=1,yD=1;class Qw{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=t,o=mD++,l={time:0,delay:e,duration:n,rate:s,repeat:r};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:r,channel:o}=s;r.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=yD++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,s=t.duration*t.repeat;n>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}function vD(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function bD(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let xD=0;class sm{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:A0.stats.get(`animation-loop-${xD++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...sm.defaultAnimationLoopProps,...t},t=this.props,!t.device)throw new Error("No device provided");this.stats=t.stats||new pc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(t){this.props.onError(t),this._error=t}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=vD(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(bD(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const t=this.device?.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const e=t?.canvas,n=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:e,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const zp={};function vc(i="id"){zp[i]=zp[i]||1;const t=zp[i]++;return`${i}-${t}`}class k3{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||vc("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&fe.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function SD(i,t){if(t instanceof k3)return t;const e=TD(i,t),{attributes:n,bufferLayout:s}=wD(i,t);return new k3({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:e,attributes:n})}function TD(i,t){if(!t.indices)return;const e=t.indices.value;return i.createBuffer({usage:fe.INDEX,data:e})}function wD(i,t){const e=[],n={};for(const[r,o]of Object.entries(t.attributes)){let l=r;switch(r){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){n[l]=i.createBuffer({data:o.value,id:`${r}-buffer`});const{value:u,size:f,normalized:g}=o;e.push({name:l,format:U6(u,f,g)})}}const s=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:e,vertexCount:s}}class rm{static defaultProps={...Mr.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new rm(t),t._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cachePipelines,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=t.props.debugFactories}createRenderPipeline(t){if(!this.cachingEnabled)return this.device.createRenderPipeline(t);const e={...Mr.defaultProps,...t},n=this._renderPipelineCache,s=this._hashRenderPipeline(e);let r=n[s]?.pipeline;return r?(n[s].useCount++,this.debug&&ot.log(3,`${this}: ${n[s].pipeline} reused, count=${n[s].useCount}, (id=${t.id})`)()):(r=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:vc("unnamed-cached")}),r.hash=s,n[s]={pipeline:r,useCount:1},this.debug&&ot.log(3,`${this}: ${r} created, count=${n[s].useCount}`)()),r}createComputePipeline(t){if(!this.cachingEnabled)return this.device.createComputePipeline(t);const e={...rf.defaultProps,...t},n=this._computePipelineCache,s=this._hashComputePipeline(e);let r=n[s]?.pipeline;return r?(n[s].useCount++,this.debug&&ot.log(3,`${this}: ${n[s].pipeline} reused, count=${n[s].useCount}, (id=${t.id})`)()):(r=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0}),r.hash=s,n[s]={pipeline:r,useCount:1},this.debug&&ot.log(3,`${this}: ${r} created, count=${n[s].useCount}`)()),r}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._getCache(t),n=t.hash;e[n].useCount--,e[n].useCount===0?(this._destroyPipeline(t),this.debug&&ot.log(3,`${this}: ${t} released and destroyed`)()):e[n].useCount<0?(ot.error(`${this}: ${t} released, useCount < 0, resetting`)(),e[n].useCount=0):this.debug&&ot.log(3,`${this}: ${t} released, count=${e[n].useCount}`)()}_destroyPipeline(t){const e=this._getCache(t);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete e[t.hash],t.destroy(),!0}}_getCache(t){let e;if(t instanceof rf&&(e=this._computePipelineCache),t instanceof Mr&&(e=this._renderPipelineCache),!e)throw new Error(`${this}`);if(!e[t.hash])throw new Error(`${this}: ${t} matched incorrect entry`);return e}_hashComputePipeline(t){const{type:e}=this.device,n=this._getHash(t.shader.source);return`${e}/C/${n}`}_hashRenderPipeline(t){const e=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,s="-",r=this._getHash(JSON.stringify(t.bufferLayout)),{type:o}=this.device;if(o==="webgl")return`${o}/R/${e}/${n}V${s}BL${r}`;{const l=this._getHash(JSON.stringify(t.parameters));return`${o}/R/${e}/${n}V${s}T${t.topology}P${l}BL${r}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class am{static defaultProps={...Of.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new am(t),t._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cacheShaders,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=!0}createShader(t){if(!this.cachingEnabled)return this.device.createShader(t);const e=this._hashShader(t);let n=this._cache[e];if(n)n.useCount++,this.debug&&ot.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const s=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=n={shader:s,useCount:1},this.debug&&ot.log(3,`${this}: Created new shader ${s.id}`)()}return n.shader}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._hashShader(t),n=this._cache[e];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[e],n.shader.destroy(),this.debug&&ot.log(3,`${this}: Releasing shader ${t.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${t.id} released too many times`);this.debug&&ot.log(3,`${this}: Releasing shader ${t.id} count=${n.useCount}`)()}}_hashShader(t){return`${t.stage}:${t.source}`}}function ED(i,t){const e={},n="Values";if(i.attributes.length===0&&!i.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const s of i.attributes)if(s){const r=`${s.location} ${s.name}: ${s.type}`;e[`in ${r}`]={[n]:s.stepMode||"vertex"}}for(const s of i.varyings||[]){const r=`${s.location} ${s.name}`;e[`out ${r}`]={[n]:JSON.stringify(s)}}return e}let ke=null,Vp=null;function AD(i,{id:t,minimap:e,opaque:n,top:s="0",left:r="0",rgbaScale:o=1}){ke||(ke=document.createElement("canvas"),ke.id=t,ke.title=t,ke.style.zIndex="100",ke.style.position="absolute",ke.style.top=s,ke.style.left=r,ke.style.border="blue 5px solid",ke.style.transform="scaleY(-1)",document.body.appendChild(ke),Vp=ke.getContext("2d")),(ke.width!==i.width||ke.height!==i.height)&&(ke.width=i.width/2,ke.height=i.height/2,ke.style.width="400px",ke.style.height="400px");const l=i.device.readPixelsToArrayWebGL(i),u=Vp?.createImageData(i.width,i.height);if(u){for(let g=0;g<l.length;g+=4)u.data[0+g+0]=l[g+0]*o,u.data[0+g+1]=l[g+1]*o,u.data[0+g+2]=l[g+2]*o,u.data[0+g+3]=n?255:l[g+3]*o;Vp?.putImageData(u,0,0)}}function V0(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!V0(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),s=Object.keys(t);if(n.length!==s.length)return!1;for(const r of n)if(!t.hasOwnProperty(r)||!V0(i[r],t[r],e-1))return!1;return!0}return!1}class jp{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(e=>e.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}mergeBufferLayouts(t,e){const n=[...t];for(const s of e){const r=n.findIndex(o=>o.name===s.name);r<0?n.push(s):n[r]=s}return n}getBufferIndex(t){const e=this.bufferLayouts.findIndex(n=>n.name===t);return e===-1&&ot.warn(`BufferLayout: Missing buffer for "${t}".`)(),e}}function MD(i,t){const e=Object.fromEntries(i.attributes.map(s=>[s.name,s.location])),n=t.slice();return n.sort((s,r)=>{const o=s.attributes?s.attributes.map(g=>g.attribute):[s.name],l=r.attributes?r.attributes.map(g=>g.attribute):[r.name],u=Math.min(...o.map(g=>e[g])),f=Math.min(...l.map(g=>e[g]));return u-f}),n}function CD(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function RD(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function PD(i){return CD(i)||RD(i)}function ID(i){return PD(i)||typeof i=="number"||typeof i=="boolean"}function OD(i){const t={bindings:{},uniforms:{}};return Object.keys(i).forEach(e=>{const n=i[e];ID(n)?t.uniforms[e]=n:t.bindings[e]=n}),t}class ND{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,e){Object.assign(this.options,e);const n=R_(Object.values(t).filter(s=>s.dependencies));for(const s of n)t[s.name]=s;ot.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(t))this._addModule(r),r.name&&s!==r.name&&!this.options.disableWarnings&&ot.warn(`Module name: ${s} vs ${r.name}`)()}destroy(){}setProps(t){for(const e of Object.keys(t)){const n=e,s=t[n]||{},r=this.modules[n];if(!r){this.options.disableWarnings||ot.warn(`Module ${e} not found`)();continue}const o=this.moduleUniforms[n],l=this.moduleBindings[n],u=r.getUniforms?.(s,o)||s,{uniforms:f,bindings:g}=OD(u);this.moduleUniforms[n]={...o,...f},this.moduleBindings[n]={...l,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){const t={};for(const[e,n]of Object.entries(this.moduleUniforms))for(const[s,r]of Object.entries(n))t[`${e}.${s}`]={type:this.modules[e].uniformTypes?.[s],value:String(r)};return t}_addModule(t){const e=t.name;this.moduleUniforms[e]=t.defaultUniforms||{},this.moduleBindings[e]={}}}let DD="";async function LD(i,t){const e=new Image;return e.crossOrigin="anonymous",e.src=i.startsWith("http")?i:DD+i,await e.decode(),t?await createImageBitmap(e,t):await createImageBitmap(e)}const kD=["+X","-X","+Y","-Y","+Z","-Z"],BD=["+X","-X","+Y","-Y","+Z","-Z"];class Vl{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,e){this.device=t;const n=vc("async-texture");this.props={...Vl.defaultProps,id:n,...e},this.id=this.props.id,e={...e},typeof e?.data=="string"&&e.dimension==="2d"&&(e.data=LD(e.data)),e.mipmaps&&(e.mipLevels="auto"),this.ready=new Promise((s,r)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=r}),this.initAsync(e)}async initAsync(t){const e=t.data,n=await Jw(e).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!s)throw new Error("Texture size could not be determined");const r={...s,...t,data:void 0,mipLevels:1},o=this.device.getMipLevelCount(r.width,r.height);if(r.mipLevels=this.props.mipLevels==="auto"?o:Math.min(o,this.props.mipLevels),this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,t.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),ot.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(t={}){this.texture.setSampler(t instanceof Or?t:this.device.createSampler(t))}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const e=this.texture;this.texture=e.clone(t),e.destroy()}return!0}isTextureLevelData(t){const e=t?.data;return ArrayBuffer.isView(e)}getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return this.getTextureDataSize(t[0]);if(this.device.isExternalImage(t))return this.device.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const n=Object.values(t)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}setTextureData(t){}_setTexture1DData(t,e){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(t,e=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(t);n.length>1&&this.props.mipmaps!==!1&&ot.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<n.length;s++){const r=n[s];this.device.isExternalImage(r)?this.texture.copyExternalImage({image:r,depth:e,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:r.data,mipLevel:s})}}_setTexture3DData(t,e){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeData(t,e){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,s]of Object.entries(e)){const r=BD.indexOf(n);this._setTexture2DData(s,r)}}_setTextureArrayData(t,e){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeArrayData(t,e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(t,e,n,s=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&ot.warn(`${this.id} has mipmap and multiple LODs.`)();const r=kD.indexOf(n);this._setTexture2DData(e,r)}_normalizeTextureData(t){const e=this.texture;let n;return ArrayBuffer.isView(t)?n=[{data:t,width:e.width,height:e.height}]:Array.isArray(t)?n=t:n=[t],n}static defaultProps={...Re.defaultProps,data:null,mipmaps:!1}}async function Jw(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(Jw));if(i&&typeof i=="object"&&i.constructor===Object){const t=i,e=await Promise.all(Object.values(t)),n=Object.keys(t),s={};for(let r=0;r<n.length;r++)s[n[r]]=e[r];return s}return i}const vr=2,UD=1e4;class $i{static defaultProps={...Mr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Tr.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,e){this.props={...$i.defaultProps,...e},e=this.props,this.id=e.id||vc("model"),this.device=t,Object.assign(this.userData,e.userData);const n=Object.fromEntries(this.props.modules?.map(u=>[u.name,u])||[]),s=e.shaderInputs||new ND(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const r=zD(t),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:u,getUniforms:f}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:o});this.source=u,this._getModuleUniforms=f,this.props.shaderLayout||=hI(this.source)}else{const{vs:u,fs:f,getUniforms:g}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:o});this.vs=u,this.fs=f,this._getModuleUniforms=g}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||rm.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||am.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const e=this._areBindingsLoading();if(e)return ot.info(vr,`>>> DRAWING ABORTED ${this.id}: ${e} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:r}=this.vertexArray,o=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();const e=t&&SD(this.device,t);if(e){this.setTopology(e.topology||"triangle-list");const n=new jp(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)}this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const e=new jp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?e.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){V0(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new L5(this.shaderInputs.modules);for(const[e,n]of Object.entries(this.shaderInputs.modules))if(FD(n)){const s=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){const n=e?.disableWarnings??this.props.disableWarnings;t.indices&&ot.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=MD(this.pipeline.shaderLayout,this.bufferLayout);const s=new jp(this.bufferLayout);for(const[r,o]of Object.entries(t)){const l=s.getBufferLayout(r);if(!l){n||ot.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const u=s.getAttributeNamesForBuffer(l);let f=!1;for(const g of u){const p=this._attributeInfos[g];if(p){const _=this.device.type==="webgpu"?s.getBufferIndex(p.bufferName):p.location;this.vertexArray.setBuffer(_,o),f=!0}}!f&&!n&&ot.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[n,s]of Object.entries(t)){const r=this._attributeInfos[n];r?this.vertexArray.setConstantWebGL(r.location,s):(e?.disableWarnings??this.props.disableWarnings)||ot.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof Vl&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[e,n]of Object.entries(this.bindings))n instanceof Vl?n.isReady&&(t[e]=n.texture):t[e]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof If?t=Math.max(t,e.texture.updateTimestamp):e instanceof fe||e instanceof Re?t=Math.max(t,e.updateTimestamp):e instanceof Vl?t=e.texture?Math.max(t,e.texture.updateTimestamp):1/0:e instanceof Or||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[n]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete e[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(ot.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=jT(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=ot.level>3?0:UD;ot.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,ot.group(vr,`>>> DRAWING MODEL ${this.id}`,{collapsed:ot.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=ED(this.pipeline.shaderLayout,this.id);ot.table(vr,t)();const e=this.shaderInputs.getDebugTable();ot.table(vr,e)();const n=this._getAttributeDebugTable();ot.table(vr,this._attributeInfos)(),ot.table(vr,n)(),ot.groupEnd(vr)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const e=this.device.props.debugFramebuffers;if(this._drawCount++,!e)return;const n=t.props.framebuffer;n&&AD(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,n]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[n.location];t[n.location]={name:e,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,n=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,e){const n=I_(e);return(t instanceof fe?new n(t.debugData):t).toString()}}function FD(i){return!!(i.uniformTypes&&!VD(i.uniformTypes))}function zD(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function VD(i){for(const t in i)return!1;return!0}class ao{device;model;transformFeedback;static defaultProps={...$i.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,e=ao.defaultProps){if(!ao.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new $i(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||P6(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof fe)return e.readAsync();const{buffer:n,byteOffset:s=0,byteLength:r=n.byteLength}=e;return n.readAsync(s,r)}}class Jn{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:e={},indices:n=null,vertexCount:s=null}=t;this.id=t.id||vc("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,o]of Object.entries(e)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(r)}: must be typed array or object with value as typed array`);if((r==="POSITION"||r==="positions")&&!l.size&&(l.size=3),r==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[r]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const s of Object.values(t)){const{value:r,size:o,constant:l}=s;!l&&r&&o!==void 0&&o>=1&&(n=Math.min(n,r.length/o))}return n}}const jD={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class tE extends nm{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:n,viewports:s,onViewportActive:r,pickingFBO:o,deviceRect:{x:l,y:u,width:f,height:g},cullRect:p,effects:_,pass:v="picking",pickZ:b,shaderModuleProps:x}){this.pickZ=b;const T=this._resetColorEncoder(b),w=[l,u,f,g],M=super.render({target:o,layers:t,layerFilter:e,views:n,viewports:s,onViewportActive:r,cullRect:p,effects:_?.filter(P=>P.useInPicking),pass:v,isPicking:!0,shaderModuleProps:x,clearColor:[0,0,0,0],colorMask:15,scissorRect:w});return this._colorEncoderState=null,{decodePickingColor:T&&$D.bind(null,T),stats:M}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,e,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,e,n){const s={...t.props.parameters},{pickable:r,operation:o}=t.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:r&&o.includes("draw")&&(Object.assign(s,jD),s.blend=!0,s.blendColor=HD(this._colorEncoderState,t,n)),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function HD(i,t,e){const{byLayer:n,byAlpha:s}=i;let r,o=n.get(t);return o?(o.viewports.push(e),r=o.a):(r=n.size+1,r<=255?(o={a:r,layer:t,viewports:[e]},n.set(t,o),s[r]=o):(Lt.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function $D(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const La={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_f=Symbol.for("component"),Gs=Symbol.for("propTypes"),Hp=Symbol.for("deprecatedProps"),Qa=Symbol.for("asyncPropDefaults"),Br=Symbol.for("asyncPropOriginal"),Vs=Symbol.for("asyncPropResolved");function En(i,t=()=>!0){return Array.isArray(i)?eE(i,t,[]):t(i)?[i]:[]}function eE(i,t,e){let n=-1;for(;++n<i.length;){const s=i[n];Array.isArray(s)?eE(s,t,e):t(s)&&e.push(s)}return e}function GD({target:i,source:t,start:e=0,count:n=1}){const s=t.length,r=n*s;let o=0;for(let l=e;o<s;o++)i[l++]=t[o];for(;o<r;)o<r-o?(i.copyWithin(e+o,e,e+o),o*=2):(i.copyWithin(e+o,e,e+r-o),o=r);return i}class WD{constructor(t,e,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let s=t;typeof t=="string"&&(s=tf(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const r of this._subscribers)r.onChange(this.getData())}}class qD{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:n=!1,persistent:s=!0}){let r=this._resources[t];r?r.setData(e,n):(r=new WD(t,e,this._context),this._resources[t]=r),r.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const n in e){const s=e[n],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:n,requestId:s="default"}){const{_resources:r,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),r[t]||this.add({resourceId:t,data:null,persistent:!1}));const l=r[t];if(this._track(n,s,l,e),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,s){const r=this._consumers,o=r[t]=r[t]||{};let l=o[e];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),n&&(l?(l.onChange=s,l.resourceId=n.id):l={onChange:s,resourceId:n.id},o[e]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const XD="layerManager.setLayers",YD="layerManager.activateViewport";class KD{constructor(t,e){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{Ze(YD,this,l),l&&(this.context.viewport=l)};const{deck:n,stats:s,viewport:r,timeline:o}=e||{};this.layers=[],this.resourceManager=new qD({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:GN(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[J8],renderPass:void 0,stats:s||new pc({id:"deck.gl"}),viewport:r||new po({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Qw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Ze(XD,this,e,t),this._lastRenderedLayers=t;const n=En(t,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(n=>n.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,n=e.findIndex(s=>s.name===t.name);n>=0&&(e.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,n){n.raiseError(e,`${t} of ${n}`)}_updateLayers(t,e){const n={};for(const o of t)n[o.id]?Lt.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of t)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(e,n,s),this._finalizeOldLayers(n);let r=!1;for(const o of s)if(o.hasUniformTransition()){r=`Uniform transition in ${o}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(t,e,n){for(const s of t){s.context=this.context;const r=e[s.id];r===null&&Lt.warn(`Multiple new layers with same id ${s.id}`)(),e[s.id]=null;let o=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),o=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}o&&this._updateSublayersRecursively(o,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=La.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=La.MATCHED,e!==t&&(t.lifecycle=La.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=La.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=La.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Vi(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Vi(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),s=Object.keys(t);if(n.length!==s.length)return!1;for(const r of n)if(!t.hasOwnProperty(r)||!Vi(i[r],t[r],e-1))return!1;return!0}return!1}class ZD{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),s={x:t[0],y:t[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(s)){const l=t.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=En(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Vi(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Lt.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>this.getView(t.id)?.makeViewport({viewState:r,width:this.width,height:this.height})})}_updateController(t,e,n,s){const r=t.controller;if(r&&n){const o={...e,...r,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==r.type)&&(s=this._createController(t,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=t.length;s--;){const r=t[s],o=this.getViewState(r),l=r.makeViewport({viewState:o,width:this.width,height:this.height});let u=e[r.id];const f=!!r.controller;f&&!u&&(n=!0),(n||!f)&&u&&(u.finalize(),u=null),this.controllers[r.id]=this._updateController(r,o,l,u),l&&this._viewports.unshift(l)}for(const s in e){const r=e[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,s)=>!t[s].equals(e[s]))}}const QD=/([0-9]+\.?[0-9]*)(%|px)/;function Ns(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=QD.exec(i);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${i}`)}}function Ds(i,t){return i.relative?Math.round(i.position*t):i.position}class iE{constructor(t){const{id:e,x:n=0,y:s=0,width:r="100%",height:o="100%",padding:l=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Ns(n),this._y=Ns(s),this._width=Ns(r),this._height=Ns(o),this._padding=l&&{left:Ns(l.left||0),right:Ns(l.right||0),top:Ns(l.top||0),bottom:Ns(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Vi(this.props,t.props,2)}clone(t){const e=this.constructor;return new e({...this.props,...t})}makeViewport({width:t,height:e,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:t,height:e});if(!s.height||!s.width)return null;const r=this.getViewportType(n);return new r({...n,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions({width:t,height:e}){const n={x:Ds(this._x,t),y:Ds(this._y,e),width:Ds(this._width,t),height:Ds(this._height,e)};return this._padding&&(n.padding={left:Ds(this._padding.left,t),top:Ds(this._padding.top,e),right:Ds(this._padding.right,t),bottom:Ds(this._padding.bottom,e)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Lf{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const B3=()=>{},j0={BREAK:1,SNAP_TO_END:2,IGNORE:3},JD=i=>i,tL=j0.BREAK;class eL{constructor(t){this._onTransitionUpdate=e=>{const{time:n,settings:{interpolator:s,startProps:r,endProps:o,duration:l,easing:u}}=e,f=u(n/l),g=s.interpolateProps(r,o,f);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Lf(t.timeline),this.onViewStateChange=t.onViewStateChange||B3,this.onStateChange=t.onStateChange||B3}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let s=n;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;s={...n,...r===j0.SNAP_TO_END?o:this.propsInTransition||n}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===j0.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(n),r=e.transitionInterpolator,o=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(o===0)return;const l=r.initializeProps(t,s);this.propsInTransition={};const u={duration:o,easing:e.transitionEasing||JD,interpolator:r,interruption:e.transitionInterruption||tL,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(e)}}}function ye(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}class iL{constructor(t){const{compare:e,extract:n,required:s}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=s}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!Qn(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},s={};for(const r of this._propsToExtract)(r in t||r in e)&&(n[r]=t[r],s[r]=e[r]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];ye(Number.isFinite(n)||Array.isArray(n),`${e} is required for transition`)})}}const rh=Math.PI/180,U3=180/Math.PI,zh=6370972,Ua=256;function nL(){const i=Ua/zh,t=Math.PI/180*Ua;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[t,t,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/i]}}class bc extends po{constructor(t={}){const{longitude:e=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:r=1,resolution:o=10}=t;let{latitude:l=0,height:u,altitude:f=1.5,fovy:g}=t;l=Math.max(Math.min(l,Tn),-Tn),u=u||1,g?f=em(g):g=ic(f);const p=Math.pow(2,n-Fa(l)),_=t.nearZ??s,v=t.farZ??(f+Ua*2*p/u)*r,b=new He().lookAt({eye:[0,-f,0],up:[0,0,1]});b.rotateX(l*rh),b.rotateZ(-e*rh),b.scale(p/u),super({...t,height:u,viewMatrix:b,longitude:e,latitude:l,zoom:n,distanceScales:nL(),fovy:g,focalDistance:f,near:_,far:v}),this.scale=p,this.latitude=l,this.longitude=e,this.fovy=g,this.resolution=o}get projectionMode(){return Ri.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,this.height/2],e),s=this.unproject([this.width/2,0],e),r=this.unproject([this.width,this.height/2],e),o=this.unproject([this.width/2,this.height],e);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1]),Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[s,r,o]=t,l=e?r:this.height-r,{pixelUnprojectionMatrix:u}=this;let f;if(Number.isFinite(o))f=$p(u,[s,l,o,1]);else{const v=$p(u,[s,l,-1,1]),b=$p(u,[s,l,1,1]),x=((n||0)/zh+1)*Ua,T=Ip(bw([],v,b)),w=Ip(v),M=Ip(b),P=4*((4*w*M-(T-w-M)**2)/16)/T,k=Math.sqrt(w-P),U=Math.sqrt(Math.max(0,x*x-P)),Y=(k-U)/Math.sqrt(T);f=II([],v,b,Y)}const[g,p,_]=this.unprojectPosition(f);return Number.isFinite(o)?[g,p,_]:Number.isFinite(n)?[g,p,n]:[g,p]}projectPosition(t){const[e,n,s=0]=t,r=e*rh,o=n*rh,l=Math.cos(o),u=(s/zh+1)*Ua;return[Math.sin(r)*l*u,-Math.cos(r)*l*u,Math.sin(o)*u]}unprojectPosition(t){const[e,n,s]=t,r=xw(t),o=Math.asin(s/r),u=Math.atan2(e,-n)*U3,f=o*U3,g=(r/Ua-1)*zh;return[u,f,g]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition([t,e,n],s,r){const l=.25/Math.pow(2,this.zoom-Fa(this.latitude)),u=t+l*(r[0]-s[0]);let f=e-l*(r[1]-s[1]);f=Math.max(Math.min(f,Tn),-Tn);const g={longitude:u,latitude:f,zoom:n-Fa(e)};return g.zoom+=Fa(g.latitude),g}}bc.displayName="GlobeViewport";function Fa(i){const t=Math.PI*Math.cos(i*Math.PI/180);return Math.log2(t)}function $p(i,t){const e=ho([],t,i);return Q_(e,e,1/e[3]),e}const sL=["longitude","latitude","zoom","bearing","pitch"],rL=["longitude","latitude","zoom"];class om extends iL{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:sL,required:rL},super(n.transitionProps),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:s,around:r}=this.opts;if(s&&r)if(s(t)instanceof bc)Lt.warn("around not supported in GlobeView")();else{const l=s(t),u=s(e),f=l.unproject(r);n.start.around=r,Object.assign(n.end,{around:u.project(f),aroundPosition:f,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const s={};for(const r of this._propsToExtract)s[r]=ff(t[r]||0,e[r]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...e,...s});Object.assign(s,r.panByPosition(e.aroundPosition,ff(t.around,e.around,n)))}return s}}const qn={transitionDuration:0},aL=300,ah=i=>1-(1-i)*(1-i),Na={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},br={};class nE{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new eL({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return e?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-n]}isPointInBounds(t,e){const{width:n,height:s}=this.props;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=s;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?aL:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:f=!0}=t,g=!!this.onViewStateChange;this.toggleEvents(Na.WHEEL,g&&n),this.toggleEvents(Na.PAN,g),this.toggleEvents(Na.PINCH,g&&(l||u)),this.toggleEvents(Na.MULTI_PAN,g&&u),this.toggleEvents(Na.DOUBLE_CLICK,g&&o),this.toggleEvents(Na.KEYBOARD,g&&f),this.scrollZoom=n,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,e=null,n={}){const s={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),r){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(s,qn,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,qn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),s=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ah},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,qn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),s=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ah},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=t;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&o!==0&&(o=1/o);const l=s?{...this._getTransitionProps({around:e}),transitionDuration:250}:qn,u=this.controllerState.zoom({pos:e,scale:o});return this.updateViewport(u,l,{isZooming:!0,isPanning:!0}),s||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,qn,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,qn,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),s=[n[0],n[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:ah},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return br._startPinchRotation=t.rotation,br._lastPinchEvent=t,this.updateViewport(n,qn,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:br._startPinchRotation-n})}return this.updateViewport(e,qn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),br._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=br;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const s=this.getCenter(t);let r=this.controllerState.rotateEnd();const o=Math.log2(t.scale),l=(o-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),u=Math.pow(2,o+l*e/2);r=r.zoom({pos:s,scale:u}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:ah},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return br._startPinchRotation=null,br._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const f={};switch(t.srcEvent.code){case"Minus":u=e?l.zoomOut(n).zoomOut(n):l.zoomOut(n),f.isZooming=!0;break;case"Equal":u=e?l.zoomIn(n).zoomIn(n):l.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":e?(u=l.rotateLeft(r),f.isRotating=!0):(u=l.moveLeft(s),f.isPanning=!0);break;case"ArrowRight":e?(u=l.rotateRight(r),f.isRotating=!0):(u=l.moveRight(s),f.isPanning=!0);break;case"ArrowUp":e?(u=l.rotateUp(o),f.isRotating=!0):(u=l.moveUp(s),f.isPanning=!0);break;case"ArrowDown":e?(u=l.rotateDown(o),f.isRotating=!0):(u=l.moveDown(s),f.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?qn:t?{...e,transitionInterpolator:new om({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class oL{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const F3=5,lL=1.2;class sE extends oL{constructor(t){const{width:e,height:n,latitude:s,longitude:r,zoom:o,bearing:l=0,pitch:u=0,altitude:f=1.5,position:g=[0,0,0],maxZoom:p=20,minZoom:_=0,maxPitch:v=60,minPitch:b=0,startPanLngLat:x,startZoomLngLat:T,startRotatePos:w,startBearing:M,startPitch:E,startZoom:P,normalize:k=!0}=t;ye(Number.isFinite(r)),ye(Number.isFinite(s)),ye(Number.isFinite(o)),super({width:e,height:n,latitude:s,longitude:r,zoom:o,bearing:l,pitch:u,altitude:f,maxZoom:p,minZoom:_,maxPitch:v,minPitch:b,normalize:k,position:g},{startPanLngLat:x,startZoomLngLat:T,startRotatePos:w,startBearing:M,startPitch:E,startZoom:P}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const n=this.getState().startPanLngLat||this._unproject(e);if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState();if(!s||r===void 0||o===void 0)return this;let l;return t?l=this._getNewRotation(t,s,o,r):l={bearing:r+e,pitch:o+n},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:n}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(e)||this._unproject(t)),!r)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=s+Math.log2(n);u=Sn(u,l,o);const f=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...f.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:r}=n;return Math.abs(s-e.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:s}=t;t.zoom=Sn(s,n,e);const{maxPitch:r,minPitch:o,pitch:l}=t;t.pitch=Sn(l,o,r);const{normalize:u=!0}=t;return u&&Object.assign(t,RN(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,s){const r=t[0]-e[0],o=t[1]-e[1],l=t[1],u=e[1],{width:f,height:g}=this.getViewportProps(),p=r/f;let _=0;o>0?Math.abs(g-u)>F3&&(_=o/(u-g)*lL):o<0&&u>F3&&(_=1-l/u),_=Sn(_,-1,1);const{minPitch:v,maxPitch:b}=this.getViewportProps(),x=s+180*p;let T=n;return _>0?T=n+_*(b-n):_<0&&(T=n-_*(v-n)),{pitch:T,bearing:x}}}class cL extends nE{constructor(){super(...arguments),this.ControllerState=sE,this.transition={transitionDuration:300,transitionInterpolator:new om({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class lm extends iE{constructor(t={}){super(t)}getViewportType(){return ns}get ControllerType(){return cL}}lm.displayName="MapView";const uL=new Kw;function hL(i,t){const e=i.order??1/0,n=t.order??1/0;return e-n}class fL{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(s=>hL(s,t)>0);n<0?e.push(t):e.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Vi(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const n=[];for(const s of t){const r=e[s.id];let o=s;r&&r!==s?r.setProps?(r.setProps(s.props),o=r):r.cleanup(this._context):r||s.setup(this._context),n.push(o),delete e[s.id]}for(const s in e)e[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(s=>s instanceof Kw)||this._resolvedEffects.push(uL),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class dL extends nm{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const gL="deckRenderer.renderLayers";class pL{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new dL(t),this.pickLayersPass=new tE(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=e.render({...n,target:s});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=t.clearCanvas===void 0?!0:t.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Ze(gL,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize(),[n,s]=e;t.length===0&&[0,1].map(r=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:s});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[o]}))});for(const r of t)r.resize(e)}_postRender(t,e){const{renderBuffers:n}=this,s={...e,inputBuffer:n[0],swapBuffer:n[1]};for(const r of t)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?e.target:void 0;const o=r.postRender(s);s.inputBuffer=o,s.swapBuffer=o===n[0]?n[1]:n[0]}}}const _L={pickedColor:null,pickedObjectIndex:-1};function z3({pickedColors:i,decodePickingColor:t,deviceX:e,deviceY:n,deviceRadius:s,deviceRect:r}){const{x:o,y:l,width:u,height:f}=r;let g=s*s,p=-1,_=0;for(let v=0;v<f;v++){const b=v+l-n,x=b*b;if(x>g)_+=4*u;else for(let T=0;T<u;T++){if(i[_+3]-1>=0){const M=T+o-e,E=M*M+x;E<=g&&(g=E,p=_)}_+=4}}if(p>=0){const v=i.slice(p,p+4),b=t(v);if(b){const x=Math.floor(p/4/u),T=p/4-x*u;return{...b,pickedColor:v,pickedX:o+T,pickedY:l+x}}Lt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return _L}function V3({pickedColors:i,decodePickingColor:t}){const e=new Map;if(i){for(let n=0;n<i.length;n+=4)if(i[n+3]-1>=0){const r=i.slice(n,n+4),o=r.join(",");if(!e.has(o)){const l=t(r);l?e.set(o,{...l,color:r}):Lt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function H0({pickInfo:i,viewports:t,pixelRatio:e,x:n,y:s,z:r}){let o=t[0];t.length>1&&(o=mL(i?.pickedViewports||t,{x:n,y:s}));let l;if(o){const u=[n-o.x,s-o.y];r!==void 0&&(u[2]=r),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:l,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:e}}function j3(i){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:s}=i,{pickedColor:r,pickedLayer:o,pickedObjectIndex:l}=t,u=o?[o]:[];if(n==="hover"){const p=e.index,_=e.layerId,v=o?o.props.id:null;if(v!==_||l!==p){if(v!==_){const b=s.find(x=>x.props.id===_);b&&u.unshift(b)}e.layerId=v,e.index=l,e.info=null}}const f=H0(i),g=new Map;return g.set(null,f),u.forEach(p=>{let _={...f};p===o&&(_.color=r,_.index=l,_.picked=!0),_=$0({layer:p,info:_,mode:n});const v=_.layer;p===o&&n==="hover"&&(e.info=_),g.set(v.id,_),n==="hover"&&v.updateAutoHighlight(_)}),g}function $0({layer:i,info:t,mode:e}){for(;i&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=i,t=i.getPickingInfo({info:t,mode:e,sourceLayer:n}),i=i.parent}return t}function mL(i,t){for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.containsPixel(t))return n}return i[0]}class yL{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new tE(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(t){return this._pickClosestObjectAsync(t)}pickObjectsAsync(t){return this._pickVisibleObjectsAsync(t)}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:n,viewports:s},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,l=r&&r.viewport&&r.viewport.id,u=o?n.find(_=>_.id===o):null,f=l&&s.find(_=>_.id===l)||s[0],g=f&&f.unproject([t-f.x,e-f.y]);return{...r,...{x:t,y:e,viewport:f,coordinate:g,layer:u}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}async _pickClosestObjectAsync({layers:t,views:e,viewports:n,x:s,y:r,radius:o=0,depth:l=1,mode:u="query",unproject3D:f,onViewportActive:g,effects:p}){const _=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(t);if(!v||n.length===0)return{result:[],emptyInfo:H0({viewports:n,x:s,y:r,pixelRatio:_})};this._resizeBuffer();const b=this.device.canvasContext.cssToDevicePixels([s,r],!0),x=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],T=Math.round(o*_),{width:w,height:M}=this.pickingFBO,E=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:T,deviceWidth:w,deviceHeight:M}),P={x:s-o,y:r-o,width:o*2+1,height:o*2+1};let k;const U=[],Y=new Set;for(let et=0;et<l;et++){let K;if(E){const ht=this._drawAndSample({layers:v,views:e,viewports:n,onViewportActive:g,deviceRect:E,cullRect:P,effects:p,pass:`picking:${u}`});K=z3({...ht,deviceX:x[0],deviceY:x[1],deviceRadius:T,deviceRect:E})}else K={pickedColor:null,pickedObjectIndex:-1};let ut;if(K.pickedLayer&&f&&this.depthFBO){const{pickedColors:ht}=this._drawAndSample({layers:[K.pickedLayer],views:e,viewports:n,onViewportActive:g,deviceRect:{x:K.pickedX,y:K.pickedY,width:1,height:1},cullRect:P,effects:p,pass:`picking:${u}:z`},!0);ht[3]&&(ut=ht[0])}K.pickedLayer&&et+1<l&&(Y.add(K.pickedLayer),K.pickedLayer.disablePickingIndex(K.pickedObjectIndex)),k=j3({pickInfo:K,lastPickedInfo:this.lastPickedInfo,mode:u,layers:v,viewports:n,x:s,y:r,z:ut,pixelRatio:_});for(const ht of k.values())ht.layer&&U.push(ht);if(!K.pickedColor)break}for(const et of Y)et.restorePickingColors();return{result:U,emptyInfo:k.get(null)}}_pickClosestObject({layers:t,views:e,viewports:n,x:s,y:r,radius:o=0,depth:l=1,mode:u="query",unproject3D:f,onViewportActive:g,effects:p}){const _=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(t);if(!v||n.length===0)return{result:[],emptyInfo:H0({viewports:n,x:s,y:r,pixelRatio:_})};this._resizeBuffer();const b=this.device.canvasContext.cssToDevicePixels([s,r],!0),x=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],T=Math.round(o*_),{width:w,height:M}=this.pickingFBO,E=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:T,deviceWidth:w,deviceHeight:M}),P={x:s-o,y:r-o,width:o*2+1,height:o*2+1};let k;const U=[],Y=new Set;for(let et=0;et<l;et++){let K;if(E){const ht=this._drawAndSample({layers:v,views:e,viewports:n,onViewportActive:g,deviceRect:E,cullRect:P,effects:p,pass:`picking:${u}`});K=z3({...ht,deviceX:x[0],deviceY:x[1],deviceRadius:T,deviceRect:E})}else K={pickedColor:null,pickedObjectIndex:-1};let ut;if(K.pickedLayer&&f&&this.depthFBO){const{pickedColors:ht}=this._drawAndSample({layers:[K.pickedLayer],views:e,viewports:n,onViewportActive:g,deviceRect:{x:K.pickedX,y:K.pickedY,width:1,height:1},cullRect:P,effects:p,pass:`picking:${u}:z`},!0);ht[3]&&(ut=ht[0])}K.pickedLayer&&et+1<l&&(Y.add(K.pickedLayer),K.pickedLayer.disablePickingIndex(K.pickedObjectIndex)),k=j3({pickInfo:K,lastPickedInfo:this.lastPickedInfo,mode:u,layers:v,viewports:n,x:s,y:r,z:ut,pixelRatio:_});for(const ht of k.values())ht.layer&&U.push(ht);if(!K.pickedColor)break}for(const et of Y)et.restorePickingColors();return{result:U,emptyInfo:k.get(null)}}async _pickVisibleObjectsAsync({layers:t,views:e,viewports:n,x:s,y:r,width:o=1,height:l=1,mode:u="query",maxObjects:f=null,onViewportActive:g,effects:p}){const _=this._getPickable(t);if(!_||n.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),b=this.device.canvasContext.cssToDevicePixels([s,r],!0),x=b.x,T=b.y+b.height,w=this.device.canvasContext.cssToDevicePixels([s+o,r+l],!0),M=w.x+w.width,E=w.y,P={x,y:E,width:M-x,height:T-E},k=this._drawAndSample({layers:_,views:e,viewports:n,onViewportActive:g,deviceRect:P,cullRect:{x:s,y:r,width:o,height:l},effects:p,pass:`picking:${u}`}),U=V3(k),Y=new Map,et=[],K=Number.isFinite(f);for(let ut=0;ut<U.length&&!(K&&et.length>=f);ut++){const ht=U[ut];let _t={color:ht.pickedColor,layer:null,index:ht.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:v};_t=$0({layer:ht.pickedLayer,info:_t,mode:u});const St=_t.layer.id;Y.has(St)||Y.set(St,new Set);const pt=Y.get(St),It=_t.object??_t.index;pt.has(It)||(pt.add(It),et.push(_t))}return et}_pickVisibleObjects({layers:t,views:e,viewports:n,x:s,y:r,width:o=1,height:l=1,mode:u="query",maxObjects:f=null,onViewportActive:g,effects:p}){const _=this._getPickable(t);if(!_||n.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),b=this.device.canvasContext.cssToDevicePixels([s,r],!0),x=b.x,T=b.y+b.height,w=this.device.canvasContext.cssToDevicePixels([s+o,r+l],!0),M=w.x+w.width,E=w.y,P={x,y:E,width:M-x,height:T-E},k=this._drawAndSample({layers:_,views:e,viewports:n,onViewportActive:g,deviceRect:P,cullRect:{x:s,y:r,width:o,height:l},effects:p,pass:`picking:${u}`}),U=V3(k),Y=new Map,et=[],K=Number.isFinite(f);for(let ut=0;ut<U.length&&!(K&&et.length>=f);ut++){const ht=U[ut];let _t={color:ht.pickedColor,layer:null,index:ht.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:v};_t=$0({layer:ht.pickedLayer,info:_t,mode:u});const St=_t.layer.id;Y.has(St)||Y.set(St,new Set);const pt=Y.get(St),It=_t.object??_t.index;pt.has(It)||(pt.add(It),et.push(_t))}return et}async _drawAndSampleAsync({layers:t,views:e,viewports:n,onViewportActive:s,deviceRect:r,cullRect:o,effects:l,pass:u},f=!1){const g=f?this.depthFBO:this.pickingFBO,p={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:s,pickingFBO:g,deviceRect:r,cullRect:o,effects:l,pass:u,pickZ:f,preRenderStats:{},isPicking:!0};for(const M of l)M.useInPicking&&(p.preRenderStats[M.id]=M.preRender(p));const{decodePickingColor:_}=this.pickLayersPass.render(p),{x:v,y:b,width:x,height:T}=r,w=new(f?Float32Array:Uint8Array)(x*T*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:v,sourceY:b,sourceWidth:x,sourceHeight:T,target:w}),{pickedColors:w,decodePickingColor:_}}_drawAndSample({layers:t,views:e,viewports:n,onViewportActive:s,deviceRect:r,cullRect:o,effects:l,pass:u},f=!1){const g=f?this.depthFBO:this.pickingFBO,p={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:s,pickingFBO:g,deviceRect:r,cullRect:o,effects:l,pass:u,pickZ:f,preRenderStats:{},isPicking:!0};for(const M of l)M.useInPicking&&(p.preRenderStats[M.id]=M.preRender(p));const{decodePickingColor:_}=this.pickLayersPass.render(p),{x:v,y:b,width:x,height:T}=r,w=new(f?Float32Array:Uint8Array)(x*T*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:v,sourceY:b,sourceWidth:x,sourceHeight:T,target:w}),{pickedColors:w,decodePickingColor:_}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:n,deviceWidth:s,deviceHeight:r}){const o=Math.max(0,t-n),l=Math.max(0,e-n),u=Math.min(s,t+n+1)-o,f=Math.min(r,e+n+1)-l;return u<=0||f<=0?null:{x:o,y:l,width:u,height:f}}}const vL={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},bL="top-left",H3="root";class xL{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,e?.classList.add("deck-widget-container"),this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){if(t.widgets&&!Vi(t.widgets,this.widgets,1)){const e=t.widgets.filter(Boolean);this._setWidgets(e)}}finalize(){for(const t of this.getWidgets())this._removeWidget(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._addWidget(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}onRedraw({viewports:t,layers:e}){const n=t.reduce((s,r)=>(s[r.id]=r,s),{});for(const s of this.getWidgets()){const{viewId:r}=s;if(r){const o=n[r];o&&(s.onViewportChange&&s.onViewportChange(o),s.onRedraw?.({viewports:[o],layers:e}))}else{if(s.onViewportChange)for(const o of t)s.onViewportChange(o);s.onRedraw?.({viewports:t,layers:e})}}this.lastViewports=n,this._updateContainers()}onHover(t,e){for(const n of this.getWidgets()){const{viewId:s}=n;(!s||s===t.viewport?.id)&&n.onHover?.(t,e)}}onEvent(t,e){const n=B0[e.type];if(n)for(const s of this.getWidgets()){const{viewId:r}=s;(!r||r===t.viewport?.id)&&s[n]?.(t,e)}}_setWidgets(t){const e={};for(const n of this.resolvedWidgets)e[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)e[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const s=e[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._removeWidget(s),this._addWidget(n)):n!==s&&(s.setProps(n.props),n=s):this._addWidget(n),e[n.id]=null,this.resolvedWidgets.push(n)}for(const n in e){const s=e[n];s&&this._removeWidget(s)}this.widgets=t}_addWidget(t){const{viewId:e=null,placement:n=bL}=t,s=t.props._container??e;t.widgetManager=this,t.deck=this.deck,t.rootElement=t._onAdd({deck:this.deck,viewId:e}),t.rootElement&&this._getContainer(s,n).append(t.rootElement),t.updateHTML()}_removeWidget(t){t.onRemove?.(),t.rootElement&&t.rootElement.remove(),t.rootElement=void 0,t.deck=void 0,t.widgetManager=void 0}_getContainer(t,e){if(t&&typeof t!="string")return t;const n=t||H3;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[n]=s);let r=s.querySelector(`.${e}`);return r||(r=globalThis.document.createElement("div"),r.className=e,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,vL[e]),s.append(r)),r}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,r=n===H3||s,o=this.containers[n];r?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:t}px`,o.style.height=`${s?s.height:e}px`):o.style.display="none"}}}function $3(i,t){t&&Object.entries(t).map(([e,n])=>{e.startsWith("--")?i.style.setProperty(e,n):i.style[e]=n})}function SL(i,t){t&&Object.keys(t).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""})}class cm{constructor(t){this.viewId=null,this.props={...this.constructor.defaultProps,...t},this.id=this.props.id}setProps(t){const e=this.props,n=this.rootElement;n&&e.className!==t.className&&(e.className&&n.classList.remove(e.className),t.className&&n.classList.add(t.className)),n&&!Vi(e.style,t.style,1)&&(SL(n,e.style),$3(n,t.style)),Object.assign(this.props,t),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const t=["deck-widget",this.className,this.props.className],e=document.createElement("div");return t.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>e.classList.add(n)),$3(e,this.props.style),e}_onAdd(t){return this.onAdd(t)??this.onCreateRootElement()}onAdd(t){}onRemove(){}onViewportChange(t){}onRedraw(t){}onHover(t,e){}onClick(t,e){}onDrag(t,e){}onDragStart(t,e){}onDragEnd(t,e){}}cm.defaultProps={id:"widget",style:{},_container:null,className:""};const TL={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class rE extends cm{constructor(t={}){super(t),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(t)}onCreateRootElement(){const t=document.createElement("div");return t.className=this.className,Object.assign(t.style,TL),t}onRenderHTML(t){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&!t.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=t}onHover(t){const{deck:e}=this,n=e&&e.props.getTooltip;if(!n)return;const s=n(t);this.setTooltip(s,t.x,t.y)}setTooltip(t,e,n){const s=this.rootElement;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${e}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}}rE.defaultProps={...cm.defaultProps};const wL="modulepreload",EL=function(i){return"/deck.gl-raster/examples/naip-mosaic/"+i},G3={},sn=function(t,e,n){let s=Promise.resolve();if(e&&e.length>0){let u=function(f){return Promise.all(f.map(g=>Promise.resolve(g).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");s=u(e.map(f=>{if(f=EL(f),f in G3)return;G3[f]=!0;const g=f.endsWith(".css"),p=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${p}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":wL,g||(_.as="script"),_.crossOrigin="",_.href=f,l&&_.setAttribute("nonce",l),document.head.appendChild(_),g)return new Promise((v,b)=>{_.addEventListener("load",v),_.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${f}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};var za;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(za||(za={}));const AL={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},ML=i=>({drawBuffersWEBGL(t){return i.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),CL=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(t){return i.deleteVertexArray(t)},isVertexArrayOES(t){return i.isVertexArray(t)},bindVertexArrayOES(t){return i.bindVertexArray(t)}}),RL=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return i.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return i.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return i.vertexAttribDivisor(...t)}});function PL(i=!0){const t=HTMLCanvasElement.prototype;if(!i&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,n){if(e==="webgl"||e==="experimental-webgl"){const s=this.originalGetContext("webgl2",n);return s instanceof HTMLElement&&IL(s),s}return this.originalGetContext(e,n)}}function IL(i){i.getExtension("EXT_color_buffer_float");const t={...AL,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:ML(i),OES_vertex_array_object:CL(i),ANGLE_instanced_arrays:RL(i)},e=i.getExtension;i.getExtension=function(s){const r=e.call(i,s);return r||(s in t?t[s]:null)};const n=i.getSupportedExtensions;i.getSupportedExtensions=function(){return(n.apply(i)||[])?.concat(Object.keys(t))}}async function aE(i,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",i),new Promise((s,r)=>{n.onload=s,n.onerror=o=>r(new Error(`Unable to load script '${i}': ${o}`)),e.appendChild(n)})}const OL=1;let Ei=null,W3=!1;const um={debugSpectorJS:ot.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function NL(i){if(!globalThis.SPECTOR)try{await aE(i.debugSpectorJSUrl||um.debugSpectorJSUrl)}catch(t){ot.warn(String(t))}}function DL(i){if(i={...um,...i},!i.debugSpectorJS)return null;if(!Ei&&globalThis.SPECTOR&&!globalThis.luma?.spector){ot.probe(OL,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Ei=new t,globalThis.luma&&(globalThis.luma.spector=Ei)}if(!Ei)return null;if(W3||(W3=!0,Ei.spyCanvases(),Ei?.onCaptureStarted.add(t=>ot.info("Spector capture started:",t)()),Ei?.onCapture.add(t=>{ot.info("Spector capture complete:",t)(),Ei?.getResultUI(),Ei?.resultView.display(),Ei?.resultView.addCapture(t)})),i.gl){const t=i.gl,e=t.device;Ei?.startCapture(i.gl,500),t.device=e,new Promise(n=>setTimeout(n,2e3)).then(n=>{ot.info("Spector capture stopped after 2 seconds")(),Ei?.stopCapture()})}return Ei}const LL="https://unpkg.com/webgl-debug@2.0.1/index.js";function oE(i){return i.luma=i.luma||{},i.luma}async function kL(){Vr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await aE(LL))}function BL(i,t={}){return t.debugWebGL||t.traceWebGL?FL(i,t):UL(i)}function UL(i){const t=oE(i);return t.realContext?t.realContext:i}function FL(i,t){if(!globalThis.WebGLDebugUtils)return ot.warn("webgl-debug not loaded")(),i;const e=oE(i);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...za,...i});const n=globalThis.WebGLDebugUtils.makeDebugContext(i,zL.bind(null,t),VL.bind(null,t));for(const o in za)!(o in n)&&typeof za[o]=="number"&&(n[o]=za[o]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(i)),Object.setPrototypeOf(s,n);const r=Object.create(s);return e.realContext=i,e.debugContext=r,r.debug=!0,r}function q3(i,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${i}(${e})`}function zL(i,t,e,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const s=globalThis.WebGLDebugUtils.glEnumToString(t),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,n),o=`${s} in gl.${e}(${r})`;ot.error(o)();debugger}function VL(i,t,e){let n="";ot.level>=1&&(n=q3(t,e),i.traceWebGL&&ot.log(1,n)());for(const s of e)if(s===void 0){n=n||q3(t,e);debugger}}const oh=1;class jL extends e5{type="webgl";constructor(){super(),Ir.defaultProps={...Ir.defaultProps,...um}}enforceWebGL2(t){PL(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&ot.warn("WebGL1 is not supported",t)(),!1)}async attach(t,e={}){const{WebGLDevice:n}=await sn(async()=>{const{WebGLDevice:r}=await Promise.resolve().then(()=>cx);return{WebGLDevice:r}},void 0);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(!HL(t))throw new Error("Invalid WebGL2RenderingContext");const s=e.createCanvasContext===!0?{}:e.createCanvasContext;return new n({...e,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...s}})}async create(t={}){const{WebGLDevice:e}=await sn(async()=>{const{WebGLDevice:n}=await Promise.resolve().then(()=>cx);return{WebGLDevice:n}},void 0);ot.groupCollapsed(oh,"WebGLDevice created")();try{const n=[];(t.debugWebGL||t.debug)&&n.push(kL()),t.debugSpectorJS&&n.push(NL(t));const s=await Promise.allSettled(n);for(const l of s)l.status==="rejected"&&ot.error(`Failed to initialize debug libraries ${l.reason}`)();const r=new e(t),o=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return ot.probe(oh,o)(),ot.table(oh,r.info)(),r}finally{ot.groupEnd(oh)()}}}function HL(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const Gp=new jL,hm={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ae=(i,t,e)=>t?i.enable(e):i.disable(e),X3=(i,t,e)=>i.hint(e,t),Ai=(i,t,e)=>i.pixelStorei(e,t),Y3=(i,t,e)=>{const n=e===36006?36009:36008;return i.bindFramebuffer(n,t)},vl=(i,t,e)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];i.bindBuffer(s,t)};function Wp(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const $L={3042:Ae,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:Ae,2885:(i,t)=>i.cullFace(t),2929:Ae,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:Ae,35723:X3,35725:(i,t)=>i.useProgram(t),36007:(i,t)=>i.bindRenderbuffer(36161,t),36389:(i,t)=>i.bindTransformFeedback?.(36386,t),34229:(i,t)=>i.bindVertexArray(t),36006:Y3,36010:Y3,34964:vl,36662:vl,36663:vl,35053:vl,35055:vl,2886:(i,t)=>i.frontFace(t),33170:X3,2849:(i,t)=>i.lineWidth(t),32823:Ae,32824:"polygonOffset",10752:"polygonOffset",35977:Ae,32926:Ae,32928:Ae,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ae,3088:(i,t)=>i.scissor(...t),2960:Ae,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),34383:Ae,10754:Ae,12288:Ae,12289:Ae,12290:Ae,12291:Ae,12292:Ae,12293:Ae,12294:Ae,12295:Ae,3333:Ai,3317:Ai,37440:Ai,37441:Ai,37443:Ai,3330:Ai,3332:Ai,3331:Ai,3314:Ai,32878:Ai,3316:Ai,3315:Ai,32877:Ai,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{const e=typeof t=="number"?[t,t]:t;i.blendEquationSeparate(...e)},blendFunc:(i,t)=>{const e=t?.length===2?[...t,...t]:t;i.blendFuncSeparate(...e)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(t[0],t[1]||!1),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=Wp(t)?t:[t,t];const[e,n]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,n)},stencilFunc:(i,t)=>{t=Wp(t)&&t.length===3?[...t,...t]:t;const[e,n,s,r,o,l]=t;i.stencilFuncSeparate(1028,e,n,s),i.stencilFuncSeparate(1029,r,o,l)},stencilOp:(i,t)=>{t=Wp(t)&&t.length===3?[...t,...t]:t;const[e,n,s,r,o,l]=t;i.stencilOpSeparate(1028,e,n,s),i.stencilOpSeparate(1029,r,o,l)},viewport:(i,t)=>i.viewport(...t)};function pe(i,t,e){return t[i]!==void 0?t[i]:e[i]}const GL={blendEquation:(i,t,e)=>i.blendEquationSeparate(pe(32777,t,e),pe(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(pe(32969,t,e),pe(32968,t,e),pe(32971,t,e),pe(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(pe(32824,t,e),pe(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(pe(32938,t,e),pe(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,pe(2962,t,e),pe(2967,t,e),pe(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,pe(34816,t,e),pe(36003,t,e),pe(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,pe(2964,t,e),pe(2965,t,e),pe(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,pe(34817,t,e),pe(34818,t,e),pe(34819,t,e))},K3={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),useProgram:(i,t)=>i({35725:t}),bindRenderbuffer:(i,t,e)=>i({36007:e}),bindTransformFeedback:(i,t,e)=>i({36389:e}),bindVertexArray:(i,t)=>i({34229:t}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},bindBuffer:(i,t,e)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?i({[n]:e}):{valueChanged:!0}},blendColor:(i,t,e,n,s)=>i({32773:new Float32Array([t,e,n,s])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,n,s)=>i({32969:t,32968:e,32971:n,32970:s}),clearColor:(i,t,e,n,s)=>i({3106:new Float32Array([t,e,n,s])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,n,s)=>i({3107:[t,e,n,s]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,n,s)=>i({3088:new Int32Array([t,e,n,s])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,n)=>i({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(i,t,e,n,s)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:s}),stencilOp:(i,t,e,n)=>i({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(i,t,e,n,s)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:s}),viewport:(i,t,e,n,s)=>i({2978:[t,e,n,s]})},dn=(i,t)=>i.isEnabled(t),Z3={3042:dn,2884:dn,2929:dn,3024:dn,32823:dn,32926:dn,32928:dn,3089:dn,2960:dn,35977:dn},WL=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function _o(i,t){if(XL(t))return;const e={};for(const s in t){const r=Number(s),o=$L[s];o&&(typeof o=="string"?e[o]=!0:o(i,t[s],r))}const n=i.state&&i.state.cache;if(n)for(const s in e){const r=GL[s];r(i,t,n)}}function lE(i,t=hm){if(typeof t=="number"){const s=t,r=Z3[s];return r?r(i,s):i.getParameter(s)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const s of e){const r=Z3[s];n[s]=r?r(i,Number(s)):i.getParameter(Number(s))}return n}function qL(i){_o(i,hm)}function XL(i){for(const t in i)return!1;return!0}function YL(i,t){if(i===t)return!0;if(Q3(i)&&Q3(t)&&i.length===t.length){for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}return!1}function Q3(i){return Array.isArray(i)||ArrayBuffer.isView(i)}class Rr{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,e){this.gl=t,this.log=e?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];_o(this.gl,t),this.stateStack.pop()}trackState(t,e){if(this.cache=e?.copyState?lE(t):Object.assign({},hm),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,ZL(t);for(const n in K3){const s=K3[n];KL(t,n,s)}J3(t,"getParameter"),J3(t,"isEnabled")}_updateCache(t){let e=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in t){const o=t[r],l=this.cache[r];YL(o,l)||(e=!0,n=l,s&&!(r in s)&&(s[r]=l),this.cache[r]=o)}return{valueChanged:e,oldValue:n}}}function J3(i,t){const e=i[t].bind(i);i[t]=function(s){if(s===void 0||WL.has(s))return e(s);const r=Rr.get(i);return s in r.cache||(r.cache[s]=e(s)),r.enable?r.cache[s]:e(s)},Object.defineProperty(i[t],"name",{value:`${t}-from-cache`,configurable:!1})}function KL(i,t,e){if(!i[t])return;const n=i[t].bind(i);i[t]=function(...r){const o=Rr.get(i),{valueChanged:l,oldValue:u}=e(o._updateCache,...r);return l&&n(...r),u},Object.defineProperty(i[t],"name",{value:`${t}-to-cache`,configurable:!1})}function ZL(i){const t=i.useProgram.bind(i);i.useProgram=function(n){const s=Rr.get(i);s.program!==n&&(t(n),s.program=n)}}function QL(i,t,e){let n="";const s={preserveDrawingBuffer:!0,...e};let r=null;if(r||=i.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!r&&!e.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,r=i.getContext("webgl2",s),r.luma||={},r.luma.softwareRenderer=!0),r||(r=i.getContext("webgl",{}),r&&(r=null,n||="Your browser only supports WebGL1")),!r)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:o,onContextRestored:l}=t;return i.addEventListener("webglcontextlost",u=>o(u),!1),i.addEventListener("webglcontextrestored",u=>l(u),!1),r.luma||={},r}function oo(i,t,e){return e[t]===void 0&&(e[t]=i.getExtension(t)||null),e[t]}function JL(i,t){const e=i.getParameter(7936),n=i.getParameter(7937);oo(i,"WEBGL_debug_renderer_info",t);const s=t.WEBGL_debug_renderer_info,r=i.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=i.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),l=r||e,u=o||n,f=i.getParameter(7938),g=cE(l,u),p=tk(l,u),_=ek(l,u);return{type:"webgl",gpu:g,gpuType:_,gpuBackend:p,vendor:l,renderer:u,version:f,shadingLanguage:"glsl",shadingLanguageVersion:300}}function cE(i,t){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(i)||/Apple/i.exec(t)?"apple":/AMD/i.exec(i)||/AMD/i.exec(t)||/ATI/i.exec(i)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t)?"software":"unknown"}function tk(i,t){return/Metal/i.exec(i)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(t)?"opengl":"unknown"}function ek(i,t){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t))return"cpu";switch(cE(i,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function uE(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const Cl="WEBGL_compressed_texture_s3tc",Rl="WEBGL_compressed_texture_s3tc_srgb",Va="EXT_texture_compression_rgtc",ja="EXT_texture_compression_bptc",ik="WEBGL_compressed_texture_etc",nk="WEBGL_compressed_texture_astc",sk="WEBGL_compressed_texture_etc1",rk="WEBGL_compressed_texture_pvrtc",ak="WEBGL_compressed_texture_atc",tx="EXT_texture_norm16",ex="EXT_render_snorm",ok="EXT_color_buffer_float",fm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ex],"norm16-renderable-webgl":[tx],"snorm16-renderable-webgl":[tx,ex],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Cl,Rl,Va,ja],"texture-compression-bc5-webgl":[Va],"texture-compression-bc7-webgl":[ja],"texture-compression-etc2":[ik],"texture-compression-astc":[nk],"texture-compression-etc1-webgl":[sk],"texture-compression-pvrtc-webgl":[rk],"texture-compression-atc-webgl":[ak]};function lk(i){return i in fm}function ck(i,t,e){return(fm[t]||[]).every(s=>oo(i,s,e))}const dm={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:ok,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Cl},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Rl},"bc1-rgba-unorm":{gl:33777,x:Cl},"bc1-rgba-unorm-srgb":{gl:35916,x:Rl},"bc2-rgba-unorm":{gl:33778,x:Cl},"bc2-rgba-unorm-srgb":{gl:35918,x:Rl},"bc3-rgba-unorm":{gl:33779,x:Cl},"bc3-rgba-unorm-srgb":{gl:35919,x:Rl},"bc4-r-unorm":{gl:36283,x:Va},"bc4-r-snorm":{gl:36284,x:Va},"bc5-rg-unorm":{gl:36285,x:Va},"bc5-rg-snorm":{gl:36286,x:Va},"bc6h-rgb-ufloat":{gl:36495,x:ja},"bc6h-rgb-float":{gl:36494,x:ja},"bc7-rgba-unorm":{gl:36492,x:ja},"bc7-rgba-unorm-srgb":{gl:36493,x:ja},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function uk(i,t,e){let n=t.create;const s=dm[t.format];return s?.gl===void 0&&(n=!1),s?.x&&(n=n&&!!oo(i,s.x,e)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function hE(i){const t=dm[i],e=dk(i),n=Ka.getInfo(i);return n.compressed&&(t.dataFormat=e),{internalFormat:e,format:t?.dataFormat||fk(n.channels,n.integer,n.normalized,e),type:n.dataType?uE(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function hk(i){switch(Ka.getInfo(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function fk(i,t,e,n){if(n===6408||n===6407)return n;switch(i){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function dk(i){const e=dm[i]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${i}`);return e}const ix={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class gk extends J6{gl;extensions;testedFeatures=new Set;constructor(t,e,n){super([],n),this.gl=t,this.extensions=e,oo(t,"EXT_color_buffer_float",e)}*[Symbol.iterator](){const t=this.getFeatures();for(const e of t)this.has(e)&&(yield e);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),lk(t)&&ck(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(e=>e!=="polygon-mode-webgl");for(const e of t)this.has(e)}getFeatures(){return[...Object.keys(ix),...Object.keys(fm)]}getWebGLFeature(t){const e=ix[t];return typeof e=="string"?!!oo(this.gl,e,this.extensions):!!e}}class pk extends Q6{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class jl extends Nf{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,e){super(t,e);const n=e.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const n=this.colorAttachments[e];if(n){const s=36064+e;this._attachTextureView(s,n)}}if(this.depthStencilAttachment){const e=hk(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(e!==36053)throw new Error(`Framebuffer ${mk(e)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,e){const{gl:n}=this.device,{texture:s}=e,r=e.props.baseMipLevel,o=e.props.baseArrayLayer;switch(n.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,s.handle,r,o);break;case 34067:const l=_k(o);n.framebufferTexture2D(36160,t,l,s.handle,r);break;case 3553:n.framebufferTexture2D(36160,t,3553,s.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(s.glTarget,null)}}function _k(i){return i<34069?i+34069:i}function mk(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class yk extends wr{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,e){super(e),this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new jl(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const qp={};function vk(i="id"){qp[i]=qp[i]||1;const t=qp[i]++;return`${i}-${t}`}class Hl extends fe{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(t,e={}){super(t,e),this.device=t,this.gl=this.device.gl;const n=typeof e=="object"?e.handle:void 0;this.handle=n||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=bk(this.props.usage),this.glUsage=xk(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,e.data?this._initWithData(e.data,e.byteOffset,e.byteLength):this._initWithByteLength(e.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,e=0,n=t.byteLength+e){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bufferSubData(s,e,t),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,e,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let e=t;t===0&&(e=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,e,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,e=0){const n=ArrayBuffer.isView(t)?t:new Uint8Array(t),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,e,n),this.gl.bindBuffer(s,null),this._setDebugData(t,e,t.byteLength)}async mapAndWriteAsync(t,e=0,n=this.byteLength-e){const s=new ArrayBuffer(n);await t(s,"copied"),this.write(s,e)}async readAsync(t=0,e){return this.readSyncWebGL(t,e)}async mapAndReadAsync(t,e=0,n){const s=await this.readAsync(e,n);return await t(s.buffer,"copied")}readSyncWebGL(t=0,e){e=e??this.byteLength-t;const n=new Uint8Array(e),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,s,e),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,e),n}}function bk(i){return i&fe.INDEX?34963:i&fe.VERTEX?34962:i&fe.UNIFORM?35345:34962}function xk(i){return i&fe.INDEX||i&fe.VERTEX?35044:i&fe.UNIFORM?35048:35044}function Sk(i){const t=i.split(/\r?\n/),e=[];for(const n of t){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[p,_]=s;e.push({message:_.trim(),type:nx(p),lineNum:0,linePos:0});continue}const[r,o,l,...u]=s;let f=parseInt(l,10);isNaN(f)&&(f=0);let g=parseInt(o,10);isNaN(g)&&(g=0),e.push({message:u.join(":").trim(),type:nx(r),lineNum:f,linePos:g})}return e}function nx(i){const t=["warning","error","info"],e=i.toLowerCase();return t.includes(e)?e:"info"}class Tk extends Of{device;handle;constructor(t,e){switch(super(t,e),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?Sk(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:e}=this.device;if(e.shaderSource(this.handle,t),e.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ot.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ot.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(r=>setTimeout(r,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function wk(i,t,e,n){if(Ck(t))return n(i);const s=i;s.pushState();try{return Ek(i,t),_o(s.gl,e),n(i)}finally{s.popState()}}function Ek(i,t){const e=i,{gl:n}=e;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Pr("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&i.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&i.features.has("provoking-vertex-webgl")){const r=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Pr("provokingVertex",t.provokingVertex,{first:36429,last:36430});r?.provokingVertexWEBGL(o)}if((t.polygonMode||t.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Pr("polygonMode",t.polygonMode,{fill:6914,line:6913});r?.polygonModeWEBGL(1028,o),r?.polygonModeWEBGL(1029,o)}t.polygonOffsetLine&&n.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(Mk("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(G0("depthCompare",t.depthCompare))),t.stencilWriteMask){const s=t.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(t.stencilReadMask&&ot.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const s=t.stencilReadMask||4294967295,r=G0("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,r,0,s),n.stencilFuncSeparate(1029,r,0,s)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const s=Xp("stencilPassOperation",t.stencilPassOperation),r=Xp("stencilFailOperation",t.stencilFailOperation),o=Xp("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,r,o,s),n.stencilOpSeparate(1029,r,o,s)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const s=sx("blendColorOperation",t.blendColorOperation||"add"),r=sx("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(s,r);const o=lh("blendColorSrcFactor",t.blendColorSrcFactor||"one"),l=lh("blendColorDstFactor",t.blendColorDstFactor||"zero"),u=lh("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),f=lh("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,l,u,f)}}function G0(i,t){return Pr(i,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Xp(i,t){return Pr(i,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function sx(i,t){return Pr(i,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function lh(i,t,e="color"){return Pr(i,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:e==="color"?32769:32771,"one-minus-constant":e==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Ak(i,t){return`Illegal parameter ${t} for ${i}`}function Pr(i,t,e){if(!(t in e))throw new Error(Ak(i,t));return e[t]}function Mk(i,t){return t}function Ck(i){let t=!0;for(const e in i){t=!1;break}return t}function fE(i){const t={};return i.addressModeU&&(t[10242]=Yp(i.addressModeU)),i.addressModeV&&(t[10243]=Yp(i.addressModeV)),i.addressModeW&&(t[32882]=Yp(i.addressModeW)),i.magFilter&&(t[10240]=W0(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(t[10241]=Rk(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(t[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(t[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(t[34892]=34894),i.compare&&(t[34893]=G0("compare",i.compare)),i.maxAnisotropy&&(t[34046]=i.maxAnisotropy),t}function Yp(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function W0(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function Rk(i,t="none"){if(!t)return W0(i);switch(t){case"none":return W0(i);case"nearest":switch(i){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(i){case"nearest":return 9986;case"linear":return 9987}}}class Pk extends Or{device;handle;parameters;constructor(t,e){super(t,e),this.device=t,this.parameters=fE(e),this.handle=e.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[e,n]of Object.entries(t)){const s=Number(e);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,n);break;default:this.device.gl.samplerParameteri(this.handle,s,n);break}}}}function nc(i,t,e){if(Ik(t))return e(i);const{nocatch:n=!0}=t,s=Rr.get(i);s.push(),_o(i,t);let r;if(n)r=e(i),s.pop();else try{r=e(i)}finally{s.pop()}return r}function Ik(i){for(const t in i)return!1;return!0}class Ha extends If{device;gl;handle;texture;constructor(t,e){super(t,{...Re.defaultProps,...e}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=e.texture}}class $l extends Re{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(t,e){super(t,e),this.device=t,this.gl=this.device.gl;const n=hE(this.props.format);this.glTarget=Ok(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:r,height:o,depth:l,mipLevels:u,glTarget:f,glInternalFormat:g}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(f,u,g,r,o);break;case"2d-array":case"3d":this.gl.texStorage3D(f,u,g,r,o,l);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(e.data),this.setSampler(this.props.sampler),this.view=new Ha(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Ha(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);const e=fE(this.sampler.props);this._setSamplerParameters(e)}copyImageData(t){const e=this._normalizeCopyImageDataOptions(t),n=e.data,{width:s,height:r,depth:o}=this,{mipLevel:l=0,byteOffset:u=0,x:f=0,y:g=0,z:p=0}=e,{glFormat:_,glType:v,compressed:b}=this,x=rx(this.glTarget,this.dimension,p);let T;if(!this.compressed){const{bytesPerPixel:M}=this.device.getTextureFormatInfo(this.format);if(M){if(e.bytesPerRow%M!==0)throw new Error(`bytesPerRow (${e.bytesPerRow}) must be a multiple of bytesPerPixel (${M}) for ${this.format}`);T=e.bytesPerRow/M}}const w=this.compressed?{}:{...T!==void 0?{3314:T}:{},32878:e.rowsPerImage};this.gl.bindTexture(x,this.handle),nc(this.gl,w,()=>{switch(this.dimension){case"2d":case"cube":b?this.gl.compressedTexSubImage2D(x,l,f,g,s,r,_,n,u):this.gl.texSubImage2D(x,l,f,g,s,r,_,v,n,u);break;case"2d-array":case"3d":b?this.gl.compressedTexSubImage3D(x,l,f,g,p,s,r,o,_,n,u):this.gl.texSubImage3D(x,l,f,g,p,s,r,o,_,v,n,u);break;default:}}),this.gl.bindTexture(x,null)}copyExternalImage(t){const e=this._normalizeCopyExternalImageOptions(t);if(e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:s}=this,{image:r,depth:o,mipLevel:l,x:u,y:f,z:g,width:p,height:_}=e,v=rx(this.glTarget,this.dimension,o),b=e.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),nc(this.gl,b,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(v,l,u,f,p,_,n,s,r);break;case"2d-array":case"3d":this.gl.texSubImage3D(v,l,u,f,g,p,_,o,n,s,r);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:e.width,height:e.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ot.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){ot.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){ot.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[e,n]of Object.entries(t)){const s=Number(e),r=n;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,r);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,r);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,r);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,r);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,r);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,this.handle),t}_unbind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,null),t}}function Ok(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function rx(i,t,e){return t==="cube"?34069+e:i}function Nk(i){return Bk[i]}function gm(i){return kk[i]}function Dk(i){return!!dE[i]}function Lk(i){return dE[i]}const kk={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},dE={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Bk={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function Uk(i,t){const e={attributes:[],bindings:[]};e.attributes=Fk(i,t);const n=jk(i,t);for(const l of n){const u=l.uniforms.map(f=>({name:f.name,format:f.format,byteOffset:f.byteOffset,byteStride:f.byteStride,arrayLength:f.arrayLength}));e.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const s=Vk(i,t);let r=0;for(const l of s)if(Dk(l.type)){const{viewDimension:u,sampleType:f}=Lk(l.type);e.bindings.push({type:"texture",name:l.name,group:0,location:r,viewDimension:u,sampleType:f}),l.textureUnit=r,r+=1}s.length&&(e.uniforms=s);const o=zk(i,t);return o?.length&&(e.varyings=o),e}function Fk(i,t){const e=[],n=i.getProgramParameter(t,35721);for(let s=0;s<n;s++){const r=i.getActiveAttrib(t,s);if(!r)throw new Error("activeInfo");const{name:o,type:l}=r,u=i.getAttribLocation(t,o);if(u>=0){const f=gm(l),g=/instance/i.test(o)?"instance":"vertex";e.push({name:o,location:u,stepMode:g,type:f})}}return e.sort((s,r)=>s.location-r.location),e}function zk(i,t){const e=[],n=i.getProgramParameter(t,35971);for(let s=0;s<n;s++){const r=i.getTransformFeedbackVarying(t,s);if(!r)throw new Error("activeInfo");const{name:o,type:l,size:u}=r,f=gm(l),{type:g,components:p}=VT(f);e.push({location:s,name:o,type:g,size:u*p})}return e.sort((s,r)=>s.location-r.location),e}function Vk(i,t){const e=[],n=i.getProgramParameter(t,35718);for(let s=0;s<n;s++){const r=i.getActiveUniform(t,s);if(!r)throw new Error("activeInfo");const{name:o,size:l,type:u}=r,{name:f,isArray:g}=Hk(o);let p=i.getUniformLocation(t,f);const _={location:p,name:f,size:l,type:u,isArray:g};if(e.push(_),_.size>1)for(let v=0;v<_.size;v++){const b=`${f}[${v}]`;p=i.getUniformLocation(t,b);const x={..._,name:b,location:p};e.push(x)}}return e}function jk(i,t){const e=(r,o)=>i.getActiveUniformBlockParameter(t,r,o),n=[],s=i.getProgramParameter(t,35382);for(let r=0;r<s;r++){const o={name:i.getActiveUniformBlockName(t,r)||"",location:e(r,35391),byteLength:e(r,35392),vertex:e(r,35396),fragment:e(r,35398),uniformCount:e(r,35394),uniforms:[]},l=e(r,35395)||[],u=i.getActiveUniforms(t,l,35383),f=i.getActiveUniforms(t,l,35384),g=i.getActiveUniforms(t,l,35387),p=i.getActiveUniforms(t,l,35388);for(let _=0;_<o.uniformCount;++_){const v=i.getActiveUniform(t,l[_]);if(!v)throw new Error("activeInfo");const b=gm(u[_]);o.uniforms.push({name:v.name,format:b,type:u[_],arrayLength:f[_],byteOffset:g[_],byteStride:p[_]})}n.push(o)}return n.sort((r,o)=>r.location-o.location),n}function Hk(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function $k(i,t,e,n){const s=i;let r=n;r===!0&&(r=1),r===!1&&(r=0);const o=typeof r=="number"?[r]:r;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return i.uniform1i(t,n);case 5126:return i.uniform1fv(t,o);case 35664:return i.uniform2fv(t,o);case 35665:return i.uniform3fv(t,o);case 35666:return i.uniform4fv(t,o);case 5124:return i.uniform1iv(t,o);case 35667:return i.uniform2iv(t,o);case 35668:return i.uniform3iv(t,o);case 35669:return i.uniform4iv(t,o);case 35670:return i.uniform1iv(t,o);case 35671:return i.uniform2iv(t,o);case 35672:return i.uniform3iv(t,o);case 35673:return i.uniform4iv(t,o);case 5125:return s.uniform1uiv(t,o,1);case 36294:return s.uniform2uiv(t,o,2);case 36295:return s.uniform3uiv(t,o,3);case 36296:return s.uniform4uiv(t,o,4);case 35674:return i.uniformMatrix2fv(t,!1,o);case 35675:return i.uniformMatrix3fv(t,!1,o);case 35676:return i.uniformMatrix4fv(t,!1,o);case 35685:return s.uniformMatrix2x3fv(t,!1,o);case 35686:return s.uniformMatrix2x4fv(t,!1,o);case 35687:return s.uniformMatrix3x2fv(t,!1,o);case 35688:return s.uniformMatrix3x4fv(t,!1,o);case 35689:return s.uniformMatrix4x2fv(t,!1,o);case 35690:return s.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function Gk(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function Wk(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const ax=4;class qk extends Mr{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(t,e){super(t,e),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=e.vs,this.fs=e.fs;const{varyings:n,bufferMode:s=35981}=e;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,s)),this._linkShaders(),ot.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Uk(this.device.gl,this.handle),ot.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=e.shaderLayout?Xk(this.introspectedLayout,e.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,e){for(const[n,s]of Object.entries(t)){const r=this.shaderLayout.bindings.find(o=>o.name===n)||this.shaderLayout.bindings.find(o=>o.name===`${n}Uniforms`);if(!r){const o=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");e?.disableWarnings||ot.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${o}`,s)();continue}switch(s||ot.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),r.type){case"uniform":if(!(s instanceof Hl)&&!(s.buffer instanceof Hl))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ha||s instanceof $l||s instanceof jl))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":ot.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(r.type)}this.bindings[n]=s}}draw(t){const{renderPass:e,parameters:n=this.props.parameters,topology:s=this.props.topology,vertexArray:r,vertexCount:o,instanceCount:l,isInstanced:u=!1,firstVertex:f=0,transformFeedback:g}=t,p=Gk(s),_=!!r.indexBuffer,v=r.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return ot.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ot.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),r.bindBeforeRender(e),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const b=e;return wk(this.device,n,b.glParameters,()=>{_&&u?this.device.gl.drawElementsInstanced(p,o||0,v,f,l||0):_?this.device.gl.drawElements(p,o||0,v,f):u?this.device.gl.drawArraysInstanced(p,f,o||0,l||0):this.device.gl.drawArrays(p,f,o||0),g&&g.end()}),r.unbindAfterRender(e),!0}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ot.time(ax,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ot.timeEnd(ax,`linkProgram for ${this.id}`)(),ot.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}ot.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ot.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const e=this._getLinkStatus();this._reportLinkStatus(e)}async _reportLinkStatus(t){switch(t){case"success":return;default:const e=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${e} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${e} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${e} during ${t}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const t=async s=>await new Promise(r=>setTimeout(r,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const e of this.shaderLayout.bindings)!this.bindings[e.name]&&!this.bindings[e.name.replace(/Uniforms$/,"")]&&(ot.warn(`Binding ${e.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let e=0,n=0;for(const s of this.shaderLayout.bindings){const r=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:o}=s,l=t.getUniformBlockIndex(this.handle,o);if(l===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,n,l),r instanceof Hl?t.bindBufferBase(35345,n,r.handle):t.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof Ha||r instanceof $l||r instanceof jl))throw new Error("texture");let u;if(r instanceof Ha)u=r.texture;else if(r instanceof $l)u=r;else if(r instanceof jl&&r.colorAttachments[0]instanceof Ha)ot.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=r.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+e),t.bindTexture(u.glTarget,u.handle),e+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:e,location:n,type:s,textureUnit:r}=t,o=this.uniforms[e]??r;o!==void 0&&$k(this.device.gl,n,s,o)}}}function Xk(i,t){const e={...i,attributes:i.attributes.map(n=>({...n}))};for(const n of t?.attributes||[]){const s=e.attributes.find(r=>r.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):ot.warn(`shader layout attribute ${n.name} not present in shader`)}return e}class Yk extends L_{device;handle=null;commands=[];constructor(t){super(t,{}),this.device=t}_executeCommands(t=this.commands){for(const e of t)switch(e.name){case"copy-buffer-to-buffer":Kk(this.device,e.options);break;case"copy-buffer-to-texture":Zk(this.device,e.options);break;case"copy-texture-to-buffer":Qk(this.device,e.options);break;case"copy-texture-to-texture":Jk(this.device,e.options);break;default:throw new Error(e.name)}}}function Kk(i,t){const e=t.sourceBuffer,n=t.destinationBuffer;i.gl.bindBuffer(36662,e.handle),i.gl.bindBuffer(36663,n.handle),i.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function Zk(i,t){throw new Error("Not implemented")}function Qk(i,t){const{sourceTexture:e,mipLevel:n=0,aspect:s="all",width:r=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:f,byteOffset:g=0,bytesPerRow:p,rowsPerImage:_}=t;if(s!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||l!==0||p||_)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:b}=gE(e);let x;try{const T=f,w=r||v.width,M=o||v.height,E=hE(v.colorAttachments[0].texture.props.format),P=E.format,k=E.type;i.gl.bindBuffer(35051,T.handle),x=i.gl.bindFramebuffer(36160,v.handle),i.gl.readPixels(u[0],u[1],w,M,P,k,g)}finally{i.gl.bindBuffer(35051,null),x!==void 0&&i.gl.bindFramebuffer(36160,x),b&&v.destroy()}}function Jk(i,t){const{sourceTexture:e,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:r=[0,0],destinationTexture:o}=t;let{width:l=t.destinationTexture.width,height:u=t.destinationTexture.height}=t;const{framebuffer:f,destroyFramebuffer:g}=gE(e),[p,_]=s,[v,b,x]=r,T=i.gl.bindFramebuffer(36160,f.handle);let w,M;if(o instanceof $l)w=o,l=Number.isFinite(l)?l:w.width,u=Number.isFinite(u)?u:w.height,w._bind(0),M=w.glTarget;else throw new Error("invalid destination");switch(M){case 3553:case 34067:i.gl.copyTexSubImage2D(M,n,v,b,p,_,l,u);break;case 35866:case 32879:i.gl.copyTexSubImage3D(M,n,v,b,x,p,_,l,u);break}w&&w._unbind(),i.gl.bindFramebuffer(36160,T),g&&f.destroy()}function gE(i){if(i instanceof Re){const{width:t,height:e,id:n}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:e,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}const tB=[1,2,4,8];class eB extends Sr{device;handle=null;glParameters={};constructor(t,e){super(t,e),this.device=t;let n;if(!e?.parameters?.viewport)if(e?.framebuffer){const{width:r,height:o}=e.framebuffer;n=[0,0,r,o]}else{const[r,o]=t.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,r,o]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const r=this.props.framebuffer.colorAttachments.map((o,l)=>36064+l);this.device.gl.drawBuffers(r)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const e={...this.glParameters};e.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(e.depthMask=!this.props.depthReadOnly),e.stencilMask=this.props.stencilReadOnly?0:1,e[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(e.viewport=t.viewport.slice(0,4),e.depthRange=[t.viewport[4],t.viewport[5]]):e.viewport=t.viewport),t.scissorRect&&(e.scissorTest=!0,e.scissor=t.scissorRect),t.blendConstant&&(e.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=t.stencilReference),"colorMask"in t&&(e.colorMask=tB.map(n=>!!(n&t.colorMask))),this.glParameters=e,_o(this.device.gl,e)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let e=0;this.props.clearColors&&this.props.clearColors.forEach((n,s)=>{n&&this.clearColorBuffer(s,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(e|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(e|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(e|=1024,t.clearStencil=this.props.clearStencil),e!==0&&nc(this.device.gl,t,()=>{this.device.gl.clear(e)})}clearColorBuffer(t=0,e=[0,0,0,0]){nc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,e);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,e);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,e);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class ox extends D_{device;handle=null;commandBuffer;constructor(t,e){super(t,e),this.device=t,this.commandBuffer=new Yk(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new eB(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,e,n){}}function iB(i){const{target:t,source:e,start:n=0,count:s=1}=i,r=e.length,o=s*r;let l=0;for(let u=n;l<r;l++)t[u++]=e[l];for(;l<o;)l<o-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+o-l),l=o);return i.target}class pm extends k_{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return CC()==="Chrome"}constructor(t,e){super(t,e),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const e=t;if(e&&e.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,e?e.handle:null),this.indexBuffer=e,this.device.gl.bindVertexArray(null)}setBuffer(t,e){const n=e;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:r,stride:o,offset:l,normalized:u,integer:f,divisor:g}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),f?this.device.gl.vertexAttribIPointer(t,s,r,o,l):this.device.gl.vertexAttribPointer(t,s,r,u,o,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,g||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,e){this._enable(t,!1),this.attributes[t]=e}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const e=this.attributes[t];ArrayBuffer.isView(e)&&this.device.setConstantAttributeWebGL(t,e)}}_getAccessor(t){const e=this.attributeInfos[t];if(!e)throw new Error(`Unknown attribute location ${t}`);const n=uE(e.bufferDataType);return{size:e.bufferComponents,type:n,stride:e.byteStride,offset:e.byteOffset,normalized:e.normalized,integer:e.integer,divisor:e.stepMode==="instance"?1:0}}_enable(t,e=!0){const s=pm.isConstantAttributeZeroSupported(this.device)||t!==0;(e||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),e?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,e){const n=nB(e),s=n.byteLength*t,r=n.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o||=!sB(n,this.bufferValue),o){const l=C5(e.constructor,r);iB({target:l,source:n,start:0,count:r}),this.buffer.write(l),this.bufferValue=e}return this.buffer}}function nB(i){return Array.isArray(i)?new Float32Array(i):i}function sB(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}class rB extends B_{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,e){super(t,e),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,e.buffers&&this.setBuffers(e.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Wk(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])})}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:s,byteLength:r,byteOffset:o}=this._getBufferRange(e);if(n<0){this.unusedBuffers[t]=s,ot.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:s,byteLength:r,byteOffset:o},this.bindOnUse||this._bindBuffer(n,s,o,r)}getBuffer(t){if(lx(t))return this.buffers[t]||null;const e=this._getVaryingIndex(t);return e>=0?this.buffers[e]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let e;return this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Hl)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:e,byteOffset:n=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:e,byteOffset:n,byteLength:s}}_getVaryingIndex(t){if(lx(t))return Number(t);for(const e of this.layout.varyings||[])if(t===e.name)return e.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:e,byteLength:n,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),e,s,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,e,n=0,s){const r=e&&e.handle;!r||s===void 0?this.gl.bindBufferBase(35982,t,r):this.gl.bindBufferRange(35982,t,r,n,s)}}function lx(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class aB extends U_{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,e){if(super(t,e),this.device=t,e.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,s)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}function pE(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function oB(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function lB(i){return cB[i]}const cB={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function uB(i,t){const{sourceX:e=0,sourceY:n=0,sourceAttachment:s=0}=t||{};let{target:r=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:f,sourceType:g}=t||{};const{framebuffer:p,deleteFramebuffer:_}=_E(i),{gl:v,handle:b}=p;o||=p.width,l||=p.height;const x=p.colorAttachments[s]?.texture;if(!x)throw new Error(`Invalid framebuffer attachment ${s}`);u=x?.depth||1,f||=x?.glFormat||6408,g||=x?.glType||5121,r=dB(r,g,f,o,l);const T=P_(r);g=g||Nk(T);const w=v.bindFramebuffer(36160,b);return v.readBuffer(36064+s),v.readPixels(e,n,o,l,f,g,r),v.readBuffer(36064),v.bindFramebuffer(36160,w||null),_&&p.destroy(),r}function hB(i,t){const{target:e,sourceX:n=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:l,sourceHeight:u,sourceType:f}=t||{};const{framebuffer:g,deleteFramebuffer:p}=_E(i);l=l||g.width,u=u||g.height;const _=g;f=f||5121;let v=e;if(!v){const x=pE(r),T=oB(f),w=o+l*u*x*T;v=_.device.createBuffer({byteLength:w})}const b=i.device.createCommandEncoder();return b.copyTextureToBuffer({sourceTexture:i,width:l,height:u,origin:[n,s],destinationBuffer:v,byteOffset:o}),b.destroy(),p&&g.destroy(),v}function _E(i){return i instanceof Nf?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:fB(i),deleteFramebuffer:!0}}function fB(i,t){const{device:e,width:n,height:s,id:r}=i;return e.createFramebuffer({...t,id:`framebuffer-for-${r}`,width:n,height:s,colorAttachments:[i]})}function dB(i,t,e,n,s,r){if(i)return i;t||=5121;const o=lB(t),l=I_(o),u=pE(e);return new l(n*s*u)}class q0 extends Ir{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){return t!=="unorm8x4-bgra"}constructor(t){super({...t,id:t.id||vk("webgl-device")});const e=Ir._getCanvasContextProps(t);if(!e)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=e.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new yk(this,e),this.lost=new Promise(g=>{this._resolveContextLost=g});const s={...t.webgl};e.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const o=this.props._handle||QL(this.canvasContext.canvas,{onContextLost:g=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:g=>console.log("WebGL context restored")},s);if(!o)throw new Error("WebGL context creation failed");if(n=o.device,n){if(t._reuseDevices)return ot.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=o,this.gl=o,this.spectorJS=DL({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=JL(this.gl,this._extensions),this.limits=new pk(this.gl),this.features=new gk(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Rr(this.gl,{log:(...g)=>ot.log(1,...g)()}).trackState(this.gl,{copyState:!1});const u=t.debugWebGL||t.debug,f=t.debugWebGL;u&&(this.gl=BL(this.gl,{debugWebGL:u,traceWebGL:f}),ot.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ot.level=Math.max(ot.level,1))),this.commandEncoder=new ox(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const e=this._normalizeBufferProps(t);return new Hl(this,e)}createTexture(t){return new $l(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Pk(this,t)}createShader(t){return new Tk(this,t)}createFramebuffer(t){return new jl(this,t)}createVertexArray(t){return new pm(this,t)}createTransformFeedback(t){return new rB(this,t)}createQuerySet(t){return new aB(this,t)}createRenderPipeline(t){return new qk(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new ox(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,e){return uB(t,e)}readPixelsToBufferWebGL(t,e){return hB(t,e)}setParametersWebGL(t){_o(this.gl,t)}getParametersWebGL(t){return lE(this.gl,t)}withParametersWebGL(t,e){return nc(this.gl,t,e)}resetWebGL(){ot.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),qL(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return uk(this.gl,t,this._extensions)}loseDevice(){let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Rr.get(this.gl).push()}popState(){Rr.get(this.gl).pop()}getGLKey(t,e){const n=Number(t);for(const s in this.gl)if(this.gl[s]===n)return`GL.${s}`;return e?.emptyIfUnknown?"":String(t)}getGLKeys(t){const e={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[s,r])=>(n[`${s}:${this.getGLKey(s,e)}`]=`${r}:${this.getGLKey(r,e)}`,n),{})}setConstantAttributeWebGL(t,e){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const s=this._constants[t];switch(s&&mB(s,e)&&ot.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=e,e.constructor){case Float32Array:gB(this,t,e);break;case Int32Array:pB(this,t,e);break;case Uint32Array:_B(this,t,e);break;default:throw new Error("constant")}}getExtension(t){return oo(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,e,n){t.luma=e;const s={props:n.spector,id:n.spector.id};t.__SPECTOR_Metadata=s}}function gB(i,t,e){switch(e.length){case 1:i.gl.vertexAttrib1fv(t,e);break;case 2:i.gl.vertexAttrib2fv(t,e);break;case 3:i.gl.vertexAttrib3fv(t,e);break;case 4:i.gl.vertexAttrib4fv(t,e);break}}function pB(i,t,e){i.gl.vertexAttribI4iv(t,e)}function _B(i,t,e){i.gl.vertexAttribI4uiv(t,e)}function mB(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}const cx=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:q0},Symbol.toStringTag,{value:"Module"}));function Ls(){}const yB=({isDragging:i})=>i?"grabbing":"grab",mE={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ls,onWebGLInitialized:Ls,onResize:Ls,onViewStateChange:Ls,onInteractionStateChange:Ls,onBeforeRender:Ls,onAfterRender:Ls,onLoad:Ls,onError:i=>Lt.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:yB,getTooltip:null,debug:!1,drawPickingColors:!1};class sc{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new pc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=B0[n.type],r=n.offsetCenter;if(!s||!r||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:o,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:u}=l,f=u&&(u[s]||u.props[s]),g=this.props[s];let p=!1;f&&(p=f.call(u,l,n)),p||(g?.(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const s=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...mE,...t},t=this.props,t.viewState&&t.initialViewState&&Lt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let e=this.device;if(!e&&t.gl){t.gl instanceof WebGLRenderingContext&&Lt.error("WebGL1 context not supported.")();const n=this.props.deviceProps?.onResize;e=Gp.attach(t.gl,{...this.props.deviceProps,onResize:(s,r)=>{const{width:o,height:l}=s.canvas;s.drawingBufferWidth=o,s.drawingBufferHeight=l,this._needsRedraw="Canvas resized",n?.(s,r)}})}e||(e=this._createDevice(t)),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&ro.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Lt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Lt.removed("onLayerClick","onClick")(),t.initialViewState&&!Vi(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),t.device&&t.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==t.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Lt.log(`recreating animation loop for new device! id=${t.device.id}`)(),this.animationLoop=this._createAnimationLoop(t.device,t),this.animationLoop.start()),this.animationLoop?.setProps(e),t.useDevicePixels!==void 0&&this.device?.canvasContext&&this.device.canvasContext.setProps({useDevicePixels:t.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return e=e||n||s||r||o,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return ye(this.viewManager),this.viewManager.views}getViewports(t){return ye(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,e,n){ye(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),ye(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",t.width&&typeof t.width=="number"&&(e.width=t.width),t.height&&typeof t.height=="number"&&(e.height=t.height),(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const s=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=s}if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,n=t.clientHeight??t.height;(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.viewManager?.setProps({width:e,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:n}))}_createAnimationLoop(t,e){const{gl:n,onError:s}=e;return new sm({device:t,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:r=>this._setDevice(r.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(t){const e=this.props.deviceProps?.createCanvasContext,n=typeof e=="object"?e:void 0,s={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...t.deviceProps};s.adapters.includes(Gp)||s.adapters.push(Gp);const r={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},o=this.props.deviceProps?.onResize;return A0.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...r,...n,canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(l,u)=>{this._needsRedraw="Canvas resized",o?.(l,u)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new lm({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=e.length>0;let s=n,r=!1;for(const o of e)s=o,r=o.layer?.onHover(o,t.event)||r;r||(this.props.onHover?.(s,t.event),this.widgetManager.onHover(s,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const e=new Qw;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new QO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(T3).map(s=>{const[r,o,l,u]=T3[s],f=this.props.eventRecognizerOptions?.[s],g={...o,...f,event:s};return{recognizer:new r(g),recognizeWith:l,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in B0)this.eventManager.on(s,this._onEvent);this.viewManager=new ZD({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new KD(this.device,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new fL({deck:this,device:this.device}),this.deckRenderer=new pL(this.device),this.deckPicker=new yL(this.device),this.widgetManager=new xL({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new rE),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};this.deckRenderer?.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Lt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=A0.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}sc.defaultProps=mE;sc.VERSION=n6;function vB(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return I_(i)}}const bB=P_;function ch(i,t,e){const n=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:i,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function Er(i){return i.stride||i.size*i.bytesPerElement}function xB(i,t){return i.type===t.type&&i.size===t.size&&Er(i)===Er(t)&&(i.offset||0)===(t.offset||0)}function X0(i,t){t.offset&&Lt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Er(i),n=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,s=t.elementOffset||0,r=n*e+s*i.bytesPerElement+(i.offset||0);return{...t,offset:r,stride:e}}function SB(i,t){const e=X0(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class TB{constructor(t,e,n){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,r=s==="float64";let{defaultValue:o}=e;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;r?l="float32":!s&&e.isIndexed?l="uint32":l=s||"float32";let u=vB(s||l);this.doublePrecision=r,r&&e.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...e,defaultType:u,defaultValue:o,logicalType:s,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Er(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ro.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const n={};if(this.state.constant){const s=this.value;if(e){const r=X0(this.getAccessor(),e),o=r.offset/s.BYTES_PER_ELEMENT,l=r.size||this.size;n[t]=s.subarray(o,o+l)}else n[t]=s}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,e=null){const n=this.getAccessor(),s=[],r={name:this.id,byteStride:Er(n),attributes:s};if(this.doublePrecision){const o=SB(n,e||{});s.push(ch(t,{...n,...o.high},this.device.type),ch(`${t}64Low`,{...n,...o.low},this.device.type))}else if(e){const o=X0(n,e);s.push(ch(t,{...n,...o},this.device.type))}else s.push(ch(t,n,this.device.type));return r}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:s}=this,r=n*s;if(e&&r&&e.length>=r){const o=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let u=0;u<r;)for(let f=0;f<s;f++){const g=e[u++];g<o[f]&&(o[f]=g),g>l[f]&&(l[f]=g)}t=[o,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof fe?n={buffer:t}:n=t;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const o=bB(n.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=Er(s)}if(e.bounds=null,n.constant){let r=n.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!e.constant||!this._areValuesEqual(r,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(n.buffer){const r=n.buffer;e.externalBuffer=r,e.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let r=n.value;e.externalBuffer=null,e.constant=!1,this.value=r;let{buffer:o}=this;const l=Er(s),u=(s.vertexOffset||0)*l;if(this.doublePrecision&&r instanceof Float64Array&&(r=Up(r,s)),this.settings.isIndexed){const g=this.settings.defaultType;r.constructor!==g&&(r=new g(r))}const f=r.byteLength+u+l*2;(!o||o.byteLength<f)&&(o=this._createBuffer(f)),o.write(r,u)}return this.setAccessor(s),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:s}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?Up(e,{size:this.size,startIndex:n,endIndex:s}):e.subarray(n,s),n*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:n}=this,s=n.allocatedValue,r=ro.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<r.byteLength+o)&&(l=this._createBuffer(r.byteLength+o),e&&s&&l.write(s instanceof Float64Array?Up(s,this):s,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=e.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Lt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let o=r;for(;--o>=0;)e[n+o]=s[o];return e}switch(r){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let o=r;for(;--o>=0;)e[n+o]=Number.isFinite(t[o])?t[o]:s[o]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:e,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(e?fe.INDEX:fe.VERTEX)|fe.COPY_DST,indexType:e?n:void 0,byteLength:t}),this._buffer}}const ux=[],hx=[];function mo(i,t=0,e=1/0){let n=ux;const s={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?n=i:i.length>0&&(hx.length=i.length,n=hx):n=ux,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),s.index=t-1),{iterable:n,objectInfo:s}}function yE(i){return i&&i[Symbol.asyncIterator]}function vE(i,t){const{size:e,stride:n,offset:s,startIndices:r,nested:o}=t,l=i.BYTES_PER_ELEMENT,u=n?n/l:e,f=s?s/l:0,g=Math.floor((i.length-f)/u);return(p,{index:_,target:v})=>{if(!r){const w=_*u+f;for(let M=0;M<e;M++)v[M]=i[w+M];return v}const b=r[_],x=r[_+1]||g;let T;if(o){T=new Array(x-b);for(let w=b;w<x;w++){const M=w*u+f;v=new Array(e);for(let E=0;E<e;E++)v[E]=i[M+E];T[w-b]=v}}else if(u===e)T=i.subarray(b*e+f,x*e+f);else{T=new i.constructor((x-b)*e);let w=0;for(let M=b;M<x;M++){const E=M*u+f;for(let P=0;P<e;P++)T[w++]=i[E+P]}}return T}}const wB=[],Vh=[[0,1/0]];function EB(i,t){if(i===Vh||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],n=i.length;let s=0;for(let r=0;r<n;r++){const o=i[r];o[1]<t[0]?(e.push(o),s=r+1):o[0]>t[1]?e.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return e.splice(s,0,t),e}const AB={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function bE(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...AB[e],...t,...i,type:e}}class xE extends TB{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Vh}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!xB(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,s=Array.isArray(e)?t[e.find(r=>t[r])]:t[e];return bE(s,n)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:s=1/0}=e;this.state.updateRanges=EB(this.state.updateRanges,[n,s])}else this.state.updateRanges=Vh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=wB}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==Vh),!0):!1}updateBuffer({numInstances:t,data:e,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[f,g]of r)o.call(s,this,{data:e,startRow:f,endRow:g,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[f,g]of r){const p=Number.isFinite(f)?this.getVertexOffset(f):0,_=Number.isFinite(g)?this.getVertexOffset(g):l||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:p,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(t,e){const n=this.device.type==="webgpu";if(n||e===void 0||typeof e=="function"){if(n&&typeof e!="function"){const o=this._normalizeValue(e,[],0);this._areValuesEqual(o,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&t?this.settings.transform.call(t,e):e;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:n,settings:s}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),s.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const o=t;ye(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const l=!!o.size&&o.size!==this.size;return n.binaryAccessor=vE(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:e,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const n in t)Object.assign(e,super.getValue(n,t[n]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=s??"vertex",!e)return n;for(const r in e){const o=super._getBufferLayout(r,e[r]);n.attributes.push(...o.attributes)}return n}_autoUpdater(t,{data:e,startRow:n,endRow:s,props:r,numInstances:o}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:f,size:g,startIndices:p}=t,{accessor:_,transform:v}=l;let b=u.binaryAccessor||(typeof _=="function"?_:r[_]);typeof b!="function"&&typeof _=="string"&&(b=()=>r[_]),ye(typeof b=="function",`accessor "${_}" is not a function`);let x=t.getVertexOffset(n);const{iterable:T,objectInfo:w}=mo(e,n,s);for(const M of T){w.index++;let E=b(M,w);if(v&&(E=v.call(this,E)),p){const P=(w.index<p.length-1?p[w.index+1]:o)-p[w.index];if(E&&Array.isArray(E[0])){let k=x;for(const U of E)t._normalizeValue(U,f,k),k+=g}else E&&E.length>g?f.set(E,x):(t._normalizeValue(E,w.target,0),GD({target:f,source:w.target,start:x,count:P}));x+=P*g}else t._normalizeValue(E,f,x),x+=g}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Kp(i){const{source:t,target:e,start:n=0,size:s,getData:r}=i,o=i.end||e.length,l=t.length,u=o-n;if(l>u){e.set(t.subarray(0,u),n);return}if(e.set(t,n),!r)return;let f=l;for(;f<u;){const g=r(f,t);for(let p=0;p<s;p++)e[n+f]=g[p]||0,f++}}function MB({source:i,target:t,size:e,getData:n,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return Kp({source:i,target:t,size:e,getData:n}),t;let o=0,l=0;const u=n&&((g,p)=>n(g+l,p)),f=Math.min(s.length,r.length);for(let g=1;g<f;g++){const p=s[g]*e,_=r[g]*e;Kp({source:i.subarray(o,p),target:t,start:l,end:_,size:e,getData:u}),o=p,l=_}return l<t.length&&Kp({source:[],target:t,start:l,size:e,getData:u}),t}function CB(i){const{device:t,settings:e,value:n}=i,s=new xE(t,e);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),s}function SE(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function TE(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function wE(i){i.push(i.shift())}function RB(i,t){const{doublePrecision:e,settings:n,value:s,size:r}=i,o=e&&s instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=i.settings;if(u)for(const f of Object.values(u))l=Math.max(l,f.vertexOffset??0);return(n.noAlloc?s.length:(t+l)*r)*o}function EE({device:i,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e?.destroy(),e=i.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function AE({device:i,buffer:t,attribute:e,fromLength:n,toLength:s,fromStartIndices:r,getData:o=l=>l}){const l=e.doublePrecision&&e.value instanceof Float64Array?2:1,u=e.size*l,f=e.byteOffset,g=e.settings.bytesPerElement<4?f/e.settings.bytesPerElement*4:f,p=e.startIndices,_=r&&p,v=e.isConstant;if(!_&&t&&n>=s)return t;const b=e.value instanceof Float64Array?Float32Array:e.value.constructor,x=v?e.value:new b(e.getBuffer().readSyncWebGL(f,s*b.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!v){const E=o;o=(P,k)=>e.normalizeConstant(E(P,k))}const T=v?(E,P)=>o(x,P):(E,P)=>o(x.subarray(E+f,E+f+u),P),w=t?new Float32Array(t.readSyncWebGL(g,n*4).buffer):new Float32Array(0),M=new Float32Array(s);return MB({source:w,target:M,sourceStartIndices:r,targetStartIndices:p,size:u,getData:T}),(!t||t.byteLength<M.byteLength+g)&&(t?.destroy(),t=i.createBuffer({byteLength:M.byteLength+g,usage:35050})),t.write(M,g),t}class ME{constructor({device:t,attribute:e,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Lf(n),this.attribute=e,this.attributeInTransition=CB(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=RB(this.attribute,e),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class PB extends ME{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="interpolation",this.transform=DB(t,e)}start(t,e){const n=this.currentLength,s=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:o}=this;wE(r),r[0]=AE({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:t.enter}),r[1]=EE({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:l}=this,u=l.model;let f=Math.floor(this.currentLength/o.size);CE(o)&&(f/=2),u.setVertexCount(f),o.isConstant?(u.setAttributes({aFrom:r[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let s=n/t;e&&(s=e(s));const{model:r}=this.transform,o={time:s};r.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const IB=`uniform interpolationUniforms {
  float time;
} interpolation;
`,fx={name:"interpolation",vs:IB,uniformTypes:{time:"f32"}},OB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,NB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function CE(i){return i.doublePrecision&&i.value instanceof Float64Array}function DB(i,t){const e=t.size,n=SE(e),s=TE(e),r=t.getBufferLayout();return CE(t)?new ao(i,{vs:NB,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*e}]}],modules:[j8,fx],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ao(i,{vs:OB,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:r.attributes[0].format}],modules:[fx],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class LB extends ME{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="spring",this.texture=VB(t),this.framebuffer=jB(t,this.texture),this.transform=zB(t,e)}start(t,e){const n=this.currentLength,s=this.currentStartIndices;super.start(t,e);const{buffers:r,attribute:o}=this;for(let u=0;u<2;u++)r[u]=AE({device:this.device,buffer:r[u],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:t.enter});r[2]=EE({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:n,transition:s}=this,r=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const o={stiffness:r.stiffness,damping:r.damping};e.model.shaderInputs.setProps({spring:o}),e.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),wE(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const kB=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,BB={name:"spring",vs:kB,uniformTypes:{damping:"f32",stiffness:"f32"}},UB=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,FB=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function zB(i,t){const e=SE(t.size),n=TE(t.size);return new ao(i,{vs:UB,fs:FB,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[BB],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function VB(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function jB(i,t){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const HB={interpolation:PB,spring:LB};class $B{constructor(t,{id:e,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:n}){this.numInstances=n||1;for(const s in t){const r=t[s],o=r.getTransitionSetting(e);o&&this._updateAttribute(s,r,o)}for(const s in this.transitions){const r=t[s];(!r||!r.getTransitionSetting(e))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,n){const s=this.transitions[t];let r=!s||s.type!==n.type;if(r){s&&this._removeTransition(t);const o=HB[n.type];o?this.transitions[t]=new o({attribute:e,timeline:this.timeline,device:this.device}):(Lt.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const dx="attributeManager.invalidate",GB="attributeManager.updateStart",WB="attributeManager.updateEnd",qB="attribute.updateStart",XB="attribute.allocate",YB="attribute.updateEnd";class KB{constructor(t,{id:e="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=yc(uD),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new $B(t,{id:`${e}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);Ze(dx,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Ze(dx,this,"all")}update({data:t,numInstances:e,startIndices:n=null,transitions:s,props:r={},buffers:o={},context:l={}}){let u=!1;Ze(GB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const f in this.attributes){const g=this.attributes[f],p=g.settings.accessor;g.startIndices=n,g.numInstances=e,r[f]&&Lt.removed(`props.${f}`,`data.attributes.${f}`)(),g.setExternalBuffer(o[f])||g.setBinaryValue(typeof p=="string"?o[p]:void 0,t.startIndices)||typeof p=="string"&&!o[p]&&g.setConstantValue(l,r[p])||g.needsUpdate()&&(u=!0,this._updateAttribute({attribute:g,numInstances:e,data:t,props:r,context:l})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}u&&Ze(WB,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const r in e){const o=e[r];o.needsRedraw(t)&&!n.hasAttribute(r)&&(s[r]=o)}return s}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const n in t){const s=t[n],r={...s,id:n,size:s.isIndexed&&1||s.size||1,...e};this.attributes[n]=new xE(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(s=>{t[s]||(t[s]=[]),t[s].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:s}=this,r=s[t];return r&&r.forEach(o=>{const l=n[o];l&&l.setNeedsUpdate(l.id,e)}),r}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(Ze(qB,e),e.constant){e.setConstantValue(t.context,e.value);return}e.allocate(n)&&Ze(XB,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,Ze(YB,e,n))}}class ZB extends Lf{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:s,easing:r}}=this,o=r(t/s);this._value=ff(e,n,o)}}const gx=1e-5;function px(i,t,e,n,s){const r=t-i,l=(e-t)*s,u=-r*n;return l+u+r+t}function QB(i,t,e,n,s){if(Array.isArray(e)){const r=[];for(let o=0;o<e.length;o++)r[o]=px(i[o],t[o],e[o],n,s);return r}return px(i,t,e,n,s)}function _x(i,t){if(Array.isArray(i)){let e=0;for(let n=0;n<i.length;n++){const s=i[n]-t[n];e+=s*s}return Math.sqrt(e)}return Math.abs(i-t)}class JB extends Lf{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:s}=this.settings,{_prevValue:r=t,_currValue:o=t}=this;let l=QB(r,o,e,n,s);const u=_x(l,e),f=_x(l,o);u<gx&&f<gx&&(l=e,this.end()),this._prevValue=o,this._currValue=l}}const tU={interpolation:ZB,spring:JB};class eU{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,s){const{transitions:r}=this;if(r.has(t)){const u=r.get(t),{value:f=u.settings.fromValue}=u;e=f,this.remove(t)}if(s=bE(s),!s)return;const o=tU[s.type];if(!o){Lt.error(`unsupported transition type '${s.type}'`)();return}const l=new o(this.timeline);l.start({...s,fromValue:e,toValue:n}),r.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function iU(i){const t=i[Gs];for(const e in t){const n=t[e],{validate:s}=n;if(s&&!s(i[e],n))throw new Error(`Invalid prop ${e}: ${i[e]}`)}}function nU(i,t){const e=RE({newProps:i,oldProps:t,propTypes:i[Gs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=rU(i,t);let s=!1;return n||(s=aU(i,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:s,extensionsChanged:oU(i,t),transitionsChanged:sU(i,t)}}function sU(i,t){if(!i.transitions)return!1;const e={},n=i[Gs];let s=!1;for(const r in i.transitions){const o=n[r],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&Y0(i[r],t[r],o)&&(e[r]=!0,s=!0)}return s?e:!1}function RE({newProps:i,oldProps:t,ignoreProps:e={},propTypes:n={},triggerName:s="props"}){if(t===i)return!1;if(typeof i!="object"||i===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(const r of Object.keys(i))if(!(r in e)){if(!(r in t))return`${s}.${r} added`;const o=Y0(i[r],t[r],n[r]);if(o)return`${s}.${r} ${o}`}for(const r of Object.keys(t))if(!(r in e)){if(!(r in i))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(i,r)){const o=Y0(i[r],t[r],n[r]);if(o)return`${s}.${r} ${o}`}}return!1}function Y0(i,t,e){let n=e&&e.equal;return n&&!n(i,t,e)||!n&&(n=i&&t&&i.equals,n&&!n.call(i,t))?"changed deeply":!n&&t!==i?"changed shallowly":null}function rU(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:s}=i;return n?n(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&s&&(e=s(i.data,t.data)||e),e}function aU(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&mx(i,t,"all"))return{all:!0};const e={};let n=!1;for(const s in i.updateTriggers)s!=="all"&&mx(i,t,s)&&(e[s]=!0,n=!0);return n?e:!1}function oU(i,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=i;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(e[s]))return!0;return!1}function mx(i,t,e){let n=i.updateTriggers[e];n=n??{};let s=t.updateTriggers[e];return s=s??{},RE({oldProps:s,newProps:n,triggerName:e})}const lU="count(): argument not an object",cU="count(): argument not a container";function uU(i){if(!fU(i))throw new Error(lU);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(hU(i))return Object.keys(i).length;throw new Error(cU)}function hU(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function fU(i){return i!==null&&typeof i=="object"}function yx(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(s=>s.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const n={...i.inject};for(const s in t.inject)n[s]=(n[s]||"")+t.inject[s];e.inject=n}return e}const dU={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},K0={};function gU(i,t,e,n){if(e instanceof Re)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const{width:r,height:o}=e.data,l=t.createTexture({...e,sampler:{...dU,...s,...n},mipLevels:t.getMipLevelCount(r,o)});return l.generateMipmapsWebGL(),K0[l.id]=i,l}function pU(i,t){!t||!(t instanceof Re)||K0[t.id]===i&&(t.delete(),delete K0[t.id])}const _U={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||Z0(i)&&(i.length===3||i.length===4)},equal(i,t,e){return Vi(i,t,1)}},accessor:{validate(i,t){const e=mf(i);return e==="function"||e===mf(t.value)},equal(i,t,e){return typeof t=="function"?!0:Vi(i,t,1)}},array:{validate(i,t){return t.optional&&!i||Z0(i)},equal(i,t,e){const{compare:n}=e,s=Number.isInteger(n)?n:n?1:0;return n?Vi(i,t,s):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:n}=e,s=Number.isInteger(n)?n:n?1:0;return n?Vi(i,t,s):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{if(!i)return i;const{dataTransform:n}=e.props;return n?n(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,t,e)=>{const n=e.context;return!n||!n.device?null:gU(e.id,n.device,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{pU(e.id,i)}}};function mU(i){const t={},e={},n={};for(const[s,r]of Object.entries(i)){const o=r?.deprecatedFor;if(o)n[s]=Array.isArray(o)?o:[o];else{const l=yU(s,r);t[s]=l,e[s]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function yU(i,t){switch(mf(t)){case"object":return bl(i,t);case"array":return bl(i,{type:"array",value:t,compare:!1});case"boolean":return bl(i,{type:"boolean",value:t});case"number":return bl(i,{type:"number",value:t});case"function":return bl(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function bl(i,t){return"type"in t?{name:i,..._U[t.type],...t}:"value"in t?{name:i,type:mf(t.value),...t}:{name:i,type:"object",value:t}}function Z0(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function mf(i){return Z0(i)?"array":i===null?"null":typeof i}function vU(i,t){let e;for(let r=t.length-1;r>=0;r--){const o=t[r];"extensions"in o&&(e=o.extensions)}const n=Q0(i.constructor,e),s=Object.create(n);s[_f]=i,s[Br]={},s[Vs]={};for(let r=0;r<t.length;++r){const o=t[r];for(const l in o)s[l]=o[l]}return Object.freeze(s),s}const bU="_mergedDefaultProps";function Q0(i,t){if(!(i instanceof kf.constructor))return{};let e=bU;if(t)for(const s of t){const r=s.constructor;r&&(e+=`:${r.extensionName||r.name}`)}const n=PE(i,e);return n||(i[e]=xU(i,t||[]))}function xU(i,t){if(!i.prototype)return null;const n=Object.getPrototypeOf(i),s=Q0(n),r=PE(i,"defaultProps")||{},o=mU(r),l=Object.assign(Object.create(null),s,o.defaultProps),u=Object.assign(Object.create(null),s?.[Gs],o.propTypes),f=Object.assign(Object.create(null),s?.[Hp],o.deprecatedProps);for(const g of t){const p=Q0(g.constructor);p&&(Object.assign(l,p),Object.assign(u,p[Gs]),Object.assign(f,p[Hp]))}return SU(l,i),wU(l,u),TU(l,f),l[Gs]=u,l[Hp]=f,t.length===0&&!_m(i,"_propTypes")&&(i._propTypes=u),l}function SU(i,t){const e=AU(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function TU(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(n){const s=`${this.id}: ${e}`;for(const r of t[e])_m(this,r)||(this[r]=n);Lt.deprecated(s,t[e].join("/"))()}})}function wU(i,t){const e={},n={};for(const s in t){const r=t[s],{name:o,value:l}=r;r.async&&(e[o]=l,n[o]=EU(o))}i[Qa]=e,i[Br]={},Object.defineProperties(i,n)}function EU(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||yE(t)?this[Br][i]=t:this[Vs][i]=t},get(){if(this[Vs]){if(i in this[Vs])return this[Vs][i]||this[Qa][i];if(i in this[Br]){const t=this[_f]&&this[_f].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[Qa][i]}}return this[Qa][i]}}}function _m(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function PE(i,t){return _m(i,t)&&i[t]}function AU(i){const t=i.componentName;return t||Lt.warn(`${i.name}.componentName not specified`)(),t||i.name}let MU=0;class kf{constructor(...t){this.props=vU(this,t),this.id=this.props.id,this.count=MU++}clone(t){const{props:e}=this,n={};for(const s in e[Qa])s in e[Vs]?n[s]=e[Vs][s]:s in e[Br]&&(n[s]=e[Br][s]);return new this.constructor({...e,...n,...t})}}kf.componentName="Component";kf.defaultProps={};const CU=Object.freeze({});class RU{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||CU}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[_f]||this.component;const e=t[Vs]||{},n=t[Br]||t,s=t[Qa]||{};for(const r in e){const o=e[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o),e[r]=this.getAsyncProp(r)}for(const r in n){const o=n[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(yE(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const s=this.asyncProps[t];s&&n>=s.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=e,s.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;e.then(r=>{this.component&&(r=this._postProcessValue(n,r),this._setAsyncPropValue(t,r,s),this._onResolve(t,r))}).catch(r=>{this._onError(t,r)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let r=[],o=0;for await(const l of e){if(!this.component)return;const{dataTransform:u}=this.component.props;u?r=u(l,r):r=r.concat(l),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(t,r,s)}this._onResolve(t,r)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const s=this.component&&this.component.props[Gs];this.asyncProps[t]={type:s&&s[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class PU extends RU{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,s=n?.props.fetch;return s?s(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const s=n.props.onDataLoad;t==="data"&&s&&s(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,`loading ${t} of ${this.layer}`)}}const IU="layer.changeFlag",OU="layer.initialize",NU="layer.update",DU="layer.finalize",LU="layer.matched",vx=2**24-1,kU=Object.freeze([]),BU=yc(({oldViewport:i,viewport:t})=>i.equals(t));let Ki=new Uint8ClampedArray(0);const UU={data:{type:"data",value:kU,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:t,layer:e,loaders:n,loadOptions:s,signal:r})=>{const{resourceManager:o}=e.context;s=s||e.getLoadOptions(),n=n||e.props.loaders,r&&(s={...s,fetch:{...s?.fetch,signal:r}});let l=o.contains(i);return!l&&!s&&(o.add({resourceId:i,data:tf(i,n),persistent:!1}),l=!0),l?o.subscribe({resourceId:i,onChange:u=>e.internalState?.reloadAsyncProp(t,u),consumerId:e.id,requestId:t}):tf(i,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ft.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class rs extends kf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=La.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){ye(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=Zw(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,o]=qw(n,e.pixelProjectionMatrix);return t.length===2?[s,r]:[s,r,o]}unproject(t){return ye(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){ye(this.internalState);const n=this.internalState.viewport||this.context.viewport;return _D(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===Ft.DEFAULT||t===Ft.LNGLAT||t===Ft.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){ye(t instanceof Uint8Array);const[e,n,s]=t;return e+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:uU(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=yx(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=yx(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const s of n)e.invalidateAll(s);else e.invalidateAll();if(e){const{props:s}=t,r=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(r!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=e.attributes,f=l||u;f&&(o&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!o&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:n}){const{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(t,e){e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!BU({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const n in t)t[n].layoutChanged()&&(e=!0);for(const n of this.getModels())this._setModelAttributes(n,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),s=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const s in e)Object.defineProperty(n,s,{value:e[s]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const n=Math.floor(Ki.length/4);if(this.internalState.usesPickingColorCache=!0,n<e){e>vx&&Lt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ki=ro.allocate(Ki,e,{size:4,copy:!0,maxCount:Math.max(e,vx)});const s=Math.floor(Ki.length/4),r=[0,0,0];for(let o=n;o<s;o++)this.encodePickingColor(o,r),Ki[o*4+0]=r[0],Ki[o*4+1]=r[1],Ki[o*4+2]=r[2],Ki[o*4+3]=0}t.value=Ki.subarray(0,e*4)}_setModelAttributes(t,e,n=!1){if(!Object.keys(e).length)return;if(n){const l=this.getAttributeManager();t.setBufferLayout(l.getBufferLayouts(t)),e=l.getAttributes()}const s=t.userData?.excludeAttributes||{},r={},o={};for(const l in e){if(s[l])continue;const u=e[l].getValue();for(const f in u){const g=u[f];g instanceof fe?e[l].settings.isIndexed?t.setIndexBuffer(g):r[f]=g:g&&(o[f]=g)}}t.setAttributes(r),t.setConstantAttributes(o)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,r=n||s,o=r&&e.attributes&&e.attributes[r.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const g=r.getVertexOffset(f);l[g]===u[0]&&l[g+1]===u[1]&&l[g+2]===u[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,s=e||n;if(!s)return;const r=s.getVertexOffset(t),o=s.getVertexOffset(t+1);s.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Ki.buffer&&(n.value=Ki.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){ye(!this.internalState),ye(Number.isFinite(this.props.coordinateSystem)),Ze(OU,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new PU({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Lt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new eU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Ze(LU,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Ze(NU,this,t),!t)return;const e=this.props,n=this.context,s=this.internalState,r=n.viewport,o=this._updateUniformTransition();s.propsInTransition=o,n.viewport=s.viewport||r,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const g of this.props.extensions)g.updateState.call(this,l,g);this.setNeedsRedraw(),this._updateAttributes();const f=this.getModels()[0]!==u[0];this._postUpdate(l,f)}finally{n.viewport=r,this.props=e,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Ze(DU,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:l}=this.props,u=l&&l(n)||[0,0];o.device instanceof q0&&o.device.setParametersWebGL({polygonOffset:u});for(const f of this.getModels())f.device.type==="webgpu"?f.setParameters({...f.parameters,...s}):f.setParameters(s);if(o.device instanceof q0)o.device.withParametersWebGL(s,()=>{const f={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:s,context:o};for(const g of this.props.extensions)g.draw.call(this,f,g);this.draw(f)});else{const f={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:s,context:o};for(const g of this.props.extensions)g.draw.call(this,f,g);this.draw(f)}}finally{this.props=r}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const s in t)if(t[s]){let r=!1;switch(s){case"dataChanged":const o=t[s],l=e[s];o&&Array.isArray(l)&&(e.dataChanged=Array.isArray(o)?l.concat(o):o,r=!0);default:e[s]||(e[s]=t[s],r=!0)}r&&Ze(IU,this,s,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=nU(t,e);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged)this.internalState.uniformTransitions.add(s,e[s],t[s],t.transitions?.[s]);return this.setChangeFlags(n)}validateProps(){iU(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.highlightColor=n(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new KB(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:s}=t,r=this.state.model;r?.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=n;if(e||s.autoHighlight!==o||s.highlightedObjectIndex!==l||s.highlightColor!==u){const f={};Array.isArray(u)&&(f.highlightColor=u),(e||s.autoHighlight!==o||l!==s.highlightedObjectIndex)&&(f.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:f})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(t):!1;if(e=e||s,e)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}rs.defaultProps=UU;rs.layerName="Layer";const FU="compositeLayer.renderLayers";class Zs extends rs{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,s)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,s)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:u,highlightColor:f,coordinateSystem:g,coordinateOrigin:p,wrapLongitude:_,positionFormat:v,modelMatrix:b,extensions:x,fetch:T,operation:w,_subLayerProps:M}=this.props,E={id:"",updateTriggers:{},opacity:e,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:u,highlightColor:f,coordinateSystem:g,coordinateOrigin:p,wrapLongitude:_,positionFormat:v,modelMatrix:b,extensions:x,fetch:T,operation:w},P=M&&t.id&&M[t.id],k=P&&P.updateTriggers,U=t.id||"sublayer";if(P){const Y=this.props[Gs],et=t.type?t.type._propTypes:{};for(const K in P){const ut=et[K]||Y[K];ut&&ut.type==="accessor"&&(P[K]=this.getSubLayerAccessor(P[K]))}}Object.assign(E,t,P),E.id=`${this.props.id}-${U}`,E.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...k};for(const Y of x){const et=Y.getSubLayerProps.call(this,Y);et&&Object.assign(E,et,{updateTriggers:Object.assign(E.updateTriggers,et.updateTriggers)})}return E}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const s=!n||this.needsUpdate();if(s){const r=this.renderLayers();n=En(r,Boolean),this.internalState.subLayers=n}Ze(FU,this,s,n);for(const r of n)r.parent=this}}Zs.layerName="CompositeLayer";class zU extends sE{constructor(t){const{startPanPos:e,...n}=t;super(n),e!==void 0&&(this._state.startPanPos=e)}panStart({pos:t}){const{latitude:e,longitude:n,zoom:s}=this.getViewportProps();return this._getUpdatedState({startPanLngLat:[n,e],startPanPos:t,startZoom:s})}pan({pos:t,startPos:e}){const n=this.getState(),s=n.startPanLngLat||this._unproject(e);if(!s)return this;const r=n.startZoom??this.getViewportProps().zoom,o=n.startPanPos||e,l=[s[0],s[1],r],f=this.makeViewport(this.getViewportProps()).panByPosition(l,t,o);return this._getUpdatedState(f)}panEnd(){return this._getUpdatedState({startPanLngLat:null,startPanPos:null,startZoom:null})}zoom({scale:t}){const n=(this.getState().startZoom||this.getViewportProps().zoom)+Math.log2(t);return this._getUpdatedState({zoom:n})}applyConstraints(t){const{longitude:e,latitude:n,maxZoom:s,minZoom:r,zoom:o}=t,l=Fa(0),u=Fa(n)-l;return t.zoom=Sn(o,r+u,s+u),(e<-180||e>180)&&(t.longitude=aD(e+180,360)-180),t.latitude=Sn(n,-Tn,Tn),t}}class VU extends nE{constructor(){super(...arguments),this.ControllerState=zU,this.transition={transitionDuration:300,transitionInterpolator:new om(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(t){super.setProps(t),this.dragRotate=!1,this.touchRotate=!1}}class IE extends iE{constructor(t={}){super(t)}getViewportType(t){return t.zoom>12?ns:bc}get ControllerType(){return VU}}IE.displayName="GlobeView";class OE{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:e={}}=t;this.typedArrayManager=ro,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:s,geometryBuffer:r,positionFormat:o,dataChanged:l,normalize:u=!0}=this.opts;if(this.data=e,this.getGeometry=s,this.positionSize=r&&r.size||(o==="XY"?2:3),this.buffers=n,this.normalize=u,r&&(ye(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),u||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(l))for(const f of l)this._rebuildGeometry(f);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?vE(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:n,buffers:s,_attributeDefs:r,typedArrayManager:o}=this;for(const l in r)if(l in s)o.release(n[l]),n[l]=null;else{const u=r[l];u.copy=e,n[l]=o.allocate(n[l],t,u)}}_forEachGeometry(t,e,n){const{data:s,getGeometry:r}=this,{iterable:o,objectInfo:l}=mo(s,e,n);for(const u of o){l.index++;const f=r?r(u,l):null;t(f,l.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:n,instanceCount:s}=this;const{data:r,geometryBuffer:o}=this,{startRow:l=0,endRow:u=1/0}=t||{},f={};if(t||(e=[0],n=[0]),this.normalize||!o)this._forEachGeometry((p,_)=>{const v=p&&this.normalizeGeometry(p);f[_]=v,n[_+1]=n[_]+(v?this.getGeometrySize(v):0)},l,u),s=n[n.length-1];else if(n=r.startIndices,s=n[r.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof fe){const p=this.positionSize*4;s=s||o.byteLength/p}else if(o.buffer){const p=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/p}else if(o.value){const p=o.value,_=o.stride/p.BYTES_PER_ELEMENT||this.positionSize;s=s||p.length/_}this._allocate(s,!!t),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=s;const g={};this._forEachGeometry((p,_)=>{const v=f[_]||p;g.vertexStart=n[_],g.indexStart=e[_];const b=_<n.length-1?n[_+1]:s;g.geometrySize=b-n[_],g.geometryIndex=_,this.updateGeometryAttributes(v,g)},l,u),this.vertexCount=e[e.length-1]}}const rc="mapbox",Zp=512,jU=Math.PI/180;function mm({map:i,gl:t,deck:e}){if(i.__deck)return i.__deck;const n=e?.props._customRender,s=e?.props.onLoad,r={...e?.props,_customRender:()=>{i.triggerRepaint(),n?.("")}};r.parameters={...jh(i,!0),...r.parameters},r.views||(r.views=Gl(i));let o;return(!e||e.props.gl===t)&&(Object.assign(r,{gl:t,width:null,height:null,touchAction:"unset",viewState:ac(i)}),e?.isInitialized?bx(e,i):r.onLoad=()=>{s?.(),bx(o,i)}),e?(o=e,e.setProps(r),e.userData.isExternal=!0):(o=new sc(r),i.on("remove",()=>{NE(i)})),o.userData.mapboxLayers=new Set,i.__deck=o,i.on("render",()=>{o.isInitialized&&YU(o,i)}),o}function bx(i,t){const e=()=>{i.isInitialized?KU(i,t):t.off("move",e)};t.on("move",e)}function NE(i){i.__deck?.finalize(),i.__deck=null}function jh(i,t){const e=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return ym(i)==="globe"&&(e.cullMode="back"),e}function HU(i,t){i.userData.mapboxLayers.add(t),bm(i)}function $U(i,t){i.userData.mapboxLayers.delete(t),bm(i)}function GU(i,t){bm(i)}function WU(i,t,e,n){let{currentViewport:s}=i.userData,r=!1;s||(s=vm(i,t,n),i.userData.currentViewport=s,r=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:o=>(!i.props.layerFilter||i.props.layerFilter(o))&&(e.id===o.layer.id||o.layer.props.operation.includes("terrain")),clearStack:r,clearCanvas:!1})}function qU(i,t,e,n){let{currentViewport:s}=i.userData,r=!1;s||(s=vm(i,t,n),i.userData.currentViewport=s,r=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:o=>{if(i.props.layerFilter&&!i.props.layerFilter(o))return!1;const l=o.layer;return l.props.beforeId===e.beforeId&&l.props.slot===e.slot},clearStack:r,clearCanvas:!1})}function ym(i){const t=i.getProjection?.(),e=t?.type||t?.name;if(e==="globe")return"globe";if(e&&e!=="mercator")throw new Error("Unsupported projection");return"mercator"}function Gl(i){return ym(i)==="globe"?new IE({id:rc}):new lm({id:rc})}function ac(i){const{lng:t,lat:e}=i.getCenter(),n={longitude:(t+540)%360-180,latitude:e,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return i.getTerrain?.()&&XU(i,n),n}function XU(i,t){if(i.getFreeCameraOptions){const{position:e}=i.getFreeCameraOptions();if(!e||e.z===void 0)return;const n=i.transform.height,{longitude:s,latitude:r,pitch:o}=t,l=e.x*Zp,u=(1-e.y)*Zp,f=e.z*Zp,g=is([s,r]),p=l-g[0],_=u-g[1],v=Math.sqrt(p*p+_*_),b=o*jU,x=1.5*n,T=b<.001?x*Math.cos(b)/f:x*Math.sin(b)/v;t.zoom=Math.log2(T);const w=x*Math.cos(b)/T,M=f-w;t.position=[0,0,M/Fh(r)]}else typeof i.transform.elevation=="number"&&(t.position=[0,0,i.transform.elevation])}function vm(i,t,e){const n=ac(t),{views:s}=i.props,r=s&&En(s).find(u=>u.id===rc)||Gl(t);e&&(r.props.nearZMultiplier=.2);const o=e?.nearZ??t.transform._nearZ,l=e?.farZ??t.transform._farZ;return Number.isFinite(o)&&(n.nearZ=o/t.transform.height,n.farZ=l/t.transform.height),r.makeViewport({width:i.width,height:i.height,viewState:n})}function YU(i,t){const{mapboxLayers:e,isExternal:n}=i.userData;if(n){const s=Array.from(e,g=>g.id),o=En(i.props.layers,Boolean).some(g=>g&&!s.includes(g.id));let l=i.getViewports();const u=l.findIndex(g=>g.id===rc),f=l.length>1||u<0;(o||f)&&(u>=0&&(l=l.slice(),l[u]=vm(i,t)),i._drawLayers("mapbox-repaint",{viewports:l,layerFilter:g=>(!i.props.layerFilter||i.props.layerFilter(g))&&(g.viewport.id!==rc||!s.includes(g.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function KU(i,t){i.setProps({viewState:ac(t)}),i.needsRedraw({clearRedrawFlags:!0})}function bm(i){if(i.userData.isExternal)return;const t=[];i.userData.mapboxLayers.forEach(e=>{const n=e.props.type,s=new n(e.props);t.push(s)}),i.setProps({layers:t})}class ZU{constructor(t){if(!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.slot=t.slot,this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=mm({map:t,gl:e,deck:this.props.deck}),HU(this.deck,this)}onRemove(){this.deck&&$U(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&GU(this.deck)}render(t,e){WU(this.deck,this.map,this,e)}}const Qp="__UNDEFINED__";function QU(i,t,e,n){if(!i||!t||!i.style||!i.style._loaded)return;const s=En(n,Boolean);if(e!==n){const l=En(e,Boolean),u=new Set(l.map(f=>f.id));for(const f of s)u.delete(f.id);for(const f of u)i.getLayer(f)&&i.removeLayer(f)}for(const l of s){const u=i.getLayer(l.id);u?(u.implementation||u).setProps(l.props):i.addLayer(new ZU({id:l.id,deck:t,slot:l.props.slot}),l.props.beforeId)}const r=i.style._order,o={};for(const l of s){let{beforeId:u}=l.props;(!u||!r.includes(u))&&(u=Qp),o[u]=o[u]||[],o[u].push(l.id)}for(const l in o){const u=o[l];let f=l===Qp?r.length:r.indexOf(l),g=l===Qp?void 0:l;for(let p=u.length-1;p>=0;p--){const _=u[p],v=r.indexOf(_);v!==f-1&&(i.moveLayer(_,g),v>f&&f++),f--,g=_}}}class JU{constructor(t){ye(t.id,"id is required"),this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.slot=t.slot,this.beforeId=t.beforeId,this.map=null,this.deck=null}onAdd(t,e){this.map=t,this.deck=mm({map:t,gl:e})}render(t,e){!this.deck||!this.map||qU(this.deck,this.map,this,e)}}const Jp="__UNDEFINED__";function t0(i){return i.props.beforeId?`deck-layer-group-before:${i.props.beforeId}`:i.props.slot?`deck-layer-group-slot:${i.props.slot}`:"deck-layer-group-last"}function t7(i,t,e){if(!i||!i.style||!i.style._loaded)return;const n=En(e,Boolean);if(t!==e){const o=En(t,Boolean),l=new Set(o.map(f=>t0(f))),u=new Set(n.map(f=>t0(f)));for(const f of l)u.has(f)||i.getLayer(f)&&i.removeLayer(f)}const s={};for(const o of n){const l=t0(o),u=i.getLayer(l);if(u){const f=u.implementation||u;s[l]=f}else{const f=new JU({id:l,slot:o.props.slot,beforeId:o.props.beforeId});s[l]=f,i.addLayer(f,o.props.beforeId)}}const r=i.style._order;for(const[o,l]of Object.entries(s)){const u=l.beforeId||Jp,f=u===Jp?r.length:r.indexOf(u);if(r.indexOf(o)!==f-1){const p=u===Jp?void 0:u;i.moveLayer(o,p)}}}class e7{constructor(t){this._handleStyleChange=()=>{if(this._resolveLayers(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;ym(this._map)&&!this._props.views&&this._deck?.setProps({views:Gl(this._map)})},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:n,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${s}px`})}},this._updateViewState=()=>{const n=this._deck,s=this._map;n&&s&&(n.setProps({views:this._props.views||Gl(s),viewState:ac(s)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{const s=this._deck;if(!s||!s.isInitialized)return;const r={type:n.type,offsetCenter:n.point,srcEvent:n},o=this._lastMouseDownPoint;switch(!n.point&&o&&(r.deltaX=n.originalEvent.clientX-o.clientX,r.deltaY=n.originalEvent.clientY-o.clientY,r.offsetCenter={x:o.x+r.deltaX,y:o.y+r.deltaY}),r.type){case"mousedown":s._onPointerDown(r),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":r.type="panstart",s._onEvent(r);break;case"drag":r.type="panmove",s._onEvent(r);break;case"dragend":r.type="panend",s._onEvent(r);break;case"click":r.tapCount=1,s._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,s._onEvent(r);break;case"mousemove":r.type="pointermove",s._onPointerMove(r);break;case"mouseout":r.type="pointerleave",s._onPointerMove(r);break;default:return}};const{interleaved:e=!1}=t;this._interleaved=e,this._renderLayersInGroups=t._renderLayersInGroups||!1,this._props=this.filterProps(t)}filterProps(t){const{interleaved:e=!1,useDevicePixels:n,...s}=t;return!e&&n!==void 0&&(s.useDevicePixels=n),s}setProps(t){this._interleaved&&t.layers&&this._resolveLayers(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,this.filterProps(t)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...jh(this._map,this._interleaved),...this._props.parameters}})}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){const e=document.createElement("div");return Object.assign(e.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=e,this._deck=new sc({...this._props,parent:e,parameters:{...jh(t,!1),...this._props.parameters},views:this._props.views||Gl(t),viewState:ac(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),e}_onAddInterleaved(t){const e=t.painter.context.gl;return e instanceof WebGLRenderingContext&&Lt.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=mm({map:t,gl:e,deck:new sc({...this._props,gl:e,parameters:{...jh(t,!0),...this._props.parameters}})}),t.on("styledata",this._handleStyleChange),this._resolveLayers(t,this._deck,[],this._props.layers),document.createElement("div")}_resolveLayers(t,e,n,s){this._renderLayersInGroups?t7(t,n,s):QU(t,e,n,s)}onRemove(){const t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),this._resolveLayers(t,this._deck,this._props.layers,[]),NE(t)}getDefaultPosition(){return"top-left"}pickObject(t){return ye(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return ye(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return ye(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const xx=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,i7={name:"icon",vs:xx,fs:xx,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},n7=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,s7=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,r7=1024,a7=4,Sx=()=>{},Tx={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},o7={x:0,y:0,width:0,height:0};function l7(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function c7(i,t,e,n){const s=Math.min(e/t.width,n/t.height),r=Math.floor(t.width*s),o=Math.floor(t.height*s);return s===1?{image:t,width:r,height:o}:(i.canvas.height=o,i.canvas.width=r,i.clearRect(0,0,r,o),i.drawImage(t,0,0,t.width,t.height,0,0,r,o),{image:i.canvas,width:r,height:o})}function oc(i){return i&&(i.id||i.url)}function u7(i,t,e,n){const{width:s,height:r,device:o}=i,l=o.createTexture({format:"rgba8unorm",width:t,height:e,sampler:n,mipLevels:o.getMipLevelCount(t,e)}),u=o.createCommandEncoder();return u.copyTextureToTexture({sourceTexture:i,destinationTexture:l,width:s,height:r}),u.finish(),l.generateMipmapsWebGL(),i.destroy(),l}function wx(i,t,e){for(let n=0;n<t.length;n++){const{icon:s,xOffset:r}=t[n],o=oc(s);i[o]={...s,x:r,y:e}}}function h7({icons:i,buffer:t,mapping:e={},xOffset:n=0,yOffset:s=0,rowHeight:r=0,canvasWidth:o}){let l=[];for(let u=0;u<i.length;u++){const f=i[u],g=oc(f);if(!e[g]){const{height:p,width:_}=f;n+_+t>o&&(wx(e,l,s),n=0,s=r+s+t,r=0,l=[]),l.push({icon:f,xOffset:n}),n=n+_+t,r=Math.max(r,p)}}return l.length>0&&wx(e,l,s),{mapping:e,rowHeight:r,xOffset:n,yOffset:s,canvasWidth:o,canvasHeight:l7(r+s+t)}}function f7(i,t,e){if(!i||!t)return null;e=e||{};const n={},{iterable:s,objectInfo:r}=mo(i);for(const o of s){r.index++;const l=t(o,r),u=oc(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!n[u]&&(!e[u]||l.url!==e[u].url)&&(n[u]={...l,source:o,sourceIndex:r.index})}return n}class d7{constructor(t,{onUpdate:e=Sx,onError:n=Sx}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=a7,this._canvasWidth=r7,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=e,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?oc(t):t;return this._mapping[e]||o7}setProps({loadOptions:t,autoPacking:e,iconAtlas:n,iconMapping:s,textureParameters:r}){t&&(this._loadOptions=t),e!==void 0&&(this._autoPacking=e),s&&(this._mapping=s),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),r&&(this._samplerParameters=r)}get isLoaded(){return this._pendingCount===0}packIcons(t,e){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(f7(t,e,this._mapping)||{});if(n.length>0){const{mapping:s,xOffset:r,yOffset:o,rowHeight:l,canvasHeight:u}=h7({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=s,this._xOffset=r,this._yOffset=o,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||Tx,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=u7(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||Tx)),this.onUpdate(!0),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,tf(n.url,this._loadOptions).then(s=>{const r=oc(n),o=this._mapping[r],{x:l,y:u,width:f,height:g}=o,{image:p,width:_,height:v}=c7(e,s,f,g),b=l+(f-_)/2,x=u+(g-v)/2;this._texture?.copyExternalImage({image:p,x:b,y:x,width:_,height:v}),o.x=b,o.y=x,o.width=_,o.height=v,this._texture?.generateMipmapsWebGL(),this.onUpdate(_!==f||v!==g)}).catch(s=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const DE=[0,0,0,255],g7={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:DE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Bf extends rs{getShaders(){return super.getShaders({vs:n7,fs:s7,modules:[fo,go,i7]})}initializeState(){this.state={iconManager:new d7(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:DE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:s}=t,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:l,data:u,getIcon:f,textureParameters:g}=e,{iconManager:p}=this.state;if(typeof o=="string")return;const _=o||this.internalState.isAsyncPropLoading("iconAtlas");p.setProps({loadOptions:e.loadOptions,autoPacking:!_,iconAtlas:o,iconMapping:_?l:null,textureParameters:g}),_?n.iconMapping!==e.iconMapping&&r.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&p.packIcons(u,f),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeBasis:n,sizeMinPixels:s,sizeMaxPixels:r,sizeUnits:o,billboard:l,alphaCutoff:u}=this.props,{iconManager:f}=this.state,g=f.getTexture();if(g){const p=this.state.model,_={iconsTexture:g,iconsTextureDim:[g.width,g.height],sizeUnits:ts[o],sizeScale:e,sizeBasis:n==="height"?1:0,sizeMinPixels:s,sizeMaxPixels:r,billboard:l,alphaCutoff:u};p.shaderInputs.setProps({icon:_}),p.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new $i(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jn({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(t){t?(this.getAttributeManager()?.invalidate("getIcon"),this.setNeedsUpdate()):this.setNeedsRedraw()}_onError(t){const e=this.getCurrentLayer()?.props.onIconError;e?e(t):Lt.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:n,anchorX:s=e/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(t);return[e/2-s,n/2-r]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:n,width:s,height:r}=this.state.iconManager.getIconMapping(t);return[e,n,s,r]}}Bf.defaultProps=g7;Bf.layerName="IconLayer";const Ex=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,p7={name:"scatterplot",vs:Ex,fs:Ex,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},_7=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,m7=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,y7=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Ax=[0,0,0,255],v7={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Ax},getLineColor:{type:"accessor",value:Ax},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class xm extends rs{getShaders(){return super.getShaders({vs:_7,fs:m7,source:y7,modules:[fo,eO,go,p7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,stroked:o,filled:l,billboard:u,antialiasing:f,lineWidthUnits:g,lineWidthScale:p,lineWidthMinPixels:_,lineWidthMaxPixels:v}=this.props,b={stroked:o,filled:l,billboard:u,antialiasing:f,radiusUnits:ts[e],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:ts[g],lineWidthScale:p,lineWidthMinPixels:_,lineWidthMaxPixels:v},x=this.state.model;x.shaderInputs.setProps({scatterplot:b}),this.context.device.type==="webgpu"&&(x.instanceCount=this.props.data.length),x.draw(this.context.renderPass)}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new $i(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jn({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0,parameters:t})}}xm.defaultProps=v7;xm.layerName="ScatterplotLayer";const LE={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function kE(i,t,e={}){return b7(i,e)!==t?(S7(i,e),!0):!1}function b7(i,t={}){return Math.sign(x7(i,t))}const Mx={x:0,y:1,z:2};function x7(i,t={}){const{start:e=0,end:n=i.length,plane:s="xy"}=t,r=t.size||2;let o=0;const l=Mx[s[0]],u=Mx[s[1]];for(let f=e,g=n-r;f<n;f+=r)o+=(i[f+l]-i[g+l])*(i[f+u]+i[g+u]),g=f;return o/2}function S7(i,t){const{start:e=0,end:n=i.length,size:s=2}=t,r=(n-e)/s,o=Math.floor(r/2);for(let l=0;l<o;++l){const u=e+l*s,f=e+(r-1-l)*s;for(let g=0;g<s;++g){const p=i[u+g];i[u+g]=i[f+g],i[f+g]=p}}}function tn(i,t){const e=t.length,n=i.length;if(n>0){let s=!0;for(let r=0;r<e;r++)if(i[n-e+r]!==t[r]){s=!1;break}if(s)return!1}for(let s=0;s<e;s++)i[n+s]=t[s];return!0}function J0(i,t){const e=t.length;for(let n=0;n<e;n++)i[n]=t[n]}function lc(i,t,e,n,s=[]){const r=n+t*e;for(let o=0;o<e;o++)s[o]=i[r+o];return s}function t_(i,t,e,n,s=[]){let r,o;if(e&8)r=(n[3]-i[1])/(t[1]-i[1]),o=3;else if(e&4)r=(n[1]-i[1])/(t[1]-i[1]),o=1;else if(e&2)r=(n[2]-i[0])/(t[0]-i[0]),o=2;else if(e&1)r=(n[0]-i[0])/(t[0]-i[0]),o=0;else return null;for(let l=0;l<i.length;l++)s[l]=(o&1)===l?n[o]:r*(t[l]-i[l])+i[l];return s}function Hh(i,t){let e=0;return i[0]<t[0]?e|=1:i[0]>t[2]&&(e|=2),i[1]<t[1]?e|=4:i[1]>t[3]&&(e|=8),e}function BE(i,t){const{size:e=2,broken:n=!1,gridResolution:s=10,gridOffset:r=[0,0],startIndex:o=0,endIndex:l=i.length}=t||{},u=(l-o)/e;let f=[];const g=[f],p=lc(i,0,e,o);let _,v;const b=FE(p,s,r,[]),x=[];tn(f,p);for(let T=1;T<u;T++){for(_=lc(i,T,e,o,_),v=Hh(_,b);v;){t_(p,_,v,b,x);const w=Hh(x,b);w&&(t_(p,x,w,b,x),v=w),tn(f,x),J0(p,x),w7(b,s,v),n&&f.length>e&&(f=[],g.push(f),tn(f,p)),v=Hh(_,b)}tn(f,_),J0(p,_)}return n?g:g[0]}const Cx=0,T7=1;function UE(i,t=null,e){if(!i.length)return[];const{size:n=2,gridResolution:s=10,gridOffset:r=[0,0],edgeTypes:o=!1}=e||{},l=[],u=[{pos:i,types:o?new Array(i.length/n).fill(T7):null,holes:t||[]}],f=[[],[]];let g=[];for(;u.length;){const{pos:p,types:_,holes:v}=u.shift();E7(p,n,v[0]||p.length,f),g=FE(f[0],s,r,g);const b=Hh(f[1],g);if(b){let x=Rx(p,_,n,0,v[0]||p.length,g,b);const T={pos:x[0].pos,types:x[0].types,holes:[]},w={pos:x[1].pos,types:x[1].types,holes:[]};u.push(T,w);for(let M=0;M<v.length;M++)x=Rx(p,_,n,v[M],v[M+1]||p.length,g,b),x[0]&&(T.holes.push(T.pos.length),T.pos=uh(T.pos,x[0].pos),o&&(T.types=uh(T.types,x[0].types))),x[1]&&(w.holes.push(w.pos.length),w.pos=uh(w.pos,x[1].pos),o&&(w.types=uh(w.types,x[1].types)))}else{const x={positions:p};o&&(x.edgeTypes=_),v.length&&(x.holeIndices=v),l.push(x)}}return l}function Rx(i,t,e,n,s,r,o){const l=(s-n)/e,u=[],f=[],g=[],p=[],_=[];let v,b,x;const T=lc(i,l-1,e,n);let w=Math.sign(o&8?T[1]-r[3]:T[0]-r[2]),M=t&&t[l-1],E=0,P=0;for(let k=0;k<l;k++)v=lc(i,k,e,n,v),b=Math.sign(o&8?v[1]-r[3]:v[0]-r[2]),x=t&&t[n/e+k],b&&w&&w!==b&&(t_(T,v,o,r,_),tn(u,_)&&g.push(M),tn(f,_)&&p.push(M)),b<=0?(tn(u,v)&&g.push(x),E-=b):g.length&&(g[g.length-1]=Cx),b>=0?(tn(f,v)&&p.push(x),P+=b):p.length&&(p[p.length-1]=Cx),J0(T,v),w=b,M=x;return[E?{pos:u,types:t&&g}:null,P?{pos:f,types:t&&p}:null]}function FE(i,t,e,n){const s=Math.floor((i[0]-e[0])/t)*t+e[0],r=Math.floor((i[1]-e[1])/t)*t+e[1];return n[0]=s,n[1]=r,n[2]=s+t,n[3]=r+t,n}function w7(i,t,e){e&8?(i[1]+=t,i[3]+=t):e&4?(i[1]-=t,i[3]-=t):e&2?(i[0]+=t,i[2]+=t):e&1&&(i[0]-=t,i[2]-=t)}function E7(i,t,e,n){let s=1/0,r=-1/0,o=1/0,l=-1/0;for(let u=0;u<e;u+=t){const f=i[u],g=i[u+1];s=f<s?f:s,r=f>r?f:r,o=g<o?g:o,l=g>l?g:l}return n[0][0]=s,n[0][1]=o,n[1][0]=r,n[1][1]=l,n}function uh(i,t){for(let e=0;e<t.length;e++)i.push(t[e]);return i}const A7=85.051129;function M7(i,t){const{size:e=2,startIndex:n=0,endIndex:s=i.length,normalize:r=!0}=t||{},o=i.slice(n,s);zE(o,e,0,s-n);const l=BE(o,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const u of l)VE(u,e);return l}function C7(i,t=null,e){const{size:n=2,normalize:s=!0,edgeTypes:r=!1}=e||{};t=t||[];const o=[],l=[];let u=0,f=0;for(let p=0;p<=t.length;p++){const _=t[p]||i.length,v=f,b=R7(i,n,u,_);for(let x=b;x<_;x++)o[f++]=i[x];for(let x=u;x<b;x++)o[f++]=i[x];zE(o,n,v,f),P7(o,n,v,f,e?.maxLatitude),u=_,l[p]=f}l.pop();const g=UE(o,l,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:r});if(s)for(const p of g)VE(p.positions,n);return g}function R7(i,t,e,n){let s=-1,r=-1;for(let o=e+1;o<n;o+=t){const l=Math.abs(i[o]);l>s&&(s=l,r=o-1)}return r}function P7(i,t,e,n,s=A7){const r=i[e],o=i[n-t];if(Math.abs(r-o)>180){const l=lc(i,0,t,e);l[0]+=Math.round((o-r)/360)*360,tn(i,l),l[1]=Math.sign(l[1])*s,tn(i,l),l[0]=r,tn(i,l)}}function zE(i,t,e,n){let s=i[0],r;for(let o=e;o<n;o+=t){r=i[o];const l=r-s;(l>180||l<-180)&&(r-=Math.round(l/360)*360),i[o]=s=r}}function VE(i,t){let e;const n=i.length/t;for(let r=0;r<n&&(e=i[r*t],(e+180)%360===0);r++);const s=-Math.round(e/360)*360;if(s!==0)for(let r=0;r<n;r++)i[r*t]+=s}function I7(i,t,e,n){let s;if(Array.isArray(i[0])){const r=i.length*t;s=new Array(r);for(let o=0;o<i.length;o++)for(let l=0;l<t;l++)s[o*t+l]=i[o][l]||0}else s=i;return e?BE(s,{size:t,gridResolution:e}):n?M7(s,{size:t}):s}const O7=1,N7=2,e0=4;class D7 extends OE{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?I7(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(Px(t)){let n=0;for(const s of t)n+=this.getGeometrySize(s);return n}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(e.geometrySize!==0)if(t&&Px(t))for(const n of t){const s=this.getGeometrySize(n);e.geometrySize=s,this.updateGeometryAttributes(n,e),e.vertexStart+=s}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const n=this.attributes.segmentTypes,s=t?this.isClosed(t):!1,{vertexStart:r,geometrySize:o}=e;n.fill(0,r,r+o),s?(n[r]=e0,n[r+o-2]=e0):(n[r]+=O7,n[r+o-2]+=N7),n[r+o-1]=e0}_updatePositions(t,e){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:s,geometrySize:r}=e,o=new Array(3);for(let l=s,u=0;u<r;l++,u++)this.getPointOnPath(t,u,o),n[l*3]=o[0],n[l*3+1]=o[1],n[l*3+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,n=[]){const{positionSize:s}=this;e*s>=t.length&&(e+=1-t.length/s);const r=e*s;return n[0]=t[r],n[1]=t[r+1],n[2]=s===3&&t[r+2]||0,n}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:e}=this,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(e===2||t[2]===t[n+2])}}function Px(i){return Array.isArray(i[0])}const Ix=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,L7={name:"path",vs:Ix,fs:Ix,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},k7=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,B7=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jE=[0,0,0,255],U7={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:i=>i.path},getColor:{type:"accessor",value:jE},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},i0={enter:(i,t)=>t.length?t.subarray(t.length-i.length):i};class xc extends rs{getShaders(){return super.getShaders({vs:k7,fs:B7,modules:[fo,go,L7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:i0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:i0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:i0,defaultValue:jE},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:s,target:r})=>this.encodePickingColor(n&&n.__source?n.__source.index:s,r)}}),this.setState({pathTesselator:new D7({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:n}=t,s=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,l=e.data.attributes||{};o.updateGeometry({data:e.data,geometryBuffer:l.getPath,buffers:l,normalize:!e._pathType,loop:e._pathType==="loop",getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||s.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,s=this.props.data;return s[0]&&s[0].__source&&(e.object=s.find(r=>r.__source.index===n)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:n,billboard:s,miterLimit:r,widthUnits:o,widthScale:l,widthMinPixels:u,widthMaxPixels:f}=this.props,g=this.state.model,p={jointType:Number(e),capType:Number(n),billboard:s,widthUnits:ts[o],widthScale:l,miterLimit:r,widthMinPixels:u,widthMaxPixels:f};g.shaderInputs.setProps({path:p}),g.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],e=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new $i(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jn({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(e),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}xc.defaultProps=U7;xc.layerName="PathLayer";var hh={exports:{}},Ox;function F7(){if(Ox)return hh.exports;Ox=1,hh.exports=i,hh.exports.default=i;function i(C,N,D){D=D||2;var Q=N&&N.length,J=Q?N[0]*D:C.length,I=t(C,0,J,D,!0),B=[];if(!I||I.next===I.prev)return B;var Z,at,ct,mt,xt,Mt,Ot;if(Q&&(I=u(C,N,I,D)),C.length>80*D){Z=ct=C[0],at=mt=C[1];for(var kt=D;kt<J;kt+=D)xt=C[kt],Mt=C[kt+1],xt<Z&&(Z=xt),Mt<at&&(at=Mt),xt>ct&&(ct=xt),Mt>mt&&(mt=Mt);Ot=Math.max(ct-Z,mt-at),Ot=Ot!==0?32767/Ot:0}return n(I,B,D,Z,at,Ot,0),B}function t(C,N,D,Q,J){var I,B;if(J===It(C,N,D,Q)>0)for(I=N;I<D;I+=Q)B=_t(I,C[I],C[I+1],B);else for(I=D-Q;I>=N;I-=Q)B=_t(I,C[I],C[I+1],B);return B&&P(B,B.next)&&(St(B),B=B.next),B}function e(C,N){if(!C)return C;N||(N=C);var D=C,Q;do if(Q=!1,!D.steiner&&(P(D,D.next)||E(D.prev,D,D.next)===0)){if(St(D),D=N=D.prev,D===D.next)break;Q=!0}else D=D.next;while(Q||D!==N);return N}function n(C,N,D,Q,J,I,B){if(C){!B&&I&&v(C,Q,J,I);for(var Z=C,at,ct;C.prev!==C.next;){if(at=C.prev,ct=C.next,I?r(C,Q,J,I):s(C)){N.push(at.i/D|0),N.push(C.i/D|0),N.push(ct.i/D|0),St(C),C=ct.next,Z=ct.next;continue}if(C=ct,C===Z){B?B===1?(C=o(e(C),N,D),n(C,N,D,Q,J,I,2)):B===2&&l(C,N,D,Q,J,I):n(e(C),N,D,Q,J,I,1);break}}}}function s(C){var N=C.prev,D=C,Q=C.next;if(E(N,D,Q)>=0)return!1;for(var J=N.x,I=D.x,B=Q.x,Z=N.y,at=D.y,ct=Q.y,mt=J<I?J<B?J:B:I<B?I:B,xt=Z<at?Z<ct?Z:ct:at<ct?at:ct,Mt=J>I?J>B?J:B:I>B?I:B,Ot=Z>at?Z>ct?Z:ct:at>ct?at:ct,kt=Q.next;kt!==N;){if(kt.x>=mt&&kt.x<=Mt&&kt.y>=xt&&kt.y<=Ot&&w(J,Z,I,at,B,ct,kt.x,kt.y)&&E(kt.prev,kt,kt.next)>=0)return!1;kt=kt.next}return!0}function r(C,N,D,Q){var J=C.prev,I=C,B=C.next;if(E(J,I,B)>=0)return!1;for(var Z=J.x,at=I.x,ct=B.x,mt=J.y,xt=I.y,Mt=B.y,Ot=Z<at?Z<ct?Z:ct:at<ct?at:ct,kt=mt<xt?mt<Mt?mt:Mt:xt<Mt?xt:Mt,an=Z>at?Z>ct?Z:ct:at>ct?at:ct,Cn=mt>xt?mt>Mt?mt:Mt:xt>Mt?xt:Mt,So=x(Ot,kt,N,D,Q),on=x(an,Cn,N,D,Q),Ht=C.prevZ,$t=C.nextZ;Ht&&Ht.z>=So&&$t&&$t.z<=on;){if(Ht.x>=Ot&&Ht.x<=an&&Ht.y>=kt&&Ht.y<=Cn&&Ht!==J&&Ht!==B&&w(Z,mt,at,xt,ct,Mt,Ht.x,Ht.y)&&E(Ht.prev,Ht,Ht.next)>=0||(Ht=Ht.prevZ,$t.x>=Ot&&$t.x<=an&&$t.y>=kt&&$t.y<=Cn&&$t!==J&&$t!==B&&w(Z,mt,at,xt,ct,Mt,$t.x,$t.y)&&E($t.prev,$t,$t.next)>=0))return!1;$t=$t.nextZ}for(;Ht&&Ht.z>=So;){if(Ht.x>=Ot&&Ht.x<=an&&Ht.y>=kt&&Ht.y<=Cn&&Ht!==J&&Ht!==B&&w(Z,mt,at,xt,ct,Mt,Ht.x,Ht.y)&&E(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.prevZ}for(;$t&&$t.z<=on;){if($t.x>=Ot&&$t.x<=an&&$t.y>=kt&&$t.y<=Cn&&$t!==J&&$t!==B&&w(Z,mt,at,xt,ct,Mt,$t.x,$t.y)&&E($t.prev,$t,$t.next)>=0)return!1;$t=$t.nextZ}return!0}function o(C,N,D){var Q=C;do{var J=Q.prev,I=Q.next.next;!P(J,I)&&k(J,Q,Q.next,I)&&K(J,I)&&K(I,J)&&(N.push(J.i/D|0),N.push(Q.i/D|0),N.push(I.i/D|0),St(Q),St(Q.next),Q=C=I),Q=Q.next}while(Q!==C);return e(Q)}function l(C,N,D,Q,J,I){var B=C;do{for(var Z=B.next.next;Z!==B.prev;){if(B.i!==Z.i&&M(B,Z)){var at=ht(B,Z);B=e(B,B.next),at=e(at,at.next),n(B,N,D,Q,J,I,0),n(at,N,D,Q,J,I,0);return}Z=Z.next}B=B.next}while(B!==C)}function u(C,N,D,Q){var J=[],I,B,Z,at,ct;for(I=0,B=N.length;I<B;I++)Z=N[I]*Q,at=I<B-1?N[I+1]*Q:C.length,ct=t(C,Z,at,Q,!1),ct===ct.next&&(ct.steiner=!0),J.push(T(ct));for(J.sort(f),I=0;I<J.length;I++)D=g(J[I],D);return D}function f(C,N){return C.x-N.x}function g(C,N){var D=p(C,N);if(!D)return N;var Q=ht(D,C);return e(Q,Q.next),e(D,D.next)}function p(C,N){var D=N,Q=C.x,J=C.y,I=-1/0,B;do{if(J<=D.y&&J>=D.next.y&&D.next.y!==D.y){var Z=D.x+(J-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(Z<=Q&&Z>I&&(I=Z,B=D.x<D.next.x?D:D.next,Z===Q))return B}D=D.next}while(D!==N);if(!B)return null;var at=B,ct=B.x,mt=B.y,xt=1/0,Mt;D=B;do Q>=D.x&&D.x>=ct&&Q!==D.x&&w(J<mt?Q:I,J,ct,mt,J<mt?I:Q,J,D.x,D.y)&&(Mt=Math.abs(J-D.y)/(Q-D.x),K(D,C)&&(Mt<xt||Mt===xt&&(D.x>B.x||D.x===B.x&&_(B,D)))&&(B=D,xt=Mt)),D=D.next;while(D!==at);return B}function _(C,N){return E(C.prev,C,N.prev)<0&&E(N.next,C,C.next)<0}function v(C,N,D,Q){var J=C;do J.z===0&&(J.z=x(J.x,J.y,N,D,Q)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==C);J.prevZ.nextZ=null,J.prevZ=null,b(J)}function b(C){var N,D,Q,J,I,B,Z,at,ct=1;do{for(D=C,C=null,I=null,B=0;D;){for(B++,Q=D,Z=0,N=0;N<ct&&(Z++,Q=Q.nextZ,!!Q);N++);for(at=ct;Z>0||at>0&&Q;)Z!==0&&(at===0||!Q||D.z<=Q.z)?(J=D,D=D.nextZ,Z--):(J=Q,Q=Q.nextZ,at--),I?I.nextZ=J:C=J,J.prevZ=I,I=J;D=Q}I.nextZ=null,ct*=2}while(B>1);return C}function x(C,N,D,Q,J){return C=(C-D)*J|0,N=(N-Q)*J|0,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,N=(N|N<<8)&16711935,N=(N|N<<4)&252645135,N=(N|N<<2)&858993459,N=(N|N<<1)&1431655765,C|N<<1}function T(C){var N=C,D=C;do(N.x<D.x||N.x===D.x&&N.y<D.y)&&(D=N),N=N.next;while(N!==C);return D}function w(C,N,D,Q,J,I,B,Z){return(J-B)*(N-Z)>=(C-B)*(I-Z)&&(C-B)*(Q-Z)>=(D-B)*(N-Z)&&(D-B)*(I-Z)>=(J-B)*(Q-Z)}function M(C,N){return C.next.i!==N.i&&C.prev.i!==N.i&&!et(C,N)&&(K(C,N)&&K(N,C)&&ut(C,N)&&(E(C.prev,C,N.prev)||E(C,N.prev,N))||P(C,N)&&E(C.prev,C,C.next)>0&&E(N.prev,N,N.next)>0)}function E(C,N,D){return(N.y-C.y)*(D.x-N.x)-(N.x-C.x)*(D.y-N.y)}function P(C,N){return C.x===N.x&&C.y===N.y}function k(C,N,D,Q){var J=Y(E(C,N,D)),I=Y(E(C,N,Q)),B=Y(E(D,Q,C)),Z=Y(E(D,Q,N));return!!(J!==I&&B!==Z||J===0&&U(C,D,N)||I===0&&U(C,Q,N)||B===0&&U(D,C,Q)||Z===0&&U(D,N,Q))}function U(C,N,D){return N.x<=Math.max(C.x,D.x)&&N.x>=Math.min(C.x,D.x)&&N.y<=Math.max(C.y,D.y)&&N.y>=Math.min(C.y,D.y)}function Y(C){return C>0?1:C<0?-1:0}function et(C,N){var D=C;do{if(D.i!==C.i&&D.next.i!==C.i&&D.i!==N.i&&D.next.i!==N.i&&k(D,D.next,C,N))return!0;D=D.next}while(D!==C);return!1}function K(C,N){return E(C.prev,C,C.next)<0?E(C,N,C.next)>=0&&E(C,C.prev,N)>=0:E(C,N,C.prev)<0||E(C,C.next,N)<0}function ut(C,N){var D=C,Q=!1,J=(C.x+N.x)/2,I=(C.y+N.y)/2;do D.y>I!=D.next.y>I&&D.next.y!==D.y&&J<(D.next.x-D.x)*(I-D.y)/(D.next.y-D.y)+D.x&&(Q=!Q),D=D.next;while(D!==C);return Q}function ht(C,N){var D=new pt(C.i,C.x,C.y),Q=new pt(N.i,N.x,N.y),J=C.next,I=N.prev;return C.next=N,N.prev=C,D.next=J,J.prev=D,Q.next=D,D.prev=Q,I.next=Q,Q.prev=I,Q}function _t(C,N,D,Q){var J=new pt(C,N,D);return Q?(J.next=Q.next,J.prev=Q,Q.next.prev=J,Q.next=J):(J.prev=J,J.next=J),J}function St(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function pt(C,N,D){this.i=C,this.x=N,this.y=D,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(C,N,D,Q){var J=N&&N.length,I=J?N[0]*D:C.length,B=Math.abs(It(C,0,I,D));if(J)for(var Z=0,at=N.length;Z<at;Z++){var ct=N[Z]*D,mt=Z<at-1?N[Z+1]*D:C.length;B-=Math.abs(It(C,ct,mt,D))}var xt=0;for(Z=0;Z<Q.length;Z+=3){var Mt=Q[Z]*D,Ot=Q[Z+1]*D,kt=Q[Z+2]*D;xt+=Math.abs((C[Mt]-C[kt])*(C[Ot+1]-C[Mt+1])-(C[Mt]-C[Ot])*(C[kt+1]-C[Mt+1]))}return B===0&&xt===0?0:Math.abs((xt-B)/B)};function It(C,N,D,Q){for(var J=0,I=N,B=D-Q;I<D;I+=Q)J+=(C[B]-C[I])*(C[I+1]+C[B+1]),B=I;return J}return i.flatten=function(C){for(var N=C[0][0].length,D={vertices:[],holes:[],dimensions:N},Q=0,J=0;J<C.length;J++){for(var I=0;I<C[J].length;I++)for(var B=0;B<N;B++)D.vertices.push(C[J][I][B]);J>0&&(Q+=C[J-1].length,D.holes.push(Q))}return D},hh.exports}var z7=F7();const V7=v_(z7),fh=LE.CLOCKWISE,Nx=LE.COUNTER_CLOCKWISE,js={};function j7(i){if(i=i&&i.positions||i,!Array.isArray(i)&&!ArrayBuffer.isView(i))throw new Error("invalid polygon")}function Pl(i){return"positions"in i?i.positions:i}function $h(i){return"holeIndices"in i?i.holeIndices:null}function H7(i){return Array.isArray(i[0])}function $7(i){return i.length>=1&&i[0].length>=2&&Number.isFinite(i[0][0])}function G7(i){const t=i[0],e=i[i.length-1];return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function W7(i,t,e,n){for(let s=0;s<t;s++)if(i[e+s]!==i[n-t+s])return!1;return!0}function Dx(i,t,e,n,s){let r=t;const o=e.length;for(let l=0;l<o;l++)for(let u=0;u<n;u++)i[r++]=e[l][u]||0;if(!G7(e))for(let l=0;l<n;l++)i[r++]=e[0][l]||0;return js.start=t,js.end=r,js.size=n,kE(i,s,js),r}function Lx(i,t,e,n,s=0,r,o){r=r||e.length;const l=r-s;if(l<=0)return t;let u=t;for(let f=0;f<l;f++)i[u++]=e[s+f];if(!W7(e,n,s,r))for(let f=0;f<n;f++)i[u++]=e[s+f];return js.start=t,js.end=u,js.size=n,kE(i,o,js),u}function HE(i,t){j7(i);const e=[],n=[];if("positions"in i){const{positions:s,holeIndices:r}=i;if(r){let o=0;for(let l=0;l<=r.length;l++)o=Lx(e,o,s,t,r[l-1],r[l],l===0?fh:Nx),n.push(o);return n.pop(),{positions:e,holeIndices:n}}i=s}if(!H7(i))return Lx(e,0,i,t,0,e.length,fh),e;if(!$7(i)){let s=0;for(const[r,o]of i.entries())s=Dx(e,s,o,t,r===0?fh:Nx),n.push(s);return n.pop(),{positions:e,holeIndices:n}}return Dx(e,0,i,t,fh),e}function n0(i,t,e){const n=i.length/3;let s=0;for(let r=0;r<n;r++){const o=(r+1)%n;s+=i[r*3+t]*i[o*3+e],s-=i[o*3+t]*i[r*3+e]}return Math.abs(s/2)}function kx(i,t,e,n){const s=i.length/3;for(let r=0;r<s;r++){const o=r*3,l=i[o+0],u=i[o+1],f=i[o+2];i[o+t]=l,i[o+e]=u,i[o+n]=f}}function q7(i,t,e,n){let s=$h(i);s&&(s=s.map(l=>l/t));let r=Pl(i);const o=n&&t===3;if(e){const l=r.length;r=r.slice();const u=[];for(let f=0;f<l;f+=t){u[0]=r[f],u[1]=r[f+1],o&&(u[2]=r[f+2]);const g=e(u);r[f]=g[0],r[f+1]=g[1],o&&(r[f+2]=g[2])}}if(o){const l=n0(r,0,1),u=n0(r,0,2),f=n0(r,1,2);if(!l&&!u&&!f)return[];l>u&&l>f||(u>f?(e||(r=r.slice()),kx(r,0,2,1)):(e||(r=r.slice()),kx(r,2,0,1)))}return V7(r,s,t)}class X7 extends OE{constructor(t){const{fp64:e,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:e}=this;return t==="indices"?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;if(e)this.vertexCount=(e.value||e).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const e=HE(t,this.positionSize);return this.opts.resolution?UE(Pl(e),$h(e),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?C7(Pl(e),$h(e),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):e}return t}getGeometrySize(t){if(Bx(t)){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}return Pl(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,e){if(t&&Bx(t))for(const n of t){const s=this.getGeometrySize(n);e.geometrySize=s,this.updateGeometryAttributes(n,e),e.vertexStart+=s,e.indexStart=this.indexStarts[e.geometryIndex+1]}else{const n=t;this._updateIndices(n,e),this._updatePositions(n,e),this._updateVertexValid(n,e)}}_updateIndices(t,{geometryIndex:e,vertexStart:n,indexStart:s}){const{attributes:r,indexStarts:o,typedArrayManager:l}=this;let u=r.indices;if(!u||!t)return;let f=s;const g=q7(t,this.positionSize,this.opts.preproject,this.opts.full3d);u=l.allocate(u,s+g.length,{copy:!0});for(let p=0;p<g.length;p++)u[f++]=g[p]+n;o[e+1]=s+g.length,r.indices=u}_updatePositions(t,{vertexStart:e,geometrySize:n}){const{attributes:{positions:s},positionSize:r}=this;if(!s||!t)return;const o=Pl(t);for(let l=e,u=0;u<n;l++,u++){const f=o[u*r],g=o[u*r+1],p=r>2?o[u*r+2]:0;s[l*3]=f,s[l*3+1]=g,s[l*3+2]=p}}_updateVertexValid(t,{vertexStart:e,geometrySize:n}){const{positionSize:s}=this,r=this.attributes.vertexValid,o=t&&$h(t);if(t&&t.edgeTypes?r.set(t.edgeTypes,e):r.fill(1,e,e+n),o)for(let l=0;l<o.length;l++)r[e+o[l]/s-1]=0;r[e+n-1]=0}}function Bx(i){return Array.isArray(i)&&i.length>0&&!Number.isFinite(i[0])}const Ux=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Y7={name:"solidPolygon",vs:Ux,fs:Ux,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},$E=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,K7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${$E}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Z7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${$E}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Q7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,yf=[0,0,0,255],J7={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:i=>i.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:yf},getLineColor:{type:"accessor",value:yf},material:!0},dh={enter:(i,t)=>t.length?t.subarray(t.length-i.length):i};class Uf extends rs{getShaders(t){return super.getShaders({vs:t==="top"?K7:Z7,fs:Q7,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[fo,Ow,go,Y7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:e}=this.props;const{_full3d:n}=this.props;t.isGeospatial&&e===Ft.DEFAULT&&(e=Ft.LNGLAT);let s;e===Ft.LNGLAT&&(n?s=t.projectPosition.bind(t):s=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new X7({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:dh,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:dh,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:dh,accessor:"getFillColor",defaultValue:yf},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:dh,accessor:"getLineColor",defaultValue:yf},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:u,target:f})=>this.encodePickingColor(l&&l.__source?l.__source.index:u,f)}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,s=this.props.data;return s[0]&&s[0].__source&&(e.object=s.find(r=>r.__source.index===n)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:n,wireframe:s,elevationScale:r}=this.props,{topModel:o,sideModel:l,wireframeModel:u,polygonTesselator:f}=this.state,g={extruded:!!e,elevationScale:r,isWireframe:!1};u&&s&&(u.setInstanceCount(f.instanceCount-1),u.shaderInputs.setProps({solidPolygon:{...g,isWireframe:!0}}),u.draw(this.context.renderPass)),l&&n&&(l.setInstanceCount(f.instanceCount-1),l.shaderInputs.setProps({solidPolygon:g}),l.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(f.vertexCount),o.shaderInputs.setProps({solidPolygon:g}),o.draw(this.context.renderPass))}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:n,changeFlags:s}=t,r=this.getAttributeManager();(s.extensionsChanged||e.filled!==n.filled||e.extruded!==n.extruded)&&(this.state.models?.forEach(l=>l.destroy()),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,o=t.data.attributes||{};r.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:e,extruded:n}=this.props;let s,r,o;if(e){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new $i(this.context.device,{...l,id:`${t}-top`,topology:"triangle-list",bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new $i(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:l,geometry:new Jn({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new $i(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:l,geometry:new Jn({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,o,s].filter(Boolean),topModel:s,sideModel:r,wireframeModel:o}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}Uf.defaultProps=J7;Uf.layerName="SolidPolygonLayer";function GE({data:i,getIndex:t,dataRange:e,replace:n}){const{startRow:s=0,endRow:r=1/0}=e,o=i.length;let l=o,u=o;for(let _=0;_<o;_++){const v=t(i[_]);if(l>_&&v>=s&&(l=_),v>=r){u=_;break}}let f=l;const p=u-l!==n.length?i.slice(u):void 0;for(let _=0;_<n.length;_++)i[f++]=n[_];if(p){for(let _=0;_<p.length;_++)i[f++]=p[_];i.length=f}return{startRow:l,endRow:l+n.length}}const WE=[0,0,0,255],tF=[0,0,0,255],eF={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:i=>i.polygon},getFillColor:{type:"accessor",value:tF},getLineColor:{type:"accessor",value:WE},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Sm extends Zs{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Lt.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const e=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(e&&Array.isArray(t.dataChanged)){const n=this.state.paths.slice(),s=t.dataChanged.map(r=>GE({data:n,getIndex:o=>o.__source.index,dataRange:r,replace:this._getPaths(r)}));this.setState({paths:n,pathsDiff:s})}else e&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:e,getPolygon:n,positionFormat:s,_normalize:r}=this.props,o=[],l=s==="XY"?2:3,{startRow:u,endRow:f}=t,{iterable:g,objectInfo:p}=mo(e,u,f);for(const _ of g){p.index++;let v=n(_,p);r&&(v=HE(v,l));const{holeIndices:b}=v,x=v.positions||v;if(b)for(let T=0;T<=b.length;T++){const w=x.slice(b[T-1]||0,b[T]||x.length);o.push(this.getSubLayerRow({path:w},_,p.index))}else o.push(this.getSubLayerRow({path:x},_,p.index))}return o}renderLayers(){const{data:t,_dataDiff:e,stroked:n,filled:s,extruded:r,wireframe:o,_normalize:l,_windingOrder:u,elevationScale:f,transitions:g,positionFormat:p}=this.props,{lineWidthUnits:_,lineWidthScale:v,lineWidthMinPixels:b,lineWidthMaxPixels:x,lineJointRounded:T,lineMiterLimit:w,lineDashJustified:M}=this.props,{getFillColor:E,getLineColor:P,getLineWidth:k,getLineDashArray:U,getElevation:Y,getPolygon:et,updateTriggers:K,material:ut}=this.props,{paths:ht,pathsDiff:_t}=this.state,St=this.getSubLayerClass("fill",Uf),pt=this.getSubLayerClass("stroke",xc),It=this.shouldRenderSubLayer("fill",ht)&&new St({_dataDiff:e,extruded:r,elevationScale:f,filled:s,wireframe:o,_normalize:l,_windingOrder:u,getElevation:Y,getFillColor:E,getLineColor:r&&o?P:WE,material:ut,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:K&&{getPolygon:K.getPolygon,getElevation:K.getElevation,getFillColor:K.getFillColor,lineColors:r&&o,getLineColor:K.getLineColor}}),{data:t,positionFormat:p,getPolygon:et}),C=!r&&n&&this.shouldRenderSubLayer("stroke",ht)&&new pt({_dataDiff:_t&&(()=>_t),widthUnits:_,widthScale:v,widthMinPixels:b,widthMaxPixels:x,jointRounded:T,miterLimit:w,dashJustified:M,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(P),getWidth:this.getSubLayerAccessor(k),getDashArray:this.getSubLayerAccessor(U)},this.getSubLayerProps({id:"stroke",updateTriggers:K&&{getWidth:K.getLineWidth,getColor:K.getLineColor,getDashArray:K.getLineDashArray}}),{data:ht,positionFormat:p,getPath:N=>N.path});return[!r&&It,C,r&&It]}}Sm.layerName="PolygonLayer";Sm.defaultProps=eF;function iF(i,t){if(!i)return null;const e="startIndices"in i?i.startIndices[t]:t,n=i.featureIds.value[e];return e!==-1?nF(i,n,e):null}function nF(i,t,e){const n={properties:{...i.properties[t]}};for(const s in i.numericProps)n.properties[s]=i.numericProps[s].value[e];return n}function sF(i,t){const e={points:null,lines:null,polygons:null};for(const n in e){const s=i[n].globalFeatureIds.value;e[n]=new Uint8ClampedArray(s.length*4);const r=[];for(let o=0;o<s.length;o++)t(s[o],r),e[n][o*4+0]=r[0],e[n][o*4+1]=r[1],e[n][o*4+2]=r[2],e[n][o*4+3]=255}return e}const Fx=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,rF={name:"sdf",vs:Fx,fs:Fx,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},aF=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,s0=192/256,zx=[],oF={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Tm extends Bf{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,rF],fs:aF}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:n,target:s})=>this.encodePickingColor(n,s)}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;let{outlineColor:s}=e;s!==n.outlineColor&&(s=s.map(r=>r/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!e.sdf&&e.outlineWidth&&Lt.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:e,smoothing:n,outlineWidth:s}=this.props,{outlineColor:r}=this.state,o=s?Math.max(n,s0*(1-s)):-1,l=this.state.model,u={buffer:s0,outlineBuffer:o,gamma:n,enabled:!!e,outlineColor:r};if(l.shaderInputs.setProps({sdf:u}),super.draw(t),e&&s){const{iconManager:f}=this.state;f.getTexture()&&(l.shaderInputs.setProps({sdf:{...u,outlineBuffer:s0}}),l.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(e=>super.getInstanceOffset(e)):zx}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(e=>super.getInstanceIconFrame(e)):zx}}Tm.defaultProps=oF;Tm.layerName="MultiIconLayer";const Wl=1e20;class lF{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:l="normal",lang:u=null}={}){this.buffer=e,this.cutoff=s,this.radius=n,this.lang=u;const f=this.size=t+e*4,g=this._createCanvas(f),p=this.ctx=g.getContext("2d",{willReadFrequently:!0});p.font=`${l} ${o} ${t}px ${r}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),l=Math.ceil(n),u=0,f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),g=Math.min(this.size-this.buffer,l+Math.ceil(s)),p=f+2*this.buffer,_=g+2*this.buffer,v=Math.max(p*_,0),b=new Uint8ClampedArray(v),x={data:b,width:p,height:_,glyphWidth:f,glyphHeight:g,glyphTop:l,glyphLeft:u,glyphAdvance:e};if(f===0||g===0)return x;const{ctx:T,buffer:w,gridInner:M,gridOuter:E}=this;this.lang&&(T.lang=this.lang),T.clearRect(w,w,f,g),T.fillText(t,w,w+l);const P=T.getImageData(w,w,f,g);E.fill(Wl,0,v),M.fill(0,0,v);for(let k=0;k<g;k++)for(let U=0;U<f;U++){const Y=P.data[4*(k*f+U)+3]/255;if(Y===0)continue;const et=(k+w)*p+U+w;if(Y===1)E[et]=0,M[et]=Wl;else{const K=.5-Y;E[et]=K>0?K*K:0,M[et]=K<0?K*K:0}}Vx(E,0,0,p,_,p,this.f,this.v,this.z),Vx(M,w,w,f,g,p,this.f,this.v,this.z);for(let k=0;k<v;k++){const U=Math.sqrt(E[k])-Math.sqrt(M[k]);b[k]=Math.round(255-255*(U/this.radius+this.cutoff))}return x}}function Vx(i,t,e,n,s,r,o,l,u){for(let f=t;f<t+n;f++)jx(i,e*r+f,r,s,o,l,u);for(let f=e;f<e+s;f++)jx(i,f*r+t,1,n,o,l,u)}function jx(i,t,e,n,s,r,o){r[0]=0,o[0]=-Wl,o[1]=Wl,s[0]=i[t];for(let l=1,u=0,f=0;l<n;l++){s[l]=i[t+l*e];const g=l*l;do{const p=r[u];f=(s[l]-s[p]+g-p*p)/(l-p)/2}while(f<=o[u]&&--u>-1);u++,r[u]=l,o[u]=f,o[u+1]=Wl}for(let l=0,u=0;l<n;l++){for(;o[u+1]<l;)u++;const f=r[u],g=l-f;i[t+l*e]=s[f]+g*g}}const cF=32,uF=[];function hF(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function fF({characterSet:i,getFontWidth:t,fontHeight:e,buffer:n,maxCanvasWidth:s,mapping:r={},xOffset:o=0,yOffset:l=0}){let u=0,f=o;const g=e+n*2;for(const p of i)if(!r[p]){const _=t(p);f+_+n*2>s&&(f=0,u++),r[p]={x:f+n,y:l+u*g+n,width:_,height:g,layoutWidth:_,layoutHeight:e},f+=_+n*2}return{mapping:r,xOffset:f,yOffset:l+u*g,canvasHeight:hF(l+(u+1)*g)}}function qE(i,t,e,n){let s=0;for(let r=t;r<e;r++){const o=i[r];s+=n[o]?.layoutWidth||0}return s}function XE(i,t,e,n,s,r){let o=t,l=0;for(let u=t;u<e;u++){const f=qE(i,u,u+1,s);l+f>n&&(o<u&&r.push(u),o=u,l=0),l+=f}return l}function dF(i,t,e,n,s,r){let o=t,l=t,u=t,f=0;for(let g=t;g<e;g++)if((i[g]===" "||i[g+1]===" "||g+1===e)&&(u=g+1),u>l){let p=qE(i,l,u,s);f+p>n&&(o<l&&(r.push(l),o=l,f=0),p>n&&(p=XE(i,l,u,n,s,r),o=r[r.length-1])),l=u,f+=p}return f}function gF(i,t,e,n,s=0,r){r===void 0&&(r=i.length);const o=[];return t==="break-all"?XE(i,s,r,e,n,o):dF(i,s,r,e,n,o),o}function pF(i,t,e,n,s,r){let o=0,l=0;for(let u=t;u<e;u++){const f=i[u],g=n[f];g?(l||(l=g.layoutHeight),s[u]=o+g.layoutWidth/2,o+=g.layoutWidth):(Lt.warn(`Missing character: ${f} (${f.codePointAt(0)})`)(),s[u]=o,o+=cF)}r[0]=o,r[1]=l}function _F(i,t,e,n,s){const r=Array.from(i),o=r.length,l=new Array(o),u=new Array(o),f=new Array(o),g=(e==="break-word"||e==="break-all")&&isFinite(n)&&n>0,p=[0,0],_=[0,0];let v=0,b=0,x=0;for(let T=0;T<=o;T++){const w=r[T];if((w===`
`||T===o)&&(x=T),x>b){const M=g?gF(r,e,n,s,b,x):uF;for(let E=0;E<=M.length;E++){const P=E===0?b:M[E-1],k=E<M.length?M[E]:x;pF(r,P,k,s,l,_);for(let U=P;U<k;U++){const Y=r[U],et=s[Y]?.layoutOffsetY||0;u[U]=v+_[1]/2+et,f[U]=_[0]}v=v+_[1]*t,p[0]=Math.max(p[0],_[0])}b=x}w===`
`&&(l[b]=0,u[b]=0,f[b]=0,b++)}return p[1]=v,{x:l,y:u,rowWidth:f,size:p}}function mF({value:i,length:t,stride:e,offset:n,startIndices:s,characterSet:r}){const o=i.BYTES_PER_ELEMENT,l=e?e/o:1,u=n?n/o:0,f=s[t]||Math.ceil((i.length-u)/l),g=r&&new Set,p=new Array(t);let _=i;if(l>1||u>0){const v=i.constructor;_=new v(f);for(let b=0;b<f;b++)_[b]=i[b*l+u]}for(let v=0;v<t;v++){const b=s[v],x=s[v+1]||f,T=_.subarray(b,x);p[v]=String.fromCodePoint.apply(null,T),g&&T.forEach(g.add,g)}if(g)for(const v of g)r.add(String.fromCodePoint(v));return{texts:p,characterCount:f}}class YE{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}function yF(){const i=[];for(let t=32;t<128;t++)i.push(String.fromCharCode(t));return i}const Ja={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:yF(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Hx=1024,$x=.9,Gx=1.2,KE=3;let vf=new YE(KE);function vF(i,t){let e;typeof t=="string"?e=new Set(Array.from(t)):e=new Set(t);const n=vf.get(i);if(!n)return e;for(const s in n.mapping)e.has(s)&&e.delete(s);return e}function bF(i,t){for(let e=0;e<i.length;e++)t.data[4*e+3]=i[e]}function Wx(i,t,e,n){i.font=`${n} ${e}px ${t}`,i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function xF(i){Lt.assert(Number.isFinite(i)&&i>=KE,"Invalid cache limit"),vf=new YE(i)}class SF{constructor(){this.props={...Ja}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(t*Gx+e*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=vF(this._key,this.props.characterSet),n=vf.get(this._key);if(n&&e.size===0){this._atlas!==n&&(this._atlas=n);return}const s=this._generateFontAtlas(e,n);this._atlas=s,vf.set(this._key,s)}_generateFontAtlas(t,e){const{fontFamily:n,fontWeight:s,fontSize:r,buffer:o,sdf:l,radius:u,cutoff:f}=this.props;let g=e&&e.data;g||(g=document.createElement("canvas"),g.width=Hx);const p=g.getContext("2d",{willReadFrequently:!0});Wx(p,n,r,s);const{mapping:_,canvasHeight:v,xOffset:b,yOffset:x}=fF({getFontWidth:T=>p.measureText(T).width,fontHeight:r*Gx,buffer:o,characterSet:t,maxCanvasWidth:Hx,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(g.height!==v){const T=p.getImageData(0,0,g.width,g.height);g.height=v,p.putImageData(T,0,0)}if(Wx(p,n,r,s),l){const T=new lF({fontSize:r,buffer:o,radius:u,cutoff:f,fontFamily:n,fontWeight:`${s}`});for(const w of t){const{data:M,width:E,height:P,glyphTop:k}=T.draw(w);_[w].width=E,_[w].layoutOffsetY=r*$x-k;const U=p.createImageData(E,P);bF(M,U),p.putImageData(U,_[w].x,_[w].y)}}else for(const T of t)p.fillText(T,_[T].x,_[T].y+o+r*$x);return{xOffset:b,yOffset:x,mapping:_,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:n,buffer:s,sdf:r,radius:o,cutoff:l}=this.props;return r?`${t} ${e} ${n} ${s} ${o} ${l}`:`${t} ${e} ${n} ${s}`}}const qx=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,TF={name:"textBackground",vs:qx,fs:qx,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},wF=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,EF=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,AF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class wm extends rs{getShaders(){return super.getShaders({vs:wF,fs:EF,modules:[fo,go,TF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:e}=t;e.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:e,sizeScale:n,sizeUnits:s,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:l}=this.props;let{padding:u,borderRadius:f}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]),Array.isArray(f)||(f=[f,f,f,f]);const g=this.state.model,p={billboard:e,stroked:!!l,borderRadius:f,padding:u,sizeUnits:ts[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o};g.shaderInputs.setProps({textBackground:p}),g.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new $i(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jn({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}wm.defaultProps=AF;wm.layerName="TextBackgroundLayer";const Xx={start:1,middle:0,end:-1},Yx={top:1,center:0,bottom:-1},r0=[0,0,0,255],MF=1,CF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:r0},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ja.characterSet},fontFamily:Ja.fontFamily,fontWeight:Ja.fontWeight,lineHeight:MF,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:r0},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:r0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Em extends Zs{constructor(){super(...arguments),this.getBoundingRect=(t,e)=>{let{size:[n,s]}=this.transformParagraph(t,e);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,s/=r;const{getTextAnchor:o,getAlignmentBaseline:l}=this.props,u=Xx[typeof o=="function"?o(t,e):o],f=Yx[typeof l=="function"?l(t,e):l];return[(u-1)*n/2,(f-1)*s/2,n,s]},this.getIconOffsets=(t,e)=>{const{getTextAnchor:n,getAlignmentBaseline:s}=this.props,{x:r,y:o,rowWidth:l,size:[u,f]}=this.transformParagraph(t,e),g=Xx[typeof n=="function"?n(t,e):n],p=Yx[typeof s=="function"?s(t,e):s],_=r.length,v=new Array(_*2);let b=0;for(let x=0;x<_;x++){const T=(1-g)*(u-l[x])/2;v[b++]=(g-1)*u/2+T+r[x],v[b++]=(p-1)*f/2+o[x]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new SF},this.props.maxWidth>0&&Lt.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:n,changeFlags:s}=t;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==n.lineHeight||e.wordBreak!==n.wordBreak||e.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:n}=this.props,{fontAtlasManager:s,characterSet:r}=this.state,o={...t,characterSet:r,fontFamily:e,fontWeight:n};if(!s.mapping)return s.setProps(o),!0;for(const l in o)if(o[l]!==s.props[l])return s.setProps(o),!0;return!1}_updateText(){const{data:t,characterSet:e}=this.props,n=t.attributes?.getText;let{getText:s}=this.props,r=t.startIndices,o;const l=e==="auto"&&new Set;if(n&&r){const{texts:u,characterCount:f}=mF({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:r,characterSet:l});o=f,s=(g,{index:p})=>u[p]}else{const{iterable:u,objectInfo:f}=mo(t);r=[0],o=0;for(const g of u){f.index++;const p=Array.from(s(g,f)||"");l&&p.forEach(l.add,l),o+=p.length,r.push(o)}}this.setState({getText:s,startIndices:r,numInstances:o,characterSet:l||e})}transformParagraph(t,e){const{fontAtlasManager:n}=this.state,s=n.mapping,r=this.state.getText,{wordBreak:o,lineHeight:l,maxWidth:u}=this.props,f=r(t,e)||"";return _F(f,l,o,u*n.props.fontSize,s)}renderLayers(){const{startIndices:t,numInstances:e,getText:n,fontAtlasManager:{scale:s,atlas:r,mapping:o},styleVersion:l}=this.state,{data:u,_dataDiff:f,getPosition:g,getColor:p,getSize:_,getAngle:v,getPixelOffset:b,getBackgroundColor:x,getBorderColor:T,getBorderWidth:w,backgroundBorderRadius:M,backgroundPadding:E,background:P,billboard:k,fontSettings:U,outlineWidth:Y,outlineColor:et,sizeScale:K,sizeUnits:ut,sizeMinPixels:ht,sizeMaxPixels:_t,transitions:St,updateTriggers:pt}=this.props,It=this.getSubLayerClass("characters",Tm),C=this.getSubLayerClass("background",wm);return[P&&new C({getFillColor:x,getLineColor:T,getLineWidth:w,borderRadius:M,padding:E,getPosition:g,getSize:_,getAngle:v,getPixelOffset:b,billboard:k,sizeScale:K,sizeUnits:ut,sizeMinPixels:ht,sizeMaxPixels:_t,transitions:St&&{getPosition:St.getPosition,getAngle:St.getAngle,getSize:St.getSize,getFillColor:St.getBackgroundColor,getLineColor:St.getBorderColor,getLineWidth:St.getBorderWidth,getPixelOffset:St.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:pt.getPosition,getAngle:pt.getAngle,getSize:pt.getSize,getFillColor:pt.getBackgroundColor,getLineColor:pt.getBorderColor,getLineWidth:pt.getBorderWidth,getPixelOffset:pt.getPixelOffset,getBoundingRect:{getText:pt.getText,getTextAnchor:pt.getTextAnchor,getAlignmentBaseline:pt.getAlignmentBaseline,styleVersion:l}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:f,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new It({sdf:U.sdf,smoothing:Number.isFinite(U.smoothing)?U.smoothing:Ja.smoothing,outlineWidth:Y/(U.radius||Ja.radius),outlineColor:et,iconAtlas:r,iconMapping:o,getPosition:g,getColor:p,getSize:_,getAngle:v,getPixelOffset:b,billboard:k,sizeScale:K*s,sizeUnits:ut,sizeMinPixels:ht*s,sizeMaxPixels:_t*s,transitions:St&&{getPosition:St.getPosition,getAngle:St.getAngle,getColor:St.getColor,getSize:St.getSize,getPixelOffset:St.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:pt.getText,getPosition:pt.getPosition,getAngle:pt.getAngle,getColor:pt.getColor,getSize:pt.getSize,getPixelOffset:pt.getPixelOffset,getIconOffsets:{getTextAnchor:pt.getTextAnchor,getAlignmentBaseline:pt.getAlignmentBaseline,styleVersion:l}}}),{data:u,_dataDiff:f,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){xF(t)}}Em.defaultProps=CF;Em.layerName="TextLayer";const Gh={circle:{type:xm,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Bf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Em,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Wh={type:xc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},e_={type:Uf,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function xl({type:i,props:t}){const e={};for(const n in t)e[n]=i.defaultProps[t[n]];return e}function a0(i,t){const{transitions:e,updateTriggers:n}=i.props,s={updateTriggers:{},transitions:e&&{getPosition:e.geometry}};for(const r in t){const o=t[r];let l=i.props[r];r.startsWith("get")&&(l=i.getSubLayerAccessor(l),s.updateTriggers[o]=n[r],e&&(s.transitions[o]=e[r])),s[o]=l}return s}function RF(i){if(Array.isArray(i))return i;switch(Lt.assert(i.type,"GeoJSON does not have type"),i.type){case"Feature":return[i];case"FeatureCollection":return Lt.assert(Array.isArray(i.features),"GeoJSON does not have features array"),i.features;default:return[{geometry:i}]}}function Kx(i,t,e={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:r=i.length}=e;for(let o=s;o<r;o++){const l=i[o],{geometry:u}=l;if(u)if(u.type==="GeometryCollection"){Lt.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:f}=u;for(let g=0;g<f.length;g++){const p=f[g];Zx(p,n,t,l,o)}}else Zx(u,n,t,l,o)}return n}function Zx(i,t,e,n,s){const{type:r,coordinates:o}=i,{pointFeatures:l,lineFeatures:u,polygonFeatures:f,polygonOutlineFeatures:g}=t;if(!IF(r,o)){Lt.warn(`${r} coordinates are malformed`)();return}switch(r){case"Point":l.push(e({geometry:i},n,s));break;case"MultiPoint":o.forEach(p=>{l.push(e({geometry:{type:"Point",coordinates:p}},n,s))});break;case"LineString":u.push(e({geometry:i},n,s));break;case"MultiLineString":o.forEach(p=>{u.push(e({geometry:{type:"LineString",coordinates:p}},n,s))});break;case"Polygon":f.push(e({geometry:i},n,s)),o.forEach(p=>{g.push(e({geometry:{type:"LineString",coordinates:p}},n,s))});break;case"MultiPolygon":o.forEach(p=>{f.push(e({geometry:{type:"Polygon",coordinates:p}},n,s)),p.forEach(_=>{g.push(e({geometry:{type:"LineString",coordinates:_}},n,s))})});break}}const PF={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function IF(i,t){let e=PF[i];for(Lt.assert(e,`Unknown GeoJSON type ${i}`);t&&--e>0;)t=t[0];return t&&Number.isFinite(t[0])}function ZE(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function gh(i){return i.geometry.coordinates}function OF(i,t){const e=ZE(),{pointFeatures:n,lineFeatures:s,polygonFeatures:r,polygonOutlineFeatures:o}=i;return e.points.data=n,e.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),e.points.getPosition=gh,e.lines.data=s,e.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),e.lines.getPath=gh,e.polygons.data=r,e.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),e.polygons.getPolygon=gh,e.polygonsOutline.data=o,e.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),e.polygonsOutline.getPath=gh,e}function NF(i,t){const e=ZE(),{points:n,lines:s,polygons:r}=i,o=sF(i,t);e.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},e.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},e.lines._pathType="open";const l=r.positions.value.length/r.positions.size,u=Array(l).fill(1);for(const f of r.primitivePolygonIndices.value)u[f-1]=0;return e.polygons.data={length:r.polygonIndices.value.length-1,startIndices:r.polygonIndices.value,attributes:{...r.attributes,getPolygon:r.positions,instanceVertexValid:{size:1,value:new Uint16Array(u)},pickingColors:{size:4,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},e.polygons._normalize=!1,r.triangles&&(e.polygons.data.attributes.indices=r.triangles.value),e.polygonsOutline.data={length:r.primitivePolygonIndices.value.length-1,startIndices:r.primitivePolygonIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},e.polygonsOutline._pathType="open",e}const DF=["points","linestrings","polygons"],LF={...xl(Gh.circle),...xl(Gh.icon),...xl(Gh.text),...xl(Wh),...xl(e_),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:i=>i.properties.icon},getText:{type:"accessor",value:i=>i.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Am extends Zs{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:n}=this.props,s=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:s}),s?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const n=NF(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:e}){const n=RF(t.data),s=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(e.dataChanged)){const u=this.state.features;for(const f in u)r[f]=u[f].slice(),o[f]=[];for(const f of e.dataChanged){const g=Kx(n,s,f);for(const p in u)o[p].push(GE({data:r[p],getIndex:_=>_.__source.index,dataRange:f,replace:g[p]}))}}else r=Kx(n,s);const l=OF(r,o);this.setState({features:r,featuresDiff:o,layerProps:l})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n,sourceLayer:s}=e;return e.featureType=DF.find(r=>s.id.startsWith(`${this.id}-${r}-`)),n>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(e.index=this.props.data.points.globalFeatureIds.value[n]),e}_updateAutoHighlight(t){const e=`${this.id}-points-`,n=t.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(e)===n&&s.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:e}=this.props,{layerProps:n}=this.state,s="polygons-fill",r=this.shouldRenderSubLayer(s,n.polygons?.data)&&this.getSubLayerClass(s,e_.type);if(r){const o=a0(this,e_.props),l=t&&e;return l||delete o.getLineColor,o.updateTriggers.lineColors=l,new r(o,this.getSubLayerProps({id:s,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:e}=this.props,{layerProps:n}=this.state,s="polygons-stroke",r="linestrings",o=!t&&e&&this.shouldRenderSubLayer(s,n.polygonsOutline?.data)&&this.getSubLayerClass(s,Wh.type),l=this.shouldRenderSubLayer(r,n.lines?.data)&&this.getSubLayerClass(r,Wh.type);if(o||l){const u=a0(this,Wh.props);return[o&&new o(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),n.polygonsOutline),l&&new l(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:e,binary:n}=this.state;let{highlightedObjectIndex:s}=this.props;!n&&Number.isFinite(s)&&(s=e.points.data.findIndex(l=>l.__source.index===s));const r=new Set(t.split("+")),o=[];for(const l of r){const u=`points-${l}`,f=Gh[l],g=f&&this.shouldRenderSubLayer(u,e.points?.data)&&this.getSubLayerClass(u,f.type);if(g){const p=a0(this,f.props);let _=e.points;if(l==="text"&&n){const{instancePickingColors:v,...b}=_.data.attributes;_={..._,data:{..._.data,attributes:b}}}o.push(new g(p,this.getSubLayerProps({id:u,updateTriggers:p.updateTriggers,highlightedObjectIndex:s}),_))}}return o}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer(),n=this._renderLineLayers(),s=this._renderPointLayers();return[!t&&e,n,s,t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return!e||typeof t!="function"?super.getSubLayerAccessor(t):(n,s)=>{const{data:r,index:o}=s,l=iF(r,o);return t(l,s)}}}Am.layerName="GeoJsonLayer";Am.defaultProps=LF;class kF{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:e,onLoad:n,onError:s}){const{index:r,id:o,bbox:l,userData:u,zoom:f}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:p}=this._abortController,_=await e.scheduleRequest(this,x=>x.isSelected?1:-1);if(!_){this._isCancelled=!0;return}if(this._isCancelled){_.done();return}let v=null,b;try{v=await t({index:r,id:o,bbox:l,userData:u,zoom:f,signal:p})}catch(x){b=x||!0}finally{_.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=v,this._isCancelled&&!v){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,b?s(b,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const Qe={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},Qx=new yt,BF=new yt;class Mm{constructor(t=[0,0,0],e=[0,0,0],n){n=n||Qx.copy(t).add(e).scale(.5),this.center=new yt(n),this.halfDiagonal=new yt(e).subtract(this.center),this.minimum=new yt(t),this.maximum=new yt(e)}clone(){return new Mm(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,n=BF.from(t.normal),s=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),r=this.center.dot(n)+t.distance;return r-s>0?Qe.INSIDE:r+s<0?Qe.OUTSIDE:Qe.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Qx.from(t).subtract(this.center),{halfDiagonal:n}=this;let s=0,r;return r=Math.abs(e.x)-n.x,r>0&&(s+=r*r),r=Math.abs(e.y)-n.y,r>0&&(s+=r*r),r=Math.abs(e.z)-n.z,r>0&&(s+=r*r),s}}const Sl=new yt,Jx=new yt;class Cm{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new yt,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Sl.from(e),this.center=new yt().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Cm(this.center,this.radius)}union(t){const e=this.center,n=this.radius,s=t.center,r=t.radius,o=Sl.copy(s).subtract(e),l=o.magnitude();if(n>=l+r)return this.clone();if(r>=l+n)return t.clone();const u=(n+l+r)*.5;return Jx.copy(o).scale((-n+u)/l).add(e),this.center.copy(Jx),this.radius=u,this}expand(t){const n=Sl.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const e=ZI(Sl,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const n=Sl.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,r=t.normal.dot(e)+t.distance;return r<-n?Qe.OUTSIDE:r<n?Qe.INTERSECTING:Qe.INSIDE}}const UF=new yt,FF=new yt,ph=new yt,_h=new yt,mh=new yt,zF=new yt,VF=new yt,Xn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Rm{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=new yt().from(t),this.halfAxes=new $e(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new yt(t).len(),new yt(e).len(),new yt(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),s=new yt(t).normalize(),r=new yt(e).normalize(),o=new yt(n).normalize();return new r3().fromMatrix3(new $e([...s,...r,...o]))}fromCenterHalfSizeQuaternion(t,e,n){const s=new r3(n),r=new $e().fromQuaternion(s);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=new yt().from(t),this.halfAxes=r,this}clone(){return new Rm(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Cm){const e=this.halfAxes,n=e.getColumn(0,ph),s=e.getColumn(1,_h),r=e.getColumn(2,mh),o=UF.copy(n).add(s).add(r);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,s=this.halfAxes,r=n.x,o=n.y,l=n.z,u=Math.abs(r*s[Xn.COLUMN0ROW0]+o*s[Xn.COLUMN0ROW1]+l*s[Xn.COLUMN0ROW2])+Math.abs(r*s[Xn.COLUMN1ROW0]+o*s[Xn.COLUMN1ROW1]+l*s[Xn.COLUMN1ROW2])+Math.abs(r*s[Xn.COLUMN2ROW0]+o*s[Xn.COLUMN2ROW1]+l*s[Xn.COLUMN2ROW2]),f=n.dot(e)+t.distance;return f<=-u?Qe.OUTSIDE:f>=u?Qe.INSIDE:Qe.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=FF.from(t).subtract(this.center),n=this.halfAxes,s=n.getColumn(0,ph),r=n.getColumn(1,_h),o=n.getColumn(2,mh),l=s.magnitude(),u=r.magnitude(),f=o.magnitude();s.normalize(),r.normalize(),o.normalize();let g=0,p;return p=Math.abs(e.dot(s))-l,p>0&&(g+=p*p),p=Math.abs(e.dot(r))-u,p>0&&(g+=p*p),p=Math.abs(e.dot(o))-f,p>0&&(g+=p*p),g}computePlaneDistances(t,e,n=[-0,-0]){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,l=this.halfAxes,u=l.getColumn(0,ph),f=l.getColumn(1,_h),g=l.getColumn(2,mh),p=zF.copy(u).add(f).add(g).add(o),_=VF.copy(p).subtract(t);let v=e.dot(_);return s=Math.min(v,s),r=Math.max(v,r),p.copy(o).add(u).add(f).subtract(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),p.copy(o).add(u).subtract(f).add(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),p.copy(o).add(u).subtract(f).subtract(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),o.copy(p).subtract(u).add(f).add(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),o.copy(p).subtract(u).add(f).subtract(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),o.copy(p).subtract(u).subtract(f).add(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),o.copy(p).subtract(u).subtract(f).subtract(g),_.copy(p).subtract(t),v=e.dot(_),s=Math.min(v,s),r=Math.max(v,r),n[0]=s,n[1]=r,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,ph);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,_h);n.transformAsPoint(t);const s=this.halfAxes.getColumn(2,mh);return s.transformAsPoint(t),this.halfAxes=new $e([...e,...n,...s]),this}getTransform(){throw new Error("not implemented")}}const tS=new yt,eS=new yt;class lo{constructor(t=[0,0,1],e=0){this.normal=new yt,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return tc(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=tS.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,s){return this.normal.set(t,e,n),tc(Qn(this.normal.len(),1)),this.distance=s,this}clone(){return new lo(this.normal,this.distance)}equals(t){return Qn(this.distance,t.distance)&&Qn(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=eS.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t,e=[0,0,0]){const n=tS.from(t),s=this.getPointDistance(n),r=eS.copy(this.normal).scale(s);return n.subtract(r).to(e)}}const iS=[new yt([1,0,0]),new yt([0,1,0]),new yt([0,0,1])],nS=new yt,jF=new yt;class wn{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*iS.length;const e=t.center,n=t.radius;let s=0;for(const r of iS){let o=this.planes[s],l=this.planes[s+1];o||(o=this.planes[s]=new lo),l||(l=this.planes[s+1]=new lo);const u=nS.copy(r).scale(-n).add(e);o.fromPointNormal(u,r);const f=nS.copy(r).scale(n).add(e),g=jF.copy(r).negate();l.fromPointNormal(f,g),s+=2}return this}computeVisibility(t){let e=Qe.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case Qe.OUTSIDE:return Qe.OUTSIDE;case Qe.INTERSECTING:e=Qe.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(tc(Number.isFinite(e),"parentPlaneMask is required."),e===wn.MASK_OUTSIDE||e===wn.MASK_INSIDE)return e;let n=wn.MASK_INSIDE;const s=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&(e&o)===0)continue;const l=s[r],u=t.intersectPlane(l);if(u===Qe.OUTSIDE)return wn.MASK_OUTSIDE;u===Qe.INTERSECTING&&(n|=o)}return n}}wn.MASK_OUTSIDE=4294967295;wn.MASK_INSIDE=0;wn.MASK_INDETERMINATE=2147483647;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;const _n=new $e,HF=new $e,$F=new $e,yh=new $e,sS=new $e;function GF(i,t={}){const e=L8,n=10;let s=0,r=0;const o=HF,l=$F;o.identity(),l.copy(i);const u=e*WF(l);for(;r<n&&qF(l)>u;)XF(l,yh),sS.copy(yh).transpose(),l.multiplyRight(yh),l.multiplyLeft(sS),o.multiplyRight(yh),++s>2&&(++r,s=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function WF(i){let t=0;for(let e=0;e<9;++e){const n=i[e];t+=n*n}return Math.sqrt(t)}const i_=[1,0,0],n_=[2,2,1];function qF(i){let t=0;for(let e=0;e<3;++e){const n=i[_n.getElementIndex(n_[e],i_[e])];t+=2*n*n}return Math.sqrt(t)}function XF(i,t){const e=D8;let n=0,s=1;for(let f=0;f<3;++f){const g=Math.abs(i[_n.getElementIndex(n_[f],i_[f])]);g>n&&(s=f,n=g)}const r=i_[s],o=n_[s];let l=1,u=0;if(Math.abs(i[_n.getElementIndex(o,r)])>e){const f=i[_n.getElementIndex(o,o)],g=i[_n.getElementIndex(r,r)],p=i[_n.getElementIndex(o,r)],_=(f-g)/2/p;let v;_<0?v=-1/(-_+Math.sqrt(1+_*_)):v=1/(_+Math.sqrt(1+_*_)),l=1/Math.sqrt(1+v*v),u=v*l}return $e.IDENTITY.to(t),t[_n.getElementIndex(r,r)]=t[_n.getElementIndex(o,o)]=l,t[_n.getElementIndex(o,r)]=u,t[_n.getElementIndex(r,o)]=-u,t}const ks=new yt,YF=new yt,KF=new yt,ZF=new yt,QF=new yt,JF=new $e,t9={diagonal:new $e,unitary:new $e};function QE(i,t=new Rm){if(!i||i.length===0)return t.halfAxes=new $e([0,0,0,0,0,0,0,0,0]),t.center=new yt,t;const e=i.length,n=new yt(0,0,0);for(const K of i)n.add(K);const s=1/e;n.multiplyByScalar(s);let r=0,o=0,l=0,u=0,f=0,g=0;for(const K of i){const ut=ks.copy(K).subtract(n);r+=ut.x*ut.x,o+=ut.x*ut.y,l+=ut.x*ut.z,u+=ut.y*ut.y,f+=ut.y*ut.z,g+=ut.z*ut.z}r*=s,o*=s,l*=s,u*=s,f*=s,g*=s;const p=JF;p[0]=r,p[1]=o,p[2]=l,p[3]=o,p[4]=u,p[5]=f,p[6]=l,p[7]=f,p[8]=g;const{unitary:_}=GF(p,t9),v=t.halfAxes.copy(_);let b=v.getColumn(0,KF),x=v.getColumn(1,ZF),T=v.getColumn(2,QF),w=-Number.MAX_VALUE,M=-Number.MAX_VALUE,E=-Number.MAX_VALUE,P=Number.MAX_VALUE,k=Number.MAX_VALUE,U=Number.MAX_VALUE;for(const K of i)ks.copy(K),w=Math.max(ks.dot(b),w),M=Math.max(ks.dot(x),M),E=Math.max(ks.dot(T),E),P=Math.min(ks.dot(b),P),k=Math.min(ks.dot(x),k),U=Math.min(ks.dot(T),U);b=b.multiplyByScalar(.5*(P+w)),x=x.multiplyByScalar(.5*(k+M)),T=T.multiplyByScalar(.5*(U+E)),t.center.copy(b).add(x).add(T);const Y=YF.set(w-P,M-k,E-U).multiplyByScalar(.5),et=new $e([Y[0],0,0,0,Y[1],0,0,0,Y[2]]);return t.halfAxes.multiplyRight(et),t}const $a=512,rS=3,JE=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],tA=JE.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),e9=tA.concat([[.25,.5],[.75,.5]]);class Ga{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get children(){if(!this._children){const t=this.x*2,e=this.y*2,n=this.z+1;this._children=[new Ga(t,e,n),new Ga(t,e+1,n),new Ga(t+1,e,n),new Ga(t+1,e+1,n)]}return this._children}update(t){const{viewport:e,cullingVolume:n,elevationBounds:s,minZ:r,maxZ:o,bounds:l,offset:u,project:f}=t,g=this.getBoundingVolume(s,u,f);if(l&&!this.insideBounds(l)||n.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:_}=this;if(_<o&&_>=r){const v=g.distanceTo(e.cameraPosition)*e.scale/e.height;_+=Math.floor(Math.log2(v))}if(_>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const _ of this.children)_.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds([t,e,n,s]){const r=Math.pow(2,this.z),o=$a/r;return this.x*o<n&&this.y*o<s&&(this.x+1)*o>t&&(this.y+1)*o>e}getBoundingVolume(t,e,n){if(n){const u=this.z<1?e9:this.z<2?tA:JE,f=[];for(const g of u){const p=r_(this.x+g[0],this.y+g[1],this.z);p[2]=t[0],f.push(n(p)),t[0]!==t[1]&&(p[2]=t[1],f.push(n(p)))}return QE(f)}const s=Math.pow(2,this.z),r=$a/s,o=this.x*r+e*$a,l=$a-(this.y+1)*r;return new Mm([o,l,t[0]],[o+r,l+r,t[1]])}}function i9(i,t,e,n){const s=i instanceof bc&&i.resolution?i.projectPosition:null,r=Object.values(i.getFrustumPlanes()).map(({normal:v,distance:b})=>new lo(v.clone().negate(),b)),o=new wn(r),l=i.distanceScales.unitsPerMeter[2],u=e&&e[0]*l||0,f=e&&e[1]*l||0,g=i instanceof ns&&i.pitch<=60?t:0;if(n){const[v,b,x,T]=n,w=is([v,T]),M=is([x,b]);n=[w[0],$a-w[1],M[0],$a-M[1]]}const p=new Ga(0,0,0),_={viewport:i,project:s,cullingVolume:o,elevationBounds:[u,f],minZ:g,maxZ:t,bounds:n,offset:0};if(p.update(_),i instanceof ns&&i.subViewports&&i.subViewports.length>1){for(_.offset=-1;p.update(_)&&!(--_.offset<-rS););for(_.offset=1;p.update(_)&&!(++_.offset>rS););}return p.getSelected()}const ss=512,n9=[-1/0,-1/0,1/0,1/0],s9={equal:(i,t)=>{if(i===t)return!0;if(!Array.isArray(i)||!Array.isArray(t))return!1;const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}};function Pm(i,t){const e=[t.transformAsPoint([i[0],i[1]]),t.transformAsPoint([i[2],i[1]]),t.transformAsPoint([i[0],i[3]]),t.transformAsPoint([i[2],i[3]])];return[Math.min(...e.map(s=>s[0])),Math.min(...e.map(s=>s[1])),Math.max(...e.map(s=>s[0])),Math.max(...e.map(s=>s[1]))]}function r9(i){return Math.abs(i.split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0)|0,0))}function a9(i,t){if(!i||!i.length)return null;const{index:e,id:n}=t;if(Array.isArray(i)){const r=r9(n)%i.length;i=i[r]}let s=i;for(const r of Object.keys(e)){const o=new RegExp(`{${r}}`,"g");s=s.replace(o,String(e[r]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),s}function o9(i,t,e){let n;return n=i.getBounds(),i.isGeospatial?[Math.max(n[0],e[0]),Math.max(n[1],e[1]),Math.min(n[2],e[2]),Math.min(n[3],e[3])]:[Math.max(Math.min(n[0],e[2]),e[0]),Math.max(Math.min(n[1],e[3]),e[1]),Math.min(Math.max(n[2],e[0]),e[2]),Math.min(Math.max(n[3],e[1]),e[3])]}function l9({viewport:i,z:t,cullRect:e}){return(i.subViewports||[i]).map(s=>s_(s,t||0,e))}function s_(i,t,e){if(!Array.isArray(t)){const r=e.x-i.x,o=e.y-i.y,{width:l,height:u}=e,f={targetZ:t},g=i.unproject([r,o],f),p=i.unproject([r+l,o],f),_=i.unproject([r,o+u],f),v=i.unproject([r+l,o+u],f);return[Math.min(g[0],p[0],_[0],v[0]),Math.min(g[1],p[1],_[1],v[1]),Math.max(g[0],p[0],_[0],v[0]),Math.max(g[1],p[1],_[1],v[1])]}const n=s_(i,t[0],e),s=s_(i,t[1],e);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]}function c9(i,t,e){return e?Pm(i,e).map(s=>s*t/ss):i.map(n=>n*t/ss)}function Im(i,t){return Math.pow(2,i)*ss/t}function r_(i,t,e){const n=Im(e,ss),s=i/n*360-180,r=Math.PI-2*Math.PI*t/n,o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[s,o]}function aS(i,t,e,n){const s=Im(e,n);return[i/s*ss,t/s*ss]}function u9(i,t,e,n,s=ss){if(i.isGeospatial){const[f,g]=r_(t,e,n),[p,_]=r_(t+1,e+1,n);return{west:f,north:g,east:p,south:_}}const[r,o]=aS(t,e,n,s),[l,u]=aS(t+1,e+1,n,s);return{left:r,top:o,right:l,bottom:u}}function h9(i,t,e,n,s){const r=o9(i,null,n),o=Im(t,e),[l,u,f,g]=c9(r,o,s),p=[];for(let _=Math.floor(l);_<f;_++)for(let v=Math.floor(u);v<g;v++)p.push({x:_,y:v,z:t});return p}function f9({viewport:i,maxZoom:t,minZoom:e,zRange:n,extent:s,tileSize:r=ss,modelMatrix:o,modelMatrixInverse:l,zoomOffset:u=0}){let f=i.isGeospatial?Math.round(i.zoom+Math.log2(ss/r))+u:Math.ceil(i.zoom)+u;if(typeof e=="number"&&Number.isFinite(e)&&f<e){if(!s)return[];f=e}typeof t=="number"&&Number.isFinite(t)&&f>t&&(f=t);let g=s;return o&&l&&s&&!i.isGeospatial&&(g=Pm(s,o)),i.isGeospatial?i9(i,f,n,s):h9(i,f,r,g||n9,l)}function d9(i){let t={},e;return n=>{for(const s in n)if(!g9(n[s],t[s])){e=i(n),t=n;break}return e}}function g9(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}return!1}const oS=1,Ff=2,p9="never",_9="no-overlap",Om="best-available",m9=5,y9={[Om]:b9,[_9]:x9,[p9]:()=>{}},v9={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Nm{constructor(t){this._getCullBounds=d9(l9),this.opts={...v9,...t},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new gR({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new He,this._modelMatrixInverse=new He}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const e=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(e)?this._cache.delete(t):e.setNeedsReload()}}update(t,{zRange:e,modelMatrix:n}={zRange:null,modelMatrix:null}){const s=n?new He(n):new He,r=!s.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!Qn(this._zRange,e)||r){r&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=t,this._zRange=e;const l=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,e,n){if(!t.isVisible)return!1;if(e&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:e});let{bbox:r}=t;for(const[o,l,u,f]of s){let g;if("west"in r)g=r.west<u&&r.east>o&&r.south<f&&r.north>l;else{if(n&&!He.IDENTITY.equals(n)){const[v,b,x,T]=Pm([r.left,r.top,r.right,r.bottom],n);r={left:v,top:b,right:x,bottom:T}}const p=Math.min(r.top,r.bottom),_=Math.max(r.top,r.bottom);g=r.left<u&&r.right>o&&p<f&&_>l}if(g)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:e,minZoom:n,zRange:s,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:l,extent:u,zoomOffset:f}=this.opts;return f9({viewport:t,maxZoom:e,minZoom:n,zRange:s,tileSize:l,extent:u,modelMatrix:r,modelMatrixInverse:o,zoomOffset:f})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:e}=this.opts;return{bbox:u9(this._viewport,t.x,t.y,t.z,e)}}getParentIndex(t){const e=Math.floor(t.x/2),n=Math.floor(t.y/2),s=t.z-1;return{x:e,y:n,z:s}}updateTileStates(){const t=this.opts.refinementStrategy||Om,e=new Array(this._cache.size);let n=0;for(const s of this._cache.values())e[n++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof t=="function"?t:y9[t])(Array.from(this._cache.values())),n=0;for(const s of this._cache.values())if(e[n++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,e=[];let n=0;for(const s of this._cache.values())s.isLoading&&(n++,!s.isSelected&&!s.isVisible&&e.push(s));for(;t>0&&n>t&&e.length>0;)e.shift().abort(),n--}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children&&(e.children.length=0);for(const e of t.values()){const n=this._getNearestAncestor(e);e.parent=n,n?.children&&n.children.push(e)}}_resizeCache(){const{_cache:t,opts:e}=this,n=e.maxCacheSize??(e.maxCacheByteSize!==null?1/0:m9*this.selectedTiles.length),s=e.maxCacheByteSize??1/0;if(t.size>n||this._cacheByteSize>s){for(const[o,l]of t)if(!l.isVisible&&!l.isSelected&&(this._cacheByteSize-=e.maxCacheByteSize!==null?l.byteLength:0,t.delete(o),this.opts.onTileUnload?.(l)),t.size<=n&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,l)=>o.zoom-l.zoom),this._dirty=!1)}_getTile(t,e){const n=this.getTileId(t);let s=this._cache.get(n),r=!1;return!s&&e?(s=new kF(t),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:n,zoom:this.getTileZoom(s.index)}),r=!0,this._cache.set(n,s),this._dirty=!0):s&&s.needsReload&&(r=!0),s&&r&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(t){const{_minZoom:e=0}=this;let n=t.index;for(;this.getTileZoom(n)>e;){n=this.getParentIndex(n);const s=this._getTile(n);if(s)return s}return null}}function b9(i){for(const t of i)t.state=0;for(const t of i)t.isSelected&&!eA(t)&&Dm(t);for(const t of i)t.isVisible=!!(t.state&Ff)}function x9(i){for(const e of i)e.state=0;for(const e of i)e.isSelected&&eA(e);const t=Array.from(i).sort((e,n)=>e.zoom-n.zoom);for(const e of t)if(e.isVisible=!!(e.state&Ff),e.children&&(e.isVisible||e.state&oS))for(const n of e.children)n.state=oS;else e.isSelected&&Dm(e)}function eA(i){let t=i;for(;t;){if(t.isLoaded||t.content)return t.state|=Ff,!0;t=t.parent}return!1}function Dm(i){for(const t of i.children)t.isLoaded||t.content?t.state|=Ff:Dm(t)}const S9={TilesetClass:Nm,data:{type:"data",value:[]},dataComparator:s9.equal,renderSubLayers:{type:"function",value:i=>new Am(i)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:i=>console.error(i)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Om,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class zf extends Zs{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(t=>t.isLoaded&&t.layers&&t.layers.every(e=>e.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:e}=this.state;const n=t.propsOrDataChanged||t.updateTriggersChanged,s=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);e?n&&(e.setOptions(this._getTilesetOptions()),s?e.reloadAll():e.tiles.forEach(r=>{r.layers=null})):(e=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:e})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:e,maxCacheByteSize:n,refinementStrategy:s,extent:r,maxZoom:o,minZoom:l,maxRequests:u,debounceTime:f,zoomOffset:g}=this.props;return{maxCacheSize:e,maxCacheByteSize:n,maxZoom:o,minZoom:l,tileSize:t,refinementStrategy:s,extent:r,maxRequests:u,debounceTime:f,zoomOffset:g,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:e,modelMatrix:n}=this.props,s=t.update(this.context.viewport,{zRange:e,modelMatrix:n}),{isLoaded:r}=t,o=this.state.isLoaded!==r,l=this.state.frameNumber!==s;r&&(o||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:s}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,e){this.props.onTileError(t),e.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:e,getTileData:n,fetch:s}=this.props,{signal:r}=t;return t.url=typeof e=="string"||Array.isArray(e)?a9(e,t):null,n?n(t):s&&t.url?s(t.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const e=t.sourceLayer,n=e.props.tile,s=t.info;return s.picked&&(s.tile=n),s.sourceTile=n,s.sourceTileSubLayer=e,s}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const e=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)e&&t.layers[0]&&Object.keys(e).some(n=>t.layers[0].props[n]!==e[n])&&(t.layers=t.layers.map(n=>n.clone(e)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=En(n,Boolean).map(s=>s.clone({tile:t,...e}))}return t.layers})}filterSubLayer({layer:t,cullRect:e}){const{tile:n}=t.props,{modelMatrix:s}=this.props;return this.state.tileset.isTileVisible(n,e,s?new He(s):null)}}zf.defaultProps=S9;zf.layerName="TileLayer";const o0=Math.PI/180,vh=new Float32Array(16),lS=new Float32Array(12);function cS(i,t,e){const n=t[0]*o0,s=t[1]*o0,r=t[2]*o0,o=Math.sin(r),l=Math.sin(n),u=Math.sin(s),f=Math.cos(r),g=Math.cos(n),p=Math.cos(s),_=e[0],v=e[1],b=e[2];i[0]=_*p*g,i[1]=_*u*g,i[2]=_*-l,i[3]=v*(-u*f+p*l*o),i[4]=v*(p*f+u*l*o),i[5]=v*g*o,i[6]=b*(u*o+p*l*f),i[7]=b*(-p*o+u*l*f),i[8]=b*g*f}function uS(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const T9={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,{startRow:t,endRow:e}){const{data:n,getOrientation:s,getScale:r,getTranslation:o,getTransformMatrix:l}=this.props,u=Array.isArray(l),f=u&&l.length===16,g=Array.isArray(r),p=Array.isArray(s),_=Array.isArray(o),v=f||!u&&!!l(n[0]);v?i.constant=f:i.constant=p&&g&&_;const b=i.value;if(i.constant){let x;v?(vh.set(l),x=uS(vh)):(x=lS,cS(x,s,r),x.set(o,9)),i.value=new Float32Array(x)}else{let x=t*i.size;const{iterable:T,objectInfo:w}=mo(n,t,e);for(const M of T){w.index++;let E;if(v)vh.set(f?l:l(M,w)),E=uS(vh);else{E=lS;const P=p?s:s(M,w),k=g?r:r(M,w);cS(E,P,k),E.set(_?o:o(M,w),9)}b[x++]=E[0],b[x++]=E[1],b[x++]=E[2],b[x++]=E[3],b[x++]=E[4],b[x++]=E[5],b[x++]=E[6],b[x++]=E[7],b[x++]=E[8],b[x++]=E[9],b[x++]=E[10],b[x++]=E[11]}}}};function w9(i,t){return t===Ft.CARTESIAN||t===Ft.METER_OFFSETS||t===Ft.DEFAULT&&!i.isGeospatial}const hS=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,E9={name:"simpleMesh",vs:hS,fs:hS,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},A9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,M9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function l0(i){const t=i.positions||i.POSITION;Lt.assert(t,'no "postions" or "POSITION" attribute in mesh');const e=t.value.length/t.size;let n=i.COLOR_0||i.colors;n||(n={size:3,value:new Float32Array(e*3).fill(1)});let s=i.NORMAL||i.normals;s||(s={size:3,value:new Float32Array(e*3).fill(0)});let r=i.TEXCOORD_0||i.texCoords;return r||(r={size:2,value:new Float32Array(e*2).fill(0)}),{positions:t,colors:n,normals:s,texCoords:r}}function fS(i){return i instanceof Jn?(i.attributes=l0(i.attributes),i):i.attributes?new Jn({...i,topology:"triangle-list",attributes:l0(i.attributes)}):new Jn({topology:"triangle-list",attributes:l0(i)})}const C9=[0,0,0,255],R9={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:C9},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class bf extends rs{getShaders(){return super.getShaders({vs:A9,fs:M9,modules:[fo,Nw,go,E9]})}getBounds(){if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:e}=this.props;if(!e)return null;if(t=e.header?.boundingBox,!t){const{attributes:n}=fS(e);n.POSITION=n.POSITION||n.positions,t=yP(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:T9}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:s}=t;if(e.mesh!==n.mesh||s.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),e.mesh){this.state.model=this.getModel(e.mesh);const r=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(r.NORMAL||r.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&e.texture instanceof Re&&this.setTexture(e.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:e}=this.state;if(!e)return;const{viewport:n,renderPass:s}=this.context,{sizeScale:r,coordinateSystem:o,_instanced:l}=this.props,u={sizeScale:r,composeModelMatrix:!l||w9(n,o),flatShading:!this.state.hasNormals};e.shaderInputs.setProps({simpleMesh:u}),e.draw(s)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(t){const e=new $i(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:fS(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:s}=this.state,r={sampler:n||s,hasTexture:!!n};return e.shaderInputs.setProps({simpleMesh:r}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;if(n){const s={sampler:t||e,hasTexture:!!t};n.shaderInputs.setProps({simpleMesh:s})}}}bf.defaultProps=R9;bf.layerName="SimpleMeshLayer";const P9=[[1/3,1/3,1/3],[.5,.5,0],[.5,0,.5],[0,.5,.5]],I9=.125;class O9{reprojectors;width;height;uvs;exactOutputPositions;triangles;_halfedges;_candidatesUV;_queueIndices;_queue;_errors;_pending;_pendingLen;constructor(t,e,n=e){this.reprojectors=t,this.width=e,this.height=n,this.uvs=[],this.exactOutputPositions=[],this.triangles=[],this._halfedges=[],this._candidatesUV=[],this._queueIndices=[],this._queue=[],this._errors=[],this._pending=[],this._pendingLen=0;const s=1,r=1,o=this._addPoint(0,0),l=this._addPoint(s,0),u=this._addPoint(0,r),f=this._addPoint(s,r),g=this._addTriangle(f,o,u,-1,-1,-1);this._addTriangle(o,f,l,g,-1,-1),this._flush()}run(t=I9){if(t<=0)throw new Error("maxError must be positive");for(;this.getMaxError()>t;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}_flush(){for(let t=0;t<this._pendingLen;t++){const e=this._pending[t];this._findReprojectionCandidate(e)}this._pendingLen=0}_findReprojectionCandidate(t){const e=2*this.triangles[t*3+0],n=2*this.triangles[t*3+1],s=2*this.triangles[t*3+2],r=this.uvs[e],o=this.uvs[e+1],l=this.uvs[n],u=this.uvs[n+1],f=this.uvs[s],g=this.uvs[s+1],p=this.exactOutputPositions[e],_=this.exactOutputPositions[e+1],v=this.exactOutputPositions[n],b=this.exactOutputPositions[n+1],x=this.exactOutputPositions[s],T=this.exactOutputPositions[s+1];let w=0,M=0,E=0;for(const P of P9){const k=bh(r,l,f,P[0],P[1],P[2]),U=bh(o,u,g,P[0],P[1],P[2]),Y=bh(p,v,x,P[0],P[1],P[2]),et=bh(_,b,T,P[0],P[1],P[2]),K=k*(this.width-1),ut=U*(this.height-1),ht=this.reprojectors.inverseReproject(Y,et),_t=this.reprojectors.inverseTransform(ht[0],ht[1]),St=K-_t[0],pt=ut-_t[1],It=Math.hypot(St,pt);It>w&&(w=It,M=k,E=U)}(M===r&&E===o||M===l&&E===u||M===f&&E===g)&&(w=0),this._candidatesUV[2*t]=M,this._candidatesUV[2*t+1]=E,this._queuePush(t,w)}_step(){const t=this._queuePop(),e=t*3+0,n=t*3+1,s=t*3+2,r=this.triangles[e],o=this.triangles[n],l=this.triangles[s],u=this.uvs[2*r],f=this.uvs[2*r+1],g=this.uvs[2*o],p=this.uvs[2*o+1],_=this.uvs[2*l],v=this.uvs[2*l+1],b=this._candidatesUV[2*t],x=this._candidatesUV[2*t+1],T=this._addPoint(b,x);if(c0(u,f,g,p,b,x)===0)this._handleCollinear(T,e);else if(c0(g,p,_,v,b,x)===0)this._handleCollinear(T,n);else if(c0(_,v,u,f,b,x)===0)this._handleCollinear(T,s);else{const w=this._halfedges[e],M=this._halfedges[n],E=this._halfedges[s],P=this._addTriangle(r,o,T,w,-1,-1,e),k=this._addTriangle(o,l,T,M,-1,P+1),U=this._addTriangle(l,r,T,E,P+2,k+1);this._legalize(P),this._legalize(k),this._legalize(U)}}_addPoint(t,e){const n=this.uvs.length>>1;this.uvs.push(t,e);const s=t*(this.width-1),r=e*(this.height-1),o=this.reprojectors.forwardTransform(s,r),l=this.reprojectors.forwardReproject(o[0],o[1]);return this.exactOutputPositions.push(l[0],l[1]),n}_addTriangle(t,e,n,s,r,o,l=this.triangles.length){const u=l/3;return this.triangles[l+0]=t,this.triangles[l+1]=e,this.triangles[l+2]=n,this._halfedges[l+0]=s,this._halfedges[l+1]=r,this._halfedges[l+2]=o,s>=0&&(this._halfedges[s]=l+0),r>=0&&(this._halfedges[r]=l+1),o>=0&&(this._halfedges[o]=l+2),this._candidatesUV[2*u+0]=0,this._candidatesUV[2*u+1]=0,this._queueIndices[u]=-1,this._pending[this._pendingLen++]=u,l}_legalize(t){const e=this._halfedges[t];if(e<0)return;const n=t-t%3,s=e-e%3,r=n+(t+1)%3,o=n+(t+2)%3,l=s+(e+2)%3,u=s+(e+1)%3,f=this.triangles[o],g=this.triangles[t],p=this.triangles[r],_=this.triangles[l],v=this.uvs;if(!N9(v[2*f],v[2*f+1],v[2*g],v[2*g+1],v[2*p],v[2*p+1],v[2*_],v[2*_+1]))return;const b=this._halfedges[r],x=this._halfedges[o],T=this._halfedges[l],w=this._halfedges[u];this._queueRemove(n/3),this._queueRemove(s/3);const M=this._addTriangle(f,_,p,-1,T,b,n),E=this._addTriangle(_,f,g,M,x,w,s);this._legalize(M+1),this._legalize(E+2)}_handleCollinear(t,e){const n=e-e%3,s=n+(e+1)%3,r=n+(e+2)%3,o=this.triangles[r],l=this.triangles[e],u=this.triangles[s],f=this._halfedges[s],g=this._halfedges[r],p=this._halfedges[e];if(p<0){const U=this._addTriangle(t,o,l,-1,g,-1,n),Y=this._addTriangle(o,t,u,U,-1,f);this._legalize(U+1),this._legalize(Y+2);return}const _=p-p%3,v=_+(p+2)%3,b=_+(p+1)%3,x=this.triangles[v],T=this._halfedges[v],w=this._halfedges[b];this._queueRemove(_/3);const M=this._addTriangle(o,l,t,g,-1,-1,n),E=this._addTriangle(l,x,t,w,-1,M+1,_),P=this._addTriangle(x,u,t,T,-1,E+1),k=this._addTriangle(u,o,t,f,M+2,P+1);this._legalize(M),this._legalize(E),this._legalize(P),this._legalize(k)}_queuePush(t,e){const n=this._queue.length;this._queueIndices[t]=n,this._queue.push(t),this._errors.push(e),this._queueUp(n)}_queuePop(){const t=this._queue.length-1;return this._queueSwap(0,t),this._queueDown(0,t),this._queuePopBack()}_queuePopBack(){const t=this._queue.pop();return this._errors.pop(),this._queueIndices[t]=-1,t}_queueRemove(t){const e=this._queueIndices[t];if(e<0){const s=this._pending.indexOf(t);if(s!==-1)this._pending[s]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const n=this._queue.length-1;n!==e&&(this._queueSwap(e,n),this._queueDown(e,n)||this._queueUp(e)),this._queuePopBack()}_queueLess(t,e){return this._errors[t]>this._errors[e]}_queueSwap(t,e){const n=this._queue[t],s=this._queue[e];this._queue[t]=s,this._queue[e]=n,this._queueIndices[n]=e,this._queueIndices[s]=t;const r=this._errors[t];this._errors[t]=this._errors[e],this._errors[e]=r}_queueUp(t){let e=t;for(;;){const n=e-1>>1;if(n===e||!this._queueLess(e,n))break;this._queueSwap(n,e),e=n}}_queueDown(t,e){let n=t;for(;;){const s=2*n+1;if(s>=e||s<0)break;const r=s+1;let o=s;if(r<e&&this._queueLess(r,s)&&(o=r),!this._queueLess(o,n))break;this._queueSwap(n,o),n=o}return n>t}}function c0(i,t,e,n,s,r){return(e-s)*(t-r)-(n-r)*(i-s)}function N9(i,t,e,n,s,r,o,l){const u=i-o,f=t-l,g=e-o,p=n-l,_=s-o,v=r-l,b=u*u+f*f,x=g*g+p*p,T=_*_+v*v;return u*(p*T-x*v)-f*(g*T-x*_)+b*(g*v-p*_)<0}function bh(i,t,e,n,s,r){return n*i+s*t+r*e}const Sc={name:"create-texture-unorm",inject:{"fs:#decl":"uniform sampler2D textureName;","fs:DECKGL_FILTER_COLOR":`
      color = texture(textureName, geometry.uv);
    `},getUniforms:i=>({textureName:i.textureName})},D9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (simpleMesh.flatShading) {

  normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
  } else {
    normal = normals_commonspace;
  }

  // We initialize color here before passing into DECKGL_FILTER_COLOR
  vec4 color;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;class L9 extends bf{static layerName="mesh-texture-layer";static defaultProps=bf.defaultProps;getShaders(){const t=super.getShaders(),e=t.modules;for(const n of this.props.renderPipeline)e.push(n.module);return{...t,fs:D9,modules:e}}draw(t){const e={};for(const n of this.props.renderPipeline)e[n.module.name]=n.props||{};for(const n of super.getModels())n.shaderInputs.setProps(e);super.draw(t)}}const k9=.125,dS=[[252,73,163],[255,51,204],[204,102,255],[153,51,255],[102,204,255],[51,153,255],[102,255,204],[51,255,170],[0,255,0],[51,204,51],[255,204,102],[255,179,71],[255,102,102],[255,80,80],[255,0,0],[204,0,0],[255,128,0],[255,153,51],[255,255,102],[255,255,51],[0,255,255],[0,204,255]],B9={debug:!1,debugOpacity:.5};class U9 extends Zs{static layerName="RasterLayer";static defaultProps=B9;initializeState(){this.setState({})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:s}=t;(s.dataChanged||e.width!==n.width||e.height!==n.height||e.reprojectionFns!==n.reprojectionFns||e.maxError!==n.maxError)&&this._generateMesh()}_generateMesh(){const{width:t,height:e,reprojectionFns:n,maxError:s=k9}=this.props,r=new O9(n,t+1,e+1);r.run(s);const{indices:o,positions:l,texCoords:u}=F9(r);this.setState({reprojector:r,mesh:{positions:l,indices:o,texCoords:u}})}renderDebugLayer(){const{reprojector:t}=this.state,{debugOpacity:e}=this.props;return t?new Sm(this.getSubLayerProps({id:"polygon",data:{reprojector:t,length:t.triangles.length/3},getPolygon:(n,{index:s,data:r})=>{const o=r.reprojector.triangles,l=t.exactOutputPositions,u=o[s*3],f=o[s*3+1],g=o[s*3+2];return[[l[u*2],l[u*2+1]],[l[f*2],l[f*2+1]],[l[g*2],l[g*2+1]],[l[u*2],l[u*2+1]]]},getFillColor:(n,{index:s,target:r})=>{const o=dS[s%dS.length];return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=255,r},getLineColor:[0,0,0],getLineWidth:1,lineWidthUnits:"pixels",opacity:e!==void 0&&Number.isFinite(e)?Math.max(0,Math.min(1,e)):1,pickable:!1})):null}_createRenderPipeline(){if(this.props.renderPipeline instanceof ImageData){const t=this.props.renderPipeline,e=this.context.device.createTexture({format:"rgba8unorm",width:t.width,height:t.height,data:t.data});return[{module:Sc,props:{textureName:e}}]}else return this.props.renderPipeline}renderLayers(){const{mesh:t}=this.state,{debug:e}=this.props;if(!t)return null;const{indices:n,positions:s,texCoords:r}=t,l=[new L9(this.getSubLayerProps({id:"raster",renderPipeline:this._createRenderPipeline(),data:[1],mesh:{indices:{value:n,size:1},attributes:{POSITION:{value:s,size:3},TEXCOORD_0:{value:r,size:2}}},_instanced:!1,getPosition:[0,0,0],getColor:[255,255,255]}))];if(e){const u=this.renderDebugLayer();u&&l.push(u)}return l}}function F9(i){const t=i.uvs.length/2,e=new Float32Array(t*3),n=new Float32Array(i.uvs);for(let r=0;r<t;r++)e[r*3]=i.exactOutputPositions[r*2],e[r*3+1]=i.exactOutputPositions[r*2+1],e[r*3+2]=0;return{indices:new Uint32Array(i.triangles),positions:e,texCoords:n}}const gS=512,z9=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],V9=z9.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),j9=6378137,a_=2*Math.PI*j9,pS=a_/2,H9=28e-5;class Lm{x;y;z;metadata;childVisible;selected;_children;constructor(t,e,n,s){this.x=t,this.y=e,this.z=n,this.metadata=s}get tileMatrix(){return this.metadata.tileMatrices[this.z]}get children(){if(!this._children){const t=this.metadata.tileMatrices.length-1;if(this.z>=t)return this._children=null,null;const e=this.tileMatrix,n=this.z+1,s=this.metadata.tileMatrices[n],r=_S({x:this.x,y:this.y,transform:e.geotransform,tileWidth:e.tileWidth,tileHeight:e.tileHeight}),{minCol:o,maxCol:l,minRow:u,maxRow:f}=W9(r,s),g=[];for(let p=u;p<=f;p++)for(let _=o;_<=l;_++)g.push(new Lm(_,p,n,this.metadata));this._children=g.length>0?g:null}return this._children}update(t){this.childVisible=!1,this.selected=!1;const{viewport:e,cullingVolume:n,elevationBounds:s,minZ:r,maxZ:o=this.metadata.tileMatrices.length-1,project:l,bounds:u}=t,{boundingVolume:f,commonSpaceBounds:g}=this.getBoundingVolume(s,l);if(u&&!this.insideBounds(u,g)||n.computeVisibility(f)<0)return!1;const _=this.children;if(!this.childVisible&&this.z>=r){const v=Y9(f,e.zoom);if(this.tileMatrix.scaleDenominator*H9<=v||this.z>=o||_===null&&this.z>=r)return this.selected=!0,!0}if(_&&_.length>0){this.selected=!1;let v=!1;for(const b of _)b.update(t)&&(v=!0);return this.childVisible=v,v}return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds(t,e){const[n,s,r,o]=t,[l,u,f,g]=e;return l<r&&f>n&&u<o&&g>s}getBoundingVolume(t,e){return e&&ye(!1,"TODO: implement getBoundingVolume in Globe view"),this._getGenericBoundingVolume(t)}_getGenericBoundingVolume(t){const e=this.tileMatrix,{tileWidth:n,tileHeight:s,geotransform:r}=e,[o,l]=t,u=_S({x:this.x,y:this.y,transform:r,tileWidth:n,tileHeight:s}),g=$9(V9,u,this.metadata.projectTo3857).map(w=>G9(w)),p=[];for(const w of g)p.push([w[0],w[1],o]),o!==l&&p.push([w[0],w[1],l]);let _=Number.POSITIVE_INFINITY,v=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(const[w,M]of g)w<_&&(_=w),M<v&&(v=M),w>b&&(b=w),M>x&&(x=M);const T=[_,v,b,x];return{boundingVolume:QE(p),commonSpaceBounds:T}}}function _S({x:i,y:t,transform:e,tileWidth:n,tileHeight:s}){const[r,o,l,u,f,g]=e;if(o!==0||u!==0)throw new Error(`Rotated/skewed geotransforms not yet supported (b=${o}, d=${u}). Only north-up, non-rotated rasters are currently supported.`);const p=i*n,_=t*s,v=(i+1)*n,b=(t+1)*s,x=r*p+o*_+l,T=u*p+f*_+g,w=r*v+o*b+l,M=u*v+f*b+g;return[Math.min(x,w),Math.min(T,M),Math.max(x,w),Math.max(T,M)]}function $9(i,t,e){const[n,s,r,o]=t,l=[];for(const[u,f]of i){const g=n+u*(r-n),p=s+f*(o-s),_=e([g,p]);l.push(_)}return l}function G9([i,t]){const e=Math.max(-pS,Math.min(pS,t));return[(i/a_+.5)*gS,(e/a_+.5)*gS]}function W9(i,t){const[e,n,s,r]=i,{tileWidth:o,tileHeight:l,cellSize:u,matrixWidth:f,matrixHeight:g,pointOfOrigin:p}=t,_=o*u,v=l*u,b=p[0],x=p[1];let T=Math.floor((e-b)/_),w=Math.floor((s-b)/_),M=Math.floor((x-r)/v),E=Math.floor((x-n)/v);return T=Math.max(0,Math.min(f-1,T)),w=Math.max(0,Math.min(f-1,w)),M=Math.max(0,Math.min(g-1,M)),E=Math.max(0,Math.min(g-1,E)),{minCol:T,maxCol:w,minRow:M,maxRow:E}}function q9(i,t){const{viewport:e,maxZ:n,zRange:s}=t,r=e instanceof bc&&e.resolution?e.projectPosition:null,o=Object.values(e.getFrustumPlanes()).map(({normal:K,distance:ut})=>new lo(K.clone().negate(),ut)),l=new wn(o),u=e.distanceScales.unitsPerMeter[2],f=s&&s[0]*u||0,g=s&&s[1]*u||0,p=0,{lowerLeft:_,upperRight:v}=i.wgsBounds,[b,x]=_,[T,w]=v,M=is([b,x]),E=is([T,w]),P=[M[0],M[1],E[0],E[1]],k=i.tileMatrices[0],U=[];for(let K=0;K<k.matrixHeight;K++)for(let ut=0;ut<k.matrixWidth;ut++)U.push(new Lm(ut,K,0,i));const Y={viewport:e,project:r,cullingVolume:l,elevationBounds:[f,g],minZ:p,maxZ:n,bounds:P};for(const K of U)K.update(Y);const et=[];for(const K of U)K.getSelected(et);return et}function X9(i,t){return 40075016686e-3*Math.cos(i*Math.PI/180)/2**(t+8)}function Y9(i,t){const[e,n]=kr(i.center);return X9(n,t)}class K9 extends Nm{metadata;constructor(t,e){super(e),this.metadata=t}getTileIndices(t){const e=this.metadata.tileMatrices.length-1,n=typeof t.maxZoom=="number"?Math.min(t.maxZoom,e):e;return q9(this.metadata,{viewport:t.viewport,maxZ:n,zRange:t.zRange??null})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getParentIndex(t){if(t.z===0)return t;const e=this.metadata.tileMatrices[t.z],n=this.metadata.tileMatrices[t.z-1],s=e.cellSize/n.cellSize;return{x:Math.floor(t.x/s),y:Math.floor(t.y/s),z:t.z-1}}getTileZoom(t){return t.z}getTileMetadata(t){const{x:e,y:n,z:s}=t,{tileMatrices:r}=this.metadata,o=r[s],{geotransform:l,tileHeight:u,tileWidth:f}=o,[g,p,_,v,b,x]=l,T=e*f,w=n*u,M=(e+1)*f,E=(n+1)*u,P=[g*T+p*w+_,v*T+b*w+x],k=[g*M+p*w+_,v*M+b*w+x],U=[g*T+p*E+_,v*T+b*E+x],Y=[g*M+p*E+_,v*M+b*E+x],et={topLeft:P,topRight:k,bottomLeft:U,bottomRight:Y};return{bounds:[Math.min(P[0],k[0],U[0],Y[0]),Math.min(P[1],k[1],U[1],Y[1]),Math.max(P[0],k[0],U[0],Y[0]),Math.max(P[1],k[1],U[1],Y[1])],projectedBounds:et,tileWidth:f,tileHeight:u,tileMatrix:o}}}function Z9(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)i("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),i("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");i("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),i("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var Ur=1,Fr=2,to=3,Q9=4,o_=5,mS=6378137,J9=6356752314e-3,yS=.0066943799901413165,ql=484813681109536e-20,lt=Math.PI/2,tz=.16666666666666666,ez=.04722222222222222,iz=.022156084656084655,ft=1e-10,_e=.017453292519943295,fi=57.29577951308232,Kt=Math.PI/4,cc=Math.PI*2,xe=3.14159265359,gi={};gi.greenwich=0;gi.lisbon=-9.131906111111;gi.paris=2.337229166667;gi.bogota=-74.080916666667;gi.madrid=-3.687938888889;gi.rome=12.452333333333;gi.bern=7.439583333333;gi.jakarta=106.807719444444;gi.ferro=-17.666666666667;gi.brussels=4.367975;gi.stockholm=18.058277777778;gi.athens=23.7163375;gi.oslo=10.722916666667;const nz={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var vS=/[\s_\-\/\(\)]/g;function Xs(i,t){if(i[t])return i[t];for(var e=Object.keys(i),n=t.toLowerCase().replace(vS,""),s=-1,r,o;++s<e.length;)if(r=e[s],o=r.toLowerCase().replace(vS,""),o===n)return i[r]}function l_(i){var t={},e=i.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,u){var f=u.split("=");return f.push(!0),l[f[0].toLowerCase()]=f[1],l},{}),n,s,r,o={proj:"projName",datum:"datumCode",rf:function(l){t.rf=parseFloat(l)},lat_0:function(l){t.lat0=l*_e},lat_1:function(l){t.lat1=l*_e},lat_2:function(l){t.lat2=l*_e},lat_ts:function(l){t.lat_ts=l*_e},lon_0:function(l){t.long0=l*_e},lon_1:function(l){t.long1=l*_e},lon_2:function(l){t.long2=l*_e},alpha:function(l){t.alpha=parseFloat(l)*_e},gamma:function(l){t.rectified_grid_angle=parseFloat(l)*_e},lonc:function(l){t.longc=l*_e},x_0:function(l){t.x0=parseFloat(l)},y_0:function(l){t.y0=parseFloat(l)},k_0:function(l){t.k0=parseFloat(l)},k:function(l){t.k0=parseFloat(l)},a:function(l){t.a=parseFloat(l)},b:function(l){t.b=parseFloat(l)},r:function(l){t.a=t.b=parseFloat(l)},r_a:function(){t.R_A=!0},zone:function(l){t.zone=parseInt(l,10)},south:function(){t.utmSouth=!0},towgs84:function(l){t.datum_params=l.split(",").map(function(u){return parseFloat(u)})},to_meter:function(l){t.to_meter=parseFloat(l)},units:function(l){t.units=l;var u=Xs(nz,l);u&&(t.to_meter=u.to_meter)},from_greenwich:function(l){t.from_greenwich=l*_e},pm:function(l){var u=Xs(gi,l);t.from_greenwich=(u||parseFloat(l))*_e},nadgrids:function(l){l==="@null"?t.datumCode="none":t.nadgrids=l},axis:function(l){var u="ewnsud";l.length===3&&u.indexOf(l.substr(0,1))!==-1&&u.indexOf(l.substr(1,1))!==-1&&u.indexOf(l.substr(2,1))!==-1&&(t.axis=l)},approx:function(){t.approx=!0},over:function(){t.over=!0}};for(n in e)s=e[n],n in o?(r=o[n],typeof r=="function"?r(s):t[r]=s):t[n]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t.projStr=i,t}class iA{static getId(t){const e=t.find(n=>Array.isArray(n)&&n[0]==="ID");return e&&e.length>=3?{authority:e[1],code:parseInt(e[2],10)}:null}static convertUnit(t,e="unit"){if(!t||t.length<3)return{type:e,name:"unknown",conversion_factor:null};const n=t[1],s=parseFloat(t[2])||null,r=t.find(l=>Array.isArray(l)&&l[0]==="ID"),o=r?{authority:r[1],code:parseInt(r[2],10)}:null;return{type:e,name:n,conversion_factor:s,id:o}}static convertAxis(t){const e=t[1]||"Unknown";let n;const s=e.match(/^\((.)\)$/);if(s){const f=s[1].toUpperCase();if(f==="E")n="east";else if(f==="N")n="north";else if(f==="U")n="up";else throw new Error(`Unknown axis abbreviation: ${f}`)}else n=t[2]?t[2].toLowerCase():"unknown";const r=t.find(f=>Array.isArray(f)&&f[0]==="ORDER"),o=r?parseInt(r[1],10):null,l=t.find(f=>Array.isArray(f)&&(f[0]==="LENGTHUNIT"||f[0]==="ANGLEUNIT"||f[0]==="SCALEUNIT")),u=this.convertUnit(l);return{name:e,direction:n,unit:u,order:o}}static extractAxes(t){return t.filter(e=>Array.isArray(e)&&e[0]==="AXIS").map(e=>this.convertAxis(e)).sort((e,n)=>(e.order||0)-(n.order||0))}static convert(t,e={}){switch(t[0]){case"PROJCRS":e.type="ProjectedCRS",e.name=t[1],e.base_crs=t.find(_=>Array.isArray(_)&&_[0]==="BASEGEOGCRS")?this.convert(t.find(_=>Array.isArray(_)&&_[0]==="BASEGEOGCRS")):null,e.conversion=t.find(_=>Array.isArray(_)&&_[0]==="CONVERSION")?this.convert(t.find(_=>Array.isArray(_)&&_[0]==="CONVERSION")):null;const n=t.find(_=>Array.isArray(_)&&_[0]==="CS");n&&(e.coordinate_system={type:n[1],axis:this.extractAxes(t)});const s=t.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT");if(s){const _=this.convertUnit(s);e.coordinate_system.unit=_}e.id=this.getId(t);break;case"BASEGEOGCRS":case"GEOGCRS":e.type="GeographicCRS",e.name=t[1];const r=t.find(_=>Array.isArray(_)&&(_[0]==="DATUM"||_[0]==="ENSEMBLE"));if(r){const _=this.convert(r);r[0]==="ENSEMBLE"?e.datum_ensemble=_:e.datum=_;const v=t.find(b=>Array.isArray(b)&&b[0]==="PRIMEM");v&&v[1]!=="Greenwich"&&(_.prime_meridian={name:v[1],longitude:parseFloat(v[2])})}e.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(t)},e.id=this.getId(t);break;case"DATUM":e.type="GeodeticReferenceFrame",e.name=t[1],e.ellipsoid=t.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID")?this.convert(t.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":e.type="DatumEnsemble",e.name=t[1],e.members=t.filter(_=>Array.isArray(_)&&_[0]==="MEMBER").map(_=>({type:"DatumEnsembleMember",name:_[1],id:this.getId(_)}));const o=t.find(_=>Array.isArray(_)&&_[0]==="ENSEMBLEACCURACY");o&&(e.accuracy=parseFloat(o[1]));const l=t.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID");l&&(e.ellipsoid=this.convert(l)),e.id=this.getId(t);break;case"ELLIPSOID":e.type="Ellipsoid",e.name=t[1],e.semi_major_axis=parseFloat(t[2]),e.inverse_flattening=parseFloat(t[3]),t.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT")&&this.convert(t.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT"),e);break;case"CONVERSION":e.type="Conversion",e.name=t[1],e.method=t.find(_=>Array.isArray(_)&&_[0]==="METHOD")?this.convert(t.find(_=>Array.isArray(_)&&_[0]==="METHOD")):null,e.parameters=t.filter(_=>Array.isArray(_)&&_[0]==="PARAMETER").map(_=>this.convert(_));break;case"METHOD":e.type="Method",e.name=t[1],e.id=this.getId(t);break;case"PARAMETER":e.type="Parameter",e.name=t[1],e.value=parseFloat(t[2]),e.unit=this.convertUnit(t.find(_=>Array.isArray(_)&&(_[0]==="LENGTHUNIT"||_[0]==="ANGLEUNIT"||_[0]==="SCALEUNIT"))),e.id=this.getId(t);break;case"BOUNDCRS":e.type="BoundCRS";const u=t.find(_=>Array.isArray(_)&&_[0]==="SOURCECRS");if(u){const _=u.find(v=>Array.isArray(v));e.source_crs=_?this.convert(_):null}const f=t.find(_=>Array.isArray(_)&&_[0]==="TARGETCRS");if(f){const _=f.find(v=>Array.isArray(v));e.target_crs=_?this.convert(_):null}const g=t.find(_=>Array.isArray(_)&&_[0]==="ABRIDGEDTRANSFORMATION");g?e.transformation=this.convert(g):e.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(e.type="Transformation",e.name=t[1],e.method=t.find(_=>Array.isArray(_)&&_[0]==="METHOD")?this.convert(t.find(_=>Array.isArray(_)&&_[0]==="METHOD")):null,e.parameters=t.filter(_=>Array.isArray(_)&&(_[0]==="PARAMETER"||_[0]==="PARAMETERFILE")).map(_=>{if(_[0]==="PARAMETER")return this.convert(_);if(_[0]==="PARAMETERFILE")return{name:_[1],value:_[2],id:{authority:"EPSG",code:8656}}}),e.parameters.length===7){const _=e.parameters[6];_.name==="Scale difference"&&(_.value=Math.round((_.value-1)*1e12)/1e6)}e.id=this.getId(t);break;case"AXIS":e.coordinate_system||(e.coordinate_system={type:"unspecified",axis:[]}),e.coordinate_system.axis.push(this.convertAxis(t));break;case"LENGTHUNIT":const p=this.convertUnit(t,"LinearUnit");e.coordinate_system&&e.coordinate_system.axis&&e.coordinate_system.axis.forEach(_=>{_.unit||(_.unit=p)}),p.conversion_factor&&p.conversion_factor!==1&&e.semi_major_axis&&(e.semi_major_axis={value:e.semi_major_axis,unit:p});break;default:e.keyword=t[0];break}return e}}class sz extends iA{static convert(t,e={}){return super.convert(t,e),e.coordinate_system&&e.coordinate_system.subtype==="Cartesian"&&delete e.coordinate_system,e.usage&&delete e.usage,e}}class rz extends iA{static convert(t,e={}){super.convert(t,e);const n=t.find(r=>Array.isArray(r)&&r[0]==="CS");n&&(e.coordinate_system={subtype:n[1],axis:this.extractAxes(t)});const s=t.find(r=>Array.isArray(r)&&r[0]==="USAGE");if(s){const r=s.find(u=>Array.isArray(u)&&u[0]==="SCOPE"),o=s.find(u=>Array.isArray(u)&&u[0]==="AREA"),l=s.find(u=>Array.isArray(u)&&u[0]==="BBOX");e.usage={},r&&(e.usage.scope=r[1]),o&&(e.usage.area=o[1]),l&&(e.usage.bbox=l.slice(1))}return e}}function az(i){return i.find(t=>Array.isArray(t)&&t[0]==="USAGE")?"2019":(i.find(t=>Array.isArray(t)&&t[0]==="CS")||i[0]==="BOUNDCRS"||i[0]==="PROJCRS"||i[0]==="GEOGCRS","2015")}function oz(i){return(az(i)==="2019"?rz:sz).convert(i)}function lz(i){const t=i.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}var uc=1,nA=2,sA=3,xf=4,rA=5,km=-1,cz=/\s/,uz=/[A-Za-z]/,hz=/[A-Za-z84_]/,Vf=/[,\]]/,aA=/[\d\.E\-\+]/;function as(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=uc}as.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==xf)for(;cz.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case uc:return this.neutral(i);case nA:return this.keyword(i);case xf:return this.quoted(i);case rA:return this.afterquote(i);case sA:return this.number(i);case km:return}};as.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=xf;return}if(Vf.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};as.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=uc;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=uc,this.currentObject=this.stack.pop(),this.currentObject||(this.state=km);return}};as.prototype.number=function(i){if(aA.test(i)){this.word+=i;return}if(Vf.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};as.prototype.quoted=function(i){if(i==='"'){this.state=rA;return}this.word+=i};as.prototype.keyword=function(i){if(hz.test(i)){this.word+=i;return}if(i==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=uc;return}if(Vf.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};as.prototype.neutral=function(i){if(uz.test(i)){this.word=i,this.state=nA;return}if(i==='"'){this.word="",this.state=xf;return}if(aA.test(i)){this.word=i,this.state=sA;return}if(Vf.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};as.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===km)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function fz(i){var t=new as(i);return t.output()}function u0(i,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:i,s=e.reduce(function(r,o){return Wa(o,r),r},n);t&&(i[t]=s)}function Wa(i,t){if(!Array.isArray(i)){t[i]=!0;return}var e=i.shift();if(e==="PARAMETER"&&(e=i.shift()),i.length===1){if(Array.isArray(i[0])){t[e]={},Wa(i[0],t[e]);return}t[e]=i[0];return}if(!i.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=i;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(i);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&Wa(i[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:i[0],a:i[1],rf:i[2]},i.length===4&&Wa(i[3],t[e]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":i[0]=["name",i[0]],u0(t,e,i);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":i[0]=["name",i[0]],u0(t,e,i),t[e].type=e;return;default:for(n=-1;++n<i.length;)if(!Array.isArray(i[n]))return Wa(i,t[e]);return u0(t,e,i)}}var dz=.017453292519943295;function Qi(i){return i*dz}function oA(i){const t=(i.projName||"").toLowerCase().replace(/_/g," ");!i.long0&&i.longc&&(t==="albers conic equal area"||t==="lambert azimuthal equal area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(t==="stereographic south pole"||t==="polar stereographic (variant b)")?(i.lat0=Qi(i.lat1>0?90:-90),i.lat_ts=i.lat1,delete i.lat1):!i.lat_ts&&i.lat0&&(t==="polar stereographic"||t==="polar stereographic (variant a)")&&(i.lat_ts=i.lat0,i.lat0=Qi(i.lat0>0?90:-90),delete i.lat1)}function bS(i){let t={units:null,to_meter:void 0};return typeof i=="string"?(t.units=i.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.units==="meter"&&(t.to_meter=1)):i&&i.name&&(t.units=i.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.to_meter=i.conversion_factor),t}function xS(i){return typeof i=="object"?i.value*i.unit.conversion_factor:i}function SS(i,t){i.ellipsoid.radius?(t.a=i.ellipsoid.radius,t.rf=0):(t.a=xS(i.ellipsoid.semi_major_axis),i.ellipsoid.inverse_flattening!==void 0?t.rf=i.ellipsoid.inverse_flattening:i.ellipsoid.semi_major_axis!==void 0&&i.ellipsoid.semi_minor_axis!==void 0&&(t.rf=t.a/(t.a-xS(i.ellipsoid.semi_minor_axis))))}function Sf(i,t={}){return!i||typeof i!="object"?i:i.type==="BoundCRS"?(Sf(i.source_crs,t),i.transformation&&(i.transformation.method&&i.transformation.method.name==="NTv2"?t.nadgrids=i.transformation.parameters[0].value:t.datum_params=i.transformation.parameters.map(e=>e.value)),t):(Object.keys(i).forEach(e=>{const n=i[e];if(n!==null)switch(e){case"name":if(t.srsCode)break;t.name=n,t.srsCode=n;break;case"type":n==="GeographicCRS"?t.projName="longlat":n==="ProjectedCRS"&&i.conversion&&i.conversion.method&&(t.projName=i.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(t.ellps=n.ellipsoid.name,SS(n,t)),n.prime_meridian&&(t.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=n.name,SS(n,t);break;case"prime_meridian":t.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis){if(t.axis=n.axis.map(s=>{const r=s.direction;if(r==="east")return"e";if(r==="north")return"n";if(r==="west")return"w";if(r==="south")return"s";throw new Error(`Unknown axis direction: ${r}`)}).join("")+"u",n.unit){const{units:s,to_meter:r}=bS(n.unit);t.units=s,t.to_meter=r}else if(n.axis[0]&&n.axis[0].unit){const{units:s,to_meter:r}=bS(n.axis[0].unit);t.units=s,t.to_meter=r}}break;case"id":n.authority&&n.code&&(t.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(t.projName=n.method.name),n.parameters&&n.parameters.forEach(s=>{const r=s.name.toLowerCase().replace(/\s+/g,"_"),o=s.value;s.unit&&s.unit.conversion_factor?t[r]=o*s.unit.conversion_factor:s.unit==="degree"?t[r]=o*Math.PI/180:t[r]=o});break;case"unit":n.name&&(t.units=n.name.toLowerCase(),t.units==="metre"&&(t.units="meter")),n.conversion_factor&&(t.to_meter=n.conversion_factor);break;case"base_crs":Sf(n,t),t.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name;break}}),t.latitude_of_false_origin!==void 0&&(t.lat0=t.latitude_of_false_origin),t.longitude_of_false_origin!==void 0&&(t.long0=t.longitude_of_false_origin),t.latitude_of_standard_parallel!==void 0&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),t.latitude_of_1st_standard_parallel!==void 0&&(t.lat1=t.latitude_of_1st_standard_parallel),t.latitude_of_2nd_standard_parallel!==void 0&&(t.lat2=t.latitude_of_2nd_standard_parallel),t.latitude_of_projection_centre!==void 0&&(t.lat0=t.latitude_of_projection_centre),t.longitude_of_projection_centre!==void 0&&(t.longc=t.longitude_of_projection_centre),t.easting_at_false_origin!==void 0&&(t.x0=t.easting_at_false_origin),t.northing_at_false_origin!==void 0&&(t.y0=t.northing_at_false_origin),t.latitude_of_natural_origin!==void 0&&(t.lat0=t.latitude_of_natural_origin),t.longitude_of_natural_origin!==void 0&&(t.long0=t.longitude_of_natural_origin),t.longitude_of_origin!==void 0&&(t.long0=t.longitude_of_origin),t.false_easting!==void 0&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),t.false_northing!==void 0&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),t.standard_parallel_1!==void 0&&(t.lat1=t.standard_parallel_1),t.standard_parallel_2!==void 0&&(t.lat2=t.standard_parallel_2),t.scale_factor_at_natural_origin!==void 0&&(t.k0=t.scale_factor_at_natural_origin),t.scale_factor_at_projection_centre!==void 0&&(t.k0=t.scale_factor_at_projection_centre),t.scale_factor_on_pseudo_standard_parallel!==void 0&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),t.azimuth!==void 0&&(t.alpha=t.azimuth),t.azimuth_at_projection_centre!==void 0&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),oA(t),t)}var gz=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function pz(i,t){var e=t[0],n=t[1];!(e in i)&&n in i&&(i[e]=i[n],t.length===3&&(i[e]=t[2](i[e])))}function lA(i){for(var t=Object.keys(i),e=0,n=t.length;e<n;++e){var s=t[e];gz.indexOf(s)!==-1&&_z(i[s]),typeof i[s]=="object"&&lA(i[s])}}function _z(i){if(i.AUTHORITY){var t=Object.keys(i.AUTHORITY)[0];t&&t in i.AUTHORITY&&(i.title=t+":"+i.AUTHORITY[t])}if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var e="",n=0,s=i.AXIS.length;n<s;++n){var r=[i.AXIS[n][0].toLowerCase(),i.AXIS[n][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?e+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?e+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?e+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(i.axis=e)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var o=i.GEOGCS;i.type==="GEOGCS"&&(o=i),o&&(o.DATUM?i.datumCode=o.DATUM.name.toLowerCase():i.datumCode=o.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),i.datumCode==="new_zealand_1949"&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode==="belge_1972"&&(i.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(i.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=o.DATUM.SPHEROID.a,i.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(i.datum_params=o.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a),i.rectified_grid_angle&&(i.rectified_grid_angle=Qi(i.rectified_grid_angle));function l(g){var p=i.to_meter||1;return g*p}var u=function(g){return pz(i,g)},f=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qi],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qi],["x0","false_easting",l],["y0","false_northing",l],["long0","central_meridian",Qi],["lat0","latitude_of_origin",Qi],["lat0","standard_parallel_1",Qi],["lat1","standard_parallel_1",Qi],["lat2","standard_parallel_2",Qi],["azimuth","Azimuth"],["alpha","azimuth",Qi],["srsCode","name"]];f.forEach(u),oA(i)}function Tf(i){if(typeof i=="object")return Sf(i);const t=lz(i);var e=fz(i);if(t==="WKT2"){const r=oz(e);return Sf(r)}var n=e[0],s={};return Wa(e,s),lA(s),s[n]}function je(i){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?je[i]=l_(arguments[1]):je[i]=Tf(arguments[1]):e&&typeof e=="object"&&!("projName"in e)?je[i]=Tf(arguments[1]):(je[i]=e,e||delete je[i])}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(n){return Array.isArray(n)?je.apply(t,n):je(n)});if(typeof i=="string"){if(i in je)return je[i]}else"EPSG"in i?je["EPSG:"+i.EPSG]=i:"ESRI"in i?je["ESRI:"+i.ESRI]=i:"IAU2000"in i?je["IAU2000:"+i.IAU2000]=i:console.log(i);return}}Z9(je);function mz(i){return typeof i=="string"}function yz(i){return i in je}function vz(i){return i.indexOf("+")!==0&&i.indexOf("[")!==-1||typeof i=="object"&&!("srsCode"in i)}var bz=["3857","900913","3785","102113"];function xz(i){var t=Xs(i,"authority");if(t){var e=Xs(t,"epsg");return e&&bz.indexOf(e)>-1}}function Sz(i){var t=Xs(i,"extension");if(t)return Xs(t,"proj4")}function Tz(i){return i[0]==="+"}function wz(i){if(mz(i)){if(yz(i))return je[i];if(vz(i)){var t=Tf(i);if(xz(t))return je["EPSG:3857"];var e=Sz(t);return e?l_(e):t}if(Tz(i))return l_(i)}else return"projName"in i?i:Tf(i)}function TS(i,t){i=i||{};var e,n;if(!t)return i;for(n in t)e=t[n],e!==void 0&&(i[n]=e);return i}function An(i,t,e){var n=i*t;return e/Math.sqrt(1-n*n)}function Tc(i){return i<0?-1:1}function gt(i,t){return t||Math.abs(i)<=xe?i:i-Tc(i)*cc}function en(i,t,e){var n=i*e,s=.5*i;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(lt-t))/n}function hc(i,t){for(var e=.5*i,n,s,r=lt-2*Math.atan(t),o=0;o<=15;o++)if(n=i*Math.sin(r),s=lt-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function Ez(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=An(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Az(i){var t=i.x,e=i.y;if(e*fi>90&&e*fi<-90&&t*fi>180&&t*fi<-180)return null;var n,s;if(Math.abs(Math.abs(e)-lt)<=ft)return null;if(this.sphere)n=this.x0+this.a*this.k0*gt(t-this.long0,this.over),s=this.y0+this.a*this.k0*Math.log(Math.tan(Kt+.5*e));else{var r=Math.sin(e),o=en(this.e,e,r);n=this.x0+this.a*this.k0*gt(t-this.long0,this.over),s=this.y0-this.a*this.k0*Math.log(o)}return i.x=n,i.y=s,i}function Mz(i){var t=i.x-this.x0,e=i.y-this.y0,n,s;if(this.sphere)s=lt-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var r=Math.exp(-e/(this.a*this.k0));if(s=hc(this.e,r),s===-9999)return null}return n=gt(this.long0+t/(this.a*this.k0),this.over),i.x=n,i.y=s,i}var Cz=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const Rz={init:Ez,forward:Az,inverse:Mz,names:Cz};function Pz(){}function wS(i){return i}var cA=["longlat","identity"];const Iz={init:Pz,forward:wS,inverse:wS,names:cA};var Oz=[Rz,Iz],xr={},qa=[];function uA(i,t){var e=qa.length;return i.names?(qa[e]=i,i.names.forEach(function(n){xr[n.toLowerCase()]=e}),this):(console.log(t),!0)}function hA(i){return i.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function Nz(i){if(!i)return!1;var t=i.toLowerCase();if(typeof xr[t]<"u"&&qa[xr[t]]||(t=hA(t),t in xr&&qa[xr[t]]))return qa[xr[t]]}function Dz(){Oz.forEach(uA)}const Lz={start:Dz,add:uA,get:Nz};var fA={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const kz=fA.WGS84;function Bz(i,t,e,n){var s=i*i,r=t*t,o=(s-r)/s,l=0;n?(i*=1-o*(tz+o*(ez+o*iz)),s=i*i,o=0):l=Math.sqrt(o);var u=(s-r)/r;return{es:o,e:l,ep2:u}}function Uz(i,t,e,n,s){if(!i){var r=Xs(fA,n);r||(r=kz),i=r.a,t=r.b,e=r.rf}return e&&!t&&(t=(1-1/e)*i),(e===0||Math.abs(i-t)<ft)&&(s=!0,t=i),{a:i,b:t,rf:e,sphere:s}}var qh={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var Fz in qh){var h0=qh[Fz];h0.datumName&&(qh[h0.datumName]=h0)}function zz(i,t,e,n,s,r,o){var l={};return i===void 0||i==="none"?l.datum_type=o_:l.datum_type=Q9,t&&(l.datum_params=t.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=Ur),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=Fr,l.datum_params[3]*=ql,l.datum_params[4]*=ql,l.datum_params[5]*=ql,l.datum_params[6]=l.datum_params[6]/1e6+1)),o&&(l.datum_type=to,l.grids=o),l.a=e,l.b=n,l.es=s,l.ep2=r,l}var Bm={};function Vz(i,t,e){return t instanceof ArrayBuffer?jz(i,t,e):{ready:Hz(i,t)}}function jz(i,t,e){var n=!0;e!==void 0&&e.includeErrorFields===!1&&(n=!1);var s=new DataView(t),r=Wz(s),o=qz(s,r),l=Xz(s,o,r,n),u={header:o,subgrids:l};return Bm[i]=u,u}async function Hz(i,t){for(var e=[],n=await t.getImageCount(),s=n-1;s>=0;s--){var r=await t.getImage(s),o=await r.readRasters(),l=o,u=[r.getWidth(),r.getHeight()],f=r.getBoundingBox().map(ES),g=[r.fileDirectory.ModelPixelScale[0],r.fileDirectory.ModelPixelScale[1]].map(ES),p=f[0]+(u[0]-1)*g[0],_=f[3]-(u[1]-1)*g[1],v=l[0],b=l[1],x=[];for(let M=u[1]-1;M>=0;M--)for(let E=u[0]-1;E>=0;E--){var T=M*u[0]+E;x.push([-Hs(b[T]),Hs(v[T])])}e.push({del:g,lim:u,ll:[-p,_],cvs:x})}var w={header:{nSubgrids:n},subgrids:e};return Bm[i]=w,w}function $z(i){if(i===void 0)return null;var t=i.split(",");return t.map(Gz)}function Gz(i){if(i.length===0)return null;var t=i[0]==="@";return t&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:i,mandatory:!t,grid:Bm[i]||null,isNull:!1}}function ES(i){return i*Math.PI/180}function Hs(i){return i/3600*Math.PI/180}function Wz(i){var t=i.getInt32(8,!1);return t===11?!1:(t=i.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function qz(i,t){return{nFields:i.getInt32(8,t),nSubgridFields:i.getInt32(24,t),nSubgrids:i.getInt32(40,t),shiftType:c_(i,56,64).trim(),fromSemiMajorAxis:i.getFloat64(120,t),fromSemiMinorAxis:i.getFloat64(136,t),toSemiMajorAxis:i.getFloat64(152,t),toSemiMinorAxis:i.getFloat64(168,t)}}function c_(i,t,e){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(t,e)))}function Xz(i,t,e,n){for(var s=176,r=[],o=0;o<t.nSubgrids;o++){var l=Kz(i,s,e),u=Zz(i,s,l,e,n),f=Math.round(1+(l.upperLongitude-l.lowerLongitude)/l.longitudeInterval),g=Math.round(1+(l.upperLatitude-l.lowerLatitude)/l.latitudeInterval);r.push({ll:[Hs(l.lowerLongitude),Hs(l.lowerLatitude)],del:[Hs(l.longitudeInterval),Hs(l.latitudeInterval)],lim:[f,g],count:l.gridNodeCount,cvs:Yz(u)});var p=16;n===!1&&(p=8),s+=176+l.gridNodeCount*p}return r}function Yz(i){return i.map(function(t){return[Hs(t.longitudeShift),Hs(t.latitudeShift)]})}function Kz(i,t,e){return{name:c_(i,t+8,t+16).trim(),parent:c_(i,t+24,t+24+8).trim(),lowerLatitude:i.getFloat64(t+72,e),upperLatitude:i.getFloat64(t+88,e),lowerLongitude:i.getFloat64(t+104,e),upperLongitude:i.getFloat64(t+120,e),latitudeInterval:i.getFloat64(t+136,e),longitudeInterval:i.getFloat64(t+152,e),gridNodeCount:i.getInt32(t+168,e)}}function Zz(i,t,e,n,s){var r=t+176,o=16;s===!1&&(o=8);for(var l=[],u=0;u<e.gridNodeCount;u++){var f={latitudeShift:i.getFloat32(r+u*o,n),longitudeShift:i.getFloat32(r+u*o+4,n)};s!==!1&&(f.latitudeAccuracy=i.getFloat32(r+u*o+8,n),f.longitudeAccuracy=i.getFloat32(r+u*o+12,n)),l.push(f)}return l}function Gi(i,t){if(!(this instanceof Gi))return new Gi(i);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,t=t||function(f){if(f)throw f};var e=wz(i);if(typeof e!="object"){t("Could not parse to valid json: "+i);return}var n=Gi.projections.get(e.projName);if(!n){t("Could not get projection name from: "+i);return}if(e.datumCode&&e.datumCode!=="none"){var s=Xs(qh,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var r=Uz(e.a,e.b,e.rf,e.ellps,e.sphere),o=Bz(r.a,r.b,r.rf,e.R_A),l=$z(e.nadgrids),u=e.datum||zz(e.datumCode,e.datum_params,r.a,r.b,o.es,o.ep2,l);TS(this,e),TS(this,n),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=u,"init"in this&&typeof this.init=="function"&&this.init(),t(null,this)}Gi.projections=Lz;Gi.projections.start();function Qz(i,t){return i.datum_type!==t.datum_type||i.a!==t.a||Math.abs(i.es-t.es)>5e-11?!1:i.datum_type===Ur?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]:i.datum_type===Fr?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]&&i.datum_params[3]===t.datum_params[3]&&i.datum_params[4]===t.datum_params[4]&&i.datum_params[5]===t.datum_params[5]&&i.datum_params[6]===t.datum_params[6]:!0}function dA(i,t,e){var n=i.x,s=i.y,r=i.z?i.z:0,o,l,u,f;if(s<-lt&&s>-1.001*lt)s=-lt;else if(s>lt&&s<1.001*lt)s=lt;else{if(s<-lt)return{x:-1/0,y:-1/0,z:i.z};if(s>lt)return{x:1/0,y:1/0,z:i.z}}return n>Math.PI&&(n-=2*Math.PI),l=Math.sin(s),f=Math.cos(s),u=l*l,o=e/Math.sqrt(1-t*u),{x:(o+r)*f*Math.cos(n),y:(o+r)*f*Math.sin(n),z:(o*(1-t)+r)*l}}function gA(i,t,e,n){var s=1e-12,r=s*s,o=30,l,u,f,g,p,_,v,b,x,T,w,M,E,P=i.x,k=i.y,U=i.z?i.z:0,Y,et,K;if(l=Math.sqrt(P*P+k*k),u=Math.sqrt(P*P+k*k+U*U),l/e<s){if(Y=0,u/e<s)return et=lt,K=-n,{x:i.x,y:i.y,z:i.z}}else Y=Math.atan2(k,P);f=U/u,g=l/u,p=1/Math.sqrt(1-t*(2-t)*g*g),b=g*(1-t)*p,x=f*p,E=0;do E++,v=e/Math.sqrt(1-t*x*x),K=l*b+U*x-v*(1-t*x*x),_=t*v/(v+K),p=1/Math.sqrt(1-_*(2-_)*g*g),T=g*(1-_)*p,w=f*p,M=w*b-T*x,b=T,x=w;while(M*M>r&&E<o);return et=Math.atan(w/Math.abs(T)),{x:Y,y:et,z:K}}function Jz(i,t,e){if(t===Ur)return{x:i.x+e[0],y:i.y+e[1],z:i.z+e[2]};if(t===Fr){var n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],u=e[5],f=e[6];return{x:f*(i.x-u*i.y+l*i.z)+n,y:f*(u*i.x+i.y-o*i.z)+s,z:f*(-l*i.x+o*i.y+i.z)+r}}}function tV(i,t,e){if(t===Ur)return{x:i.x-e[0],y:i.y-e[1],z:i.z-e[2]};if(t===Fr){var n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],u=e[5],f=e[6],g=(i.x-n)/f,p=(i.y-s)/f,_=(i.z-r)/f;return{x:g+u*p-l*_,y:-u*g+p+o*_,z:l*g-o*p+_}}}function xh(i){return i===Ur||i===Fr}function eV(i,t,e){if(Qz(i,t)||i.datum_type===o_||t.datum_type===o_)return e;var n=i.a,s=i.es;if(i.datum_type===to){var r=AS(i,!1,e);if(r!==0)return;n=mS,s=yS}var o=t.a,l=t.b,u=t.es;if(t.datum_type===to&&(o=mS,l=J9,u=yS),s===u&&n===o&&!xh(i.datum_type)&&!xh(t.datum_type))return e;if(e=dA(e,s,n),xh(i.datum_type)&&(e=Jz(e,i.datum_type,i.datum_params)),xh(t.datum_type)&&(e=tV(e,t.datum_type,t.datum_params)),e=gA(e,u,o,l),t.datum_type===to){var f=AS(t,!0,e);if(f!==0)return}return e}function AS(i,t,e){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},r=[];t:for(var o=0;o<i.grids.length;o++){var l=i.grids[o];if(r.push(l.name),l.isNull){s=n;break}if(l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var u=l.grid.subgrids,f=0,g=u.length;f<g;f++){var p=u[f],_=(Math.abs(p.del[1])+Math.abs(p.del[0]))/1e4,v=p.ll[0]-_,b=p.ll[1]-_,x=p.ll[0]+(p.lim[0]-1)*p.del[0]+_,T=p.ll[1]+(p.lim[1]-1)*p.del[1]+_;if(!(b>n.y||v>n.x||T<n.y||x<n.x)&&(s=iV(n,t,p),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*fi+" "+n.y*fi+" tried: '"+r+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function iV(i,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return n;var s={x:i.x,y:i.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=gt(s.x-Math.PI)+Math.PI;var r=MS(s,e);if(t){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var o=9,l=1e-12,u,f;do{if(f=MS(r,e),isNaN(f.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}u={x:s.x-(f.x+r.x),y:s.y-(f.y+r.y)},r.x+=u.x,r.y+=u.y}while(o--&&Math.abs(u.x)>l&&Math.abs(u.y)>l);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=gt(r.x+e.ll[0]),n.y=r.y+e.ll[1]}else isNaN(r.x)||(n.x=i.x+r.x,n.y=i.y+r.y);return n}function MS(i,t){var e={x:i.x/t.del[0],y:i.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*n.x,y:e.y-1*n.y},r={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return r;o=n.y*t.lim[0]+n.x;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var u={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var f={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var g={x:t.cvs[o][0],y:t.cvs[o][1]},p=s.x*s.y,_=s.x*(1-s.y),v=(1-s.x)*(1-s.y),b=(1-s.x)*s.y;return r.x=v*l.x+_*u.x+b*g.x+p*f.x,r.y=v*l.y+_*u.y+b*g.y+p*f.y,r}function CS(i,t,e){var n=e.x,s=e.y,r=e.z||0,o,l,u,f={};for(u=0;u<3;u++)if(!(t&&u===2&&e.z===void 0))switch(u===0?(o=n,"ew".indexOf(i.axis[u])!==-1?l="x":l="y"):u===1?(o=s,"ns".indexOf(i.axis[u])!==-1?l="y":l="x"):(o=r,l="z"),i.axis[u]){case"e":f[l]=o;break;case"w":f[l]=-o;break;case"n":f[l]=o;break;case"s":f[l]=-o;break;case"u":e[l]!==void 0&&(f.z=o);break;case"d":e[l]!==void 0&&(f.z=-o);break;default:return null}return f}function pA(i){var t={x:i[0],y:i[1]};return i.length>2&&(t.z=i[2]),i.length>3&&(t.m=i[3]),t}function nV(i){RS(i.x),RS(i.y)}function RS(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function sV(i,t){return(i.datum.datum_type===Ur||i.datum.datum_type===Fr||i.datum.datum_type===to)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Ur||t.datum.datum_type===Fr||t.datum.datum_type===to)&&i.datumCode!=="WGS84"}function wf(i,t,e,n){var s;Array.isArray(e)?e=pA(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var r=e.z!==void 0;if(nV(e),i.datum&&t.datum&&sV(i,t)&&(s=new Gi("WGS84"),e=wf(i,s,e,n),i=s),n&&i.axis!=="enu"&&(e=CS(i,!1,e)),i.projName==="longlat")e={x:e.x*_e,y:e.y*_e,z:e.z||0};else if(i.to_meter&&(e={x:e.x*i.to_meter,y:e.y*i.to_meter,z:e.z||0}),e=i.inverse(e),!e)return;if(i.from_greenwich&&(e.x+=i.from_greenwich),e=eV(i.datum,t.datum,e),!!e)return e=e,t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*fi,y:e.y*fi,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?CS(t,!0,e):(e&&!r&&delete e.z,e)}var PS=Gi("WGS84");function f0(i,t,e,n){var s,r,o;return Array.isArray(e)?(s=wf(i,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.slice(3)):[s.x,s.y,e[2]].concat(e.slice(3)):[s.x,s.y].concat(e.slice(2)):[s.x,s.y]):(r=wf(i,t,e,n),o=Object.keys(e),o.length===2||o.forEach(function(l){if(typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;r[l]=e[l]}),r)}function Sh(i){return i instanceof Gi?i:typeof i=="object"&&"oProj"in i?i.oProj:Gi(i)}function rV(i,t,e){var n,s,r=!1,o;return typeof t>"u"?(s=Sh(i),n=PS,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,s=Sh(i),n=PS,r=!0),n||(n=Sh(i)),s||(s=Sh(t)),e?f0(n,s,e):(o={forward:function(l,u){return f0(n,s,l,u)},inverse:function(l,u){return f0(s,n,l,u)}},r&&(o.oProj=s),o)}var IS=6,_A="AJSAJS",mA="AFAFAF",Xa=65,ui=73,zi=79,Il=86,Ol=90;const aV={forward:yA,inverse:oV,toPoint:vA};function yA(i,t){return t=t||5,uV(lV({lat:i[1],lon:i[0]}),t)}function oV(i){var t=Um(xA(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function vA(i){var t=Um(xA(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function d0(i){return i*(Math.PI/180)}function OS(i){return 180*(i/Math.PI)}function lV(i){var t=i.lat,e=i.lon,n=6378137,s=.00669438,r=.9996,o,l,u,f,g,p,_,v=d0(t),b=d0(e),x,T;T=Math.floor((e+180)/6)+1,e===180&&(T=60),t>=56&&t<64&&e>=3&&e<12&&(T=32),t>=72&&t<84&&(e>=0&&e<9?T=31:e>=9&&e<21?T=33:e>=21&&e<33?T=35:e>=33&&e<42&&(T=37)),o=(T-1)*6-180+3,x=d0(o),l=s/(1-s),u=n/Math.sqrt(1-s*Math.sin(v)*Math.sin(v)),f=Math.tan(v)*Math.tan(v),g=l*Math.cos(v)*Math.cos(v),p=Math.cos(v)*(b-x),_=n*((1-s/4-3*s*s/64-5*s*s*s/256)*v-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*v)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*v)-35*s*s*s/3072*Math.sin(6*v));var w=r*u*(p+(1-f+g)*p*p*p/6+(5-18*f+f*f+72*g-58*l)*p*p*p*p*p/120)+5e5,M=r*(_+u*Math.tan(v)*(p*p/2+(5-f+9*g+4*g*g)*p*p*p*p/24+(61-58*f+f*f+600*g-330*l)*p*p*p*p*p*p/720));return t<0&&(M+=1e7),{northing:Math.round(M),easting:Math.round(w),zoneNumber:T,zoneLetter:cV(t)}}function Um(i){var t=i.northing,e=i.easting,n=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var r=.9996,o=6378137,l=.00669438,u,f=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),g,p,_,v,b,x,T,w,M,E=e-5e5,P=t;n<"N"&&(P-=1e7),T=(s-1)*6-180+3,u=l/(1-l),x=P/r,w=x/(o*(1-l/4-3*l*l/64-5*l*l*l/256)),M=w+(3*f/2-27*f*f*f/32)*Math.sin(2*w)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*w)+151*f*f*f/96*Math.sin(6*w),g=o/Math.sqrt(1-l*Math.sin(M)*Math.sin(M)),p=Math.tan(M)*Math.tan(M),_=u*Math.cos(M)*Math.cos(M),v=o*(1-l)/Math.pow(1-l*Math.sin(M)*Math.sin(M),1.5),b=E/(g*r);var k=M-g*Math.tan(M)/v*(b*b/2-(5+3*p+10*_-4*_*_-9*u)*b*b*b*b/24+(61+90*p+298*_+45*p*p-252*u-3*_*_)*b*b*b*b*b*b/720);k=OS(k);var U=(b-(1+2*p+_)*b*b*b/6+(5-2*_+28*p-3*_*_+8*u+24*p*p)*b*b*b*b*b/120)/Math.cos(M);U=T+OS(U);var Y;if(i.accuracy){var et=Um({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});Y={top:et.lat,right:et.lon,bottom:k,left:U}}else Y={lat:k,lon:U};return Y}function cV(i){var t="Z";return 84>=i&&i>=72?t="X":72>i&&i>=64?t="W":64>i&&i>=56?t="V":56>i&&i>=48?t="U":48>i&&i>=40?t="T":40>i&&i>=32?t="S":32>i&&i>=24?t="R":24>i&&i>=16?t="Q":16>i&&i>=8?t="P":8>i&&i>=0?t="N":0>i&&i>=-8?t="M":-8>i&&i>=-16?t="L":-16>i&&i>=-24?t="K":-24>i&&i>=-32?t="J":-32>i&&i>=-40?t="H":-40>i&&i>=-48?t="G":-48>i&&i>=-56?t="F":-56>i&&i>=-64?t="E":-64>i&&i>=-72?t="D":-72>i&&i>=-80&&(t="C"),t}function uV(i,t){var e="00000"+i.easting,n="00000"+i.northing;return i.zoneNumber+i.zoneLetter+hV(i.easting,i.northing,i.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function hV(i,t,e){var n=bA(e),s=Math.floor(i/1e5),r=Math.floor(t/1e5)%20;return fV(s,r,n)}function bA(i){var t=i%IS;return t===0&&(t=IS),t}function fV(i,t,e){var n=e-1,s=_A.charCodeAt(n),r=mA.charCodeAt(n),o=s+i-1,l=r+t,u=!1;o>Ol&&(o=o-Ol+Xa-1,u=!0),(o===ui||s<ui&&o>ui||(o>ui||s<ui)&&u)&&o++,(o===zi||s<zi&&o>zi||(o>zi||s<zi)&&u)&&(o++,o===ui&&o++),o>Ol&&(o=o-Ol+Xa-1),l>Il?(l=l-Il+Xa-1,u=!0):u=!1,(l===ui||r<ui&&l>ui||(l>ui||r<ui)&&u)&&l++,(l===zi||r<zi&&l>zi||(l>zi||r<zi)&&u)&&(l++,l===ui&&l++),l>Il&&(l=l-Il+Xa-1);var f=String.fromCharCode(o)+String.fromCharCode(l);return f}function xA(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var t=i.length,e=null,n="",s,r=0;!/[A-Z]/.test(s=i.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+i;n+=s,r++}var o=parseInt(n,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+i;var l=i.charAt(r++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+i;e=i.substring(r,r+=2);for(var u=bA(o),f=dV(e.charAt(0),u),g=gV(e.charAt(1),u);g<pV(l);)g+=2e6;var p=t-r;if(p%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var _=p/2,v=0,b=0,x,T,w,M,E;return _>0&&(x=1e5/Math.pow(10,_),T=i.substring(r,r+_),v=parseFloat(T)*x,w=i.substring(r+_),b=parseFloat(w)*x),M=v+f,E=b+g,{easting:M,northing:E,zoneLetter:l,zoneNumber:o,accuracy:x}}function dV(i,t){for(var e=_A.charCodeAt(t-1),n=1e5,s=!1;e!==i.charCodeAt(0);){if(e++,e===ui&&e++,e===zi&&e++,e>Ol){if(s)throw"Bad character: "+i;e=Xa,s=!0}n+=1e5}return n}function gV(i,t){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var e=mA.charCodeAt(t-1),n=0,s=!1;e!==i.charCodeAt(0);){if(e++,e===ui&&e++,e===zi&&e++,e>Il){if(s)throw"Bad character: "+i;e=Xa,s=!0}n+=1e5}return n}function pV(i){var t;switch(i){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+i}function co(i,t,e){if(!(this instanceof co))return new co(i,t,e);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof t>"u"){var n=i.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=i,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}co.fromMGRS=function(i){return new co(vA(i))};co.prototype.toMGRS=function(i){return yA([this.x,this.y],i)};var _V=1,mV=.25,NS=.046875,DS=.01953125,LS=.01068115234375,yV=.75,vV=.46875,bV=.013020833333333334,xV=.007120768229166667,SV=.3645833333333333,TV=.005696614583333333,wV=.3076171875;function Fm(i){var t=[];t[0]=_V-i*(mV+i*(NS+i*(DS+i*LS))),t[1]=i*(yV-i*(NS+i*(DS+i*LS)));var e=i*i;return t[2]=e*(vV-i*(bV+i*xV)),e*=i,t[3]=e*(SV-i*TV),t[4]=e*i*wV,t}function yo(i,t,e,n){return e*=t,t*=t,n[0]*i-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var EV=20;function zm(i,t,e){for(var n=1/(1-t),s=i,r=EV;r;--r){var o=Math.sin(s),l=1-t*o*o;if(l=(yo(s,o,Math.cos(s),e)-i)*(l*Math.sqrt(l))*n,s-=l,Math.abs(l)<ft)return s}return s}function AV(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Fm(this.es),this.ml0=yo(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function MV(i){var t=i.x,e=i.y,n=gt(t-this.long0,this.over),s,r,o,l=Math.sin(e),u=Math.cos(e);if(this.es){var g=u*n,p=Math.pow(g,2),_=this.ep2*Math.pow(u,2),v=Math.pow(_,2),b=Math.abs(u)>ft?Math.tan(e):0,x=Math.pow(b,2),T=Math.pow(x,2);s=1-this.es*Math.pow(l,2),g=g/Math.sqrt(s);var w=yo(e,l,u,this.en);r=this.a*(this.k0*g*(1+p/6*(1-x+_+p/20*(5-18*x+T+14*_-58*x*_+p/42*(61+179*T-T*x-479*x)))))+this.x0,o=this.a*(this.k0*(w-this.ml0+l*n*g/2*(1+p/12*(5-x+9*_+4*v+p/30*(61+T-58*x+270*_-330*x*_+p/56*(1385+543*T-T*x-3111*x))))))+this.y0}else{var f=u*Math.sin(n);if(Math.abs(Math.abs(f)-1)<ft)return 93;if(r=.5*this.a*this.k0*Math.log((1+f)/(1-f))+this.x0,o=u*Math.cos(n)/Math.sqrt(1-Math.pow(f,2)),f=Math.abs(o),f>=1){if(f-1>ft)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return i.x=r,i.y=o,i}function CV(i){var t,e,n,s,r=(i.x-this.x0)*(1/this.a),o=(i.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=zm(t,this.es,this.en),Math.abs(e)<lt){var p=Math.sin(e),_=Math.cos(e),v=Math.abs(_)>ft?Math.tan(e):0,b=this.ep2*Math.pow(_,2),x=Math.pow(b,2),T=Math.pow(v,2),w=Math.pow(T,2);t=1-this.es*Math.pow(p,2);var M=r*Math.sqrt(t)/this.k0,E=Math.pow(M,2);t=t*v,n=e-t*E/(1-this.es)*.5*(1-E/12*(5+3*T-9*b*T+b-4*x-E/30*(61+90*T-252*b*T+45*w+46*b-E/56*(1385+3633*T+4095*w+1574*w*T)))),s=gt(this.long0+M*(1-E/6*(1+2*T+b-E/20*(5+28*T+24*w+8*b*T+6*b-E/42*(61+662*T+1320*w+720*w*T))))/_,this.over)}else n=lt*Tc(o),s=0;else{var l=Math.exp(r/this.k0),u=.5*(l-1/l),f=this.lat0+o/this.k0,g=Math.cos(f);t=Math.sqrt((1-Math.pow(g,2))/(1+Math.pow(u,2))),n=Math.asin(t),o<0&&(n=-n),u===0&&g===0?s=0:s=gt(Math.atan2(u,g)+this.long0,this.over)}return i.x=s,i.y=n,i}var RV=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Xh={init:AV,forward:MV,inverse:CV,names:RV};function SA(i){var t=Math.exp(i);return t=(t-1/t)/2,t}function hi(i,t){i=Math.abs(i),t=Math.abs(t);var e=Math.max(i,t),n=Math.min(i,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function PV(i){var t=1+i,e=t-1;return e===0?i:i*Math.log(t)/e}function IV(i){var t=Math.abs(i);return t=PV(t*(1+t/(hi(1,t)+1))),i<0?-t:t}function Vm(i,t){for(var e=2*Math.cos(2*t),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+e*s+i[n],r=s,s=o;return t+o*Math.sin(2*t)}function OV(i,t){for(var e=2*Math.cos(t),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+e*s+i[n],r=s,s=o;return Math.sin(t)*o}function NV(i){var t=Math.exp(i);return t=(t+1/t)/2,t}function TA(i,t,e){for(var n=Math.sin(t),s=Math.cos(t),r=SA(e),o=NV(e),l=2*s*o,u=-2*n*r,f=i.length-1,g=i[f],p=0,_=0,v=0,b,x;--f>=0;)b=_,x=p,_=g,p=v,g=-b+l*_-u*p+i[f],v=-x+u*_+l*p;return l=n*o,u=s*r,[l*g-u*v,l*v+u*g]}function DV(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Xh.init.apply(this),this.forward=Xh.forward,this.inverse=Xh.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),t=i/(2-i),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=Vm(this.cbg,this.lat0);this.Zb=-this.Qn*(n+OV(this.gtu,2*n))}function LV(i){var t=gt(i.x-this.long0,this.over),e=i.y;e=Vm(this.cbg,e);var n=Math.sin(e),s=Math.cos(e),r=Math.sin(t),o=Math.cos(t);e=Math.atan2(n,o*s),t=Math.atan2(r*s,hi(n,s*o)),t=IV(Math.tan(t));var l=TA(this.gtu,2*e,2*t);e=e+l[0],t=t+l[1];var u,f;return Math.abs(t)<=2.623395162778?(u=this.a*(this.Qn*t)+this.x0,f=this.a*(this.Qn*e+this.Zb)+this.y0):(u=1/0,f=1/0),i.x=u,i.y=f,i}function kV(i){var t=(i.x-this.x0)*(1/this.a),e=(i.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,s;if(Math.abs(t)<=2.623395162778){var r=TA(this.utg,2*e,2*t);e=e+r[0],t=t+r[1],t=Math.atan(SA(t));var o=Math.sin(e),l=Math.cos(e),u=Math.sin(t),f=Math.cos(t);e=Math.atan2(o*f,hi(u,f*l)),t=Math.atan2(u,f*l),n=gt(t+this.long0,this.over),s=Vm(this.cgb,e)}else n=1/0,s=1/0;return i.x=n,i.y=s,i}var BV=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Yh={init:DV,forward:LV,inverse:kV,names:BV};function UV(i,t){if(i===void 0){if(i=Math.floor((gt(t)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var FV="etmerc";function zV(){var i=UV(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*_e,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Yh.init.apply(this),this.forward=Yh.forward,this.inverse=Yh.inverse}var VV=["Universal Transverse Mercator System","utm"];const jV={init:zV,names:VV,dependsOn:FV};function jm(i,t){return Math.pow((1-i)/(1+i),t)}var HV=20;function $V(){var i=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Kt)/(Math.pow(Math.tan(.5*this.lat0+Kt),this.C)*jm(this.e*i,this.ratexp))}function GV(i){var t=i.x,e=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Kt),this.C)*jm(this.e*Math.sin(e),this.ratexp))-lt,i.x=this.C*t,i}function WV(i){for(var t=1e-14,e=i.x/this.C,n=i.y,s=Math.pow(Math.tan(.5*n+Kt)/this.K,1/this.C),r=HV;r>0&&(n=2*Math.atan(s*jm(this.e*Math.sin(i.y),-.5*this.e))-lt,!(Math.abs(n-i.y)<t));--r)i.y=n;return r?(i.x=e,i.y=n,i):null}const Hm={init:$V,forward:GV,inverse:WV};function qV(){Hm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function XV(i){var t,e,n,s;return i.x=gt(i.x-this.long0,this.over),Hm.forward.apply(this,[i]),t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),i.x=s*e*Math.sin(i.x),i.y=s*(this.cosc0*t-this.sinc0*e*n),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function YV(i){var t,e,n,s,r;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,r=hi(i.x,i.y)){var o=2*Math.atan2(r,this.R2);t=Math.sin(o),e=Math.cos(o),s=Math.asin(e*this.sinc0+i.y*t*this.cosc0/r),n=Math.atan2(i.x*t,r*this.cosc0*e-i.y*this.sinc0*t)}else s=this.phic0,n=0;return i.x=n,i.y=s,Hm.inverse.apply(this,[i]),i.x=gt(i.x+this.long0,this.over),i}var KV=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const ZV={init:qV,forward:XV,inverse:YV,names:KV};function $m(i,t,e){return t*=e,Math.tan(.5*(lt+i))*Math.pow((1-t)/(1+t),.5*e)}function QV(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ft&&(this.k0=.5*(1+Tc(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ft&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ft&&Math.abs(Math.cos(this.lat_ts))>ft&&(this.k0=.5*this.cons*An(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/en(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=An(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan($m(this.lat0,this.sinlat0,this.e))-lt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function JV(i){var t=i.x,e=i.y,n=Math.sin(e),s=Math.cos(e),r,o,l,u,f,g,p=gt(t-this.long0,this.over);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=ft&&Math.abs(e+this.lat0)<=ft?(i.x=NaN,i.y=NaN,i):this.sphere?(r=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(p)),i.x=this.a*r*s*Math.sin(p)+this.x0,i.y=this.a*r*(this.coslat0*n-this.sinlat0*s*Math.cos(p))+this.y0,i):(o=2*Math.atan($m(e,n,this.e))-lt,u=Math.cos(o),l=Math.sin(o),Math.abs(this.coslat0)<=ft?(f=en(this.e,e*this.con,this.con*n),g=2*this.a*this.k0*f/this.cons,i.x=this.x0+g*Math.sin(t-this.long0),i.y=this.y0-this.con*g*Math.cos(t-this.long0),i):(Math.abs(this.sinlat0)<ft?(r=2*this.a*this.k0/(1+u*Math.cos(p)),i.y=r*l):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*u*Math.cos(p))),i.y=r*(this.cosX0*l-this.sinX0*u*Math.cos(p))+this.y0),i.x=r*u*Math.sin(p)+this.x0,i))}function tj(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,o=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var l=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=ft?(i.x=t,i.y=e,i):(e=Math.asin(Math.cos(l)*this.sinlat0+i.y*Math.sin(l)*this.coslat0/o),Math.abs(this.coslat0)<ft?this.lat0>0?t=gt(this.long0+Math.atan2(i.x,-1*i.y),this.over):t=gt(this.long0+Math.atan2(i.x,i.y),this.over):t=gt(this.long0+Math.atan2(i.x*Math.sin(l),o*this.coslat0*Math.cos(l)-i.y*this.sinlat0*Math.sin(l)),this.over),i.x=t,i.y=e,i)}else if(Math.abs(this.coslat0)<=ft){if(o<=ft)return e=this.lat0,t=this.long0,i.x=t,i.y=e,i;i.x*=this.con,i.y*=this.con,n=o*this.cons/(2*this.a*this.k0),e=this.con*hc(this.e,n),t=this.con*gt(this.con*this.long0+Math.atan2(i.x,-1*i.y),this.over)}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=ft?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/o),t=gt(this.long0+Math.atan2(i.x*Math.sin(s),o*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)),this.over)),e=-1*hc(this.e,Math.tan(.5*(lt+r)));return i.x=t,i.y=e,i}var ej=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const ij={init:QV,forward:JV,inverse:tj,names:ej,ssfn_:$m};function nj(){var i=this.lat0;this.lambda0=this.long0;var t=Math.sin(i),e=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),o=this.e=Math.sqrt(r);this.R=this.k0*e*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(t/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+i/2)),f=Math.log((1+o*t)/(1-o*t));this.K=l-this.alpha*u+this.alpha*o/2*f}function sj(i){var t=Math.log(Math.tan(Math.PI/4-i.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),n=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(i.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),l=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return i.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,i.x=this.R*o+this.x0,i}function rj(i){for(var t=i.x-this.x0,e=i.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),l=this.lambda0+o/this.alpha,u=0,f=r,g=-1e3,p=0;Math.abs(f-g)>1e-7;){if(++p>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(f))/2)),g=f,f=2*Math.atan(Math.exp(u))-Math.PI/2}return i.x=l,i.y=f,i}var aj=["somerc"];const oj={init:nj,forward:sj,inverse:rj,names:aj};var ka=1e-7;function lj(i){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof i.projName=="object"?Object.keys(i.projName)[0]:i.projName;return"no_uoff"in i||"no_off"in i||t.indexOf(e)!==-1||t.indexOf(hA(e))!==-1}function cj(){var i,t,e,n,s,r,o,l,u,f,g=0,p,_=0,v=0,b=0,x=0,T=0,w=0;this.no_off=lj(this),this.no_rot="no_rot"in this;var M=!1;"alpha"in this&&(M=!0);var E=!1;if("rectified_grid_angle"in this&&(E=!0),M&&(w=this.alpha),E&&(g=this.rectified_grid_angle),M||E)_=this.longc;else if(v=this.long1,x=this.lat1,b=this.long2,T=this.lat2,Math.abs(x-T)<=ka||(i=Math.abs(x))<=ka||Math.abs(i-lt)<=ka||Math.abs(Math.abs(this.lat0)-lt)<=ka||Math.abs(Math.abs(T)-lt)<=ka)throw new Error;var P=1-this.es;t=Math.sqrt(P),Math.abs(this.lat0)>ft?(l=Math.sin(this.lat0),e=Math.cos(this.lat0),i=1-this.es*l*l,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/P),this.A=this.B*this.k0*t/i,n=this.B*t/(e*Math.sqrt(i)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(en(this.e,this.lat0,l),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=s=1),M||E?(M?(p=Math.asin(Math.sin(w)/n),E||(g=w)):(p=g,w=Math.asin(n*Math.sin(p))),this.lam0=_-Math.asin(.5*(s-1/s)*Math.tan(p))/this.B):(r=Math.pow(en(this.e,x,Math.sin(x)),this.B),o=Math.pow(en(this.e,T,Math.sin(T)),this.B),s=this.E/r,u=(o-r)/(o+r),f=this.E*this.E,f=(f-o*r)/(f+o*r),i=v-b,i<-Math.PI?b-=cc:i>Math.PI&&(b+=cc),this.lam0=gt(.5*(v+b)-Math.atan(f*Math.tan(.5*this.B*(v-b))/u)/this.B,this.over),p=Math.atan(2*Math.sin(this.B*gt(v-this.lam0,this.over))/(s-1/s)),g=w=Math.asin(n*Math.sin(p))),this.singam=Math.sin(p),this.cosgam=Math.cos(p),this.sinrot=Math.sin(g),this.cosrot=Math.cos(g),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(w))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*p,this.v_pole_n=this.ArB*Math.log(Math.tan(Kt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Kt+s))}function uj(i){var t={},e,n,s,r,o,l,u,f;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-lt)>ft){if(o=this.E/Math.pow(en(this.e,i.y,Math.sin(i.y)),this.B),l=1/o,e=.5*(o-l),n=.5*(o+l),r=Math.sin(this.B*i.x),s=(e*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(s)-1)<ft)throw new Error;f=.5*this.ArB*Math.log((1-s)/(1+s)),l=Math.cos(this.B*i.x),Math.abs(l)<ka?u=this.A*i.x:u=this.ArB*Math.atan2(e*this.cosgam+r*this.singam,l)}else f=i.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*i.y;return this.no_rot?(t.x=u,t.y=f):(u-=this.u_0,t.x=f*this.cosrot+u*this.sinrot,t.y=u*this.cosrot-f*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function hj(i){var t,e,n,s,r,o,l,u={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(e=i.y,t=i.x):(e=i.x*this.cosrot-i.y*this.sinrot,t=i.y*this.cosrot+i.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),s=.5*(n-1/n),r=.5*(n+1/n),o=Math.sin(this.BrA*t),l=(o*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(l)-1)<ft)u.x=0,u.y=l<0?-lt:lt;else{if(u.y=this.E/Math.sqrt((1+l)/(1-l)),u.y=hc(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return u.x+=this.lam0,u}var fj=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const dj={init:cj,forward:uj,inverse:hj,names:fj};function gj(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ft)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=An(this.e,t,e),s=en(this.e,this.lat1,t),r=Math.sin(this.lat2),o=Math.cos(this.lat2),l=An(this.e,r,o),u=en(this.e,this.lat2,r),f=Math.abs(Math.abs(this.lat0)-lt)<ft?0:en(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ft?this.ns=Math.log(n/l)/Math.log(s/u):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(f,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function pj(i){var t=i.x,e=i.y;Math.abs(2*Math.abs(e)-Math.PI)<=ft&&(e=Tc(e)*(lt-2*ft));var n=Math.abs(Math.abs(e)-lt),s,r;if(n>ft)s=en(this.e,e,Math.sin(e)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(n=e*this.ns,n<=0)return null;r=0}var o=this.ns*gt(t-this.long0,this.over);return i.x=this.k0*(r*Math.sin(o))+this.x0,i.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,i}function _j(i){var t,e,n,s,r,o=(i.x-this.x0)/this.k0,l=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+l*l),e=1):(t=-Math.sqrt(o*o+l*l),e=-1);var u=0;if(t!==0&&(u=Math.atan2(e*o,e*l)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),s=hc(this.e,n),s===-9999)return null}else s=-lt;return r=gt(u/this.ns+this.long0,this.over),i.x=r,i.y=s,i}var mj=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const yj={init:gj,forward:pj,inverse:_j,names:mj};function vj(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function bj(i){var t,e,n,s,r,o,l,u=i.x,f=i.y,g=gt(u-this.long0,this.over);return t=Math.pow((1+this.e*Math.sin(f))/(1-this.e*Math.sin(f)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(f/2+this.s45),this.alfa)/t)-this.s45),n=-g*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),r=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(s)),o=this.n*r,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=l*Math.cos(o)/1,i.x=l*Math.sin(o)/1,this.czech||(i.y*=-1,i.x*=-1),i}function xj(i){var t,e,n,s,r,o,l,u,f=i.x;i.x=i.y,i.y=f,this.czech||(i.y*=-1,i.x*=-1),o=Math.sqrt(i.x*i.x+i.y*i.y),r=Math.atan2(i.y,i.x),s=r/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),e=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(t)),i.x=this.long0-e/this.alfa,l=t,u=0;var g=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-i.y)<1e-10&&(u=1),l=i.y,g+=1;while(u===0&&g<15);return g>=15?null:i}var Sj=["Krovak","krovak"];const Tj={init:vj,forward:bj,inverse:xj,names:Sj};function ei(i,t,e,n,s){return i*s-t*Math.sin(2*s)+e*Math.sin(4*s)-n*Math.sin(6*s)}function wc(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function Ec(i){return .375*i*(1+.25*i*(1+.46875*i))}function Ac(i){return .05859375*i*i*(1+.75*i)}function Mc(i){return i*i*i*(35/3072)}function Gm(i,t,e){var n=t*e;return i/Math.sqrt(1-n*n)}function Qs(i){return Math.abs(i)<lt?i:i-Tc(i)*Math.PI}function Ef(i,t,e,n,s){var r,o;r=i/t;for(var l=0;l<15;l++)if(o=(i-(t*r-e*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(t-2*e*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function wj(){this.sphere||(this.e0=wc(this.es),this.e1=Ec(this.es),this.e2=Ac(this.es),this.e3=Mc(this.es),this.ml0=this.a*ei(this.e0,this.e1,this.e2,this.e3,this.lat0))}function Ej(i){var t,e,n=i.x,s=i.y;if(n=gt(n-this.long0,this.over),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),l=Gm(this.a,this.e,r),u=Math.tan(s)*Math.tan(s),f=n*Math.cos(s),g=f*f,p=this.es*o*o/(1-this.es),_=this.a*ei(this.e0,this.e1,this.e2,this.e3,s);t=l*f*(1-g*u*(1/6-(8-u+8*p)*g/120)),e=_-this.ml0+l*r/o*g*(.5+(5-u+6*p)*g/24)}return i.x=t+this.x0,i.y=e+this.y0,i}function Aj(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s;if(this.sphere){var r=e+this.lat0;n=Math.asin(Math.sin(r)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(r))}else{var o=this.ml0/this.a+e,l=Ef(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-lt)<=ft)return i.x=this.long0,i.y=lt,e<0&&(i.y*=-1),i;var u=Gm(this.a,this.e,Math.sin(l)),f=u*u*u/this.a/this.a*(1-this.es),g=Math.pow(Math.tan(l),2),p=t*this.a/u,_=p*p;n=l-u*Math.tan(l)/f*p*p*(.5-(1+3*g)*p*p/24),s=p*(1-_*(g/3+(1+3*g)*g*_/15))/Math.cos(l)}return i.x=gt(s+this.long0,this.over),i.y=Qs(n),i}var Mj=["Cassini","Cassini_Soldner","cass"];const Cj={init:wj,forward:Ej,inverse:Aj,names:Mj};function Ws(i,t){var e;return i>1e-7?(e=i*t,(1-i*i)*(t/(1-e*e)-.5/i*Math.log((1-e)/(1+e)))):2*t}var u_=1,h_=2,f_=3,Kh=4;function Rj(){var i=Math.abs(this.lat0);if(Math.abs(i-lt)<ft?this.mode=this.lat0<0?u_:h_:Math.abs(i)<ft?this.mode=f_:this.mode=Kh,this.es>0){var t;switch(this.qp=Ws(this.e,1),this.mmf=.5/(1-this.es),this.apa=Uj(this.es),this.mode){case h_:this.dd=1;break;case u_:this.dd=1;break;case f_:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case Kh:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Ws(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===Kh&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function Pj(i){var t,e,n,s,r,o,l,u,f,g,p=i.x,_=i.y;if(p=gt(p-this.long0,this.over),this.sphere){if(r=Math.sin(_),g=Math.cos(_),n=Math.cos(p),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+g*n:1+this.sinph0*r+this.cosph0*g*n,e<=ft)return null;e=Math.sqrt(2/e),t=e*g*Math.sin(p),e*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*g*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(_+this.lat0)<ft)return null;e=Kt-_*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(p),e*=n}}else{switch(l=0,u=0,f=0,n=Math.cos(p),s=Math.sin(p),r=Math.sin(_),o=Ws(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=o/this.qp,u=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:f=1+this.sinb1*l+this.cosb1*u*n;break;case this.EQUIT:f=1+u*n;break;case this.N_POLE:f=lt+_,o=this.qp-o;break;case this.S_POLE:f=_-lt,o=this.qp+o;break}if(Math.abs(f)<ft)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:f=Math.sqrt(2/f),this.mode===this.OBLIQ?e=this.ymf*f*(this.cosb1*l-this.sinb1*u*n):e=(f=Math.sqrt(2/(1+u*n)))*l*this.ymf,t=this.xmf*f*u*s;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(f=Math.sqrt(o))*s,e=n*(this.mode===this.S_POLE?f:-f)):t=e=0;break}}return i.x=this.a*t+this.x0,i.y=this.a*e+this.y0,i}function Ij(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s,r,o,l,u,f;if(this.sphere){var g=0,p,_=0;if(p=Math.sqrt(t*t+e*e),s=p*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(_=Math.sin(s),g=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(p)<=ft?0:Math.asin(e*_/p),t*=_,e=g*p;break;case this.OBLIQ:s=Math.abs(p)<=ft?this.lat0:Math.asin(g*this.sinph0+e*_*this.cosph0/p),t*=_*this.cosph0,e=(g-Math.sin(s)*this.sinph0)*p;break;case this.N_POLE:e=-e,s=lt-s;break;case this.S_POLE:s-=lt;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(f=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,u=Math.sqrt(t*t+e*e),u<ft)return i.x=this.long0,i.y=this.lat0,i;o=2*Math.asin(.5*u/this.rq),r=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(f=r*this.sinb1+e*o*this.cosb1/u,l=this.qp*f,e=u*this.cosb1*r-e*this.sinb1*o):(f=e*o/u,l=this.qp*f,e=u*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),l=t*t+e*e,!l)return i.x=this.long0,i.y=this.lat0,i;f=1-l/this.qp,this.mode===this.S_POLE&&(f=-f)}n=Math.atan2(t,e),s=Fj(Math.asin(f),this.apa)}return i.x=gt(this.long0+n,this.over),i.y=s,i}var Oj=.3333333333333333,Nj=.17222222222222222,Dj=.10257936507936508,Lj=.06388888888888888,kj=.0664021164021164,Bj=.016415012942191543;function Uj(i){var t,e=[];return e[0]=i*Oj,t=i*i,e[0]+=t*Nj,e[1]=t*Lj,t*=i,e[0]+=t*Dj,e[1]+=t*kj,e[2]=t*Bj,e}function Fj(i,t){var e=i+i;return i+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var zj=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const Vj={init:Rj,forward:Pj,inverse:Ij,names:zj,S_POLE:u_,N_POLE:h_,EQUIT:f_,OBLIQ:Kh};function Ys(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function jj(){Math.abs(this.lat1+this.lat2)<ft||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=An(this.e3,this.sin_po,this.cos_po),this.qs1=Ws(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=An(this.e3,this.sin_po,this.cos_po),this.qs2=Ws(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Ws(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>ft?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function Hj(i){var t=i.x,e=i.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=Ws(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*gt(t-this.long0,this.over),o=s*Math.sin(r)+this.x0,l=this.rh-s*Math.cos(r)+this.y0;return i.x=o,i.y=l,i}function $j(i){var t,e,n,s,r,o;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),n=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),n=-1),s=0,t!==0&&(s=Math.atan2(n*i.x,n*i.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,e)),r=gt(s/this.ns0+this.long0,this.over),i.x=r,i.y=o,i}function Gj(i,t){var e,n,s,r,o,l=Ys(.5*t);if(i<ft)return l;for(var u=i*i,f=1;f<=25;f++)if(e=Math.sin(l),n=Math.cos(l),s=i*e,r=1-s*s,o=.5*r*r/n*(t/(1-u)-e/r+.5/i*Math.log((1-s)/(1+s))),l=l+o,Math.abs(o)<=1e-7)return l;return null}var Wj=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const qj={init:jj,forward:Hj,inverse:$j,names:Wj,phi1z:Gj};function Xj(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function Yj(i){var t,e,n,s,r,o,l,u,f=i.x,g=i.y;return n=gt(f-this.long0,this.over),t=Math.sin(g),e=Math.cos(g),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*s,r=1,o>0||Math.abs(o)<=ft?(l=this.x0+this.a*r*e*Math.sin(n)/o,u=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)/o):(l=this.x0+this.infinity_dist*e*Math.sin(n),u=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),i.x=l,i.y=u,i}function Kj(i){var t,e,n,s,r,o;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(t=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),n=Math.cos(s),o=Ys(n*this.sin_p14+i.y*e*this.cos_p14/t),r=Math.atan2(i.x*e,t*this.cos_p14*n-i.y*this.sin_p14*e),r=gt(this.long0+r,this.over)):(o=this.phic0,r=0),i.x=r,i.y=o,i}var Zj=["gnom"];const Qj={init:Xj,forward:Yj,inverse:Kj,names:Zj};function Jj(i,t){var e=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*lt:lt;for(var n=Math.asin(.5*t),s,r,o,l,u=0;u<30;u++)if(r=Math.sin(n),o=Math.cos(n),l=i*r,s=Math.pow(1-l*l,2)/(2*o)*(t/(1-i*i)-r/(1-l*l)+.5/i*Math.log((1-l)/(1+l))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function tH(){this.sphere||(this.k0=An(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function eH(i){var t=i.x,e=i.y,n,s,r=gt(t-this.long0,this.over);if(this.sphere)n=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=Ws(this.e,Math.sin(e));n=this.x0+this.a*this.k0*r,s=this.y0+this.a*o*.5/this.k0}return i.x=n,i.y=s,i}function iH(i){i.x-=this.x0,i.y-=this.y0;var t,e;return this.sphere?(t=gt(this.long0+i.x/this.a/Math.cos(this.lat_ts),this.over),e=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(e=Jj(this.e,2*i.y*this.k0/this.a),t=gt(this.long0+i.x/(this.a*this.k0),this.over)),i.x=t,i.y=e,i}var nH=["cea"];const sH={init:tH,forward:eH,inverse:iH,names:nH};function rH(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function aH(i){var t=i.x,e=i.y,n=gt(t-this.long0,this.over),s=Qs(e-this.lat0);return i.x=this.x0+this.a*n*this.rc,i.y=this.y0+this.a*s,i}function oH(i){var t=i.x,e=i.y;return i.x=gt(this.long0+(t-this.x0)/(this.a*this.rc),this.over),i.y=Qs(this.lat0+(e-this.y0)/this.a),i}var lH=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const cH={init:rH,forward:aH,inverse:oH,names:lH};var kS=20;function uH(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=wc(this.es),this.e1=Ec(this.es),this.e2=Ac(this.es),this.e3=Mc(this.es),this.ml0=this.a*ei(this.e0,this.e1,this.e2,this.e3,this.lat0)}function hH(i){var t=i.x,e=i.y,n,s,r,o=gt(t-this.long0,this.over);if(r=o*Math.sin(e),this.sphere)Math.abs(e)<=ft?(n=this.a*o,s=-1*this.a*this.lat0):(n=this.a*Math.sin(r)/Math.tan(e),s=this.a*(Qs(e-this.lat0)+(1-Math.cos(r))/Math.tan(e)));else if(Math.abs(e)<=ft)n=this.a*o,s=-1*this.ml0;else{var l=Gm(this.a,this.e,Math.sin(e))/Math.tan(e);n=l*Math.sin(r),s=this.a*ei(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+l*(1-Math.cos(r))}return i.x=n+this.x0,i.y=s+this.y0,i}function fH(i){var t,e,n,s,r,o,l,u,f;if(n=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=ft)t=gt(n/this.a+this.long0,this.over),e=0;else{o=this.lat0+s/this.a,l=n*n/this.a/this.a+o*o,u=o;var g;for(r=kS;r;--r)if(g=Math.tan(u),f=-1*(o*(u*g+1)-u-.5*(u*u+l)*g)/((u-o)/g-1),u+=f,Math.abs(f)<=ft){e=u;break}t=gt(this.long0+Math.asin(n*Math.tan(u)/this.a)/Math.sin(e),this.over)}else if(Math.abs(s+this.ml0)<=ft)e=0,t=gt(this.long0+n/this.a,this.over);else{o=(this.ml0+s)/this.a,l=n*n/this.a/this.a+o*o,u=o;var p,_,v,b,x;for(r=kS;r;--r)if(x=this.e*Math.sin(u),p=Math.sqrt(1-x*x)*Math.tan(u),_=this.a*ei(this.e0,this.e1,this.e2,this.e3,u),v=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),b=_/this.a,f=(o*(p*b+1)-b-.5*p*(b*b+l))/(this.es*Math.sin(2*u)*(b*b+l-2*o*b)/(4*p)+(o-b)*(p*v-2/Math.sin(2*u))-v),u-=f,Math.abs(f)<=ft){e=u;break}p=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=gt(this.long0+Math.asin(n*p/this.a)/Math.sin(e),this.over)}return i.x=t,i.y=e,i}var dH=["Polyconic","American_Polyconic","poly"];const gH={init:uH,forward:hH,inverse:fH,names:dH};function pH(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function _H(i){var t,e=i.x,n=i.y,s=n-this.lat0,r=e-this.long0,o=s/ql*1e-5,l=r,u=1,f=0;for(t=1;t<=10;t++)u=u*o,f=f+this.A[t]*u;var g=f,p=l,_=1,v=0,b,x,T=0,w=0;for(t=1;t<=6;t++)b=_*g-v*p,x=v*g+_*p,_=b,v=x,T=T+this.B_re[t]*_-this.B_im[t]*v,w=w+this.B_im[t]*_+this.B_re[t]*v;return i.x=w*this.a+this.x0,i.y=T*this.a+this.y0,i}function mH(i){var t,e=i.x,n=i.y,s=e-this.x0,r=n-this.y0,o=r/this.a,l=s/this.a,u=1,f=0,g,p,_=0,v=0;for(t=1;t<=6;t++)g=u*o-f*l,p=f*o+u*l,u=g,f=p,_=_+this.C_re[t]*u-this.C_im[t]*f,v=v+this.C_im[t]*u+this.C_re[t]*f;for(var b=0;b<this.iterations;b++){var x=_,T=v,w,M,E=o,P=l;for(t=2;t<=6;t++)w=x*_-T*v,M=T*_+x*v,x=w,T=M,E=E+(t-1)*(this.B_re[t]*x-this.B_im[t]*T),P=P+(t-1)*(this.B_im[t]*x+this.B_re[t]*T);x=1,T=0;var k=this.B_re[1],U=this.B_im[1];for(t=2;t<=6;t++)w=x*_-T*v,M=T*_+x*v,x=w,T=M,k=k+t*(this.B_re[t]*x-this.B_im[t]*T),U=U+t*(this.B_im[t]*x+this.B_re[t]*T);var Y=k*k+U*U;_=(E*k+P*U)/Y,v=(P*k-E*U)/Y}var et=_,K=v,ut=1,ht=0;for(t=1;t<=9;t++)ut=ut*et,ht=ht+this.D[t]*ut;var _t=this.lat0+ht*ql*1e5,St=this.long0+K;return i.x=St,i.y=_t,i}var yH=["New_Zealand_Map_Grid","nzmg"];const vH={init:pH,forward:_H,inverse:mH,names:yH};function bH(){}function xH(i){var t=i.x,e=i.y,n=gt(t-this.long0,this.over),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return i.x=s,i.y=r,i}function SH(i){i.x-=this.x0,i.y-=this.y0;var t=gt(this.long0+i.x/this.a,this.over),e=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=t,i.y=e,i}var TH=["Miller_Cylindrical","mill"];const wH={init:bH,forward:xH,inverse:SH,names:TH};var EH=20;function AH(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Fm(this.es)}function MH(i){var t,e,n=i.x,s=i.y;if(n=gt(n-this.long0,this.over),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),o=EH;o;--o){var l=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=l,Math.abs(l)<ft)break}t=this.a*this.C_x*n*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var u=Math.sin(s),f=Math.cos(s);e=this.a*yo(s,u,f,this.en),t=this.a*n*f/Math.sqrt(1-this.es*u*u)}return i.x=t,i.y=e,i}function CH(i){var t,e,n,s;return i.x-=this.x0,n=i.x/this.a,i.y-=this.y0,t=i.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=Ys((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Ys(Math.sin(t)/this.n)),n=gt(n+this.long0,this.over),t=Qs(t)):(t=zm(i.y/this.a,this.es,this.en),s=Math.abs(t),s<lt?(s=Math.sin(t),e=this.long0+i.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),n=gt(e,this.over)):s-ft<lt&&(n=this.long0)),i.x=n,i.y=t,i}var RH=["Sinusoidal","sinu"];const PH={init:AH,forward:MH,inverse:CH,names:RH};function IH(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function OH(i){for(var t=i.x,e=i.y,n=gt(t-this.long0,this.over),s=e,r=Math.PI*Math.sin(e);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<ft)break}s/=2,Math.PI/2-Math.abs(e)<ft&&(n=0);var l=.900316316158*this.a*n*Math.cos(s)+this.x0,u=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=l,i.y=u,i}function NH(i){var t,e;i.x-=this.x0,i.y-=this.y0,e=i.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=gt(this.long0+i.x/(.900316316158*this.a*Math.cos(t)),this.over);n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return i.x=n,i.y=s,i}var DH=["Mollweide","moll"];const LH={init:IH,forward:OH,inverse:NH,names:DH};function kH(){Math.abs(this.lat1+this.lat2)<ft||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=wc(this.es),this.e1=Ec(this.es),this.e2=Ac(this.es),this.e3=Mc(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=An(this.e,this.sin_phi,this.cos_phi),this.ml1=ei(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ft?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=An(this.e,this.sin_phi,this.cos_phi),this.ml2=ei(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ei(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function BH(i){var t=i.x,e=i.y,n;if(this.sphere)n=this.a*(this.g-e);else{var s=ei(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-s)}var r=this.ns*gt(t-this.long0,this.over),o=this.x0+n*Math.sin(r),l=this.y0+this.rh-n*Math.cos(r);return i.x=o,i.y=l,i}function UH(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var t,e,n,s;this.ns>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),t=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),t=-1);var r=0;if(e!==0&&(r=Math.atan2(t*i.x,t*i.y)),this.sphere)return s=gt(this.long0+r/this.ns,this.over),n=Qs(this.g-e/this.a),i.x=s,i.y=n,i;var o=this.g-e/this.a;return n=Ef(o,this.e0,this.e1,this.e2,this.e3),s=gt(this.long0+r/this.ns,this.over),i.x=s,i.y=n,i}var FH=["Equidistant_Conic","eqdc"];const zH={init:kH,forward:BH,inverse:UH,names:FH};function VH(){this.R=this.a}function jH(i){var t=i.x,e=i.y,n=gt(t-this.long0,this.over),s,r;Math.abs(e)<=ft&&(s=this.x0+this.R*n,r=this.y0);var o=Ys(2*Math.abs(e/Math.PI));(Math.abs(n)<=ft||Math.abs(Math.abs(e)-lt)<=ft)&&(s=this.x0,e>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*o):r=this.y0+Math.PI*this.R*-Math.tan(.5*o));var l=.5*Math.abs(Math.PI/n-n/Math.PI),u=l*l,f=Math.sin(o),g=Math.cos(o),p=g/(f+g-1),_=p*p,v=p*(2/f-1),b=v*v,x=Math.PI*this.R*(l*(p-b)+Math.sqrt(u*(p-b)*(p-b)-(b+u)*(_-b)))/(b+u);n<0&&(x=-x),s=this.x0+x;var T=u+p;return x=Math.PI*this.R*(v*T-l*Math.sqrt((b+u)*(u+1)-T*T))/(b+u),e>=0?r=this.y0+x:r=this.y0-x,i.x=s,i.y=r,i}function HH(i){var t,e,n,s,r,o,l,u,f,g,p,_,v;return i.x-=this.x0,i.y-=this.y0,p=Math.PI*this.R,n=i.x/p,s=i.y/p,r=n*n+s*s,o=-Math.abs(s)*(1+r),l=o-2*s*s+n*n,u=-2*o+1+2*s*s+r*r,v=s*s/u+(2*l*l*l/u/u/u-9*o*l/u/u)/27,f=(o-l*l/3/u)/u,g=2*Math.sqrt(-f/3),p=3*v/f/g,Math.abs(p)>1&&(p>=0?p=1:p=-1),_=Math.acos(p)/3,i.y>=0?e=(-g*Math.cos(_+Math.PI/3)-l/3/u)*Math.PI:e=-(-g*Math.cos(_+Math.PI/3)-l/3/u)*Math.PI,Math.abs(n)<ft?t=this.long0:t=gt(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n,this.over),i.x=t,i.y=e,i}var $H=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const GH={init:VH,forward:jH,inverse:HH,names:$H};function WH(i,t,e,n,s,r){const o=n-t,l=Math.atan((1-r)*Math.tan(i)),u=Math.atan((1-r)*Math.tan(e)),f=Math.sin(l),g=Math.cos(l),p=Math.sin(u),_=Math.cos(u);let v=o,b,x=100,T,w,M,E,P,k,U,Y,et,K,ut,ht,_t,St;do{if(T=Math.sin(v),w=Math.cos(v),M=Math.sqrt(_*T*(_*T)+(g*p-f*_*w)*(g*p-f*_*w)),M===0)return{azi1:0,s12:0};E=f*p+g*_*w,P=Math.atan2(M,E),k=g*_*T/M,U=1-k*k,Y=U!==0?E-2*f*p/U:0,et=r/16*U*(4+r*(4-3*U)),b=v,v=o+(1-et)*r*k*(P+et*M*(Y+et*E*(-1+2*Y*Y)))}while(Math.abs(v-b)>1e-12&&--x>0);return x===0?{azi1:NaN,s12:NaN}:(K=U*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),ut=1+K/16384*(4096+K*(-768+K*(320-175*K))),ht=K/1024*(256+K*(-128+K*(74-47*K))),_t=ht*M*(Y+ht/4*(E*(-1+2*Y*Y)-ht/6*Y*(-3+4*M*M)*(-3+4*Y*Y))),St=s*(1-r)*ut*(P-_t),{azi1:Math.atan2(_*T,g*p-f*_*w),s12:St})}function qH(i,t,e,n,s,r){const o=Math.atan((1-r)*Math.tan(i)),l=Math.sin(o),u=Math.cos(o),f=Math.sin(e),g=Math.cos(e),p=Math.atan2(l,u*g),_=u*f,v=1-_*_,b=v*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),x=1+b/16384*(4096+b*(-768+b*(320-175*b))),T=b/1024*(256+b*(-128+b*(74-47*b)));let w=n/(s*(1-r)*x),M,E=100,P,k,U,Y;do P=Math.cos(2*p+w),k=Math.sin(w),U=Math.cos(w),Y=T*k*(P+T/4*(U*(-1+2*P*P)-T/6*P*(-3+4*k*k)*(-3+4*P*P))),M=w,w=n/(s*(1-r)*x)+Y;while(Math.abs(w-M)>1e-12&&--E>0);if(E===0)return{lat2:NaN,lon2:NaN};const et=l*k-u*U*g,K=Math.atan2(l*U+u*k*g,(1-r)*Math.sqrt(_*_+et*et)),ut=Math.atan2(k*f,u*U-l*k*g),ht=r/16*v*(4+r*(4-3*v)),_t=ut-(1-ht)*r*_*(w+ht*k*(P+ht*U*(-1+2*P*P))),St=t+_t;return{lat2:K,lon2:St}}function XH(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function YH(i){var t=i.x,e=i.y,n=Math.sin(i.y),s=Math.cos(i.y),r=gt(t-this.long0,this.over),o,l,u,f,g,p,_,v,b,x,T;return this.sphere?Math.abs(this.sin_p12-1)<=ft?(i.x=this.x0+this.a*(lt-e)*Math.sin(r),i.y=this.y0-this.a*(lt-e)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=ft?(i.x=this.x0+this.a*(lt+e)*Math.sin(r),i.y=this.y0+this.a*(lt+e)*Math.cos(r),i):(b=this.sin_p12*n+this.cos_p12*s*Math.cos(r),_=Math.acos(b),v=_?_/Math.sin(_):1,i.x=this.x0+this.a*v*s*Math.sin(r),i.y=this.y0+this.a*v*(this.cos_p12*n-this.sin_p12*s*Math.cos(r)),i):(o=wc(this.es),l=Ec(this.es),u=Ac(this.es),f=Mc(this.es),Math.abs(this.sin_p12-1)<=ft?(g=this.a*ei(o,l,u,f,lt),p=this.a*ei(o,l,u,f,e),i.x=this.x0+(g-p)*Math.sin(r),i.y=this.y0-(g-p)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=ft?(g=this.a*ei(o,l,u,f,lt),p=this.a*ei(o,l,u,f,e),i.x=this.x0+(g+p)*Math.sin(r),i.y=this.y0+(g+p)*Math.cos(r),i):Math.abs(t)<ft&&Math.abs(e-this.lat0)<ft?(i.x=i.y=0,i):(x=WH(this.lat0,this.long0,e,t,this.a,this.f),T=x.azi1,i.x=x.s12*Math.sin(T),i.y=x.s12*Math.cos(T),i))}function KH(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,o,l,u,f,g,p,_,v,b,x,T;return this.sphere?(t=Math.sqrt(i.x*i.x+i.y*i.y),t>2*lt*this.a?void 0:(e=t/this.a,n=Math.sin(e),s=Math.cos(e),r=this.long0,Math.abs(t)<=ft?o=this.lat0:(o=Ys(s*this.sin_p12+i.y*n*this.cos_p12/t),l=Math.abs(this.lat0)-lt,Math.abs(l)<=ft?this.lat0>=0?r=gt(this.long0+Math.atan2(i.x,-i.y),this.over):r=gt(this.long0-Math.atan2(-i.x,i.y),this.over):r=gt(this.long0+Math.atan2(i.x*n,t*this.cos_p12*s-i.y*this.sin_p12*n),this.over)),i.x=r,i.y=o,i)):(u=wc(this.es),f=Ec(this.es),g=Ac(this.es),p=Mc(this.es),Math.abs(this.sin_p12-1)<=ft?(_=this.a*ei(u,f,g,p,lt),t=Math.sqrt(i.x*i.x+i.y*i.y),v=_-t,o=Ef(v/this.a,u,f,g,p),r=gt(this.long0+Math.atan2(i.x,-1*i.y),this.over),i.x=r,i.y=o,i):Math.abs(this.sin_p12+1)<=ft?(_=this.a*ei(u,f,g,p,lt),t=Math.sqrt(i.x*i.x+i.y*i.y),v=t-_,o=Ef(v/this.a,u,f,g,p),r=gt(this.long0+Math.atan2(i.x,i.y),this.over),i.x=r,i.y=o,i):(b=Math.atan2(i.x,i.y),x=Math.sqrt(i.x*i.x+i.y*i.y),T=qH(this.lat0,this.long0,b,x,this.a,this.f),i.x=T.lon2,i.y=T.lat2,i))}var ZH=["Azimuthal_Equidistant","aeqd"];const QH={init:XH,forward:YH,inverse:KH,names:ZH};function JH(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function t$(i){var t,e,n,s,r,o,l,u,f=i.x,g=i.y;return n=gt(f-this.long0,this.over),t=Math.sin(g),e=Math.cos(g),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*s,r=1,(o>0||Math.abs(o)<=ft)&&(l=this.a*r*e*Math.sin(n),u=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)),i.x=l,i.y=u,i}function e$(i){var t,e,n,s,r,o,l;return i.x-=this.x0,i.y-=this.y0,t=Math.sqrt(i.x*i.x+i.y*i.y),e=Ys(t/this.a),n=Math.sin(e),s=Math.cos(e),o=this.long0,Math.abs(t)<=ft?(l=this.lat0,i.x=o,i.y=l,i):(l=Ys(s*this.sin_p14+i.y*n*this.cos_p14/t),r=Math.abs(this.lat0)-lt,Math.abs(r)<=ft?(this.lat0>=0?o=gt(this.long0+Math.atan2(i.x,-i.y),this.over):o=gt(this.long0-Math.atan2(-i.x,i.y),this.over),i.x=o,i.y=l,i):(o=gt(this.long0+Math.atan2(i.x*n,t*this.cos_p14*s-i.y*this.sin_p14*n),this.over),i.x=o,i.y=l,i))}var i$=["ortho"];const n$={init:JH,forward:t$,inverse:e$,names:i$};var he={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Zt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function s$(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=lt-Kt/2?this.face=he.TOP:this.lat0<=-(lt-Kt/2)?this.face=he.BOTTOM:Math.abs(this.long0)<=Kt?this.face=he.FRONT:Math.abs(this.long0)<=lt+Kt?this.face=this.long0>0?he.RIGHT:he.LEFT:this.face=he.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function r$(i){var t={x:0,y:0},e,n,s,r,o,l,u={value:0};if(i.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):e=i.y,n=i.x,this.face===he.TOP)r=lt-e,n>=Kt&&n<=lt+Kt?(u.value=Zt.AREA_0,s=n-lt):n>lt+Kt||n<=-(lt+Kt)?(u.value=Zt.AREA_1,s=n>0?n-xe:n+xe):n>-(lt+Kt)&&n<=-Kt?(u.value=Zt.AREA_2,s=n+lt):(u.value=Zt.AREA_3,s=n);else if(this.face===he.BOTTOM)r=lt+e,n>=Kt&&n<=lt+Kt?(u.value=Zt.AREA_0,s=-n+lt):n<Kt&&n>=-Kt?(u.value=Zt.AREA_1,s=-n):n<-Kt&&n>=-(lt+Kt)?(u.value=Zt.AREA_2,s=-n-lt):(u.value=Zt.AREA_3,s=n>0?-n+xe:-n-xe);else{var f,g,p,_,v,b,x;this.face===he.RIGHT?n=eo(n,+lt):this.face===he.BACK?n=eo(n,+xe):this.face===he.LEFT&&(n=eo(n,-lt)),_=Math.sin(e),v=Math.cos(e),b=Math.sin(n),x=Math.cos(n),f=v*x,g=v*b,p=_,this.face===he.FRONT?(r=Math.acos(f),s=Th(r,p,g,u)):this.face===he.RIGHT?(r=Math.acos(g),s=Th(r,p,-f,u)):this.face===he.BACK?(r=Math.acos(-f),s=Th(r,p,-g,u)):this.face===he.LEFT?(r=Math.acos(-g),s=Th(r,p,f,u)):(r=s=0,u.value=Zt.AREA_0)}return l=Math.atan(12/xe*(s+Math.acos(Math.sin(s)*Math.cos(Kt))-lt)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(s))))),u.value===Zt.AREA_1?l+=lt:u.value===Zt.AREA_2?l+=xe:u.value===Zt.AREA_3&&(l+=1.5*xe),t.x=o*Math.cos(l),t.y=o*Math.sin(l),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,i.x=t.x,i.y=t.y,i}function a$(i){var t={lam:0,phi:0},e,n,s,r,o,l,u,f,g,p={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,n=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?p.value=Zt.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(p.value=Zt.AREA_1,e-=lt):i.x<0&&-i.x>=Math.abs(i.y)?(p.value=Zt.AREA_2,e=e<0?e+xe:e-xe):(p.value=Zt.AREA_3,e+=lt),g=xe/12*Math.tan(e),o=Math.sin(g)/(Math.cos(g)-1/Math.sqrt(2)),l=Math.atan(o),s=Math.cos(e),r=Math.tan(n),u=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(l)))),u<-1?u=-1:u>1&&(u=1),this.face===he.TOP)f=Math.acos(u),t.phi=lt-f,p.value===Zt.AREA_0?t.lam=l+lt:p.value===Zt.AREA_1?t.lam=l<0?l+xe:l-xe:p.value===Zt.AREA_2?t.lam=l-lt:t.lam=l;else if(this.face===he.BOTTOM)f=Math.acos(u),t.phi=f-lt,p.value===Zt.AREA_0?t.lam=-l+lt:p.value===Zt.AREA_1?t.lam=-l:p.value===Zt.AREA_2?t.lam=-l-lt:t.lam=l<0?-l-xe:-l+xe;else{var _,v,b;_=u,g=_*_,g>=1?b=0:b=Math.sqrt(1-g)*Math.sin(l),g+=b*b,g>=1?v=0:v=Math.sqrt(1-g),p.value===Zt.AREA_1?(g=v,v=-b,b=g):p.value===Zt.AREA_2?(v=-v,b=-b):p.value===Zt.AREA_3&&(g=v,v=b,b=-g),this.face===he.RIGHT?(g=_,_=-v,v=g):this.face===he.BACK?(_=-_,v=-v):this.face===he.LEFT&&(g=_,_=v,v=-g),t.phi=Math.acos(-b)-lt,t.lam=Math.atan2(v,_),this.face===he.RIGHT?t.lam=eo(t.lam,-lt):this.face===he.BACK?t.lam=eo(t.lam,-xe):this.face===he.LEFT&&(t.lam=eo(t.lam,+lt))}if(this.es!==0){var x,T,w;x=t.phi<0?1:0,T=Math.tan(t.phi),w=this.b/Math.sqrt(T*T+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-w*w)/(this.one_minus_f*w)),x&&(t.phi=-t.phi)}return t.lam+=this.long0,i.x=t.lam,i.y=t.phi,i}function Th(i,t,e,n){var s;return i<ft?(n.value=Zt.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=Kt?n.value=Zt.AREA_0:s>Kt&&s<=lt+Kt?(n.value=Zt.AREA_1,s-=lt):s>lt+Kt||s<=-(lt+Kt)?(n.value=Zt.AREA_2,s=s>=0?s-xe:s+xe):(n.value=Zt.AREA_3,s+=lt)),s}function eo(i,t){var e=i+t;return e<-xe?e+=cc:e>+xe&&(e-=cc),e}var o$=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const l$={init:s$,forward:r$,inverse:a$,names:o$};var d_=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Nl=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],wA=.8487,EA=1.3523,AA=fi/5,c$=1/AA,Ya=18,Af=function(i,t){return i[0]+t*(i[1]+t*(i[2]+t*i[3]))},u$=function(i,t){return i[1]+t*(2*i[2]+t*3*i[3])};function h$(i,t,e,n){for(var s=t;n;--n){var r=i(s);if(s-=r,Math.abs(r)<e)break}return s}function f$(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function d$(i){var t=gt(i.x-this.long0,this.over),e=Math.abs(i.y),n=Math.floor(e*AA);n<0?n=0:n>=Ya&&(n=Ya-1),e=fi*(e-c$*n);var s={x:Af(d_[n],e)*t,y:Af(Nl[n],e)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*wA+this.x0,s.y=s.y*this.a*EA+this.y0,s}function g$(i){var t={x:(i.x-this.x0)/(this.a*wA),y:Math.abs(i.y-this.y0)/(this.a*EA)};if(t.y>=1)t.x/=d_[Ya][0],t.y=i.y<0?-lt:lt;else{var e=Math.floor(t.y*Ya);for(e<0?e=0:e>=Ya&&(e=Ya-1);;)if(Nl[e][0]>t.y)--e;else if(Nl[e+1][0]<=t.y)++e;else break;var n=Nl[e],s=5*(t.y-n[0])/(Nl[e+1][0]-n[0]);s=h$(function(r){return(Af(n,r)-t.y)/u$(n,r)},s,ft,100),t.x/=Af(d_[e],s),t.y=(5*e+s)*_e,i.y<0&&(t.y=-t.y)}return t.x=gt(t.x+this.long0,this.over),t}var p$=["Robinson","robin"];const _$={init:f$,forward:d$,inverse:g$,names:p$};function m$(){this.name="geocent"}function y$(i){var t=dA(i,this.es,this.a);return t}function v$(i){var t=gA(i,this.es,this.a,this.b);return t}var b$=["Geocentric","geocentric","geocent","Geocent"];const x$={init:m$,forward:y$,inverse:v$,names:b$};var Ke={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Tl={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function S$(){if(Object.keys(Tl).forEach((function(e){if(typeof this[e]>"u")this[e]=Tl[e].def;else{if(Tl[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Tl[e].num&&(this[e]=parseFloat(this[e]))}Tl[e].degrees&&(this[e]=this[e]*_e)}).bind(this)),Math.abs(Math.abs(this.lat0)-lt)<ft?this.mode=this.lat0<0?Ke.S_POLE:Ke.N_POLE:Math.abs(this.lat0)<ft?this.mode=Ke.EQUIT:(this.mode=Ke.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(i),this.sw=Math.sin(i)}function T$(i){i.x-=this.long0;var t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s,r;switch(this.mode){case Ke.OBLIQ:r=this.sinph0*t+this.cosph0*e*n;break;case Ke.EQUIT:r=e*n;break;case Ke.S_POLE:r=-t;break;case Ke.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),s=r*e*Math.sin(i.x),this.mode){case Ke.OBLIQ:r*=this.cosph0*t-this.sinph0*e*n;break;case Ke.EQUIT:r*=t;break;case Ke.N_POLE:r*=-(e*n);break;case Ke.S_POLE:r*=e*n;break}var o,l;return o=r*this.cg+s*this.sg,l=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*l,r=o*l,i.x=s*this.a,i.y=r*this.a,i}function w$(i){i.x/=this.a,i.y/=this.a;var t={x:i.x,y:i.y},e,n,s;s=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*s,n=this.pn1*i.y*this.cw*s,i.x=e*this.cg+n*this.sg,i.y=n*this.cg-e*this.sg;var r=hi(i.x,i.y);if(Math.abs(r)<ft)t.x=0,t.y=i.y;else{var o,l;switch(l=1-r*r*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-l*l),this.mode){case Ke.OBLIQ:t.y=Math.asin(o*this.sinph0+i.y*l*this.cosph0/r),i.y=(o-this.sinph0*Math.sin(t.y))*r,i.x*=l*this.cosph0;break;case Ke.EQUIT:t.y=Math.asin(i.y*l/r),i.y=o*r,i.x*=l;break;case Ke.N_POLE:t.y=Math.asin(o),i.y=-i.y;break;case Ke.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(i.x,i.y)}return i.x=t.x+this.long0,i.y=t.y,i}var E$=["Tilted_Perspective","tpers"];const A$={init:S$,forward:T$,inverse:w$,names:E$};function M$(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,t=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function C$(i){var t=i.x,e=i.y,n,s,r,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var l=this.radius_p/hi(this.radius_p*Math.cos(e),Math.sin(e));if(s=l*Math.cos(t)*Math.cos(e),r=l*Math.sin(t)*Math.cos(e),o=l*Math.sin(e),(this.radius_g-s)*s-r*r-o*o*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/hi(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/hi(r,n)))}else this.shape==="sphere"&&(n=Math.cos(e),s=Math.cos(t)*n,r=Math.sin(t)*n,o=Math.sin(e),n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/hi(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/hi(r,n))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function R$(i){var t=-1,e=0,n=0,s,r,o,l;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*hi(1,n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*hi(1,e));var u=n/this.radius_p;if(s=e*e+u*u+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;l=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+l*t,e*=l,n*=l,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+n*n+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;l=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+l*t,e*=l,n*=l,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t)}return i.x=i.x+this.long0,i}var P$=["Geostationary Satellite View","Geostationary_Satellite","geos"];const I$={init:M$,forward:C$,inverse:R$,names:P$};var Xl=1.340264,Yl=-.081106,Kl=893e-6,Zl=.003796,Mf=Math.sqrt(3)/2;function O$(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function N$(i){var t=gt(i.x-this.long0,this.over),e=i.y,n=Math.asin(Mf*Math.sin(e)),s=n*n,r=s*s*s;return i.x=t*Math.cos(n)/(Mf*(Xl+3*Yl*s+r*(7*Kl+9*Zl*s))),i.y=n*(Xl+Yl*s+r*(Kl+Zl*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function D$(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var t=1e-9,e=12,n=i.y,s,r,o,l,u,f;for(f=0;f<e&&(s=n*n,r=s*s*s,o=n*(Xl+Yl*s+r*(Kl+Zl*s))-i.y,l=Xl+3*Yl*s+r*(7*Kl+9*Zl*s),n-=u=o/l,!(Math.abs(u)<t));++f);return s=n*n,r=s*s*s,i.x=Mf*i.x*(Xl+3*Yl*s+r*(7*Kl+9*Zl*s))/Math.cos(n),i.y=Math.asin(Math.sin(n)/Mf),i.x=gt(i.x+this.long0,this.over),i}var L$=["eqearth","Equal Earth","Equal_Earth"];const k$={init:O$,forward:N$,inverse:D$,names:L$};var fc=1e-10;function B$(){var i;if(this.phi1=this.lat1,Math.abs(this.phi1)<fc)throw new Error;this.es?(this.en=Fm(this.es),this.m1=yo(this.phi1,this.am1=Math.sin(this.phi1),i=Math.cos(this.phi1),this.en),this.am1=i/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=F$,this.forward=U$):(Math.abs(this.phi1)+fc>=lt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=V$,this.forward=z$)}function U$(i){var t=gt(i.x-(this.long0||0),this.over),e=i.y,n,s,r;return n=this.am1+this.m1-yo(e,s=Math.sin(e),r=Math.cos(e),this.en),s=r*t/(n*Math.sqrt(1-this.es*s*s)),i.x=n*Math.sin(s),i.y=this.am1-n*Math.cos(s),i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function F$(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,n,s;if(e=hi(i.x,i.y=this.am1-i.y),s=zm(this.am1+this.m1-e,this.es,this.en),(t=Math.abs(s))<lt)t=Math.sin(s),n=e*Math.atan2(i.x,i.y)*Math.sqrt(1-this.es*t*t)/Math.cos(s);else if(Math.abs(t-lt)<=fc)n=0;else throw new Error;return i.x=gt(n+(this.long0||0),this.over),i.y=Qs(s),i}function z$(i){var t=gt(i.x-(this.long0||0),this.over),e=i.y,n,s;return s=this.cphi1+this.phi1-e,Math.abs(s)>fc?(i.x=s*Math.sin(n=t*Math.cos(e)/s),i.y=this.cphi1-s*Math.cos(n)):i.x=i.y=0,i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function V$(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,n=hi(i.x,i.y=this.cphi1-i.y);if(e=this.cphi1+this.phi1-n,Math.abs(e)>lt)throw new Error;return Math.abs(Math.abs(e)-lt)<=fc?t=0:t=n*Math.atan2(i.x,i.y)/Math.cos(e),i.x=gt(t+(this.long0||0),this.over),i.y=Qs(e),i}var j$=["bonne","Bonne (Werner lat_1=90)"];const H$={init:B$,names:j$},BS={OBLIQUE:{forward:X$,inverse:K$},TRANSVERSE:{forward:Y$,inverse:Z$}},Cf={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function $$(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=cA.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);const i=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),t=Gi(i);if(!t)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);t.long0=0,this.obliqueProjection=t;let e;const n=Object.keys(Cf),s=l=>{if(typeof this[l]>"u")return;const u=parseFloat(this[l])*_e;if(isNaN(u))throw new Error("Invalid value for "+l+": "+this[l]);return u};for(let l=0;l<n.length;l++){const u=n[l],f=Cf[u],g=Object.entries(f);if(g.some(([_])=>typeof this[_]<"u")){e=f;for(let _=0;_<g.length;_++){const[v,b]=g[_],x=s(v);if(typeof x>"u")throw new Error("Missing parameter: "+v+".");this[b]=x}break}}if(!e)throw new Error("No valid parameters provided for ob_tran projection.");const{lamp:r,phip:o}=q$(this,e);this.lamp=r,Math.abs(o)>ft?(this.cphip=Math.cos(o),this.sphip=Math.sin(o),this.projectionType=BS.OBLIQUE):this.projectionType=BS.TRANSVERSE}function G$(i){return this.projectionType.forward(this,i)}function W$(i){return this.projectionType.inverse(this,i)}function q$(i,t){let e,n;if(t===Cf.ROTATE){let s=i.oLongC,r=i.oLatC,o=i.oAlpha;if(Math.abs(Math.abs(r)-lt)<=ft)throw new Error("Invalid value for o_lat_c: "+i.o_lat_c+" should be < 90");n=s+Math.atan2(-1*Math.cos(o),-1*Math.sin(o)*Math.sin(r)),e=Math.asin(Math.cos(r)*Math.sin(o))}else if(t===Cf.NEW_POLE)n=i.oLongP,e=i.oLatP;else{let s=i.oLong1,r=i.oLat1,o=i.oLong2,l=i.oLat2,u=Math.abs(r);if(Math.abs(r)>lt-ft)throw new Error("Invalid value for o_lat_1: "+i.o_lat_1+" should be < 90");if(Math.abs(l)>lt-ft)throw new Error("Invalid value for o_lat_2: "+i.o_lat_2+" should be < 90");if(Math.abs(r-l)<ft)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(u<ft)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");n=Math.atan2(Math.cos(r)*Math.sin(l)*Math.cos(s)-Math.sin(r)*Math.cos(l)*Math.cos(o),Math.sin(r)*Math.cos(l)*Math.sin(o)-Math.cos(r)*Math.sin(l)*Math.sin(s)),e=Math.atan(-1*Math.cos(n-s)/Math.tan(r))}return{lamp:n,phip:e}}function X$(i,t){let{x:e,y:n}=t;e+=i.long0;const s=Math.cos(e),r=Math.sin(n),o=Math.cos(n);t.x=gt(Math.atan2(o*Math.sin(e),i.sphip*o*s+i.cphip*r)+i.lamp),t.y=Math.asin(i.sphip*r-i.cphip*o*s);const l=i.obliqueProjection.forward(t);return i.isIdentity&&(l.x*=fi,l.y*=fi),l}function Y$(i,t){let{x:e,y:n}=t;e+=i.long0;const s=Math.cos(n),r=Math.cos(e);t.x=gt(Math.atan2(s*Math.sin(e),Math.sin(n))+i.lamp),t.y=Math.asin(-1*s*r);const o=i.obliqueProjection.forward(t);return i.isIdentity&&(o.x*=fi,o.y*=fi),o}function K$(i,t){i.isIdentity&&(t.x*=_e,t.y*=_e);const e=i.obliqueProjection.inverse(t);let{x:n,y:s}=e;if(n<Number.MAX_VALUE){n-=i.lamp;const r=Math.cos(n),o=Math.sin(s),l=Math.cos(s);t.x=Math.atan2(l*Math.sin(n),i.sphip*l*r-i.cphip*o),t.y=Math.asin(i.sphip*o+i.cphip*l*r)}return t.x=gt(t.x+i.long0),t}function Z$(i,t){i.isIdentity&&(t.x*=_e,t.y*=_e);const e=i.obliqueProjection.inverse(t);let{x:n,y:s}=e;if(n<Number.MAX_VALUE){const r=Math.cos(s);n-=i.lamp,t.x=Math.atan2(r*Math.sin(n),-1*Math.sin(s)),t.y=Math.asin(r*Math.cos(n))}return t.x=gt(t.x+i.long0),t}var Q$=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"];const J$={init:$$,forward:G$,inverse:W$,names:Q$};function tG(i){i.Proj.projections.add(Xh),i.Proj.projections.add(Yh),i.Proj.projections.add(jV),i.Proj.projections.add(ZV),i.Proj.projections.add(ij),i.Proj.projections.add(oj),i.Proj.projections.add(dj),i.Proj.projections.add(yj),i.Proj.projections.add(Tj),i.Proj.projections.add(Cj),i.Proj.projections.add(Vj),i.Proj.projections.add(qj),i.Proj.projections.add(Qj),i.Proj.projections.add(sH),i.Proj.projections.add(cH),i.Proj.projections.add(gH),i.Proj.projections.add(vH),i.Proj.projections.add(wH),i.Proj.projections.add(PH),i.Proj.projections.add(LH),i.Proj.projections.add(zH),i.Proj.projections.add(GH),i.Proj.projections.add(QH),i.Proj.projections.add(n$),i.Proj.projections.add(l$),i.Proj.projections.add(_$),i.Proj.projections.add(x$),i.Proj.projections.add(A$),i.Proj.projections.add(I$),i.Proj.projections.add(k$),i.Proj.projections.add(H$),i.Proj.projections.add(J$)}const Ks=Object.assign(rV,{defaultDatum:"WGS84",Proj:Gi,WGS84:new Gi("WGS84"),Point:co,toPoint:pA,defs:je,nadgrid:Vz,transform:wf,mgrs:aV,version:"__VERSION__"});tG(Ks);const eG={MERIT:{a:6378137},SGS85:{a:6378136},GRS80:{a:6378137},IAU76:{a:6378140},airy:{a:6377563396e-3,b:635625691e-2},APL4:{a:6378137},NWL9D:{a:6378145},mod_airy:{a:6377340189e-3,b:6356034446e-3},andrae:{a:637710443e-2},aust_SA:{a:6378160},GRS67:{a:6378160},bessel:{a:6377397155e-3},bess_nam:{a:6377483865e-3},clrk66:{a:63782064e-1,b:63565838e-1},clrk80:{a:6378249145e-3},clrk80ign:{a:63782492e-1,b:6356515},clrk58:{a:6378293645208759e-9},CPM:{a:63757387e-1},delmbr:{a:6376428},engelis:{a:637813605e-2},evrst30:{a:6377276345e-3},evrst48:{a:6377304063e-3},evrst56:{a:6377301243e-3},evrst69:{a:6377295664e-3},evrstSS:{a:6377298556e-3},fschr60:{a:6378166},fschr60m:{a:6378155},fschr68:{a:6378150},helmert:{a:6378200},hough:{a:6378270},intl:{a:6378388},kaula:{a:6378163},lerch:{a:6378139},mprts:{a:6397300},new_intl:{a:63781575e-1,b:63567722e-1},plessis:{a:6376523},krass:{a:6378245},SEasia:{a:6378155,b:63567733205e-4},walbeck:{a:6376896,b:63558348467e-4},WGS60:{a:6378165},WGS66:{a:6378145},WGS7:{a:6378135},WGS84:{a:6378137},sphere:{a:6370997,b:6370997}};function iG(i){if(nG(i))throw new Error("Cannot invert degenerate transform");const t=1/MA(i),[e,n,s,r,o,l]=i,u=o*t,f=-n*t,g=-r*t,p=e*t;return[u,f,-s*u-l*f,g,p,-s*g-l*p]}function nG(i){return MA(i)===0}function MA(i){const[t,e,n,s,r,o]=i;return t*r-e*s}function US(i,t,e){const[n,s,r,o,l,u]=e;return[n*i+s*t+r,o*i+l*t+u]}function sG(i){const t=iG(i);return{forwardTransform:(e,n)=>US(e,n,i),inverseTransform:(e,n)=>US(e,n,t)}}function rG(i){const t=i.getOrigin(),e=i.getResolution(),s=i.getFileDirectory().ModelTransformation;let r=0,o=0;return s&&s.length>=16&&(r=s[1],o=s[4]),[e[0],r,t[0],o,e[1],t[1]]}const CA=28e-5;async function aG(i,t){const e=await i.getImage();if(!e.isTiled)throw new Error("COG TileMatrixSet requires a tiled GeoTIFF");const n=await i.getImageCount(),s=e.getBoundingBox(),r=e.getWidth(),o=e.getHeight(),l=await t(e.getGeoKeys());if(l===null)throw new Error("Could not determine coordinate reference system from GeoTIFF geo keys");const u=Ks(l.def,"EPSG:4326").forward,f=Ks(l.def,"EPSG:3857").forward,g={lowerLeft:[s[0],s[1]],upperRight:[s[2],s[3]]},p=rG(e);if(p[1]!==0||p[3]!==0)throw new Error("COG TileMatrixSet with rotation/skewed geotransform is not supported");const _=Math.abs(p[0]),v=e.getTileWidth(),b=e.getTileHeight(),x=[{id:String(n-1),scaleDenominator:_*RA(l.parsed,l.coordinatesUnits)/CA,cellSize:_,pointOfOrigin:[p[2],p[5]],tileWidth:e.getTileWidth(),tileHeight:e.getTileHeight(),matrixWidth:Math.ceil(r/v),matrixHeight:Math.ceil(o/b),geotransform:p}];for(let T=1;T<n;T++){const w=await i.getImage(T);if(!w.isTiled)throw new Error("COG TileMatrixSet requires a tiled GeoTIFF");const M=oG({id:String(n-1-T),image:w,fullWidth:r,baseTransform:p,crs:l});x.push(M)}return x.reverse(),{crs:l,boundingBox:g,wgsBounds:lG(g,u),tileMatrices:x,projectToWgs84:u,projectTo3857:f}}function RA(i,t){const e=(t||i.units)?.toLowerCase();switch(e){case"m":case"metre":case"meter":case"meters":return 1;case"foot":return .3048;case"us survey foot":return 1200/3937}if(e==="degree"){const{a:n}=eG[i.ellps];return 2*Math.PI*n/360}throw new Error(`Unsupported CRS units: ${e}`)}function oG({id:i,image:t,fullWidth:e,baseTransform:n,crs:s}){const r=t.getWidth(),o=t.getHeight(),u=e/r,f=[n[0]*u,n[1]*u,n[2],n[3]*u,n[4]*u,n[5]],g=Math.abs(f[0]),p=t.getTileWidth(),_=t.getTileHeight();return{id:i,scaleDenominator:g*RA(s.parsed,s.coordinatesUnits)/CA,cellSize:g,pointOfOrigin:[f[2],f[5]],tileWidth:p,tileHeight:_,matrixWidth:Math.ceil(r/p),matrixHeight:Math.ceil(o/_),geotransform:f}}function lG(i,t){const e=t(i.lowerLeft),n=t([i.upperRight[0],i.lowerLeft[1]]),s=t(i.upperRight),r=t([i.lowerLeft[0],i.upperRight[1]]),o=Math.min(e[0],n[0],s[0],r[0]),l=Math.max(e[0],n[0],s[0],r[0]),u=Math.min(e[1],n[1],s[1],r[1]),f=Math.max(e[1],n[1],s[1],r[1]);return{lowerLeft:[o,u],upperRight:[l,f]}}function Ge(i){return(t,...e)=>cG(i,t,e)}function vo(i,t){return Ge(PA(i,t).get)}const{apply:cG,getOwnPropertyDescriptor:PA,getPrototypeOf:Wm,ownKeys:uG}=Reflect,{iterator:Cc,toStringTag:hG}=Symbol,fG=Object,{create:qm,defineProperty:dG}=fG,gG=Array,pG=gG.prototype,IA=pG[Cc],_G=Ge(IA),OA=ArrayBuffer,mG=OA.prototype;vo(mG,"byteLength");const FS=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;FS&&vo(FS.prototype,"byteLength");const NA=Wm(Uint8Array);NA.from;const ii=NA.prototype;ii[Cc];Ge(ii.keys);Ge(ii.values);Ge(ii.entries);Ge(ii.set);Ge(ii.reverse);Ge(ii.fill);Ge(ii.copyWithin);Ge(ii.sort);Ge(ii.slice);Ge(ii.subarray);vo(ii,"buffer");vo(ii,"byteOffset");vo(ii,"length");vo(ii,hG);const yG=Uint8Array,DA=Uint16Array,Xm=Uint32Array,vG=Float32Array,dc=Wm([][Cc]()),LA=Ge(dc.next),bG=Ge((function*(){})().next),xG=Wm(dc),SG=DataView.prototype,TG=Ge(SG.getUint16),Ym=WeakMap,kA=Ym.prototype,BA=Ge(kA.get),wG=Ge(kA.set),UA=new Ym,EG=qm(null,{next:{value:function(){const t=BA(UA,this);return LA(t)}},[Cc]:{value:function(){return this}}});function AG(i){if(i[Cc]===IA&&dc.next===LA)return i;const t=qm(EG);return wG(UA,t,_G(i)),t}const MG=new Ym,CG=qm(xG,{next:{value:function(){const t=BA(MG,this);return bG(t)},writable:!0,configurable:!0}});for(const i of uG(dc))i!=="next"&&dG(CG,i,PA(dc,i));const FA=new OA(4),RG=new vG(FA),PG=new Xm(FA),gn=new DA(512),pn=new yG(512);for(let i=0;i<256;++i){const t=i-127;t<-24?(gn[i]=0,gn[i|256]=32768,pn[i]=24,pn[i|256]=24):t<-14?(gn[i]=1024>>-t-14,gn[i|256]=1024>>-t-14|32768,pn[i]=-t-1,pn[i|256]=-t-1):t<=15?(gn[i]=t+15<<10,gn[i|256]=t+15<<10|32768,pn[i]=13,pn[i|256]=13):t<128?(gn[i]=31744,gn[i|256]=64512,pn[i]=24,pn[i|256]=24):(gn[i]=31744,gn[i|256]=64512,pn[i]=13,pn[i|256]=13)}const Km=new Xm(2048);for(let i=1;i<1024;++i){let t=i<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,Km[i]=t|e}for(let i=1024;i<2048;++i)Km[i]=939524096+(i-1024<<13);const bo=new Xm(64);for(let i=1;i<31;++i)bo[i]=i<<23;bo[31]=1199570944;bo[32]=2147483648;for(let i=33;i<63;++i)bo[i]=2147483648+(i-32<<23);bo[63]=3347054592;const zA=new DA(64);for(let i=1;i<64;++i)i!==32&&(zA[i]=1024);function IG(i){const t=i>>10;return PG[0]=Km[zA[t]+(i&1023)]+bo[t],RG[0]}function VA(i,t,...e){return IG(TG(i,t,...AG(e)))}var wh={exports:{}},zS;function OG(){if(zS)return wh.exports;zS=1;function i(t,e,n){const s=n&&n.debug||!1;s&&console.log("[xml-utils] getting "+e+" in "+t);const r=typeof t=="object"?t.outer:t,o=r.slice(0,r.indexOf(">")+1),l=['"',"'"];for(let u=0;u<l.length;u++){const f=l[u],g=e+"\\="+f+"([^"+f+"]*)"+f;s&&console.log("[xml-utils] pattern:",g);const _=new RegExp(g).exec(o);if(s&&console.log("[xml-utils] match:",_),_)return _[1]}}return wh.exports=i,wh.exports.default=i,wh.exports}var NG=OG();const g0=v_(NG);var Eh={exports:{}},Ah={exports:{}},Mh={exports:{}},VS;function DG(){if(VS)return Mh.exports;VS=1;function i(t,e,n){const r=new RegExp(e).exec(t.slice(n));return r?n+r.index:-1}return Mh.exports=i,Mh.exports.default=i,Mh.exports}var Ch={exports:{}},jS;function LG(){if(jS)return Ch.exports;jS=1;function i(t,e,n){const r=new RegExp(e).exec(t.slice(n));return r?n+r.index+r[0].length-1:-1}return Ch.exports=i,Ch.exports.default=i,Ch.exports}var Rh={exports:{}},HS;function kG(){if(HS)return Rh.exports;HS=1;function i(t,e){const n=new RegExp(e,"g"),s=t.match(n);return s?s.length:0}return Rh.exports=i,Rh.exports.default=i,Rh.exports}var $S;function BG(){if($S)return Ah.exports;$S=1;const i=DG(),t=LG(),e=kG();function n(s,r,o){const l=o&&o.debug||!1,u=!(o&&typeof o.nested===!1),f=o&&o.startIndex||0;l&&console.log("[xml-utils] starting findTagByName with",r," and ",o);const g=i(s,`<${r}[ 
>/]`,f);if(l&&console.log("[xml-utils] start:",g),g===-1)return;const p=s.slice(g+r.length);let _=t(p,"^[^<]*[ /]>",0);const v=_!==-1&&p[_-1]==="/";if(l&&console.log("[xml-utils] selfClosing:",v),v===!1)if(u){let w=0,M=1,E=0;for(;(_=t(p,"[ /]"+r+">",w))!==-1;){const P=p.substring(w,_+1);if(M+=e(P,"<"+r+`[ 
	>]`),E+=e(P,"</"+r+">"),E>=M)break;w=_}}else _=t(p,"[ /]"+r+">",0);const b=g+r.length+_+1;if(l&&console.log("[xml-utils] end:",b),b===-1)return;const x=s.slice(g,b);let T;return v?T=null:T=x.slice(x.indexOf(">")+1,x.lastIndexOf("<")),{inner:T,outer:x,start:g,end:b}}return Ah.exports=n,Ah.exports.default=n,Ah.exports}var GS;function UG(){if(GS)return Eh.exports;GS=1;const i=BG();function t(e,n,s){const r=[],o=s&&s.debug||!1,l=s&&typeof s.nested=="boolean"?s.nested:!0;let u=s&&s.startIndex||0,f;for(;f=i(e,n,{debug:o,startIndex:u});)l?u=f.start+1+n.length:u=f.end,r.push(f);return o&&console.log("findTagsByName found",r.length,"tags"),r}return Eh.exports=t,Eh.exports.default=t,Eh.exports}var FG=UG();const zG=v_(FG),Ql={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},mn={};for(const i in Ql)Ql.hasOwnProperty(i)&&(mn[Ql[i]]=parseInt(i,10));const VG=[mn.BitsPerSample,mn.ExtraSamples,mn.SampleFormat,mn.StripByteCounts,mn.StripOffsets,mn.StripRowCounts,mn.TileByteCounts,mn.TileOffsets,mn.SubIFDs],p0={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Dt={};for(const i in p0)p0.hasOwnProperty(i)&&(Dt[p0[i]]=parseInt(i,10));const Mi={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},jG={Unspecified:0},cX={AddCompression:1},uX={None:0,Deflate:1,Zstandard:2},HG={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function $G(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let o=0,l=0;o<i.length;++o,l+=3)r=256-i[o]/t*256,s[l]=r,s[l+1]=r,s[l+2]=r;return s}function GG(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let o=0,l=0;o<i.length;++o,l+=3)r=i[o]/t*256,s[l]=r,s[l+1]=r,s[l+2]=r;return s}function WG(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3),r=t.length/3,o=t.length/3*2;for(let l=0,u=0;l<i.length;++l,u+=3){const f=i[l];s[u]=t[f]/65536*256,s[u+1]=t[f+r]/65536*256,s[u+2]=t[f+o]/65536*256}return s}function qG(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=4,r+=3){const o=i[s],l=i[s+1],u=i[s+2],f=i[s+3];n[r]=255*((255-o)/256)*((255-f)/256),n[r+1]=255*((255-l)/256)*((255-f)/256),n[r+2]=255*((255-u)/256)*((255-f)/256)}return n}function XG(i){const{width:t,height:e}=i,n=new Uint8ClampedArray(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s],l=i[s+1],u=i[s+2];n[r]=o+1.402*(u-128),n[r+1]=o-.34414*(l-128)-.71414*(u-128),n[r+2]=o+1.772*(l-128)}return n}const YG=.95047,KG=1,ZG=1.08883;function QG(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s+0],l=i[s+1]<<24>>24,u=i[s+2]<<24>>24;let f=(o+16)/116,g=l/500+f,p=f-u/200,_,v,b;g=YG*(g*g*g>.008856?g*g*g:(g-16/116)/7.787),f=KG*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),p=ZG*(p*p*p>.008856?p*p*p:(p-16/116)/7.787),_=g*3.2406+f*-1.5372+p*-.4986,v=g*-.9689+f*1.8758+p*.0415,b=g*.0557+f*-.204+p*1.057,_=_>.0031308?1.055*_**(1/2.4)-.055:12.92*_,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,n[r]=Math.max(0,Math.min(1,_))*255,n[r+1]=Math.max(0,Math.min(1,v))*255,n[r+2]=Math.max(0,Math.min(1,b))*255}return n}const jA=new Map;function Js(i,t){Array.isArray(i)||(i=[i]),i.forEach(e=>jA.set(e,t))}async function HA(i){const t=jA.get(i.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${i.Compression}`);const e=await t();return new e(i)}Js([void 0,1],()=>sn(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1])).then(i=>i.default));Js(5,()=>sn(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1])).then(i=>i.default));Js(6,()=>{throw new Error("old style JPEG compression is not supported.")});Js(7,()=>sn(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1])).then(i=>i.default));Js([8,32946],()=>sn(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1])).then(i=>i.default));Js(32773,()=>sn(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1])).then(i=>i.default));Js(34887,()=>sn(()=>import("./lerc-Cpiq9mOA.js"),__vite__mapDeps([7,5,1])).then(async i=>(await i.zstd.init(),i)).then(i=>i.default));Js(50001,()=>sn(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([8,1])).then(i=>i.default));function jf(i,t,e,n=1){return new(Object.getPrototypeOf(i)).constructor(t*e*n)}function JG(i,t,e,n,s){const r=t/n,o=e/s;return i.map(l=>{const u=jf(l,n,s);for(let f=0;f<s;++f){const g=Math.min(Math.round(o*f),e-1);for(let p=0;p<n;++p){const _=Math.min(Math.round(r*p),t-1),v=l[g*t+_];u[f*n+p]=v}}return u})}function io(i,t,e){return(1-e)*i+e*t}function tW(i,t,e,n,s){const r=t/n,o=e/s;return i.map(l=>{const u=jf(l,n,s);for(let f=0;f<s;++f){const g=o*f,p=Math.floor(g),_=Math.min(Math.ceil(g),e-1);for(let v=0;v<n;++v){const b=r*v,x=b%1,T=Math.floor(b),w=Math.min(Math.ceil(b),t-1),M=l[p*t+T],E=l[p*t+w],P=l[_*t+T],k=l[_*t+w],U=io(io(M,E,x),io(P,k,x),g%1);u[f*n+v]=U}}return u})}function eW(i,t,e,n,s,r="nearest"){switch(r.toLowerCase()){case"nearest":return JG(i,t,e,n,s);case"bilinear":case"linear":return tW(i,t,e,n,s);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function iW(i,t,e,n,s,r){const o=t/n,l=e/s,u=jf(i,n,s,r);for(let f=0;f<s;++f){const g=Math.min(Math.round(l*f),e-1);for(let p=0;p<n;++p){const _=Math.min(Math.round(o*p),t-1);for(let v=0;v<r;++v){const b=i[g*t*r+_*r+v];u[f*n*r+p*r+v]=b}}}return u}function nW(i,t,e,n,s,r){const o=t/n,l=e/s,u=jf(i,n,s,r);for(let f=0;f<s;++f){const g=l*f,p=Math.floor(g),_=Math.min(Math.ceil(g),e-1);for(let v=0;v<n;++v){const b=o*v,x=b%1,T=Math.floor(b),w=Math.min(Math.ceil(b),t-1);for(let M=0;M<r;++M){const E=i[p*t*r+T*r+M],P=i[p*t*r+w*r+M],k=i[_*t*r+T*r+M],U=i[_*t*r+w*r+M],Y=io(io(E,P,x),io(k,U,x),g%1);u[f*n*r+v*r+M]=Y}}}return u}function sW(i,t,e,n,s,r,o="nearest"){switch(o.toLowerCase()){case"nearest":return iW(i,t,e,n,s,r);case"bilinear":case"linear":return nW(i,t,e,n,s,r);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function rW(i,t,e){let n=0;for(let s=t;s<e;++s)n+=i[s];return n}function g_(i,t,e){switch(i){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function aW(i,t){return(i===1||i===2)&&t<=32&&t%8===0?!1:!(i===3&&(t===16||t===32||t===64))}function oW(i,t,e,n,s,r,o){const l=new DataView(i),u=e===2?o*r:o*r*n,f=e===2?1:n,g=g_(t,s,u),p=parseInt("1".repeat(s),2);if(t===1){let _;e===1?_=n*s:_=s;let v=r*_;(v&7)!==0&&(v=v+7&-8);for(let b=0;b<o;++b){const x=b*v;for(let T=0;T<r;++T){const w=x+T*f*s;for(let M=0;M<f;++M){const E=w+M*s,P=(b*r+T)*f+M,k=Math.floor(E/8),U=E%8;if(U+s<=8)g[P]=l.getUint8(k)>>8-s-U&p;else if(U+s<=16)g[P]=l.getUint16(k)>>16-s-U&p;else if(U+s<=24){const Y=l.getUint16(k)<<8|l.getUint8(k+2);g[P]=Y>>24-s-U&p}else g[P]=l.getUint32(k)>>32-s-U&p}}}}return g.buffer}class lW{constructor(t,e,n,s,r,o){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=s,this.tiles=r?{}:null,this.isTiled=!t.StripOffsets;const l=t.PlanarConfiguration;if(this.planarConfiguration=typeof l>"u"?1:l,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,r){return VA(this,s,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),s=this.getBitsPerSample(t);return g_(n,s,e)}async getTileOrStrip(t,e,n,s,r){const o=Math.ceil(this.getWidth()/this.getTileWidth()),l=Math.ceil(this.getHeight()/this.getTileHeight());let u;const{tiles:f}=this;this.planarConfiguration===1?u=e*o+t:this.planarConfiguration===2&&(u=n*o*l+e*o+t);let g,p;this.isTiled?(g=this.fileDirectory.TileOffsets[u],p=this.fileDirectory.TileByteCounts[u]):(g=this.fileDirectory.StripOffsets[u],p=this.fileDirectory.StripByteCounts[u]);const _=(await this.source.fetch([{offset:g,length:p}],r))[0];let v;return f===null||!f[u]?(v=(async()=>{let b=await s.decode(this.fileDirectory,_);const x=this.getSampleFormat(),T=this.getBitsPerSample();return aW(x,T)&&(b=oW(b,x,this.planarConfiguration,this.getSamplesPerPixel(),T,this.getTileWidth(),this.getBlockHeight(e))),b})(),f!==null&&(f[u]=v)):v=f[u],{x:t,y:e,sample:n,data:await v}}async _readRaster(t,e,n,s,r,o,l,u,f){const g=this.getTileWidth(),p=this.getTileHeight(),_=this.getWidth(),v=this.getHeight(),b=Math.max(Math.floor(t[0]/g),0),x=Math.min(Math.ceil(t[2]/g),Math.ceil(_/g)),T=Math.max(Math.floor(t[1]/p),0),w=Math.min(Math.ceil(t[3]/p),Math.ceil(v/p)),M=t[2]-t[0];let E=this.getBytesPerPixel();const P=[],k=[];for(let et=0;et<e.length;++et)this.planarConfiguration===1?P.push(rW(this.fileDirectory.BitsPerSample,0,e[et])/8):P.push(0),k.push(this.getReaderForSample(e[et]));const U=[],{littleEndian:Y}=this;for(let et=T;et<w;++et)for(let K=b;K<x;++K){let ut;this.planarConfiguration===1&&(ut=this.getTileOrStrip(K,et,0,r,f));for(let ht=0;ht<e.length;++ht){const _t=ht,St=e[ht];this.planarConfiguration===2&&(E=this.getSampleByteSize(St),ut=this.getTileOrStrip(K,et,St,r,f));const pt=ut.then(It=>{const C=It.data,N=new DataView(C),D=this.getBlockHeight(It.y),Q=It.y*p,J=It.x*g,I=Q+D,B=(It.x+1)*g,Z=k[_t],at=Math.min(D,D-(I-t[3]),v-Q),ct=Math.min(g,g-(B-t[2]),_-J);for(let mt=Math.max(0,t[1]-Q);mt<at;++mt)for(let xt=Math.max(0,t[0]-J);xt<ct;++xt){const Mt=(mt*g+xt)*E,Ot=Z.call(N,Mt+P[_t],Y);let kt;s?(kt=(mt+Q-t[1])*M*e.length+(xt+J-t[0])*e.length+_t,n[kt]=Ot):(kt=(mt+Q-t[1])*M+xt+J-t[0],n[_t][kt]=Ot)}});U.push(pt)}}if(await Promise.all(U),o&&t[2]-t[0]!==o||l&&t[3]-t[1]!==l){let et;return s?et=sW(n,t[2]-t[0],t[3]-t[1],o,l,e.length,u):et=eW(n,t[2]-t[0],t[3]-t[1],o,l,u),et.width=o,et.height=l,et}return n.width=o||t[2]-t[0],n.height=l||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:s=null,width:r,height:o,resampleMethod:l,fillValue:u,signal:f}={}){const g=t||[0,0,this.getWidth(),this.getHeight()];if(g[0]>g[2]||g[1]>g[3])throw new Error("Invalid subsets");const p=g[2]-g[0],_=g[3]-g[1],v=p*_,b=this.getSamplesPerPixel();if(!e||!e.length)for(let M=0;M<b;++M)e.push(M);else for(let M=0;M<e.length;++M)if(e[M]>=b)return Promise.reject(new RangeError(`Invalid sample index '${e[M]}'.`));let x;if(n){const M=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample);x=g_(M,E,v*e.length),u&&x.fill(u)}else{x=[];for(let M=0;M<e.length;++M){const E=this.getArrayForSample(e[M],v);Array.isArray(u)&&M<u.length?E.fill(u[M]):u&&!Array.isArray(u)&&E.fill(u),x.push(E)}}const T=s||await HA(this.fileDirectory);return await this._readRaster(g,e,x,n,T,r,o,l,f)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:s,height:r,resampleMethod:o,enableAlpha:l=!1,signal:u}={}){const f=t||[0,0,this.getWidth(),this.getHeight()];if(f[0]>f[2]||f[1]>f[3])throw new Error("Invalid subsets");const g=this.fileDirectory.PhotometricInterpretation;if(g===Mi.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==jG.Unspecified&&l){w=[];for(let M=0;M<this.fileDirectory.BitsPerSample.length;M+=1)w.push(M)}return this.readRasters({window:t,interleave:e,samples:w,pool:n,width:s,height:r,resampleMethod:o,signal:u})}let p;switch(g){case Mi.WhiteIsZero:case Mi.BlackIsZero:case Mi.Palette:p=[0];break;case Mi.CMYK:p=[0,1,2,3];break;case Mi.YCbCr:case Mi.CIELab:p=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const _={window:f,interleave:!0,samples:p,pool:n,width:s,height:r,resampleMethod:o,signal:u},{fileDirectory:v}=this,b=await this.readRasters(_),x=2**this.fileDirectory.BitsPerSample[0];let T;switch(g){case Mi.WhiteIsZero:T=$G(b,x);break;case Mi.BlackIsZero:T=GG(b,x);break;case Mi.Palette:T=WG(b,v.ColorMap);break;case Mi.CMYK:T=qG(b);break;case Mi.YCbCr:T=XG(b);break;case Mi.CIELab:T=QG(b);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const w=new Uint8Array(T.length/3),M=new Uint8Array(T.length/3),E=new Uint8Array(T.length/3);for(let P=0,k=0;P<T.length;P+=3,++k)w[k]=T[P],M[k]=T[P+1],E[k]=T[P+2];T=[w,M,E]}return T.width=b.width,T.height=b.height,T}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=zG(n,"Item");t===null?s=s.filter(r=>g0(r,"sample")===void 0):s=s.filter(r=>Number(g0(r,"sample"))===t);for(let r=0;r<s.length;++r){const o=s[r];e[g0(o,"name")]=o.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(t){const[s,r,o]=t.getResolution();return[s*t.getWidth()/this.getWidth(),r*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(t=!1){const e=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!t){const[s,r,o,l,u,f,g,p]=this.fileDirectory.ModelTransformation,v=[[0,0],[0,e],[n,0],[n,e]].map(([T,w])=>[l+s*T+r*w,p+u*T+f*w]),b=v.map(T=>T[0]),x=v.map(T=>T[1]);return[Math.min(...b),Math.min(...x),Math.max(...b),Math.max(...x)]}else{const s=this.getOrigin(),r=this.getResolution(),o=s[0],l=s[1],u=o+r[0]*n,f=l+r[1]*e;return[Math.min(o,u),Math.min(l,f),Math.max(o,u),Math.max(l,f)]}}}class cW{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),s=this.getUint32(t+4,e);let r;if(e){if(r=n+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*n+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(t,e){let n=0;const s=(this._dataView.getUint8(t+(e?7:0))&128)>0;let r=!0;for(let o=0;o<8;o++){let l=this._dataView.getUint8(t+(e?o:7-o));s&&(r?l!==0&&(l=~(l-1)&255,r=!1):l=~l&255),n+=l*256**o}return s&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return VA(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class uW{constructor(t,e,n,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*e+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let s=!0;for(let r=0;r<8;r++){let o=this._dataView.getUint8(t+(this._littleEndian?r:7-r));n&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),e+=o*256**r}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const hW=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class fW{constructor(t=hW,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(n=>{sn(()=>import("./decoder-tqM1uIvc.js"),[]).then(s=>{n(s.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<t;s++)this.workers.push({worker:n(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?HA(t).then(n=>n.decode(t,e)):new Promise(n=>{const s=this.workers.find(l=>l.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const r=this.messageId++,o=l=>{l.data.id===r&&(s.idle=!0,n(l.data.decoded),s.worker.removeEventListener("message",o))};s.worker.addEventListener("message",o),s.worker.postMessage({fileDirectory:t,buffer:e,id:r},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const WS=`\r
\r
`;function $A(i){if(typeof Object.fromEntries<"u")return Object.fromEntries(i);const t={};for(const[e,n]of i)t[e.toLowerCase()]=n;return t}function dW(i){const t=i.split(`\r
`).map(e=>{const n=e.split(":").map(s=>s.trim());return n[0]=n[0].toLowerCase(),n});return $A(t)}function gW(i){const[t,...e]=i.split(";").map(s=>s.trim()),n=e.map(s=>s.split("="));return{type:t,params:$A(n)}}function p_(i){let t,e,n;return i&&([,t,e,n]=i.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function pW(i,t){let e=null;const n=new TextDecoder("ascii"),s=[],r=`--${t}`,o=`${r}--`;for(let l=0;l<10;++l)n.decode(new Uint8Array(i,l,r.length))===r&&(e=l);if(e===null)throw new Error("Could not find initial boundary");for(;e<i.byteLength;){const l=n.decode(new Uint8Array(i,e,Math.min(r.length+1024,i.byteLength-e)));if(l.length===0||l.startsWith(o))break;if(!l.startsWith(r))throw new Error("Part does not start with boundary");const u=l.substr(r.length+2);if(u.length===0)break;const f=u.indexOf(WS),g=dW(u.substr(0,f)),{start:p,end:_,total:v}=p_(g["content-range"]),b=e+r.length+f+WS.length,x=parseInt(_,10)+1-parseInt(p,10);s.push({headers:g,data:i.slice(b,b+x),offset:p,length:x,fileSize:v}),e=b+x+4}return s}class Hf{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class _W extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield t)}for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const s=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:s}):this._set(t,{value:e,expiry:s}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,s]of this.entriesAscending())t.call(e,s,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function mW(i){return new Promise(t=>setTimeout(t,i))}function yW(i,t){const e=Array.isArray(i)?i:Array.from(i),n=Array.isArray(t)?t:Array.from(t);return e.map((s,r)=>[s,n[r]])}class zr extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,zr),this.name="AbortError"}}class vW extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const bW=vW;class xW{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class qS{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class SW extends Hf{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new _W({maxSize:n,onEviction:(s,r)=>{this.evictedBlocks.set(s,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=[],s=[],r=[];this.evictedBlocks.clear();for(const{offset:_,length:v}of t){let b=_+v;const{fileSize:x}=this;x!==null&&(b=Math.min(b,x));const T=Math.floor(_/this.blockSize)*this.blockSize;for(let w=T;w<b;w+=this.blockSize){const M=Math.floor(w/this.blockSize);!this.blockCache.has(M)&&!this.blockRequests.has(M)&&(this.blockIdsToFetch.add(M),s.push(M)),this.blockRequests.has(M)&&n.push(this.blockRequests.get(M)),r.push(M)}}await mW(),this.fetchBlocks(e);const o=[];for(const _ of s)this.blockRequests.has(_)&&o.push(this.blockRequests.get(_));await Promise.allSettled(n),await Promise.allSettled(o);const l=[],u=r.filter(_=>this.abortedBlockIds.has(_)||!this.blockCache.has(_));if(u.forEach(_=>this.blockIdsToFetch.add(_)),u.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const _ of u){const v=this.blockRequests.get(_);if(!v)throw new Error(`Block ${_} is not in the block requests`);l.push(v)}await Promise.allSettled(l)}if(e&&e.aborted)throw new zr("Request was aborted");const f=r.map(_=>this.blockCache.get(_)||this.evictedBlocks.get(_)),g=f.filter(_=>!_);if(g.length)throw new bW(g,"Request failed");const p=new Map(yW(r,f));return this.readSliceData(t,p)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let s=0;s<e.length;++s){const r=e[s];for(const o of r.blockIds)this.blockRequests.set(o,(async()=>{try{const l=(await n)[s],u=o*this.blockSize,f=u-l.offset,g=Math.min(f+this.blockSize,l.data.byteLength),p=l.data.slice(f,g),_=new xW(u,p.byteLength,p,o);this.blockCache.set(o,_),this.abortedBlockIds.delete(o)}catch(l){if(l.name==="AbortError")l.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw l}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((o,l)=>o-l);if(e.length===0)return[];let n=[],s=null;const r=[];for(const o of e)s===null||s+1===o?(n.push(o),s=o):(r.push(new qS(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],s=o);return r.push(new qS(n[0]*this.blockSize,n.length*this.blockSize,n)),r}readSliceData(t,e){return t.map(n=>{let s=n.offset+n.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const r=Math.floor(n.offset/this.blockSize),o=Math.floor(s/this.blockSize),l=new ArrayBuffer(n.length),u=new Uint8Array(l);for(let f=r;f<=o;++f){const g=e.get(f),p=g.offset-n.offset,_=g.top-s;let v=0,b=0,x;p<0?v=-p:p>0&&(b=p),_<0?x=g.length-v:x=s-g.offset-v;const T=new Uint8Array(g.data,v,x);u.set(T,b)}return l})}}class Zm{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class $f{constructor(t){this.url=t}async request({headers:t,signal:e}={}){throw new Error("request is not implemented")}}class TW extends Zm{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class wW extends $f{constructor(t,e){super(t),this.credentials=e}async request({headers:t,signal:e}={}){const n=await fetch(this.url,{headers:t,credentials:this.credentials,signal:e});return new TW(n)}}class EW extends Zm{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class AW extends $f{constructRequest(t,e){return new Promise((n,s)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[o,l]of Object.entries(t))r.setRequestHeader(o,l);r.onload=()=>{const o=r.response;n(new EW(r,o))},r.onerror=s,r.onabort=()=>s(new zr("Request aborted")),r.send(),e&&(e.aborted&&r.abort(),e.addEventListener("abort",()=>r.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class MW extends Zm{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class CW extends $f{constructor(t){super(t),this.parsedUrl=vp.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",vp)}constructRequest(t,e){return new Promise((n,s)=>{const r=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const l=new Promise(u=>{const f=[];o.on("data",g=>{f.push(g)}),o.on("end",()=>{const g=Buffer.concat(f).buffer;u(g)}),o.on("error",s)});n(new MW(o,l))});r.on("error",s),e&&(e.aborted&&r.destroy(new zr("Request aborted")),e.addEventListener("abort",()=>r.destroy(new zr("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class Gf extends Hf{constructor(t,e,n,s){super(),this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=s,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:s,length:r})=>`${s}-${s+r}`).join(",")}`},signal:e});if(n.ok)if(n.status===206){const{type:s,params:r}=gW(n.getHeader("content-type"));if(s==="multipart/byteranges"){const p=pW(await n.getData(),r.boundary);return this._fileSize=p[0].fileSize||null,p}const o=await n.getData(),{start:l,end:u,total:f}=p_(n.getHeader("content-range"));this._fileSize=f||null;const g=[{data:o,offset:l,length:u-l}];if(t.length>1){const p=await Promise.all(t.slice(1).map(_=>this.fetchSlice(_,e)));return g.concat(p)}return g}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await n.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:s}=t,r=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+s}`},signal:e});if(r.ok)if(r.status===206){const o=await r.getData(),{total:l}=p_(r.getHeader("content-range"));return this._fileSize=l||null,{data:o,offset:n,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await r.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Wf(i,{blockSize:t,cacheSize:e}){return t===null?i:new SW(i,{blockSize:t,cacheSize:e})}function RW(i,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:s=!1,...r}={}){const o=new wW(i,e),l=new Gf(o,t,n,s);return Wf(l,r)}function PW(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new AW(i),o=new Gf(r,t,e,n);return Wf(o,s)}function IW(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new CW(i),o=new Gf(r,t,e,n);return Wf(o,s)}function OW(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new Gf(i,t,e,n);return Wf(r,s)}function NW(i,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?RW(i,e):typeof XMLHttpRequest<"u"?PW(i,e):IW(i,e)}class DW extends Hf{constructor(t){super(),this.arrayBuffer=t}fetchSlice(t,e){if(e&&e.aborted)throw new zr("Request aborted");return this.arrayBuffer.slice(t.offset,t.offset+t.length)}}function LW(i){return new DW(i)}class kW extends Hf{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((n,s)=>{const r=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=l=>n(l.target.result),o.onerror=s,o.onabort=s,o.readAsArrayBuffer(r),e&&e.addEventListener("abort",()=>o.abort())})}}function BW(i){return new kW(i)}function __(i){switch(i){case Dt.BYTE:case Dt.ASCII:case Dt.SBYTE:case Dt.UNDEFINED:return 1;case Dt.SHORT:case Dt.SSHORT:return 2;case Dt.LONG:case Dt.SLONG:case Dt.FLOAT:case Dt.IFD:return 4;case Dt.RATIONAL:case Dt.SRATIONAL:case Dt.DOUBLE:case Dt.LONG8:case Dt.SLONG8:case Dt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${i}`)}}function UW(i){const t=i.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const s=HG[t[n]],r=t[n+1]?Ql[t[n+1]]:null,o=t[n+2],l=t[n+3];let u=null;if(!r)u=l;else{if(u=i[r],typeof u>"u"||u===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof u=="string"?u=u.substring(l,l+o-1):u.subarray&&(u=u.subarray(l,l+o),o===1&&(u=u[0]))}e[s]=u}return e}function Da(i,t,e,n){let s=null,r=null;const o=__(t);switch(t){case Dt.BYTE:case Dt.ASCII:case Dt.UNDEFINED:s=new Uint8Array(e),r=i.readUint8;break;case Dt.SBYTE:s=new Int8Array(e),r=i.readInt8;break;case Dt.SHORT:s=new Uint16Array(e),r=i.readUint16;break;case Dt.SSHORT:s=new Int16Array(e),r=i.readInt16;break;case Dt.LONG:case Dt.IFD:s=new Uint32Array(e),r=i.readUint32;break;case Dt.SLONG:s=new Int32Array(e),r=i.readInt32;break;case Dt.LONG8:case Dt.IFD8:s=new Array(e),r=i.readUint64;break;case Dt.SLONG8:s=new Array(e),r=i.readInt64;break;case Dt.RATIONAL:s=new Uint32Array(e*2),r=i.readUint32;break;case Dt.SRATIONAL:s=new Int32Array(e*2),r=i.readInt32;break;case Dt.FLOAT:s=new Float32Array(e),r=i.readFloat32;break;case Dt.DOUBLE:s=new Float64Array(e),r=i.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===Dt.RATIONAL||t===Dt.SRATIONAL)for(let l=0;l<e;l+=2)s[l]=r.call(i,n+l*o),s[l+1]=r.call(i,n+(l*o+4));else for(let l=0;l<e;++l)s[l]=r.call(i,n+l*o);return t===Dt.ASCII?new TextDecoder("utf-8").decode(s):s}class FW{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class Ph extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class zW{async readRasters(t={}){const{window:e,width:n,height:s}=t;let{resX:r,resY:o,bbox:l}=t;const u=await this.getImage();let f=u;const g=await this.getImageCount(),p=u.getBoundingBox();if(e&&l)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(e){const[b,x]=u.getOrigin(),[T,w]=u.getResolution();l=[b+e[0]*T,x+e[1]*w,b+e[2]*T,x+e[3]*w]}const v=l||p;if(n){if(r)throw new Error("Both width and resX passed");r=(v[2]-v[0])/n}if(s){if(o)throw new Error("Both width and resY passed");o=(v[3]-v[1])/s}}if(r||o){const v=[];for(let b=0;b<g;++b){const x=await this.getImage(b),{SubfileType:T,NewSubfileType:w}=x.fileDirectory;(b===0||T===2||w&1)&&v.push(x)}v.sort((b,x)=>b.getWidth()-x.getWidth());for(let b=0;b<v.length;++b){const x=v[b],T=(p[2]-p[0])/x.getWidth(),w=(p[3]-p[1])/x.getHeight();if(f=x,r&&r>T||o&&o>w)break}}let _=e;if(l){const[v,b]=u.getOrigin(),[x,T]=f.getResolution(u);_=[Math.round((l[0]-v)/x),Math.round((l[1]-b)/T),Math.round((l[2]-v)/x),Math.round((l[3]-b)/T)],_=[Math.min(_[0],_[2]),Math.min(_[1],_[3]),Math.max(_[0],_[2]),Math.max(_[1],_[3])]}return f.readRasters({...t,window:_})}}class xo extends zW{constructor(t,e,n,s,r={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=s,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new uW((await this.source.fetch([{offset:t,length:typeof e<"u"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(t);const r=this.bigTiff?s.readUint64(t):s.readUint16(t),o=r*e+(this.bigTiff?16:6);s.covers(t,o)||(s=await this.getSlice(t,o));const l={};let u=t+(this.bigTiff?8:2);for(let p=0;p<r;u+=e,++p){const _=s.readUint16(u),v=s.readUint16(u+2),b=this.bigTiff?s.readUint64(u+4):s.readUint32(u+4);let x,T;const w=__(v),M=u+(this.bigTiff?12:8);if(w*b<=(this.bigTiff?8:4))x=Da(s,v,b,M);else{const E=s.readOffset(M),P=__(v)*b;if(s.covers(E,P))x=Da(s,v,b,E);else{const k=await this.getSlice(E,P);x=Da(k,v,b,E)}}b===1&&VG.indexOf(_)===-1&&!(v===Dt.RATIONAL||v===Dt.SRATIONAL)?T=x[0]:T=x,l[Ql[_]]=T}const f=UW(l),g=s.readOffset(t+n+e*r);return new FW(l,f,g)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof Ph?new Ph(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new Ph(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new lW(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof Ph)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let s=await this.getSlice(t,n);if(e===Da(s,Dt.ASCII,e.length,t)){const o=Da(s,Dt.ASCII,n,t).split(`
`)[0],l=Number(o.split("=")[1].split(" ")[0])+o.length;l>n&&(s=await this.getSlice(t,l));const u=Da(s,Dt.ASCII,l,t);this.ghostValues={},u.split(`
`).filter(f=>f.length>0).map(f=>f.split("=")).forEach(([f,g])=>{this.ghostValues[f]=g})}return this.ghostValues}static async fromSource(t,e,n){const s=(await t.fetch([{offset:0,length:1024}],n))[0],r=new cW(s),o=r.getUint16(0,0);let l;if(o===18761)l=!0;else if(o===19789)l=!1;else throw new TypeError("Invalid byte order value.");const u=r.getUint16(2,l);let f;if(u===42)f=!1;else if(u===43){if(f=!0,r.getUint16(4,l)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const g=f?r.getUint64(8,l):r.getUint32(4,l);return new xo(t,l,f,g,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function GA(i,t={},e){return xo.fromSource(NW(i,t),e)}async function VW(i,t={},e){return xo.fromSource(OW(i,t),e)}async function jW(i,t){return xo.fromSource(LW(i),t)}async function HW(i,t){return xo.fromSource(BW(i),t)}let _0=null;function $W(){return _0===null&&(_0=new fW),_0}function GW(i){const{height:t,width:e}=i;if(i.length===t*e*4)return new ImageData(new Uint8ClampedArray(i),e,t);if(i.length===t*e*3){const n=i.length/3*4,s=new Uint8ClampedArray(n);for(let r=0;r<i.length/3;++r)s[r*4]=i[r*3],s[r*4+1]=i[r*3+1],s[r*4+2]=i[r*3+2],s[r*4+3]=255;return new ImageData(s,e,t)}else throw new Error(`Unexpected number of channels in raster data: ${i.length/(t*e)}`)}function WW(i){const t=i.length/3,e=new Uint8ClampedArray(t*4),n=0,s=t,r=t*2;for(let o=0;o<t;o++)e[4*o+0]=i[n+o]>>8,e[4*o+1]=i[s+o]>>8,e[4*o+2]=i[r+o]>>8,e[4*o+3]=255;return new ImageData(e,t,1)}async function qW(i){return typeof i=="string"?GA(i):i instanceof ArrayBuffer?jW(i):i instanceof Blob?HW(i):i instanceof $f?VW(i):i}function XW(i,t){const e=i.getBoundingBox(),[n,s,r,o]=e,l=[t.forward([n,s]),t.forward([r,s]),t.forward([r,o]),t.forward([n,o])],u=l.map(b=>b[0]),f=l.map(b=>b[1]),g=Math.min(...u),p=Math.min(...f),_=Math.max(...u),v=Math.max(...f);return{west:g,south:p,east:_,north:v}}function YW(i){if(!i)return null;const t=i?.[i?.length-1]==="\0"?i.slice(0,-1):i;return t?.length>0?parseFloat(t):null}const KW=`
  const vec3 D65 = vec3(
      0.95047, // Xn
      1.00000, // Yn
      1.08883 // Zn
  );

  vec3 cielabToRgb(vec3 labTex) {
    // labTex in [0,1] from RGB8 texture
    float L = labTex.r * 255.0;
    float a = (labTex.g - 0.5) * 255.0;
    float b = (labTex.b - 0.5) * 255.0;

    float y = (L + 16.0) / 116.0;
    float x = (a / 500.0) + y;
    float z = y - (b / 200.0);

    vec3 xyz;
    vec3 v = vec3(x, y, z);
    vec3 v3 = v * v * v;

    xyz = D65 * mix(
      (v - 16.0 / 116.0) / 7.787,
      v3,
      step(0.008856, v3)
    );

    vec3 rgb = mat3(
      3.2406, -1.5372, -0.4986,
      -0.9689, 1.8758, 0.0415,
      0.0557, -0.2040, 1.0570
    ) * xyz;

    // sRGB gamma
    rgb = mix(
      12.92 * rgb,
      1.055 * pow(rgb, vec3(1.0 / 2.4)) - 0.055,
      step(0.0031308, rgb)
    );

    return clamp(rgb, 0.0, 1.0);
  }
`,ZW={name:"cielab-to-rgb",inject:{"fs:#decl":KW,"fs:DECKGL_FILTER_COLOR":`
      color.rgb = cielabToRgb(color);
    `}},QW=`
  vec3 cmykToRgb(vec4 cmyk) {
    // cmyk in [0.0, 1.0]
    float invK = 1.0 - cmyk.a;

    return vec3(
        (1.0 - cmyk.r) * invK,
        (1.0 - cmyk.g) * invK,
        (1.0 - cmyk.b) * invK
    );
  }
`,JW={name:"cmyk-to-rgb",inject:{"fs:#decl":QW,"fs:DECKGL_FILTER_COLOR":`
      color.rgb = cmykToRgb(color);
    `}},tq=`
  vec3 ycbcrToRgb(vec3 ycbcr) {
    // ycbcr in [0.0, 1.0]
    float y = ycbcr.r;
    float cb = ycbcr.g - 0.5;
    float cr = ycbcr.b - 0.5;

    return vec3(
        y + 1.40200 * cr,
        y - 0.34414 * cb - 0.71414 * cr,
        y + 1.77200 * cb
    );
  }
`,eq={name:"ycbcr-to-rgb",inject:{"fs:#decl":tq,"fs:DECKGL_FILTER_COLOR":`
      color.rgb = ycbcrToRgb(color.rgb);
    `}},WA={name:"colormap",inject:{"fs:#decl":"uniform sampler2D colormapTexture;","fs:DECKGL_FILTER_COLOR":`
      color = texture(colormapTexture, vec2(color.r, 0.));
    `},getUniforms:i=>({colormapTexture:i.colormapTexture})},m_="nodata",iq=`uniform ${m_}Uniforms {
  float value;
} ${m_};
`,nq={name:m_,fs:iq,inject:{"fs:DECKGL_FILTER_COLOR":`
    if (color.r == nodata.value) {
      discard;
    }
    `},uniformTypes:{value:"f32"},getUniforms:i=>({value:i.value})};function sq(i,t,e){const n=rq(i),s=aq(t),r=oq(e),o=`${n}:${r}:${s}`,l=lq[o];if(!l)throw new Error(`Unsupported texture format for SamplesPerPixel=${i}, BitsPerSample=${t}, SampleFormat=${e}`);return l}function rq(i){if(i===1||i===2||i===3||i===4)return i;throw new Error(`Unsupported SamplesPerPixel ${i}. Only 1, 2, 3, or 4 are supported.`)}function aq(i){const t=i[0];for(let e=1;e<i.length;e++)if(i[e]!==t)throw new Error(`Unsupported varying BitsPerSample ${i}. All samples must have the same bit width.`);if(t!==8&&t!==16&&t!==32)throw new Error(`Unsupported BitsPerSample ${t}. Only 8, 16, or 32 are supported.`);return t}function oq(i){const t=i[0];for(let e=1;e<i.length;e++)if(i[e]!==t)throw new Error(`Unsupported varying SampleFormat ${i}. All samples must have the same format.`);switch(t){case 1:return"unorm";case 2:return"sint";case 3:return"float";default:throw new Error(`Unsupported SampleFormat ${i}`)}}const lq={"1:sint:8":"r8sint","1:uint:8":"r8uint","1:unorm:8":"r8unorm","1:float:16":"r16float","1:sint:16":"r16sint","1:uint:16":"r16uint","1:unorm:16":"r16unorm","2:sint:8":"rg8sint","2:uint:8":"rg8uint","2:unorm:8":"rg8unorm","1:float:32":"r32float","1:sint:32":"r32sint","1:uint:32":"r32uint","2:float:16":"rg16float","2:sint:16":"rg16sint","2:uint:16":"rg16uint","2:unorm:16":"rg16unorm","4:sint:8":"rgba8sint","4:uint:8":"rgba8uint","4:unorm:8":"rgba8unorm","3:uint:16":"rgb16unorm-webgl","2:float:32":"rg32float","2:sint:32":"rg32sint","2:uint:32":"rg32uint","4:float:16":"rgba16float","4:sint:16":"rgba16sint","4:uint:16":"rgba16uint","4:unorm:16":"rgba16unorm","3:float:32":"rgb32float-webgl","4:float:32":"rgba32float","4:sint:32":"rgba32sint","4:uint:32":"rgba32uint"};var Fs;(function(i){i[i.WhiteIsZero=0]="WhiteIsZero",i[i.BlackIsZero=1]="BlackIsZero",i[i.RGB=2]="RGB",i[i.Palette=3]="Palette",i[i.TransparencyMask=4]="TransparencyMask",i[i.CMYK=5]="CMYK",i[i.YCbCr=6]="YCbCr",i[i.CIELab=8]="CIELab",i[i.ICCLab=9]="ICCLab"})(Fs||(Fs={}));var XS;(function(i){i[i.Chunky=1]="Chunky",i[i.Planar=2]="Planar"})(XS||(XS={}));function cq(i,t){const{SampleFormat:e}=i;if(e[0]===1)return uq(i,t);throw new Error(`Inferring render pipeline for non-unsigned integers not yet supported. Found SampleFormat: ${e}`)}function uq(i,t){const{BitsPerSample:e,ColorMap:n,GDAL_NODATA:s,PhotometricInterpretation:r,SampleFormat:o,SamplesPerPixel:l}=i,u=[{module:Sc,props:{textureName:b=>b.texture}}],f=YW(s);if(f!==null){const b=f/255;u.push({module:nq,props:{value:b}})}const g=hq(r,t,n);g&&u.push(g);const p=r===Fs.Palette?{magFilter:"nearest",minFilter:"nearest"}:{magFilter:"linear",minFilter:"linear"};return{getTileData:async(b,x)=>{const{device:T}=x,w={...x,interleave:!0};let M=await b.readRasters(w),E=l;l===3&&(M=GW(M),E=4);const P=sq(E,e,o);return{texture:T.createTexture({data:M,format:P,width:M.width,height:M.height,sampler:p}),height:M.height,width:M.width}},renderTile:b=>u.map((x,T)=>fq(x,b))}}function hq(i,t,e){switch(i){case Fs.RGB:return null;case Fs.Palette:{if(!e)throw new Error("ColorMap is required for PhotometricInterpretation Palette");const{data:n,width:s,height:r}=WW(e),o=t.createTexture({data:n,format:"rgba8unorm",width:s,height:r,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}});return{module:WA,props:{colormapTexture:o}}}case Fs.CMYK:return{module:JW};case Fs.YCbCr:return{module:eq};case Fs.CIELab:return{module:ZW};default:throw new Error(`Unsupported PhotometricInterpretation ${i}`)}}function fq(i,t){const{module:e,props:n}=i;if(!n)return{module:e};const s={};for(const[r,o]of Object.entries(n)){const l=typeof o=="function"?o(t):o;l!==void 0&&(s[r]=l)}return{module:e,props:s}}async function dq(i){const t=i.ProjectedCSTypeGeoKey||i.GeographicTypeGeoKey||null,e=await gq(t);if(!e)return null;const n=pq(e);return{def:e,parsed:n,coordinatesUnits:n.units}}async function gq(i){if(i===null)return null;const t=`https://epsg.io/${i}.json`,e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch projection data from ${t}`);return await e.json()}function pq(i){const t="__deck.gl-geotiff-internal__";return Ks.defs(t,i),Ks.defs(t)}const _q={geoKeysParser:dq,debug:!1,debugOpacity:.5};class mq extends Zs{static layerName="COGLayer";static defaultProps=_q;initializeState(){this.setState({})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:s}=t;(s.dataChanged||e.geotiff!==n.geotiff)&&this._parseGeoTIFF()}async _parseGeoTIFF(){const t=await qW(this.props.geotiff),e=this.props.geoKeysParser,n=await aG(t,e),s=await t.getImage(),r=await t.getImageCount(),o=[];for(let v=0;v<r;v++)o.push(await t.getImage(v));const l=await e(s.getGeoKeys());if(!l)throw new Error("Could not determine source projection from GeoTIFF geo keys");const u=Ks(l.def,"EPSG:4326"),f=(v,b)=>u.forward([v,b],!1),g=(v,b)=>u.inverse([v,b],!1);if(this.props.onGeoTIFFLoad){const v=XW(s,u);this.props.onGeoTIFFLoad(t,{projection:l,geographicBounds:v})}const{getTileData:p,renderTile:_}=cq(s.fileDirectory,this.context.device);this.setState({metadata:n,forwardReproject:f,inverseReproject:g,images:o,defaultGetTileData:p,defaultRenderTile:_})}async _getTileData(t,e,n){const{signal:s}=t,{x:r,y:o,z:l}=t.index,u=e[e.length-1-l],f=u.getHeight(),g=u.getWidth(),p=n.tileMatrices[l],{tileWidth:_,tileHeight:v}=p,b=yq(r,o,p),{forwardTransform:x,inverseTransform:T}=sG(b),w=[r*_,o*v,Math.min((r+1)*_,g),Math.min((o+1)*v,f)],M=this.props.getTileData||this.state.defaultGetTileData,E=s&&this.props.signal?AbortSignal.any([s,this.props.signal]):s||this.props.signal;return{data:await M(u,{device:this.context.device,window:w,signal:E,pool:this.props.pool||$W()}),forwardTransform:x,inverseTransform:T}}_renderSubLayers(t,e,n,s){const{maxError:r,debug:o,debugOpacity:l}=this.props,{tile:u}=t;if(!t.data)return null;const{data:f,forwardTransform:g,inverseTransform:p}=t.data,_=[];if(f){const{height:v,width:b}=f,x=this.props.renderTile||this.state.defaultRenderTile;_.push(new U9({id:`${t.id}-raster`,width:b,height:v,renderPipeline:x(f),maxError:r,reprojectionFns:{forwardTransform:g,inverseTransform:p,forwardReproject:n,inverseReproject:s},debug:o,debugOpacity:l}))}if(o){const v=u?.projectedBounds;if(!v||!e)return[];const{topLeft:b,topRight:x,bottomLeft:T,bottomRight:w}=v,M=e.projectToWgs84(b),E=e.projectToWgs84(x),P=e.projectToWgs84(w),k=e.projectToWgs84(T),U=[M,E,P,k,M];_.push(new xc({id:`${this.id}-${u.id}-bounds`,data:[U],getPath:Y=>Y,getColor:[255,0,0,255],getWidth:2,widthUnits:"pixels",pickable:!1}))}return _}renderTileLayer(t,e,n,s){class r extends K9{constructor(l){super(t,l)}}return new zf({id:`cog-tile-layer-${this.id}`,TilesetClass:r,getTileData:async o=>this._getTileData(o,s,t),renderSubLayers:o=>this._renderSubLayers(o,t,e,n)})}renderLayers(){const{forwardReproject:t,inverseReproject:e,metadata:n,images:s}=this.state;return!t||!e||!n||!s?null:this.renderTileLayer(n,t,e,s)}}function yq(i,t,e){const{tileWidth:n,tileHeight:s}=e,r=i*n,o=t*s,[l,u,f,g,p,_]=e.geotransform,v=l*r+u*o+f,b=g*r+p*o+_;return[l,u,v,g,p,b]}class vq{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,e){let n=this.length++;for(;n>0;){const s=n-1>>1,r=this.values[s];if(e>=r)break;this.ids[n]=this.ids[s],this.values[n]=r,n=s}this.ids[n]=t,this.values[n]=e}pop(){if(this.length===0)return;const t=this.ids,e=this.values,n=t[0],s=--this.length;if(s>0){const r=t[s],o=e[s];let l=0;const u=s>>1;for(;l<u;){const f=(l<<1)+1,g=f+1,p=f+(+(g<s)&+(e[g]<e[f]));if(e[p]>=o)break;t[l]=t[p],e[l]=e[p],l=p}t[l]=r,e[l]=o}return n}peek(){return this.length>0?this.ids[0]:void 0}peekValue(){return this.length>0?this.values[0]:void 0}shrink(){this.ids.length=this.values.length=this.length}}const YS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m0=3;class Qm{static from(t,e=0){if(e%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[n,s]=new Uint8Array(t,e+0,2);if(n!==251)throw new Error("Data does not appear to be in a Flatbush format.");const r=s>>4;if(r!==m0)throw new Error(`Got v${r} data when expected v${m0}.`);const o=YS[s&15];if(!o)throw new Error("Unrecognized array type.");const[l]=new Uint16Array(t,e+2,1),[u]=new Uint32Array(t,e+4,1);return new Qm(u,l,o,void 0,t,e)}constructor(t,e=16,n=Float64Array,s=ArrayBuffer,r,o=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.byteOffset=o;let l=t,u=l;this._levelBounds=[l*4];do l=Math.ceil(l/this.nodeSize),u+=l,this._levelBounds.push(u*4);while(l!==1);this.ArrayType=n,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=YS.indexOf(n),g=u*4*n.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${n}.`);if(r)this.data=r,this._boxes=new n(r,o+8,u*4),this._indices=new this.IndexArrayType(r,o+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1];else{const p=this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT);this._boxes=new n(p,8,u*4),this._indices=new this.IndexArrayType(p,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(p,0,2).set([251,(m0<<4)+f]),new Uint16Array(p,2,1)[0]=e,new Uint32Array(p,4,1)[0]=t}this._queue=new vq}add(t,e,n=t,s=e){const r=this._pos>>2,o=this._boxes;return this._indices[r]=r,o[this._pos++]=t,o[this._pos++]=e,o[this._pos++]=n,o[this._pos++]=s,t<this.minX&&(this.minX=t),e<this.minY&&(this.minY=e),n>this.maxX&&(this.maxX=n),s>this.maxY&&(this.maxY=s),r}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,n=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),r=65535;for(let o=0,l=0;o<this.numItems;o++){const u=t[l++],f=t[l++],g=t[l++],p=t[l++],_=Math.floor(r*((u+g)/2-this.minX)/e),v=Math.floor(r*((f+p)/2-this.minY)/n);s[o]=xq(_,v)}y_(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let o=0,l=0;o<this._levelBounds.length-1;o++){const u=this._levelBounds[o];for(;l<u;){const f=l;let g=t[l++],p=t[l++],_=t[l++],v=t[l++];for(let b=1;b<this.nodeSize&&l<u;b++)g=Math.min(g,t[l++]),p=Math.min(p,t[l++]),_=Math.max(_,t[l++]),v=Math.max(v,t[l++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=p,t[this._pos++]=_,t[this._pos++]=v}}}search(t,e,n,s,r){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const l=[],u=[];for(;o!==void 0;){const f=Math.min(o+this.nodeSize*4,KS(o,this._levelBounds));for(let g=o;g<f;g+=4){const p=this._boxes[g];if(n<p)continue;const _=this._boxes[g+1];if(s<_)continue;const v=this._boxes[g+2];if(t>v)continue;const b=this._boxes[g+3];if(e>b)continue;const x=this._indices[g>>2]|0;o>=this.numItems*4?l.push(x):(r===void 0||r(x,p,_,v,b))&&u.push(x)}o=l.pop()}return u}neighbors(t,e,n=1/0,s=1/0,r){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const l=this._queue,u=[],f=s*s;t:for(;o!==void 0;){const g=Math.min(o+this.nodeSize*4,KS(o,this._levelBounds));for(let p=o;p<g;p+=4){const _=this._indices[p>>2]|0,v=this._boxes[p],b=this._boxes[p+1],x=this._boxes[p+2],T=this._boxes[p+3],w=t<v?v-t:t>x?t-x:0,M=e<b?b-e:e>T?e-T:0,E=w*w+M*M;E>f||(o>=this.numItems*4?l.push(_<<1,E):(r===void 0||r(_))&&l.push((_<<1)+1,E))}for(;l.length&&l.peek()&1;)if(l.peekValue()>f||(u.push(l.pop()>>1),u.length===n))break t;o=l.length?l.pop()>>1:void 0}return l.clear(),u}}function KS(i,t){let e=0,n=t.length-1;for(;e<n;){const s=e+n>>1;t[s]>i?n=s:e=s+1}return t[e]}function y_(i,t,e,n,s,r){if(Math.floor(n/r)>=Math.floor(s/r))return;const o=i[n],l=i[n+s>>1],u=i[s];let f=u;const g=Math.max(o,l);u>g?f=g:g===o?f=Math.max(l,u):g===l&&(f=Math.max(o,u));let p=n-1,_=s+1;for(;;){do p++;while(i[p]<f);do _--;while(i[_]>f);if(p>=_)break;bq(i,t,e,p,_)}y_(i,t,e,n,_,r),y_(i,t,e,_+1,s,r)}function bq(i,t,e,n,s){const r=i[n];i[n]=i[s],i[s]=r;const o=4*n,l=4*s,u=t[o],f=t[o+1],g=t[o+2],p=t[o+3];t[o]=t[l],t[o+1]=t[l+1],t[o+2]=t[l+2],t[o+3]=t[l+3],t[l]=u,t[l+1]=f,t[l+2]=g,t[l+3]=p;const _=e[n];e[n]=e[s],e[s]=_}function xq(i,t){let e=i^t,n=65535^e,s=65535^(i|t),r=i&(t^65535),o=e|n>>1,l=e>>1^e,u=s>>1^n&r>>1^s,f=e&s>>1^r>>1^r;e=o,n=l,s=u,r=f,o=e&e>>2^n&n>>2,l=e&n>>2^n&(e^n)>>2,u^=e&s>>2^n&r>>2,f^=n&s>>2^(e^n)&r>>2,e=o,n=l,s=u,r=f,o=e&e>>4^n&n>>4,l=e&n>>4^n&(e^n)>>4,u^=e&s>>4^n&r>>4,f^=n&s>>4^(e^n)&r>>4,e=o,n=l,s=u,r=f,u^=e&s>>8^n&r>>8,f^=n&s>>8^(e^n)&r>>8,e=u^u>>1,n=f^f>>1;let g=i^t,p=n|65535^(g|e);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,(p<<1|g)>>>0}class Sq extends Nm{sources;index;constructor(t,e){super(e),this.sources=t.map((s,r)=>({x:s.x===void 0?r:s.x,y:s.y===void 0?0:s.y,z:s.z===void 0?0:s.z,...s}));const n=new Qm(t.length);for(const s of t){const[r,o,l,u]=s.bbox;n.add(r,o,l,u)}n.finish(),this.index=n}getTileIndices({viewport:t,maxZoom:e,minZoom:n}){if(t.zoom<(n??-1/0))return[];if(t.zoom>(e??1/0))return[];const s=t.getBounds();return this.index.search(...s).map(o=>this.sources[o])}}const Tq={};class wq extends Zs{static layerName="MosaicLayer";static defaultProps=Tq;renderTileLayer(t,e){const{id:n,minZoom:s,maxZoom:r,extent:o,maxCacheByteSize:l,maxCacheSize:u,maxRequests:f}=this.props;class g extends Sq{constructor(_){super(t,_)}}return new zf({id:`mosaic-layer-${n}`,TilesetClass:g,minZoom:s,maxZoom:r,extent:o,...l!==void 0&&{maxCacheByteSize:l},maxCacheSize:u,maxRequests:f,getTileData:async p=>{const _=p.index,{signal:v}=p,b=this.props.getSource&&await this.props.getSource(_,{signal:v});return{source:_,data:b,signal:v}},renderSubLayers:p=>{const{data:_}=p,{source:v,signal:b,data:x}=_;return e(v,{data:x,signal:b})}})}renderLayers(){const{sources:t,renderSource:e}=this.props;return!t||t.length===0?null:this.renderTileLayer(t,e)}}const Eq=bt.createContext(null);function Aq(i,t){const e=Array.isArray(i)?i[0]:i?i.x:0,n=Array.isArray(i)?i[1]:i?i.y:0,s=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0;return e===s&&n===r}function vn(i,t){if(i===t)return!0;if(!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;e++)if(!vn(i[e],t[e]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const e=Object.keys(i),n=Object.keys(t);if(e.length!==n.length)return!1;for(const s of e)if(!t.hasOwnProperty(s)||!vn(i[s],t[s]))return!1;return!0}return!1}function ZS(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function QS(i,t){const e=t.viewState||t,n={};if("longitude"in e&&"latitude"in e&&(e.longitude!==i.center.lng||e.latitude!==i.center.lat)){const s=i.center.constructor;n.center=new s(e.longitude,e.latitude)}return"zoom"in e&&e.zoom!==i.zoom&&(n.zoom=e.zoom),"bearing"in e&&e.bearing!==i.bearing&&(n.bearing=e.bearing),"pitch"in e&&e.pitch!==i.pitch&&(n.pitch=e.pitch),e.padding&&i.padding&&!vn(e.padding,i.padding)&&(n.padding=e.padding),n}const Mq=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function JS(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;const t={};for(const n of i.layers)t[n.id]=n;const e=i.layers.map(n=>{let s=null;"interactive"in n&&(s=Object.assign({},n),delete s.interactive);const r=t[n.ref];if(r){s=s||Object.assign({},n),delete s.ref;for(const o of Mq)o in r&&(s[o]=r[o])}return s||n});return{...i,layers:e}}const tT={version:8,sources:{},layers:[]},eT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},iT={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},nT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Cq=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Rq=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class uo{constructor(t,e,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=s=>{const r=this.props[nT[s.type]];r?r(s):s.type==="error"&&console.error(s.error)},this._onCameraEvent=s=>{if(this._internalUpdate)return;s.viewState=this._propsedCameraUpdate||ZS(this._map.transform);const r=this.props[iT[s.type]];r&&r(s)},this._onCameraUpdate=s=>this._internalUpdate?s:(this._propsedCameraUpdate=ZS(s),QS(s,this.props)),this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const r=this.props[eT[s.type]];r&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),r(s),delete s.features)},this._MapClass=t,this.props=e,this._initialize(n)}get map(){return this._map}setProps(t){const e=this.props;this.props=t;const n=this._updateSettings(t,e),s=this._updateSize(t),r=this._updateViewState(t);this._updateStyle(t,e),this._updateStyleComponents(t),this._updateHandlers(t,e),(n||s||r&&!this._map.isMoving())&&this.redraw()}static reuse(t,e){const n=uo.savedMaps.pop();if(!n)return null;const s=n.map,r=s.getContainer();for(e.className=r.className;r.childNodes.length>0;)e.appendChild(r.childNodes[0]);s._container=e;const o=s._resizeObserver;o&&(o.disconnect(),o.observe(e)),n.setProps({...t,styleDiffing:!1}),s.resize();const{initialViewState:l}=t;return l&&(l.bounds?s.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):n._updateViewState(l)),s.isStyleLoaded()?s.fire("load"):s.once("style.load",()=>s.fire("load")),s._update(),n}_initialize(t){const{props:e}=this,{mapStyle:n=tT}=e,s={...e,...e.initialViewState,container:t,style:JS(n)},r=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),e.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,e.gl)}const o=new this._MapClass(s);r.padding&&o.setPadding(r.padding),e.cursor&&(o.getCanvas().style.cursor=e.cursor),o.transformCameraUpdate=this._onCameraUpdate,o.on("style.load",()=>{this._styleComponents={light:o.getLight(),sky:o.getSky(),projection:o.getProjection?.(),terrain:o.getTerrain()},this._updateStyleComponents(this.props)}),o.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in eT)o.on(l,this._onPointerEvent);for(const l in iT)o.on(l,this._onCameraEvent);for(const l in nT)o.on(l,this._onEvent);this._map=o}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),uo.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_updateSize(t){const{viewState:e}=t;if(e){const n=this._map;if(e.width!==n.transform.width||e.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(t){const e=this._map,n=e.transform;if(!e.isMoving()){const r=QS(n,t);if(Object.keys(r).length>0)return this._internalUpdate=!0,e.jumpTo(r),this._internalUpdate=!1,!0}return!1}_updateSettings(t,e){const n=this._map;let s=!1;for(const r of Cq)r in t&&!vn(t[r],e[r])&&(s=!0,n[`set${r[0].toUpperCase()}${r.slice(1)}`]?.call(n,t[r]));return s}_updateStyle(t,e){if(t.cursor!==e.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==e.mapStyle){const{mapStyle:n=tT,styleDiffing:s=!0}=t,r={diff:s};"localIdeographFontFamily"in t&&(r.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(JS(n),r)}}_updateStyleComponents({light:t,projection:e,sky:n,terrain:s}){const r=this._map,o=this._styleComponents;r.style._loaded&&(t&&!vn(t,o.light)&&(o.light=t,r.setLight(t)),e&&!vn(e,o.projection)&&e!==o.projection?.type&&(o.projection=typeof e=="string"?{type:e}:e,r.setProjection?.(o.projection)),n&&!vn(n,o.sky)&&(o.sky=n,r.setSky(n)),s!==void 0&&!vn(s,o.terrain)&&(!s||r.getSource(s.source))&&(o.terrain=s,r.setTerrain(s)))}_updateHandlers(t,e){const n=this._map;for(const s of Rq){const r=t[s]??!0,o=e[s]??!0;vn(r,o)||(r?n[s].enable(r):n[s].disable())}}_queryRenderedFeatures(t){const e=this._map,{interactiveLayerIds:n=[]}=this.props;try{return e.queryRenderedFeatures(t,{layers:n.filter(e.getLayer.bind(e))})}catch{return[]}}_updateHover(t){const{props:e}=this;if(e.interactiveLayerIds&&(e.onMouseMove||e.onMouseEnter||e.onMouseLeave)){const s=t.type,r=this._hoveredFeatures?.length>0,o=this._queryRenderedFeatures(t.point),l=o.length>0;!l&&r&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=o,l&&!r&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=s}else this._hoveredFeatures=null}}uo.savedMaps=[];const Pq=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Iq(i){if(!i)return null;const t=i.map,e={getMap:()=>t};for(const n of Oq(t))!(n in e)&&!Pq.includes(n)&&(e[n]=t[n].bind(t));return e}function Oq(i){const t=new Set;let e=i;for(;e;){for(const n of Object.getOwnPropertyNames(e))n[0]!=="_"&&typeof i[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&t.add(n);e=Object.getPrototypeOf(e)}return Array.from(t)}const Nq=typeof document<"u"?bt.useLayoutEffect:bt.useEffect;function Dq(i,t){const{RTLTextPlugin:e,maxParallelImageRequests:n,workerCount:s,workerUrl:r}=t;if(e&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:o,lazy:l=!0}=typeof e=="string"?{pluginUrl:e}:e;i.setRTLTextPlugin(o,u=>{u&&console.error(u)},l)}n!==void 0&&i.setMaxParallelImageRequests(n),s!==void 0&&i.setWorkerCount(s),r!==void 0&&i.setWorkerUrl(r)}const qf=bt.createContext(null);function Lq(i,t){const e=bt.useContext(Eq),[n,s]=bt.useState(null),r=bt.useRef(),{current:o}=bt.useRef({mapLib:null,map:null});bt.useEffect(()=>{const f=i.mapLib;let g=!0,p;return Promise.resolve(f||sn(()=>import("./maplibre-gl-BJCIKgFk.js").then(_=>_.m),[])).then(_=>{if(!g)return;if(!_)throw new Error("Invalid mapLib");const v="Map"in _?_:_.default;if(!v.Map)throw new Error("Invalid mapLib");Dq(v,i),i.reuseMaps&&(p=uo.reuse(i,r.current)),p||(p=new uo(v.Map,i,r.current)),o.map=Iq(p),o.mapLib=v,s(p),e?.onMapMount(o.map,i.id)}).catch(_=>{const{onError:v}=i;v?v({type:"error",target:null,originalEvent:null,error:_}):console.error(_)}),()=>{g=!1,p&&(e?.onMapUnmount(i.id),i.reuseMaps?p.recycle():p.destroy())}},[]),Nq(()=>{n&&n.setProps(i)}),bt.useImperativeHandle(t,()=>o.map,[n]);const l=bt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]),u={height:"100%"};return bt.createElement("div",{id:i.id,ref:r,style:l},n&&bt.createElement(qf.Provider,{value:o},bt.createElement("div",{"mapboxgl-children":"",style:u},i.children)))}const kq=bt.forwardRef(Lq);var qA=rT();const Bq=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function os(i,t){if(!i||!t)return;const e=i.style;for(const n in t){const s=t[n];Number.isFinite(s)&&!Bq.test(n)?e[n]=`${s}px`:e[n]=s}}function XA(i,t){if(i===t)return null;const e=sT(i),n=sT(t),s=[];for(const r of n)e.has(r)||s.push(r);for(const r of e)n.has(r)||s.push(r);return s.length===0?null:s}function sT(i){return new Set(i?i.trim().split(/\s+/):[])}bt.memo(bt.forwardRef((i,t)=>{const{map:e,mapLib:n}=bt.useContext(qf),s=bt.useRef({props:i}),r=bt.useMemo(()=>{let w=!1;bt.Children.forEach(i.children,P=>{P&&(w=!0)});const M={...i,element:w?document.createElement("div"):void 0},E=new n.Marker(M);return E.setLngLat([i.longitude,i.latitude]),E.getElement().addEventListener("click",P=>{s.current.props.onClick?.({type:"click",target:E,originalEvent:P})}),E.on("dragstart",P=>{const k=P;k.lngLat=r.getLngLat(),s.current.props.onDragStart?.(k)}),E.on("drag",P=>{const k=P;k.lngLat=r.getLngLat(),s.current.props.onDrag?.(k)}),E.on("dragend",P=>{const k=P;k.lngLat=r.getLngLat(),s.current.props.onDragEnd?.(k)}),E},[]);bt.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]);const{longitude:o,latitude:l,offset:u,style:f,draggable:g=!1,popup:p=null,rotation:_=0,rotationAlignment:v="auto",pitchAlignment:b="auto"}=i;bt.useEffect(()=>{os(r.getElement(),f)},[f]),bt.useImperativeHandle(t,()=>r,[]);const x=s.current.props;(r.getLngLat().lng!==o||r.getLngLat().lat!==l)&&r.setLngLat([o,l]),u&&!Aq(r.getOffset(),u)&&r.setOffset(u),r.isDraggable()!==g&&r.setDraggable(g),r.getRotation()!==_&&r.setRotation(_),r.getRotationAlignment()!==v&&r.setRotationAlignment(v),r.getPitchAlignment()!==b&&r.setPitchAlignment(b),r.getPopup()!==p&&r.setPopup(p);const T=XA(x.className,i.className);if(T)for(const w of T)r.toggleClassName(w);return s.current.props=i,qA.createPortal(i.children,r.getElement())}));bt.memo(bt.forwardRef((i,t)=>{const{map:e,mapLib:n}=bt.useContext(qf),s=bt.useMemo(()=>document.createElement("div"),[]),r=bt.useRef({props:i}),o=bt.useMemo(()=>{const l={...i},u=new n.Popup(l);return u.setLngLat([i.longitude,i.latitude]),u.once("open",f=>{r.current.props.onOpen?.(f)}),u},[]);if(bt.useEffect(()=>{const l=u=>{r.current.props.onClose?.(u)};return o.on("close",l),o.setDOMContent(s).addTo(e.getMap()),()=>{o.off("close",l),o.isOpen()&&o.remove()}},[]),bt.useEffect(()=>{os(o.getElement(),i.style)},[i.style]),bt.useImperativeHandle(t,()=>o,[]),o.isOpen()){const l=r.current.props;(o.getLngLat().lng!==i.longitude||o.getLngLat().lat!==i.latitude)&&o.setLngLat([i.longitude,i.latitude]),i.offset&&!vn(l.offset,i.offset)&&o.setOffset(i.offset),(l.anchor!==i.anchor||l.maxWidth!==i.maxWidth)&&(o.options.anchor=i.anchor,o.setMaxWidth(i.maxWidth));const u=XA(l.className,i.className);if(u)for(const f of u)o.toggleClassName(f);r.current.props=i}return qA.createPortal(i.children,s)}));function tr(i,t,e,n){const s=bt.useContext(qf),r=bt.useMemo(()=>i(s),[]);return bt.useEffect(()=>{const o=t,l=null,u=typeof t=="function"?t:null,{map:f}=s;return f.hasControl(r)||(f.addControl(r,o?.position),l&&l(s)),()=>{u&&u(s),f.hasControl(r)&&f.removeControl(r)}},[]),r}function Uq(i){const t=tr(({mapLib:e})=>new e.AttributionControl(i),{position:i.position});return bt.useEffect(()=>{os(t._container,i.style)},[i.style]),null}bt.memo(Uq);function Fq(i){const t=tr(({mapLib:e})=>new e.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return bt.useEffect(()=>{os(t._controlContainer,i.style)},[i.style]),null}bt.memo(Fq);function zq(i,t){const e=bt.useRef({props:i}),n=tr(({mapLib:s})=>{const r=new s.GeolocateControl(i),o=r._setupUI;return r._setupUI=()=>{r._container.hasChildNodes()||o()},r.on("geolocate",l=>{e.current.props.onGeolocate?.(l)}),r.on("error",l=>{e.current.props.onError?.(l)}),r.on("outofmaxbounds",l=>{e.current.props.onOutOfMaxBounds?.(l)}),r.on("trackuserlocationstart",l=>{e.current.props.onTrackUserLocationStart?.(l)}),r.on("trackuserlocationend",l=>{e.current.props.onTrackUserLocationEnd?.(l)}),r},{position:i.position});return e.current.props=i,bt.useImperativeHandle(t,()=>n,[]),bt.useEffect(()=>{os(n._container,i.style)},[i.style]),null}bt.memo(bt.forwardRef(zq));function Vq(i){const t=tr(({mapLib:e})=>new e.NavigationControl(i),{position:i.position});return bt.useEffect(()=>{os(t._container,i.style)},[i.style]),null}bt.memo(Vq);function jq(i){const t=tr(({mapLib:r})=>new r.ScaleControl(i),{position:i.position}),e=bt.useRef(i),n=e.current;e.current=i;const{style:s}=i;return i.maxWidth!==void 0&&i.maxWidth!==n.maxWidth&&(t.options.maxWidth=i.maxWidth),i.unit!==void 0&&i.unit!==n.unit&&t.setUnit(i.unit),bt.useEffect(()=>{os(t._container,s)},[s]),null}bt.memo(jq);function Hq(i){const t=tr(({mapLib:e})=>new e.TerrainControl(i),{position:i.position});return bt.useEffect(()=>{os(t._container,i.style)},[i.style]),null}bt.memo(Hq);function $q(i){const t=tr(({mapLib:e})=>new e.LogoControl(i),{position:i.position});return bt.useEffect(()=>{os(t._container,i.style)},[i.style]),null}bt.memo($q);const Gq=i=>`+proj=utm +zone=${i} +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs`;for(let i=10;i<=20;i++)Ks.defs(`EPSG:269${i}`,Gq(i));const Wq=new Uint8ClampedArray([255,255,255,255,250,250,250,255,246,246,246,255,242,242,242,255,238,238,238,255,233,233,233,255,229,229,229,255,225,225,225,255,221,221,221,255,216,216,216,255,212,212,212,255,208,208,208,255,204,204,204,255,200,200,200,255,195,195,195,255,191,191,191,255,187,187,187,255,183,183,183,255,178,178,178,255,174,174,174,255,170,170,170,255,166,166,166,255,161,161,161,255,157,157,157,255,153,153,153,255,149,149,149,255,145,145,145,255,140,140,140,255,136,136,136,255,132,132,132,255,128,128,128,255,123,123,123,255,119,119,119,255,115,115,115,255,111,111,111,255,106,106,106,255,102,102,102,255,98,98,98,255,94,94,94,255,90,90,90,255,85,85,85,255,81,81,81,255,77,77,77,255,73,73,73,255,68,68,68,255,64,64,64,255,60,60,60,255,56,56,56,255,52,52,52,255,56,56,56,255,60,60,60,255,64,64,64,255,68,68,68,255,73,73,73,255,77,77,77,255,81,81,81,255,85,85,85,255,90,90,90,255,94,94,94,255,98,98,98,255,102,102,102,255,106,106,106,255,111,111,111,255,115,115,115,255,119,119,119,255,123,123,123,255,128,128,128,255,132,132,132,255,136,136,136,255,140,140,140,255,145,145,145,255,149,149,149,255,153,153,153,255,157,157,157,255,161,161,161,255,166,166,166,255,170,170,170,255,174,174,174,255,178,178,178,255,183,183,183,255,187,187,187,255,191,191,191,255,195,195,195,255,200,200,200,255,204,204,204,255,208,208,208,255,212,212,212,255,216,216,216,255,221,221,221,255,225,225,225,255,229,229,229,255,233,233,233,255,238,238,238,255,242,242,242,255,246,246,246,255,250,250,250,255,255,255,255,255,250,250,250,255,245,245,245,255,240,240,240,255,235,235,235,255,230,230,230,255,225,225,225,255,220,220,220,255,215,215,215,255,210,210,210,255,205,205,205,255,200,200,200,255,195,195,195,255,190,190,190,255,185,185,185,255,180,180,180,255,175,175,175,255,170,170,170,255,165,165,165,255,160,160,160,255,155,155,155,255,151,151,151,255,146,146,146,255,141,141,141,255,136,136,136,255,131,131,131,255,126,126,126,255,121,121,121,255,116,116,116,255,111,111,111,255,106,106,106,255,101,101,101,255,96,96,96,255,91,91,91,255,86,86,86,255,81,81,81,255,76,76,76,255,71,71,71,255,66,66,66,255,61,61,61,255,56,56,56,255,66,66,80,255,77,77,105,255,87,87,130,255,98,98,155,255,108,108,180,255,119,119,205,255,129,129,230,255,140,140,255,255,131,147,239,255,122,154,223,255,113,161,207,255,105,168,191,255,96,175,175,255,87,183,159,255,78,190,143,255,70,197,127,255,61,204,111,255,52,211,95,255,43,219,79,255,35,226,63,255,26,233,47,255,17,240,31,255,8,247,15,255,1,255,1,255,7,255,1,255,15,255,1,255,23,255,1,255,31,255,1,255,39,255,1,255,47,255,1,255,55,255,1,255,63,255,1,255,71,255,1,255,79,255,1,255,87,255,1,255,95,255,1,255,103,255,1,255,111,255,1,255,119,255,1,255,127,255,1,255,135,255,1,255,143,255,1,255,151,255,1,255,159,255,1,255,167,255,1,255,175,255,1,255,183,255,1,255,191,255,1,255,199,255,1,255,207,255,1,255,215,255,1,255,223,255,1,255,231,255,1,255,239,255,1,255,247,255,1,255,255,255,1,255,255,249,1,255,255,244,1,255,255,239,1,255,255,233,1,255,255,228,1,255,255,223,1,255,255,217,1,255,255,212,1,255,255,207,1,255,255,201,1,255,255,196,1,255,255,191,1,255,255,185,1,255,255,180,1,255,255,175,1,255,255,170,1,255,255,164,1,255,255,159,1,255,255,154,1,255,255,148,1,255,255,143,1,255,255,138,1,255,255,132,1,255,255,127,1,255,255,122,1,255,255,116,1,255,255,111,1,255,255,106,1,255,255,100,1,255,255,95,1,255,255,90,1,255,255,85,1,255,255,79,1,255,255,74,1,255,255,69,1,255,255,63,1,255,255,58,1,255,255,53,1,255,255,47,1,255,255,42,1,255,255,37,1,255,255,31,1,255,255,26,1,255,255,21,1,255,255,15,1,255,255,10,1,255,255,5,1,255,255,1,1,255,255,1,15,255,255,1,31,255,255,1,47,255,255,1,63,255,255,1,79,255,255,1,95,255,255,1,111,255,255,1,127,255,255,1,143,255,255,1,159,255,255,1,175,255,255,1,191,255,255,1,207,255,255,1,223,255,255,1,239,255]),y0=new ImageData(Wq,256,1),wl=[-106.6059,38.7455,-104.5917,40.4223];function qq(i){return tr(()=>new e7(i)).setProps(i),null}async function Xq(i){const t=i.ProjectedCSTypeGeoKey||i.GeographicTypeGeoKey||null;if(t===null)throw new Error("No projection code found in geoKeys");const e=`EPSG:${t}`,n=Ks.defs(e);return{def:e,parsed:n,coordinatesUnits:n.units}}async function Yq(i,t){const{device:e}=t,n={...t,interleave:!0},s=await i.readRasters(n);return{texture:e.createTexture({data:s,format:"rgba8unorm",width:s.width,height:s.height}),height:s.height,width:s.width}}const Jm={name:"set-alpha-1",inject:{"fs:DECKGL_FILTER_COLOR":`
      color = vec4(color.rgb, 1.0);
    `}},Kq={name:"set-false-color-infrared",inject:{"fs:DECKGL_FILTER_COLOR":`
      float nir = color[3];
      float red = color[0];
      float green = color[1];
      color.rgb = vec3(nir, red, green);
    `}},Zq={name:"ndvi",inject:{"fs:DECKGL_FILTER_COLOR":`
      float nir = color[3];
      float red = color[0];
      float ndvi = (nir - red) / (nir + red);
      // normalize to 0-1 range
      color.r = (ndvi + 1.0) / 2.0;
    `}};function Qq(i){const{texture:t}=i;return[{module:Sc,props:{textureName:t}},{module:Jm}]}function Jq(i){const{texture:t}=i;return[{module:Sc,props:{textureName:t}},{module:Kq},{module:Jm}]}function tX(i,t){const{texture:e}=i;return[{module:Sc,props:{textureName:e}},{module:Zq},{module:WA,props:{colormapTexture:t}},{module:Jm}]}const eX=[{value:"trueColor",label:"True Color"},{value:"falseColor",label:"False Color Infrared"},{value:"ndvi",label:"NDVI"}];function iX(){const i=bt.useRef(null),[t,e]=bt.useState([]),[n,s]=bt.useState(!0),[r,o]=bt.useState(null),[l,u]=bt.useState("trueColor"),[f,g]=bt.useState([-1,1]),[p,_]=bt.useState(null),[v,b]=bt.useState(null);bt.useEffect(()=>{async function T(){try{const w={collections:"naip",bbox:wl.join(","),filter:JSON.stringify({op:"=",args:[{property:"naip:state"},"co"]}),"filter-lang":"cql2-json",datetime:"2023-01-01T00:00:00Z/2023-12-31T23:59:59Z",limit:"1000"},E=`https://planetarycomputer.microsoft.com/api/stac/v1/search?${new URLSearchParams(w).toString()}`,P=await fetch(E);if(!P.ok)throw new Error(`STAC API error: ${P.statusText}`);const k=await P.json();window.data=k,e(k.features)}catch(w){console.error("Error fetching STAC items:",w),o(w instanceof Error?w.message:"Failed to fetch STAC items")}finally{s(!1)}}T()},[]),bt.useEffect(()=>{if(!p)return;const T=p.createTexture({data:y0.data,width:y0.width,height:y0.height,format:"rgba8unorm",sampler:{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}});b(T)},[p]);const x=[];if(t.length>0&&v){const T=new wq({id:"naip-mosaic-layer",sources:t,getSource:async(w,{signal:M})=>{const E=w.assets.image.href;return await GA(E,{},M)},renderSource:(w,{data:M,signal:E})=>{const P=w.assets.image.href;return new mq({id:`cog-${P}`,geotiff:M,geoKeysParser:Xq,getTileData:Yq,renderTile:l==="trueColor"?Qq:l==="falseColor"?Jq:k=>tX(k,v),signal:E})},maxCacheSize:1/0,beforeId:"tunnel_service_case"});x.push(T)}return Me.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Me.jsx(kq,{ref:i,initialViewState:{longitude:-104.9903,latitude:39.7392,zoom:10,pitch:0,bearing:0},maxBounds:[[wl[0]-1,wl[1]-1],[wl[2]+1,wl[3]+1]],minZoom:4,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",children:Me.jsx(qq,{layers:x,interleaved:!0,onDeviceInitialized:_,deviceProps:{_cacheShaders:!0,_cachePipelines:!0}})}),Me.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Me.jsxs("div",{style:{position:"absolute",top:"20px",left:"20px",background:"white",padding:"16px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",maxWidth:"300px",pointerEvents:"auto"},children:[Me.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"NAIP Mosaic"}),Me.jsxs("p",{style:{margin:"0 0 12px 0",fontSize:"14px",color:"#666"},children:[n&&"Loading STAC items... ",r&&`Error: ${r}`,!n&&!r&&`Fetched ${t.length} `,Me.jsx("a",{href:"https://stacspec.org/en",target:"_blank",rel:"noopener noreferrer",children:"STAC"})," Items ","from"," ",Me.jsx("a",{href:"https://planetarycomputer.microsoft.com",target:"_blank",rel:"noopener noreferrer",children:"Microsoft Planetary Computer"}),"'s"," ",Me.jsx("a",{href:"https://planetarycomputer.microsoft.com/dataset/naip",target:"_blank",rel:"noopener noreferrer",children:"NAIP dataset"}),".",Me.jsx("br",{}),Me.jsx("br",{}),"All imagery is rendered client-side with ",Me.jsx("b",{children:"no server involved"})," ","using"," ",Me.jsx("a",{href:"https://github.com/developmentseed/deck.gl-raster",target:"_blank",rel:"noopener noreferrer",style:{fontFamily:"monospace"},children:"@developmentseed/deck.gl-raster"}),"."]}),Me.jsxs("div",{children:[Me.jsx("label",{htmlFor:"render-mode",style:{fontSize:"14px",fontWeight:500},children:"Render Mode"}),Me.jsx("select",{id:"render-mode",value:l,onChange:T=>u(T.target.value),style:{width:"100%",padding:"8px",fontSize:"14px",borderRadius:"4px",border:"1px solid #ccc"},children:eX.map(T=>Me.jsx("option",{value:T.value,children:T.label},T.value))})]}),!1]})})]})}AC.createRoot(document.getElementById("root")).render(Me.jsx(bt.StrictMode,{children:Me.jsx(iX,{})}));export{cX as L,uX as a,v_ as g};
